const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./i3s-DqZ34uA9-DKJpATIb.js","./_commonjsHelpers-BITg13Vk-KnjfkSck.js","./projection-m8vi7Cxv-2MLqE_Rd.js","./index-Cd7FS_80.js","./index-CpSsk29H.css","./projectMeshVertexPositions-CwAnO79z-QsduNpl1.js","./MeshLocalVertexSpace-DFCiKNRA-DhUD1trh.js","./vertexSpaceConversion-uj5jLCX_-BfZcrobF.js","./mat3-DOnW3DjW-C3hbW9XY.js","./common-CYWrYyJl-E8-sukrT.js","./mat3f64-Dh9_zhFu-BIT-k8Dm.js","./mat4-BFStKTjU-BuOOeQ4W.js","./mat4f64-BaJwL7tQ-k0uMm8LY.js","./vec32-BuqRmYBM-9L9gW8uY.js","./spatialReferenceEllipsoidUtils-DlQOpWof-CYP9jFMl.js","./computeTranslationToOriginAndRotation-DwwrTl3S-DctgvKcO.js","./projectPointToVector-CG1hALQu-B6_Kv_nW.js","./meshVertexSpaceUtils-BwEbYR8F-BgXtAvGE.js","./vec3-CRJiMrND-BggcTu9m.js","./BufferView-BBCzkcZS-D9Nqxqnz.js","./vec2-BnynUbeJ-CKtGJQAy.js","./vec42-D8CJyqHG-DnfLTeQH.js","./vec4-DcTMp5mq-BykpEXfP.js"])))=>i.map(i=>d[i]);
import{cX as P,bD as te,b as re,jE as oe,jF as ne,T as k,_ as R,iR as ie,b4 as se}from"./index-Cd7FS_80.js";import{y as ae,d as fe}from"./MeshLocalVertexSpace-DFCiKNRA-DhUD1trh.js";import{z as le,T as ce}from"./vec3-CRJiMrND-BggcTu9m.js";import"./workers-0oosFQiO-9RO2-I6m.js";import"./projection-m8vi7Cxv-2MLqE_Rd.js";import"./projectVectorToVector-D0K_S4MR-B0_8rFc5.js";import"./vec4f64-CjUMzAyX-DPYbdAom.js";import"./sphere-Cj20syUS-B5gIJGqD.js";import"./mat4-BFStKTjU-BuOOeQ4W.js";import"./mat4f64-BaJwL7tQ-k0uMm8LY.js";import"./vec32-BuqRmYBM-9L9gW8uY.js";import"./Query-CxQYWcUQ-C5jNzBBu.js";import{G as ue}from"./I3SBinaryReader-CyBOtojY-DfCMtSqp.js";import{f as me}from"./edgeUtils-CjV7X0G9-BL8guWmU.js";import"./NormalAttribute.glsl-C9zbIKka-rRz2tqn0.js";import{i as de}from"./orientedBoundingBox-CTsjUkMw-BORBfQcP.js";import"./Queue-B8H6jIv7-CjHlhDYg.js";import"./intl-DLmy-Li5-QIMhWnKT.js";import"./projectPointToVector-CG1hALQu-B6_Kv_nW.js";import"./vec42-D8CJyqHG-DnfLTeQH.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./mat3-DOnW3DjW-C3hbW9XY.js";import"./mat3f64-Dh9_zhFu-BIT-k8Dm.js";import"./plane-B_adY3_o-0JtaREXu.js";import"./quatf64-C16JxGFv-BKWK1F8U.js";import"./vec2f64-CEUyUoff-BBc0aQ6D.js";import"./Field-Cj6Pz3TI-BfIhW_SD.js";import"./fieldType-VTpxE-EM-aUbd3L0g.js";import"./TimeExtent-gZaEUVeW-BAhRnc81.js";import"./VertexAttribute-DFC3a3eR-BhmQtMsu.js";import"./floatRGBA-YJlz5IlR-DJlmEx2c.js";import"./glsl-o28TenZV-B0eZUNn3.js";import"./ShaderOutput-C_OqLoo1-jp3zUBgm.js";import"./BindType-CKbZk6AG-Bqvzo9NX.js";import"./quat-D8L_R4I0-BDM_a6sU.js";import"./spatialReferenceEllipsoidUtils-DlQOpWof-CYP9jFMl.js";import"./computeTranslationToOriginAndRotation-DwwrTl3S-DctgvKcO.js";import"./ViewingMode-CyR_b1T8-_s7_Gbsk.js";P();var B;async function bt(e,t,r,s,n,l,a,f){const u=[];for(const m of t)if(m&&n.includes(m.name)){const d=`${e}/nodes/${r}/attributes/${m.key}/0`;u.push({url:d,storageInfo:m})}const h=await Promise.allSettled(u.map(m=>re(m.url,{responseType:"array-buffer",query:{...a,token:l},signal:f==null?void 0:f.signal}).then(d=>ue(m.storageInfo,d.data)))),b=[];for(const m of s){const d={};for(let y=0;y<h.length;y++){const E=h[y];if(E.status==="fulfilled"){const c=E.value;d[u[y].storageInfo.name]=ye(c,m)}}b.push(d)}return b}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(B||(B={}));const pe=-32768,he=-2147483648;function ye(e,t){if(!e)return null;const r=e[t];return oe(e)?r===pe?null:r:ne(e)?r===he?null:r:r!=r?null:r}me({color:[0,0,0,0],opacity:0}),P(),P(),new de,new Array(72);var A,$;(function(e){e[e.None=0]="None",e[e.Int16=1]="Int16",e[e.Int32=2]="Int32"})(A||(A={})),function(e){e[e.Replace=0]="Replace",e[e.Outside=1]="Outside",e[e.Inside=2]="Inside",e[e.Finished=3]="Finished"}($||($={}));function be(){return O||(O=new Promise(e=>R(()=>import("./i3s-DqZ34uA9-DKJpATIb.js"),__vite__mapDeps([0,1]),import.meta.url).then(t=>t.i).then(({default:t})=>{const r=t({locateFile:Ee,onRuntimeInitialized:()=>e(r)});delete r.then})).catch(e=>{throw e})),O}function Ee(e){return se(`esri/libs/i3s/${e}`)}let O;class ge{constructor(t,r,s,n,l,a){this.layout=t,this.interleavedVertexData=r,this.indices=s,this.hasColors=n,this.hasModifications=l,this.positionData=a}}let _e=class{constructor(e,t,r,s,n,l,a){this.componentOffsets=e,this.featureIds=t,this.anchorIds=r,this.anchors=s,this.transformedGeometry=n,this.globalTrafo=l,this.obb=a}};new te({deallocator:null});var H,I,z,Y,G;(function(e){e[e.Unmodified=0]="Unmodified",e[e.Culled=1]="Culled",e[e.NotChecked=2]="NotChecked"})(H||(H={})),function(e){e[e.Unmodified=0]="Unmodified",e[e.PotentiallyModified=1]="PotentiallyModified",e[e.Culled=2]="Culled",e[e.Unknown=3]="Unknown",e[e.NotChecked=4]="NotChecked"}(I||(I={})),function(e){e[e.Unknown=0]="Unknown",e[e.Uncached=1]="Uncached",e[e.Cached=2]="Cached"}(z||(z={})),function(e){e[e.None=0]="None",e[e.MaxScreenThreshold=1]="MaxScreenThreshold",e[e.ScreenSpaceRelative=2]="ScreenSpaceRelative",e[e.RemovedFeatureDiameter=3]="RemovedFeatureDiameter",e[e.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"}(Y||(Y={})),function(e){e[e.Hole=0]="Hole",e[e.Leaf=1]="Leaf"}(G||(G={}));async function we(e){o=await T();const t=[e.geometryBuffer];return{result:q(o,e,t),transferList:t}}async function Se(e){var h;o=await T();const t=[e.geometryBuffer],{geometryBuffer:r}=e,s=r.byteLength,n=o._malloc(s),l=new Uint8Array(o.HEAPU8.buffer,n,s);l.set(new Uint8Array(r));const a=o.dracoDecompressPointCloudData(n,l.byteLength);if(o._free(n),a.error.length>0)throw new Error(`i3s.wasm: ${a.error}`);const f=((h=a.featureIds)==null?void 0:h.length)>0?a.featureIds.slice():null,u=a.positions.slice();return f&&t.push(f.buffer),t.push(u.buffer),{result:{positions:u,featureIds:f},transferList:t}}async function Ie(e){await T(),X(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function Te(e){await T(),J(e)}async function Ne(e){o=await T(),o.setLegacySchema(e.context,e.jsonSchema)}async function Re(e){const{localMatrix:t,origin:r,positions:s,vertexSpace:n}=e,l=k.fromJSON(e.inSpatialReference),a=k.fromJSON(e.outSpatialReference);let f;const[{projectBuffer:u},{initializeProjection:h}]=await Promise.all([R(()=>import("./projection-m8vi7Cxv-2MLqE_Rd.js"),__vite__mapDeps([2,3,4]),import.meta.url).then(c=>c.p),R(()=>import("./projection-m8vi7Cxv-2MLqE_Rd.js"),__vite__mapDeps([2,3,4]),import.meta.url).then(c=>c.g)]);await h(l,a);const b=[0,0,0];if(!u(r,l,0,b,a,0))throw new Error("Failed to project");if(n.type==="georeferenced"&&n.origin==null){if(f=new Float64Array(s.length),!u(s,l,0,f,a,0,f.length/3))throw new Error("Failed to project")}else{const c=n.type==="georeferenced"?ae.fromJSON(n):fe.fromJSON(n),{projectMeshVertexPositions:p}=await R(async()=>{const{projectMeshVertexPositions:_}=await import("./projectMeshVertexPositions-CwAnO79z-QsduNpl1.js");return{projectMeshVertexPositions:_}},__vite__mapDeps([5,2,3,4,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]),import.meta.url),g=p({vertexAttributes:{position:s},transform:t?{localMatrix:t}:void 0,vertexSpace:c,spatialReference:l},a);if(!g)throw new Error("Failed to project");f=g}const m=f.length,[d,y,E]=b;for(let c=0;c<m;c+=3)f[c]-=d,f[c+1]-=y,f[c+2]-=E;return{result:{projected:f,original:s,projectedOrigin:b},transferList:[f.buffer,s.buffer]}}async function Ae({normalMatrix:e,normals:t}){const r=new Float32Array(t.length);return le(r,t,e),ie(e)&&ce(r,r),{result:{transformed:r,original:t},transferList:[r.buffer,t.buffer]}}function De(e){K(e)}let Le,o;function J(e){if(!o)return;const t=e.modifications,r=o._malloc(8*t.length),s=new Float64Array(o.HEAPU8.buffer,r,t.length);for(let n=0;n<t.length;++n)s[n]=t[n];o.setModifications(e.context,r,t.length,e.isGeodetic),o._free(r)}function q(e,t,r){const{context:s,globalTrafo:n,mbs:l,obbData:a,elevationOffset:f,geometryBuffer:u,geometryDescriptor:h,indexToVertexProjector:b,vertexToRenderProjector:m}=t,d=e._malloc(u.byteLength),y=33,E=e._malloc(y*Float64Array.BYTES_PER_ELEMENT),c=new Uint8Array(e.HEAPU8.buffer,d,u.byteLength);c.set(new Uint8Array(u));const p=new Float64Array(e.HEAPU8.buffer,E,y);N(p,[NaN,NaN,NaN]);let g=p.byteOffset+3*p.BYTES_PER_ELEMENT,_=new Float64Array(p.buffer,g);N(_,n),g+=16*p.BYTES_PER_ELEMENT,_=new Float64Array(p.buffer,g),N(_,l),g+=4*p.BYTES_PER_ELEMENT,a&&(_=new Float64Array(p.buffer,g),N(_,a));const U=h,Q={isDraco:!1,isLegacy:!1,color:t.layouts.some(w=>w.some(S=>S.name==="color")),normal:t.needNormals&&t.layouts.some(w=>w.some(S=>S.name==="normalCompressed")),uv0:t.layouts.some(w=>w.some(S=>S.name==="uv0")),uvRegion:t.layouts.some(w=>w.some(S=>S.name==="uvRegion")),featureIndex:U.featureIndex},i=e.process(s,!!t.obbData,d,c.byteLength,U,Q,E,f,b,m,t.normalReferenceFrame);if(e._free(E),e._free(d),i.error.length>0)throw new Error(`i3s.wasm: ${i.error}`);if(i.discarded)return null;const D=i.componentOffsets.length>0?i.componentOffsets.slice():null,L=i.featureIds.length>0?i.featureIds.slice():null,W=i.anchorIds.length>0?Array.from(i.anchorIds):null,Z=i.anchors.length>0?Array.from(i.anchors):null,C=i.interleavedVertedData.slice().buffer,v=i.indicesType===A.Int16?new Uint16Array(i.indices.buffer,i.indices.byteOffset,i.indices.byteLength/2).slice():new Uint32Array(i.indices.buffer,i.indices.byteOffset,i.indices.byteLength/4).slice(),F=i.positions.slice(),{buffer:x,byteOffset:M,byteLength:j}=i.positionIndices,V=i.positionIndicesType===A.Int16?new Uint16Array(x,M,j/2).slice():new Uint32Array(x,M,j/4).slice(),ee=new ge(t.layouts[0],C,v,i.hasColors,i.hasModifications,{data:F,indices:V});return L&&r.push(L.buffer),D&&r.push(D.buffer),r.push(C),r.push(v.buffer),r.push(F.buffer),r.push(V.buffer),new _e(D,L,W,Z,ee,n,i.obb)}function Oe(e){return e===0?I.Unmodified:e===1?I.PotentiallyModified:e===2?I.Culled:I.Unknown}function X(e){if(!o)return;const{context:t,buffer:r}=e,s=o._malloc(r.byteLength),n=r.byteLength/Float64Array.BYTES_PER_ELEMENT,l=new Float64Array(o.HEAPU8.buffer,s,n),a=new Float64Array(r);l.set(a),o.filterOBBs(t,s,n),a.set(l),o._free(s)}function K(e){o&&o.destroy(e)===0&&(o=null)}function N(e,t){for(let r=0;r<t.length;++r)e[r]=t[r]}async function Pe(){o||await T()}async function T(){return o||(o=await(Le??(Le=be()))),o}const Ue={transform:(e,t)=>o&&q(o,e,t),destroy:K},Et=Object.freeze(Object.defineProperty({__proto__:null,destroyContext:De,dracoDecompressPointCloudData:Se,filterObbsForModifications:Ie,filterObbsForModificationsSync:X,initialize:Pe,interpretObbModificationResults:Oe,process:we,project:Re,setLegacySchema:Ne,setModifications:Te,setModificationsSync:J,test:Ue,transformNormals:Ae},Symbol.toStringTag,{value:"Module"}));export{Et as S,bt as V};
