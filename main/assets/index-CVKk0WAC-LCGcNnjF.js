const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Legend-C1YLx_LO-CTVIzdQ5.js","./index-Cd7FS_80.js","./index-CpSsk29H.css","./jsxFactory-C5LxVioS-Bw1wj4Mb.js","./intl-DLmy-Li5-QIMhWnKT.js","./uuid-Dj9mdEVg-BaKSCiyT.js","./featureReductionUtils-CT3zJdMo-COEl9dk_.js","./EffectView-Bw7SZPlx-CEQib8-I.js","./parser-hXQyB-Qx-F1FB6C4p.js","./mat4f32-CiZjBg9k-CUm34GoR.js","./mat4-BFStKTjU-BuOOeQ4W.js","./common-CYWrYyJl-E8-sukrT.js","./jsonUtils-DzmXEA9_-CzpxYD2g.js","./displayFilterUtils-CGSKf3_R--ZnIORi1.js","./ExportImageParameters-BFIpXRBd-CX3GVMRs.js","./scaleUtils-DtnDbXa5-CK4tFFlZ.js","./floorFilterUtils-4r-vVdzs-u-jw2p7F.js","./sublayerUtils-CVtBGavp-B9HN36-C.js","./pixelRangeUtils-BteWOAF5-CWUmGYA-.js","./jsonUtils-DQiDyVGY-A6wUj0-I.js","./typeUtils-I5iG5ZKA-j5a4OeB1.js","./ClassBreaksRenderer-D97YzbWp-D74J60YZ.js","./commonProperties-BLIn8DYU-DYLQ_4JZ.js","./colorRamps-KMmVdCPJ-M1Fwj08c.js","./ColorStop-DoHCvOqO-BLZ1Qy_r.js","./visualVariableUtils-BO-_wo28-CyPAo6zN.js","./lengthUtils-wU9RRIqK-DguGs5-0.js","./RendererLegendOptions-f5mIImtQ-Bw3HqHIi.js","./LRUCache-BLmkvs7b-BtVniFdK.js","./MemCache-BCippCv6-0PeZDn4o.js","./Version-BTMwSXf1-UyJ4JbmM.js","./FieldsIndex-Y7EBAYp0-BSlJY1sS.js","./timeZoneUtils-z3WjfjXQ-D2SA9WZQ.js","./utils-BYqzY6_X-dnmw_C7j.js","./defaultCIMValues-gWpu7WSC-cjxb95kj.js","./enums-f9UUstHQ-hLTu4V1l.js","./heatmapUtils--OU2Fakh-DKCNMFII.js","./vec42-D8CJyqHG-DnfLTeQH.js","./vec4f64-CjUMzAyX-DPYbdAom.js","./SimpleRenderer-ADQlYl8U-BoylXCW9.js","./UniqueValueRenderer-BmoLL_Ee-BB8ogjQk.js","./diffUtils-BSe9IE26-DiRtW7qV.js","./styleUtils-DxAOZq5S-CbEV8W4-.js","./rendererConversion-D-HBj0jy-CDyucTnG.js","./cimSymbolUtils-BuFg2oLA-Dq0PNuHs.js","./utils-C1HQJ6Ct-DWYE8JbY.js","./globalCss-CFN4F315-D83uZ6WN.js","./Queue-B8H6jIv7-CjHlhDYg.js","./signal-DxzURL18-Dd2UKOJd.js","./utils-C_9ghOVk-CMRCnpDy.js","./colorUtils-DxUhbS7D-C3COCPdl.js","./mat2df32-BCnkwMW8-BLRY8i4P.js","./mat2d-BQA-1WB--Pnyy0dhf.js","./webStyleSymbolUtils-BLJ6xjmu-DLE8mbm-.js","./devEnvironmentUtils-CxrVv3RG-ktR0Kqgv.js","./webStyleAcceptedFormats-DsfCZOwz-CG7ZQ6BV.js","./TimeExtent-gZaEUVeW-BAhRnc81.js","./utils-BG7WTOnW-BY2hR4XJ.js","./themeUtils-RB4IoNvm-uO-dsvgO.js","./substitute-TfjvVaWd-C3urdH8Y.js","./index-Buwx-j9b-Bq8GcmfZ.js","./dom-BYU3NyXf-CZJ3zRmv.js","./observers-BKdf62mV-K9TxOncr.js","./index-Hni9f9UA-XY4iOmW6.js","./label-BQQZwuu--CUlcHzNA.js","./index-8PAcNuSr-D3QltZa1.js","./ref-CeH0N1rX-CX2rtH_e.js","./form-CvEjKj31-CdQ8ImpU.js","./interactive-zE84MPIe-DFYh3vSI.js","./key-Dw3QkC1A-9YXD_SWk.js","./loadable-6U0DTqmj-CNDfvsjp.js","./index-D4Uosrk4-vvFsHmyw.js","./floating-ui-Cb0x-K1J-CJ_kfNiJ.js","./debounce-B9WUP9Xk-BvexrlwN.js","./guid-Cv9vc9qs-CBh637k4.js","./openCloseComponent-BMtfhy-V-c6w8zWjl.js","./FloatingArrow-CMt5DhCn-_GeGZTZv.js","./keyed-BMAvP6cM-Bri6kakU.js","./index-J94OCPzp-DsOvsxIM.js","./index-Cezzb5s0-CBl7RI9K.js","./useT9n-ao51JRwP-CmnLKwU3.js","./customElement-B5RyutyI-DoSsJUqv.js","./index-BJZZ1uba-DYIefY0D.js","./dynamicClasses-Dwz_yyhi-08boNpeL.js","./index-CytjfAQD-Rb2XCUlV.js","./component-BO03cvB--DHj_rzgP.js","./index-CZp4PK2p-CDel9jUh.js","./resources6-Ce6AoWnT-DbbvfBW6.js","./index-DA7O6rVv-N8wItWbA.js","./customElement-DlEKrn3l-wO9j2QRg.js","./index-B-rP10qG-CYTKs1iL.js","./static-Ca7qybaa-Bf3nqepl.js","./index-VtdpGf3k-DTqNxPxa.js","./array-BP5wmg5j-Cp8fhzAV.js","./index-DjLe4PDK-w2Y_1umE.js","./index-GmJqqGd6--Fm4TzBT.js","./index-O937z6z8-Dao5m4jw.js","./Validation-BvlBtyR--BK8kq8HS.js","./index-BUYNV2Id-D3nItuMw.js","./index-DBbiKKfA-Cr_5FJoU.js","./customElement-DYCpmMfo-DRLr8LRw.js","./input-CCJ2dDrH-BwKnoBMD.js","./index-CWPudE9o-DaYsCjG_.js","./utils-BV7fKXT2-BERq1aAR.js","./index-CDdEHo-w-9EOp_OnV.js","./resources5-CzJkwwvJ-BXQnB_q7.js","./index-CGKRKPuM-CBtp12n5.js","./GridControls-CEUIsZ2n-U4cB-MU1.js","./unitFormatUtils-zTNxheG9-DGtVfJ_z.js","./ByteSizeUnit-DL8UhsB0-B2-AmVRx.js","./quantityUtils-RaoZoCNH-EmpCsj9i.js","./projection-m8vi7Cxv-2MLqE_Rd.js","./projectVectorToVector-D0K_S4MR-B0_8rFc5.js","./projectPointToVector-CG1hALQu-B6_Kv_nW.js","./automaticLengthMeasurementUtils-BcfJmFU0-DYmxodWs.js","./vec32-BuqRmYBM-9L9gW8uY.js","./MeshTransform-CvTryVbE-W711tmyf.js","./mat4f64-BaJwL7tQ-k0uMm8LY.js","./quat-D8L_R4I0-BDM_a6sU.js","./mat3f64-Dh9_zhFu-BIT-k8Dm.js","./quatf64-C16JxGFv-BKWK1F8U.js","./axisAngleDegrees-nTnQhoaG-f5PrkKVS.js","./meshVertexSpaceUtils-BwEbYR8F-BgXtAvGE.js","./MeshLocalVertexSpace-DFCiKNRA-DhUD1trh.js","./SketchViewModel-T2dNp9Tt-B8LCNGD-.js","./UpdatingHandles-DBzjq66S-CApI9LWM.js","./GraphicsLayer-GkJJfSu5-CY-fpgZ2.js","./GraphicsCollection-rAFZo1AJ-Cxu1RH-g.js","./Layer-B8q-l4yV-Bs1lvoad.js","./ScaleRangeLayer-DIxukUBC-Di5rfBOd.js","./layerContainerType-ChWdCT09-G5sdAsSy.js","./ElevationInfo-DkWlof50-B8JexGJ5.js","./vec2-BnynUbeJ-CKtGJQAy.js","./vec2f64-CEUyUoff-BBc0aQ6D.js","./geodesicUtils-DV-lFWtb-XGstnHhw.js","./Query-CxQYWcUQ-C5jNzBBu.js","./Field-Cj6Pz3TI-BfIhW_SD.js","./fieldType-VTpxE-EM-aUbd3L0g.js","./plane-B_adY3_o-0JtaREXu.js","./sphere-Cj20syUS-B5gIJGqD.js","./mat3-DOnW3DjW-C3hbW9XY.js","./a11yUtils-C2ydunC--CFkTRUhX.js","./spatialReferenceEllipsoidUtils-DlQOpWof-CYP9jFMl.js","./geodesicLengthMeasurementUtils-X1SKKkBz-CCqiVPi6.js","./gridUtils-D2du44-d-X_nzmtkk.js","./normalizeUtils-b-vZURob-xbl9OAoe.js","./utils-DuaeuwP5-B11_MdHz.js","./utils-Jw-4AGsF-1N_psa_n.js","./editingTools-KBOXuhog-kzZs9wtf.js","./SnappingVisualizer2D-DR-yrbjS-hG6cJWPH.js","./automaticAreaMeasurementUtils-Bz1iefP0-D5eQdUSH.js","./PointSnappingHint-ClwQ1VNw-BkpoTzDl.js","./earcut-XDcq3zAf-BcwyrT7l.js","./triangle-BePBrXJ8-eY8V5Hfc.js","./lineSegment-BJNfNZM5-D7rIaUo-.js","./editPlaneUtils-CYBM1uSC-C8tq7npy.js","./boundedPlane-B6TkXVHT-TjiFiwLP.js","./ViewingMode-CyR_b1T8-_s7_Gbsk.js","./GraphicManipulator-DXPP3gDs-CfIhojv-.js","./drapedUtils-7RfmdK5D-BxNhFdBk.js","./drawUtils-BUIg7AUj-BlHkpNYm.js","./draw-store-C1_quxsr-BipQa7ws.js","./layerViewUtils-Bk5QNiAa-Bn8PoRvr.js","./widget-BgluoE6k-BWutvaEX.js","./hydratedFeatures-BDT5zTGB-CP-Z9E5F.js","./Scheduler-Br-2v2ys-CpHtrJ7f.js","./geometryEngineBase-DueYg7ux-B6e4gAE3.js","./_commonjsHelpers-BITg13Vk-KnjfkSck.js","./hydrated-Bae3cp-4-CvOszjtI.js","./utils-C0LvbFCo-RMQaTNpt.js","./TextOverlayItem-pAuO460X-BYi_gvAN.js","./number-ZeBaww6r-Byv6KOBH.js","./index-KqP5VmvP-UaYMSNYv.js","./index-f5siJR3U-8jlmXN-u.js","./ExpandToggle-5J19yLeu-BQZ02N5N.js","./index-DK_RfN06-TOPGHlIc.js","./geometryEngineJSON-CGn_tfx8-CijjZxZ3.js","./json-BI97KiBB-Ce5cWfI2.js","./index-BxtEfqZ2-Hel1rVMr.js","./circle-icon-DrE2wWqh-aNymG_5_.js","./edit-icon-C_tqZ1EG-ztyYcxJi.js","./point-icon-BSJft8AI-BjqrE-JQ.js","./polygon-icon-BrXtjiJl-BEDXU0n5.js","./polyline-icon-CqjafPK0-RbEy109X.js","./rectangle-icon-D8mTZj4O-WrMVsxVN.js"])))=>i.map(i=>d[i]);
var to=Object.defineProperty;var io=(e,t,i)=>t in e?to(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var ds=(e,t,i)=>io(e,typeof t!="symbol"?t+"":t,i);import{v as r,I as l,d9 as C,a as He,fs as so,L as Pe,Q as ie,fY as zt,df as P,d4 as Ii,d5 as no,fZ as oo,b3 as it,f_ as ro,cV as Ys,bM as ce,y as ao,dK as le,T as Gt,ai as I,bd as Ee,z as Di,dT as ci,e3 as Ge,f$ as lo,E as Z,a2 as qs,_ as S,aa as Me,g0 as co,g1 as po,g2 as ho,cC as Ft,a1 as js,r as uo,g3 as Ks,bJ as Qs,cS as Js,g4 as go,bP as mo,b9 as ji,bn as rt,g5 as en,g6 as tn,dW as ni,a8 as $t,b6 as Ki,g7 as yo,g8 as _o,g9 as Mt,ga as vo,gb as fo,gc as wo,gd as bo,ar as To,c$ as xo,bS as Eo,ge as Mo,cR as So,e2 as Co,gf as Po,d0 as Vo,gg as Oo,t as R,af as Lo,gh as bi,gi as ko,cN as Ro,eY as Zt,dP as Ai,cP as Io,bh as It,gj as Ti,cJ as ue,dN as sn,D as Do,av as Ao,aw as zo,gk as Go,gl as $o,aH as hs,aI as Ho,at as nn,gm as Bo,az as Fo,aL as Zo,fT as No,cT as Uo,gn as Wo,c as Xo,go as Yo,gp as us,gq as qo,gr as jo,cX as Ko,d$ as Qo,e0 as Jo,dX as Qi,gs as er,gt as tr,gu as ir,eV as sr,dG as gs,bf as nr,gv as or,gw as rr,a_ as ar,gx as lr,fd as Nt,fc as ms,eO as cr,ao as Xe,gy as pr,gz as xi,gA as Ut,gB as Ei,gC as dr}from"./index-Cd7FS_80.js";import{y as Ji}from"./draw-store-C1_quxsr-BipQa7ws.js";import hr from"./GraphicsLayer-GkJJfSu5-CY-fpgZ2.js";import"./intl-DLmy-Li5-QIMhWnKT.js";import{I as ur,O as ys,S as oi,P as es,u as gr,w as on,K as mr,F as yr,e as rn,M as Wt,B as _s,a as bt,W as _r,b as vr,T as an,c as ln,d as fr,t as cn,f as pn,g as wr,v as br,h as St,s as Tr,j as ft,D as vt,_ as dn,i as xr,R as Er,r as Mr,k as hn,l as Sr,m as Cr}from"./SketchViewModel-T2dNp9Tt-B8LCNGD-.js";import{C as Oe,T as g,m as Be,a as Pr,L as $e,c as un,z as Vr}from"./jsxFactory-C5LxVioS-Bw1wj4Mb.js";import{P as Ye,M as Or,y as vs,S as Lr,h as ts}from"./globalCss-CFN4F315-D83uZ6WN.js";import{o as Qt}from"./layerViewUtils-Bk5QNiAa-Bn8PoRvr.js";import{n as kr,l as fs,a as Rr}from"./widget-BgluoE6k-BWutvaEX.js";import{T as Ir}from"./diffUtils-BSe9IE26-DiRtW7qV.js";import{i as Dr}from"./UpdatingHandles-DBzjq66S-CApI9LWM.js";import{l as gn}from"./ViewingMode-CyR_b1T8-_s7_Gbsk.js";import{i as ws,j as Ar,P as zr,z as Gr,T as bs,A as $r,f as mn,d as Hr,O as Br}from"./vec2-BnynUbeJ-CKtGJQAy.js";import{o as qe,t as Jt,c as Fr}from"./vec2f64-CEUyUoff-BBc0aQ6D.js";import{k as Ts,X as ut,l as gt,N as zi,A as at,y as ei,Q as xs,P as mt,Y as is,W as Gi,_ as yt,g as yn,r as _n,B as Es}from"./vec32-BuqRmYBM-9L9gW8uY.js";import{A as Zr,p as Nr,O as Ur}from"./vec42-D8CJyqHG-DnfLTeQH.js";import{o as Wr,e as Mi,f as Xr}from"./vec4f64-CjUMzAyX-DPYbdAom.js";import{O as ri}from"./projection-m8vi7Cxv-2MLqE_Rd.js";import{p as Yr}from"./meshVertexSpaceUtils-BwEbYR8F-BgXtAvGE.js";import{S as qr,Q as pi}from"./hydratedFeatures-BDT5zTGB-CP-Z9E5F.js";import{Q as Ms,r as jr,B as Kr,O as Ct,C as Ss,j as Si,P as Qr,U as Jr,E as Ci,m as ea}from"./plane-B_adY3_o-0JtaREXu.js";import{o as ss,i as ta,t as ia}from"./quantityUtils-RaoZoCNH-EmpCsj9i.js";import{f as di,s as ns}from"./projectVectorToVector-D0K_S4MR-B0_8rFc5.js";import{u as sa,W as na}from"./geodesicUtils-DV-lFWtb-XGstnHhw.js";import{i as vn,S as fn}from"./Scheduler-Br-2v2ys-CpHtrJ7f.js";import{G as E}from"./geometryEngineBase-DueYg7ux-B6e4gAE3.js";import{hydratedAdapter as V}from"./hydrated-Bae3cp-4-CvOszjtI.js";import{S as oa}from"./mat2d-BQA-1WB--Pnyy0dhf.js";import{Y as ra,L as aa}from"./quat-D8L_R4I0-BDM_a6sU.js";import{e as Cs}from"./quatf64-C16JxGFv-BKWK1F8U.js";import{y as la,x as ca}from"./drapedUtils-7RfmdK5D-BxNhFdBk.js";import{n as Ps}from"./utils-C0LvbFCo-RMQaTNpt.js";import{b as Vs}from"./substitute-TfjvVaWd-C3urdH8Y.js";import"./GraphicsCollection-rAFZo1AJ-Cxu1RH-g.js";import"./Layer-B8q-l4yV-Bs1lvoad.js";import"./TimeExtent-gZaEUVeW-BAhRnc81.js";import"./ScaleRangeLayer-DIxukUBC-Di5rfBOd.js";import"./layerContainerType-ChWdCT09-G5sdAsSy.js";import"./jsonUtils-DzmXEA9_-CzpxYD2g.js";import"./parser-hXQyB-Qx-F1FB6C4p.js";import"./mat4f32-CiZjBg9k-CUm34GoR.js";import"./mat4-BFStKTjU-BuOOeQ4W.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./ElevationInfo-DkWlof50-B8JexGJ5.js";import"./lengthUtils-wU9RRIqK-DguGs5-0.js";import"./Query-CxQYWcUQ-C5jNzBBu.js";import"./Field-Cj6Pz3TI-BfIhW_SD.js";import"./fieldType-VTpxE-EM-aUbd3L0g.js";import"./sphere-Cj20syUS-B5gIJGqD.js";import"./mat3-DOnW3DjW-C3hbW9XY.js";import"./mat3f64-Dh9_zhFu-BIT-k8Dm.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";import"./Queue-B8H6jIv7-CjHlhDYg.js";import"./signal-DxzURL18-Dd2UKOJd.js";import"./Version-BTMwSXf1-UyJ4JbmM.js";import"./MeshLocalVertexSpace-DFCiKNRA-DhUD1trh.js";import"./mat4f64-BaJwL7tQ-k0uMm8LY.js";import"./projectPointToVector-CG1hALQu-B6_Kv_nW.js";import"./_commonjsHelpers-BITg13Vk-KnjfkSck.js";var $i;let Re=$i=class extends ie{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=(e==null?void 0:e.hasZ)??!1,this.rings.length!==0||!e)return;const i=xo(this.radius,this.radiusUnit,"meters"),s=e.spatialReference;let n,o="geographic";if(s.isWebMercator?o="webMercator":((s.wkid&&Eo[s.wkid])!=null||(s.wkt2||s.wkt)&&Mo(s.wkt2||s.wkt))&&(o="projected"),this.geodesic){let a;switch(o){case"webMercator":a=So(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":a=e}n=this._createGeodesicCircle(a,i,t),o==="webMercator"&&(n=Co(n))}else{let a;o==="webMercator"||o==="projected"?a=i/Po(e.spatialReference):o==="geographic"&&(a=Vo(i,"meters",Oo(e.spatialReference).radius)),n=this._createPlanarCircle(e,a,t)}this.spatialReference=n.spatialReference,this.addRing(n.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:s,geodesic:n}=this;return new $i({center:e==null?void 0:e.clone(),numberOfPoints:t,radius:i,radiusUnit:s,geodesic:n})}_createGeodesicCircle(e,t,i){const s=[],n=[e.x,e.y];for(let o=0;o<360;o+=360/i){const a=this.hasZ?[0,0,e.z??0]:[0,0];na(a,n,o,t,Gt.WGS84),s.push(a)}return s.push(s[0]),new ie({rings:[s]})}_createPlanarCircle(e,t,i){const s=[],n=2*Math.PI/i;for(let o=0;o<i;++o){const a=n*o,c=[e.x+Math.cos(-a)*t,e.y+Math.sin(-a)*t];this.hasZ&&c.push(e.z??0),s.push(c)}return s.push(s[0]),new ie({spatialReference:e.spatialReference,rings:[s]})}};r([l({type:Z})],Re.prototype,"center",void 0),r([l()],Re.prototype,"geodesic",void 0),r([l()],Re.prototype,"numberOfPoints",void 0),r([l()],Re.prototype,"radius",void 0),r([l()],Re.prototype,"radiusUnit",void 0),Re=$i=r([R("esri.geometry.Circle")],Re);const pa=Re;function O(e){const t=Array.isArray(e)?e[0].spatialReference:e.spatialReference;return t?Lo(Gt,t):Gt.WGS84}function da(e){return E.extendedSpatialReferenceInfo(e)}function ha(e,t){return C(e),E.clip(V,O(e),e,t)}function ua(e,t){return C(e),E.cut(V,O(e),e,t)}function ga(e,t){return C(e),C(t),E.contains(V,O(e),e,t)}function ma(e,t){return C(e),C(t),E.crosses(V,O(e),e,t)}function wn(e,t,i){return C(e),C(t),E.distance(V,O(e),e,t,i)}function ya(e,t){return C(e),C(t),E.equals(V,O(e),e,t)}function _a(e,t){return C(e),C(t),E.intersects(V,O(e),e,t)}function va(e,t){return C(e),C(t),E.touches(V,O(e),e,t)}function fa(e,t){return C(e),C(t),E.within(V,O(e),e,t)}function wa(e,t){return C(e),C(t),E.disjoint(V,O(e),e,t)}function ba(e,t){return C(e),C(t),E.overlaps(V,O(e),e,t)}function Ta(e,t,i){return C(e),C(t),E.relate(V,O(e),e,t,i)}function xa(e){return C(e),E.isSimple(V,O(e),e)}function bn(e){return C(e),E.simplify(V,O(e),e)}function Ea(e,t=!1){return E.convexHull(V,O(e),e,t)}function Ma(e,t){return C(t),E.difference(V,O(e),e,t)}function Sa(e,t){return C(t),E.symmetricDifference(V,O(e),e,t)}function Ca(e,t){return C(t),E.intersect(V,O(e),e,t)}function Pa(e){return E.union(V,O(e),e)}function Va(e,t,i,s,n,o){return E.offset(V,O(e),e,t,i,s,n,o)}function Oa(e,t,i,s=!1){return E.buffer(V,O(e),e,t,i,s)}function La(e,t,i,s,n,o){return E.geodesicBuffer(V,O(e),e,t,i,s,n,o)}function ka(e,t,i=!0){return C(e),E.nearestCoordinate(V,O(e),e,t,i)}function Ra(e,t){return C(e),E.nearestVertex(V,O(e),e,t)}function Ia(e,t,i,s){return C(e),E.nearestVertices(V,O(e),e,t,i,s)}function os(e){var t;return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?((t=e.extent)==null?void 0:t.center)??null:null}function Da(e,t,i){if(e==null)throw new wt;const s=e.spatialReference;if((i=i??os(e))==null)throw new wt;const n=e.constructor.fromJSON(E.rotate(e,t,i));return n.spatialReference=s,n}function Aa(e,t){if(e==null)throw new wt;const i=e.spatialReference;if((t=t??os(e))==null)throw new wt;const s=e.constructor.fromJSON(E.flipHorizontal(e,t));return s.spatialReference=i,s}function za(e,t){if(e==null)throw new wt;const i=e.spatialReference;if((t=t??os(e))==null)throw new wt;const s=e.constructor.fromJSON(E.flipVertical(e,t));return s.spatialReference=i,s}function Ga(e,t,i,s){return C(e),E.generalize(V,O(e),e,t,i,s)}function $a(e,t,i){return C(e),E.densify(V,O(e),e,t,i)}function Ha(e,t,i,s=0){return C(e),E.geodesicDensify(V,O(e),e,t,i,s)}function Ba(e,t){return C(e),E.planarArea(V,O(e),e,t)}function Fa(e,t){return C(e),E.planarLength(V,O(e),e,t)}function Za(e,t,i){return C(e),E.geodesicArea(V,O(e),e,t,i)}function Na(e,t,i){return C(e),E.geodesicLength(V,O(e),e,t,i)}function Ua(e,t){return E.intersectLinesToPoints(V,O(e),e,t)}function Wa(e,t){E.changeDefaultSpatialReferenceTolerance(e,t)}function Xa(e){E.clearDefaultSpatialReferenceTolerance(e)}let wt=class extends Error{constructor(){super("Illegal Argument Exception")}};const Yp=Object.freeze(Object.defineProperty({__proto__:null,buffer:Oa,changeDefaultSpatialReferenceTolerance:Wa,clearDefaultSpatialReferenceTolerance:Xa,clip:ha,contains:ga,convexHull:Ea,crosses:ma,cut:ua,densify:$a,difference:Ma,disjoint:wa,distance:wn,equals:ya,extendedSpatialReferenceInfo:da,flipHorizontal:Aa,flipVertical:za,generalize:Ga,geodesicArea:Za,geodesicBuffer:La,geodesicDensify:Ha,geodesicLength:Na,intersect:Ca,intersectLinesToPoints:Ua,intersects:_a,isSimple:xa,nearestCoordinate:ka,nearestVertex:Ra,nearestVertices:Ia,offset:Va,overlaps:ba,planarArea:Ba,planarLength:Fa,relate:Ta,rotate:Da,simplify:bn,symmetricDifference:Sa,touches:va,union:Pa,within:fa},Symbol.toStringTag,{value:"Module"}));var $;(function(e){e[e.Z=0]="Z",e[e.M=1]="M"})($||($={}));let Ya=class{constructor(e){this.spatialReference=e}createVector(){return this._tag(qe())}pointToVector(e){return this._tag(Jt(e.x,e.y))}arrayToVector(e){return this._tag(Jt(e[0],e[1]))}vectorToArray(e){return[e[0],e[1]]}pointToArray(e){return[e.x,e.y]}vectorToPoint(e,t=new Z){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new Z){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??(t={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"}),t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}lerp(e,t,i,s){return $r(s,e,t,i)}addDelta(e,t,i){e[0]+=t,e[1]+=i}distance(e,t){return mn(e,t)}getZ(e,t=void 0){return t}hasZ(){return!1}getM(e,t=void 0){return t}hasM(){return!1}clone(e){return this._tag(Fr(e))}copy(e,t){return Hr(t,e)}fromXYZ(e){return this._tag(Jt(e[0],e[1]))}toXYZ(e,t=P()){return at(t,e[0],e[1],0)}pointToXYZ(e,t=P()){return at(t,e.x,e.y,0)}equals(e,t){return Br(e,t)}_tag(e){return e}},Os=class{constructor(e,t){this._valueType=e,this.spatialReference=t}createVector(){return this._tag(P())}pointToVector(e){return this._tag(bi(e.x,e.y,this._valueType===$.Z?e.z:e.m))}arrayToVector(e){return this._tag(bi(e[0],e[1],e[2]||0))}vectorToArray(e){return[e[0],e[1],e[2]]}pointToArray(e){return this._valueType===$.Z?[e.x,e.y,e.z]:[e.x,e.y,e.m]}vectorToPoint(e,t=new Z){return t.x=e[0],t.y=e[1],t.z=this._valueType===$.Z?e[2]:void 0,t.m=this._valueType===$.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new Z){return t.x=e[0],t.y=e[1],t.z=this._valueType===$.Z?e[2]:void 0,t.m=this._valueType===$.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(!e)return;t??(t={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"});const i=this._valueType===$.Z,s=this._valueType===$.M;return t.x=e[0],t.y=e[1],t.z=i?e[2]:void 0,t.m=s?e[2]:void 0,t.hasZ=i,t.hasM=s,t.spatialReference=this.spatialReference,t}lerp(e,t,i,s){return is(s,e,t,i)}addDelta(e,t,i,s){e[0]+=t,e[1]+=i,this._valueType===$.Z&&(e[2]+=s)}distance(e,t){return this._valueType===$.Z?yn(e,t):mn(e,t)}getZ(e,t=void 0){return this._valueType===$.Z?e[2]:t}hasZ(){return this._valueType===$.Z}getM(e,t=void 0){return this._valueType===$.M?e[2]:t}hasM(){return this._valueType===$.M}clone(e){return this._tag(ko(e))}copy(e,t){return yt(t,e)}fromXYZ(e,t=0,i=0){return this._tag(bi(e[0],e[1],this._valueType===$.Z?e.length>2?e[2]:t:i))}toXYZ(e,t=P()){return at(t,e[0],e[1],this._valueType===$.Z?e[2]:0)}pointToXYZ(e,t=P()){return at(t,e.x,e.y,this._valueType===$.Z?e.z??0:0)}equals(e,t){return Gi(e,t)}_tag(e){return e}},qa=class{constructor(e){this.spatialReference=e}createVector(){return this._tag(Wr())}pointToVector(e){return this._tag(Mi(e.x,e.y,e.z,e.m))}arrayToVector(e){return this._tag(Mi(e[0],e[1],e[2]||0,e[3]||0))}vectorToArray(e){return[e[0],e[1],e[2],e[3]]}pointToArray(e){return[e.x,e.y,e.z,e.m]}vectorToPoint(e,t=new Z){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new Z){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??(t={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"}),t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}lerp(e,t,i,s){return Zr(s,e,t,i)}addDelta(e,t,i,s){e[0]+=t,e[1]+=i,e[2]+=s}distance(e,t){return yn(e,t)}getZ(e){return e[2]}hasZ(){return!0}getM(e){return e[3]}hasM(){return!0}clone(e){return this._tag(Xr(e))}copy(e,t){return Nr(t,e)}fromXYZ(e,t=0,i=0){return this._tag(Mi(e[0],e[1],e.length>2?e[2]:t,i))}toXYZ(e,t=P()){return at(t,e[0],e[1],e[2])}pointToXYZ(e,t=P()){return at(t,e.x,e.y,e.z??0)}equals(e,t){return Ur(e,t)}_tag(e){return e}};function Tn(e,t,i){return e&&t?new qa(i):t?new Os($.M,i):e?new Os($.Z,i):new Ya(i)}function ja(e,t){if(!t.supported)return;let i=1/0,s=-1/0;const n=t.upperBoundX-t.lowerBoundX;e.forEach(a=>{let c=a.pos[0];for(;c<t.lowerBoundX;)c+=n;for(;c>t.upperBoundX;)c-=n;i=Math.min(i,c),s=Math.max(s,c),a.pos[0]=c});const o=s-i;n-o<o&&e.forEach(a=>{a.pos[0]<0&&(a.pos[0]+=n)})}function Ka(e,t){const i=Uo(e);return t===gn.Global&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}let Ht=class{constructor(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}},Ve=class{constructor(e,t,i){this.component=e,this.leftVertex=t,this.rightVertex=i,this.type="edge",t.rightEdge=this,i.leftEdge=this}},hi=class{constructor(e,t){this._spatialReference=e,this._viewingMode=t,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||ja(this.vertices,Ka(this._spatialReference,this._viewingMode))}updateVertexIndex(e,t){if(this.vertices.length===0)return;const i=this.vertices[0];let s=null,n=e,o=t;do s=n,s.index=o++,n=s.rightEdge?s.rightEdge.rightVertex:null;while(n!=null&&n!==i);s.leftEdge&&s!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(s),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&this.vertices[0].leftEdge!==null}swapVertices(e,t){const i=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=i}iterateVertices(e){if(this.vertices.length===0)return;const t=this.vertices[0];let i=t;do e(i,i.index),i=i.rightEdge!=null?i.rightEdge.rightVertex:null;while(i!==t&&i!=null)}},Hi=class xn extends He{constructor(t,i){super(),this.type=t,this.coordinateHelper=i,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:so(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const t of this.components)for(const i of t.vertices)yield i}notifyChanges(t){this._dirty=!0,this.emit("change",t)}_toPoint(){return this.components.length===0||this.components[0].vertices.length===0?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const t=[],i=this.coordinateHelper.vectorToArray;for(const s of this.components){if(s.vertices.length<1)continue;const n=[];let o=s.vertices.find(c=>c.leftEdge==null);const a=o;do n.push(i(o.pos)),o=o.rightEdge?o.rightEdge.rightVertex:null;while(o&&o!==a);t.push(n)}return new Pe({paths:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const t=[],i=this.coordinateHelper.vectorToArray;for(const s of this.components){if(s.vertices.length<1)continue;const n=[],o=s.vertices[0];let a=o;const c=a;do n.push(i(a.pos)),a=a.rightEdge!=null?a.rightEdge.rightVertex:null;while(a&&a!==c);s.isClosed()&&n.push(i(o.pos)),t.push(n)}return new ie({rings:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(t,i){const s=t.spatialReference,n=Tn(t.hasZ,t.hasM,s),o=new xn(t.type,n);switch(t.type){case"polygon":Qa(o,t,i);break;case"polyline":Ja(o,t,i);break;case"point":Ls(o,t,i);break;case"mesh":Ls(o,t.origin,i),o._geometry=t,o._dirty=!1}return o}};function Qa(e,t,i){const s=t.spatialReference,n=e.coordinateHelper,o=t.rings;for(let a=0;a<o.length;++a){const c=o[a],p=new hi(s,i);p.index=a;const d=c.length>2&&zt(c[0],c[c.length-1]),u=d?c.length-1:c.length;for(let m=0;m<u;++m){const y=n.arrayToVector(c[m]),b=new Ht(p);p.vertices.push(b),b.pos=y,b.index=m}const h=p.vertices.length-1;for(let m=0;m<h;++m){const y=p.vertices[m],b=p.vertices[m+1],f=new Ve(p,y,b);p.edges.push(f)}if(d){const m=new Ve(p,p.vertices[p.vertices.length-1],p.vertices[0]);p.edges.push(m)}e.components.push(p)}}function Ja(e,t,i){const s=t.spatialReference,n=e.coordinateHelper,o=t.paths;for(let a=0;a<o.length;++a){const c=o[a],p=new hi(s,i);p.index=a;const d=c.length;for(let h=0;h<d;++h){const m=n.arrayToVector(c[h]),y=new Ht(p);p.vertices.push(y),y.pos=m,y.index=h}const u=p.vertices.length-1;for(let h=0;h<u;++h){const m=p.vertices[h],y=p.vertices[h+1],b=new Ve(p,m,y);p.edges.push(b)}e.components.push(p)}}function Ls(e,t,i){const s=t.spatialReference,n=e.coordinateHelper,o=new hi(s,i);o.index=0;const a=new Ht(o);a.index=0,a.pos=n.pointToVector(t),o.vertices.push(a),e.components.push(o)}function Pt(e){return e.type==="mesh"}var te;(function(e){e[e.NEW_STEP=0]="NEW_STEP",e[e.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"})(te||(te={}));let el=class{constructor(e,t,i){this._editGeometry=e,this._component=t,this._pos=i,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let e="redo";this._addedVertex==null&&(e="apply",this._addedVertex=new Ht(this._component));const t=this._component.getLastVertex();if(t==null)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let i=null;t.rightEdge&&(this._originalEdge=t.rightEdge,i=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._left==null&&(this._left=new Ve(this._component,t,this._addedVertex)),this._component.edges.push(this._left),t.rightEdge=this._left,this._originalEdge!=null&&i!=null&&(this._right==null&&(this._right=new Ve(this._component,this._addedVertex,i)),this._component.edges.push(this._right),i.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,t.index+1)}this._editGeometry.notifyChanges({operation:e,addedVertices:[this._addedVertex]})}undo(){this._addedVertex!=null&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),this._left!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),this._right!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),this._originalEdge!=null&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),this._left!=null?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}},tl=class En{constructor(t,i,s){this._editGeometry=t,this._vertices=i,this.operation=s,this._undone=!1}_notifyChanges(t){this._editGeometry.components.forEach(i=>i.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:this._vertices})}apply(){this._vertices.forEach(t=>this.operation.apply(t)),this._notifyChanges(this._undone?"redo":"apply")}undo(){this._vertices.forEach(t=>this.operation.undo(t)),this._undone=!0,this._notifyChanges("undo")}canAccumulate(t){if(this._undone||t._vertices.length!==this._vertices.length)return!1;for(let i=0;i<t._vertices.length;++i)if(t._vertices[i]!==this._vertices[i])return!1;return this.operation.canAccumulate(t.operation)}accumulate(t){return!!(t instanceof En&&this.canAccumulate(t))&&(this._vertices.forEach(i=>this.operation.accumulate(i,t.operation)),this.operation.accumulateParams(t.operation),this._notifyChanges("apply"),!0)}};var ge;(function(e){e[e.CUMULATIVE=0]="CUMULATIVE",e[e.REPLACE=1]="REPLACE"})(ge||(ge={}));let il=class{constructor(e,t,i=0){this._editGeometry=e,this._vertices=t,this._minNumberOfVertices=i,this.removedVertices=null}apply(){let e="redo";if(this.removedVertices==null){const t=this.removedVertices=[];this._vertices.forEach(i=>{const s=this._removeVertex(i);s!=null&&t.push(s)}),e="apply"}else this.removedVertices.forEach(t=>{this._removeVertex(t.removedVertex)});this._editGeometry.notifyChanges({operation:e,removedVertices:this._vertices})}undo(){var e;(e=this.removedVertices)==null||e.forEach(t=>{this._undoRemoveVertex(t)}),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(e){const t=e.component;if(t.vertices.length<=this._minNumberOfVertices)return null;const i={removedVertex:e,createdEdge:null},s=e.leftEdge,n=e.rightEdge;return t.vertices.splice(t.vertices.indexOf(e),1),s&&(t.edges.splice(t.edges.indexOf(s),1),s.leftVertex.rightEdge=null),n&&(t.edges.splice(t.edges.indexOf(n),1),n.rightVertex.leftEdge=null),e.index===0&&n&&this._vertices.length>0&&t.swapVertices(t.vertices.indexOf(n.rightVertex),0),s&&n&&(i.createdEdge=new Ve(t,s.leftVertex,n.rightVertex),t.edges.push(i.createdEdge)),n&&t.updateVertexIndex(n.rightVertex,n.rightVertex.index-1),i}_undoRemoveVertex(e){const t=e.removedVertex,i=e.removedVertex.component,s=t.leftEdge,n=t.rightEdge;e.createdEdge&&i.edges.splice(i.edges.indexOf(e.createdEdge),1),i.vertices.push(t),s&&(i.edges.push(s),s.leftVertex.rightEdge=s),n&&(i.edges.push(n),n.rightVertex.leftEdge=n),i.updateVertexIndex(t,t.index)}},sl=class{constructor(e,t,i){this._editGeometry=e,this._edge=t,this._t=i,this.createdVertex=null,this._left=null,this._right=null}apply(){let e="redo";const t=this._edge,i=t.component,s=t.leftVertex,n=t.rightVertex;i.edges.splice(i.edges.indexOf(t),1),this.createdVertex==null&&(e="apply",this.createdVertex=new Ht(t.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(t.leftVertex.pos,t.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),this._left==null&&(this._left=new Ve(i,s,this.createdVertex)),this._left.leftVertex.leftEdge?i.edges.push(this._left):i.edges.unshift(this._left),s.rightEdge=this._left,this._right==null&&(this._right=new Ve(i,this.createdVertex,n)),i.edges.push(this._right),n.leftEdge=this._right,i.updateVertexIndex(this.createdVertex,s.index+1),this._editGeometry.notifyChanges({operation:e,addedVertices:[this.createdVertex]})}undo(){if(this.createdVertex==null||this._left==null||this._right==null)return null;const e=this._edge,t=e.component,i=this.createdVertex.leftEdge,s=this.createdVertex.rightEdge,n=i==null?void 0:i.leftVertex,o=s==null?void 0:s.rightVertex;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this._left),1),t.edges.splice(t.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?t.edges.push(this._edge):t.edges.unshift(this._edge),n&&(n.rightEdge=e),o&&(o.leftEdge=e),n&&t.updateVertexIndex(n,n.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}},nl=class Mn{constructor(t,i,s){this._editGeometry=t,this._vertex=i,this._pos=s}apply(){const t=this._originalPosition==null;t&&(this._originalPosition=this._vertex.pos),this._apply(t?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(t){return t instanceof Mn&&t._vertex===this._vertex&&(this._pos=t._pos,this._apply("apply"),!0)}_apply(t){this._vertex.pos=this._pos,this._editGeometry.components.forEach(i=>i.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:[this._vertex]})}},ol=class{constructor(e,t){this._editGeometry=e,this._component=t,this._createdEdge=null}apply(){let e="redo";if(this._createdEdge==null){e="apply";const t=this._component.getFirstVertex(),i=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||t==null||i==null)return;this._createdEdge=new Ve(this._component,i,t)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:e})}undo(){this._createdEdge!=null&&(Ro(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}},ks=class Sn{constructor(t,i,s,n){this._editGeometry=t,this.dx=i,this.dy=s,this.dz=n,this._firstTime=!0}apply(){const t=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(t,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(t){const i=this._editGeometry.geometry;return t instanceof Sn&&t._editGeometry.geometry===i&&(this._apply("apply",t.dx,t.dy,t.dz),this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz,!0)}_apply(t,i,s,n){const o=this._editGeometry.geometry;o.offset(i,s,n);const a=this._editGeometry.components[0].getFirstVertex();if(!a)return;const c=this._editGeometry.coordinateHelper;a.pos=c.pointToVector(o.origin),this._editGeometry.notifyChanges({operation:t,updatedVertices:[a]})}},rl=class Cn{constructor(t,i,s,n){this._helper=t,this.dx=i,this.dy=s,this.dz=n}_move(t,i,s,n){this._helper.addDelta(t.pos,i,s,n)}apply(t){this._move(t,this.dx,this.dy,this.dz)}undo(t){this._move(t,-this.dx,-this.dy,-this.dz)}canAccumulate(t){return t instanceof Cn}accumulate(t,i){this._move(t,i.dx,i.dy,i.dz)}accumulateParams(t){this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz}},al=class Bi{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(t,i,s,n=0,o=Dt.IMMEDIATE){this._helper=t,this._planeType=i,this._edge=s,this.distance=n,this._plane=Ms(),this._offsetPlane=Ms(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,o===Dt.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){var o,a,c,p;const t=this._toXYZ(this._edge.leftVertex.pos),i=this._toXYZ((a=(o=this._edge.leftVertex.leftEdge)==null?void 0:o.leftVertex)==null?void 0:a.pos),s=this._toXYZ(this._edge.rightVertex.pos),n=this._toXYZ((p=(c=this._edge.rightVertex.rightEdge)==null?void 0:c.rightVertex)==null?void 0:p.pos);this._edgeDirection=Ts(P(),t,s),i?(this._left=this._computeNeighbor(t,i,this._edgeDirection),this._right=this._computeNeighbor(s,n,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(s,n,this._edgeDirection),this._left=this._computeNeighbor(t,i,this._edgeDirection,this._right))}_toXYZ(t){return t!=null?this._helper.toXYZ(t):null}_pointToXYZ(t){return this._toXYZ(this._helper.pointToVector(t))}_computeNeighbor(t,i,s,n){const o=P();if(i){Ts(o,t,i);const a=!this._passesBisectingAngleThreshold(o,s);return{start:t,end:i,direction:a?this._bisectVectorsPerpendicular(s,o):o,isOriginalDirection:!a}}return this._helper.hasZ()?n&&(ut(o,s,n.direction),ut(o,o,s),gt(o,o),Math.sign(o[1])!==Math.sign(s[0])&&zi(o,o,-1)):at(o,-s[1],s[0],0),{start:t,end:i,direction:o,isOriginalDirection:!0}}_passesBisectingAngleThreshold(t,i){const s=Math.abs(jr(i,t));return s>=Rs&&s<=Math.PI-Rs}_bisectVectorsPerpendicular(t,i){const s=ei(t,i)<0?t:xs(P(),t),n=Math.abs(ei(s,i));if(!(n<Is||n>1-Is))return this._bisectDirection(s,i);const o=ut(P(),s,[0,0,1]);return gt(o,o)}_bisectDirection(t,i){const s=mt(P(),t,i);return gt(s,s)}_initializePlane(){const t=this._computeNormalDirection(this._left),i=this._computeNormalDirection(this._right);ei(t,i)<0&&xs(i,i),Kr(this._left.start,this._bisectDirection(t,i),this._plane)}_computeNormalDirection(t){const i=ut(P(),t.direction,this._edgeDirection);gt(i,i);const s=ut(P(),this._edgeDirection,i);return this._planeType===Fi.XY&&(s[2]=0),gt(s,s)}_initializeDistanceConstraints(){this._left.end==null||this.requiresSplitEdgeLeft||this._updateDistanceConstraint(Ct(this._plane,this._left.end)),this._right.end==null||this.requiresSplitEdgeRight||this._updateDistanceConstraint(Ct(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(t){t<=0&&(this._minDistance=Math.max(this._minDistance,t)),t>=0&&(this._maxDistance=Math.min(this._maxDistance,t))}_updateIntersectDistanceConstraint(t){const i=Ci(t),s=this._edgeDirection,n=mt(P(),this._left.start,this._left.direction),o=mt(P(),this._right.start,this._right.direction),a=this._pointInBasis2D(qe(),i,s,this._left.start),c=this._pointInBasis2D(qe(),i,s,n),p=this._pointInBasis2D(qe(),i,s,this._right.start),d=this._pointInBasis2D(qe(),i,s,o),[u]=ur({start:c,end:a,type:ys.LINE},{start:d,end:p,type:ys.LINE});if(!u)return;const h=ws(qe(),a,c);Ar(h,h);const m=ws(qe(),u,c),y=zr(h,m),b=mt(P(),n,zi(P(),this._left.direction,-y)),f=Ct(t,b);this._updateDistanceConstraint(f)}_pointInBasis2D(t,i,s,n){return t[0]=Ss(i,n),t[1]=Ss(s,n),t}_offset(t,i){Number.isFinite(this._minDistance)&&(i=Math.max(this._minDistance,i)),Number.isFinite(this._maxDistance)&&(i=Math.min(this._maxDistance,i)),Si(this._offsetPlane,this._plane),this._offsetPlane[3]-=i;const s=(o,a,c)=>a!=null&&ea(this._offsetPlane,o,mt(P(),o,a),c),n=P();(t===this._edge.leftVertex?s(this._left.start,this._left.direction,n):s(this._right.start,this._right.direction,n))&&this._helper.copy(this._helper.fromXYZ(n,void 0,this._helper.getM(t.pos)),t.pos)}selectArrowFromStartPoint(t){this._selectedArrow=Qr(this.plane,this._pointToXYZ(t))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(t){return Ct(this.plane,this._pointToXYZ(t))}clampedStartAndEnd(t){const i=this._helper.toXYZ(this._helper.pointToVector(t)),s=Jr(this._plane,i,P()),n=Ct(this._plane,i),o=Ii(n,this._minDistance,this._maxDistance);return is(i,s,i,o/n),{start:s,end:i}}apply(t){this._offset(t,this.distance)}undo(t){this._offset(t,0)}canAccumulate(t){return t instanceof Bi&&this._edge.leftVertex.index===t._edge.leftVertex.index&&this._edge.rightVertex.index===t._edge.rightVertex.index&&this._edge.component===t._edge.component&&this._maybeEqualsVec3(this._left.direction,t._left.direction)&&this._maybeEqualsVec3(this._right.direction,t._right.direction)&&Gi(Ci(this._plane),Ci(t._plane))}accumulate(t,i){const s=this._plane[3]-i._plane[3]+i.distance;this._offset(t,s)}accumulateParams(t){const i=t.distance-t._plane[3];this.distance=i+this._plane[3]}clone(){const t=new Bi(this._helper,this._planeType,this._edge,this.distance,Dt.DEFERRED);return Si(t._plane,this._plane),Si(t._offsetPlane,this._offsetPlane),t._maxDistance=this._maxDistance,t._minDistance=this._minDistance,t._left=this._cloneNeighbor(this._left),t._right=this._cloneNeighbor(this._right),t._edgeDirection=yt(P(),this._edgeDirection),t}_maybeEqualsVec3(t,i){return t==null&&i==null||t!=null&&i!=null&&Gi(t,i)}_cloneNeighbor({start:t,end:i,direction:s,isOriginalDirection:n}){return{start:yt(P(),t),end:i!=null?yt(P(),i):null,direction:yt(P(),s),isOriginalDirection:n}}};const Rs=no(15),Is=.001;var Fi,Dt;(function(e){e[e.XYZ=0]="XYZ",e[e.XY=1]="XY"})(Fi||(Fi={})),function(e){e[e.IMMEDIATE=0]="IMMEDIATE",e[e.DEFERRED=1]="DEFERRED"}(Dt||(Dt={}));let ll=class Pn{constructor(t,i,s=ge.CUMULATIVE){this.origin=t,this.angle=i,this._accumulationType=s}_rotate(t,i){Gr(t.pos,t.pos,this.origin,i)}apply(t){this._rotate(t,this.angle)}undo(t){this._rotate(t,-this.angle)}canAccumulate(t){return t instanceof Pn&&zt(this.origin,t.origin)}accumulate(t,i){const s=i._accumulationType===ge.REPLACE;this._rotate(t,s?i.angle-this.angle:i.angle)}accumulateParams(t){const i=t._accumulationType===ge.REPLACE;this.angle=i?t.angle:this.angle+t.angle}},cl=class Vn{constructor(t,i,s,n,o=ge.CUMULATIVE){this.origin=t,this.axis1=i,this.factor1=s,this.factor2=n,this._accumulationType=o,this.axis2=Jt(i[1],-i[0])}_scale(t,i,s){bs(t.pos,t.pos,this.origin,this.axis1,i),bs(t.pos,t.pos,this.origin,this.axis2,s)}apply(t){this._scale(t,this.factor1,this.factor2)}undo(t){this._scale(t,1/this.factor1,1/this.factor2)}canAccumulate(t){return t instanceof Vn&&zt(this.origin,t.origin)&&zt(this.axis1,t.axis1)}accumulate(t,i){i._accumulationType===ge.REPLACE?this._scale(t,i.factor1/this.factor1,i.factor2/this.factor2):this._scale(t,i.factor1,i.factor2)}accumulateParams(t){const i=t._accumulationType===ge.REPLACE;this.factor1=i?t.factor1:this.factor1*t.factor1,this.factor2=i?t.factor2:this.factor2*t.factor2}},pl=class On{constructor(t,i){this._editGeometry=t,this._newPositions=i}apply(){const t=this._originalPositions==null?"apply":"redo";if(!this._originalPositions){const i=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map(s=>i.clone(s.pos))}this._apply(t,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(t){return t instanceof On&&(this._newPositions=t._newPositions,this._apply("apply",this._newPositions),!0)}_apply(t,i){const s=this._editGeometry.coordinateHelper,n=this._editGeometry.allVertices;for(let o=0;o<n.length;o++)s.copy(i[o],n[o].pos);this._editGeometry.components.forEach(o=>o.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:n})}};var Ln;const dl=Symbol();let hl=class{constructor(e){this._operations=[],this._closed=!1,this[Ln]=!0,e&&(this._operations=e,this._closed=!0)}close(){this._closed=!0}apply(){for(const e of this._operations)e.apply()}undo(){for(let e=this._operations.length-1;e>=0;e--)this._operations[e].undo()}accumulate(e){if(this._closed)return!1;const t=this._operations.length?this._operations[this._operations.length-1]:null;return t&&t.accumulate(e)||(this._operations.push(e),e.apply()),!0}};Ln=dl;let Zi=class kn extends He{constructor(t,i){super(),this.data=t,this.viewingMode=i,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",s=>{s.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:s.addedVertices,operation:s.operation}),s.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:s.removedVertices,operation:s.operation}),s.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:s.updatedVertices,operation:s.operation})})}destroy(){this._listener.remove()}splitEdge(t,i){return this._apply(new sl(this.data,t,i))}updateVertices(t,i,s=te.ACCUMULATE_STEPS){return this._apply(new tl(this.data,t,i),s)}move(t,i,s,n=te.ACCUMULATE_STEPS){return Pt(this.data)?this._apply(new ks(this.data,t,i,s),n):this.moveVertices(this.data.allVertices,t,i,s,n)}moveVertices(t,i,s,n,o=te.ACCUMULATE_STEPS){return Pt(this.data)?this._apply(new ks(this.data,i,s,n),o):this.updateVertices(t,new rl(this.data.coordinateHelper,i,s,n),o)}scale(t,i,s,n,o=te.ACCUMULATE_STEPS,a=ge.CUMULATIVE){return this.scaleVertices(this.data.allVertices,t,i,s,n,o,a)}scaleVertices(t,i,s,n,o,a=te.ACCUMULATE_STEPS,c=ge.CUMULATIVE){return this.updateVertices(t,new cl(i,s,n,o,c),a)}rotate(t,i,s=te.ACCUMULATE_STEPS,n=ge.CUMULATIVE){return this.rotateVertices(this.data.allVertices,t,i,s,n)}rotateVertices(t,i,s,n=te.ACCUMULATE_STEPS,o=ge.CUMULATIVE){return this.updateVertices(t,new ll(i,s,o),n)}removeVertices(t){return this._apply(new il(this.data,t,this._minNumVerticesPerType))}appendVertex(t){return this.data.components.length===0?null:this._apply(new el(this.data,this.data.components[0],t))}setVertexPosition(t,i){return this._apply(new nl(this.data,t,i))}offsetEdge(t,i,s,n=te.ACCUMULATE_STEPS){return this.updateVertices([i.leftVertex,i.rightVertex],new al(this.data.coordinateHelper,t,i,s),n)}trySetGeometry(t,i=te.ACCUMULATE_STEPS){const{data:s}=this,{coordinateHelper:n}=s;if(s.type!==t.type||!s.spatialReference.equals(t.spatialReference)||n.hasZ()!==t.hasZ||n.hasM()!==t.hasM||!oo(s.geometry,t)||Pt(s))return;const o=Array.from(Hi.fromGeometry(t,this.viewingMode).iterateVertices(),a=>a.pos);return this.setVertexPositions(o,i)}setVertexPositions(t,i=te.ACCUMULATE_STEPS){return this._apply(new pl(this.data,t),i)}createResetState(){if(Pt(this.data))return this._createResetStateMesh();const t=this.data.geometry.clone();return it(()=>this.trySetGeometry(t))}closeComponent(t){return this.data.components.includes(t)?this._apply(new ol(this.data,t)):null}canRemoveVertex(t){return t.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const t=new hl;return this._apply(t),it(()=>t.close())}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();return t.undo(),this._redoStack.push(t),t}return null}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();return t.apply(),this._undoStack.push(t),t}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(t,i=te.ACCUMULATE_STEPS){return i!==te.NEW_STEP&&this.lastOperation!=null&&this.lastOperation.accumulate(t)||(t.apply(),this._undoStack.push(t),this._redoStack=[]),t}_createResetStateMesh(){if(!Pt(this.data))return it();const t=this.data.geometry,{vertexSpace:i}=t;if(i.origin){const n=ro(i.origin);return it(()=>{t.vertexSpace.origin=n})}const s=t.vertexAttributes.clonePositional();return it(()=>{t.vertexAttributes=s,t.vertexAttributesChanged()})}static fromGeometry(t,i){return new kn(Hi.fromGeometry(t,i),i)}};function ti(e,t){return e===t||e!=null&&t!=null&&Ys(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function Pi(e,t,i){return e===t||e!=null&&t!=null&&Ys(e.spatialReference,t.spatialReference)&&Zt(e.x,t.x,i)&&Zt(e.y,t.y,i)&&Zt(e.z??0,t.z??0,i)&&Zt(e.m??0,t.m??0,i)}var st;(function(e){e[e.WhenToolEditable=0]="WhenToolEditable",e[e.WhenToolNotEditable=1]="WhenToolNotEditable",e[e.Always=2]="Always"})(st||(st={}));let ul=class{constructor(){this._isToolEditable=!0,this._manipulators=new Me,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=st.WhenToolEditable){this.addMany([e],t)}addMany(e,t=st.WhenToolEditable){for(const i of e){const s={manipulator:i,visibilityPredicate:t,attached:!1};this._manipulators.add(s),this._attached&&this._updateManipulatorAttachment(s)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const i=this._manipulators.splice(t,1)[0];this._detachManipulator(i);break}}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:e})=>e.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,i=>{t(i)})}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach(t=>e.push(t.manipulator)),e}intersect(e,t){let i=null,s=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:n,attached:o})=>{if(!o||!n.interactive)return;const a=n.intersectionDistance(e,t);a!=null&&a<s&&(s=a,i=n)}),i}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===st.Always||(this._isToolEditable?e.visibilityPredicate===st.WhenToolEditable:e.visibilityPredicate===st.WhenToolNotEditable)}},q=class extends ce{constructor(e){super(e),this.manipulators=new ul,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[Ye.MANAGER,!0],[Ye.USER,!0]]),this._creationFinishedResolver=ao()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(Ye.USER)}set editable(e){this.setEditableFlag(Ye.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===Ye.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){const e=this.view.inputManager.latestPointerLocation;if(!e)return;let t=!1;this.manipulators.forEach(({manipulator:i})=>{i.dragging&&(t=!0,i.events.emit("drag",{action:"end",start:e,screenPoint:e}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(Ye.USER)&&this.getEditableFlag(Ye.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};r([l({constructOnly:!0})],q.prototype,"view",void 0),r([l({readOnly:!0})],q.prototype,"active",null),r([l({value:!0})],q.prototype,"visible",null),r([l({value:!0})],q.prototype,"editable",null),r([l({readOnly:!0})],q.prototype,"manipulators",void 0),r([l({readOnly:!0})],q.prototype,"updating",null),r([l()],q.prototype,"cursor",null),r([l({readOnly:!0})],q.prototype,"automaticManipulatorSelection",void 0),r([l()],q.prototype,"hasFocusedManipulators",null),r([l()],q.prototype,"hasGrabbedManipulators",void 0),r([l()],q.prototype,"hasHoveredManipulators",void 0),r([l()],q.prototype,"firstGrabbedManipulator",void 0),r([l({readOnly:!0})],q.prototype,"created",void 0),r([l({readOnly:!0})],q.prototype,"removeIncompleteOnCancel",void 0),q=r([R("esri.views.interactive.InteractiveToolBase")],q);function gl(e,t){let i=null,s=null;return n=>{if(n.action==="cancel")return void(s!=null&&(s.execute({action:"cancel"}),i=null,s=null));const o={action:n.action,screenStart:n.start,screenEnd:n.screenPoint};n.action==="start"&&i==null&&(i=new Ni,s=new Ni,t(e,i,s,n.pointerType,o)),i==null||i.execute(o),n.action==="end"&&i!=null&&(i=null,s=null)}}function Vi(e,t){return e.events.on("drag",gl(e,t))}function qp(e,t){const i=[e.x,e.y,e.z??0],s=t,n=[Math.cos(s),Math.sin(s)],o=Math.sqrt(n[0]*n[0]+n[1]*n[1]);if(o===0)return null;n[0]/=o,n[1]/=o;const a=c=>{const p=(c.x-i[0])*n[0]+(c.y-i[1])*n[1];c.x=i[0]+p*n[0],c.y=i[1]+p*n[1]};return c=>(a(c.mapStart),a(c.mapEnd),{...c,axis:n})}function ml(e){let t=null;return i=>{if(i.action==="start"&&(t=yl(e,i.mapStart.spatialReference)),t==null)return null;const s=i.mapEnd.x-i.mapStart.x,n=i.mapEnd.y-i.mapStart.y,o=(i.mapEnd.z??0)-(i.mapStart.z??0);return t.move(s,n,o,i.action),{...i,translationX:s,translationY:n,translationZ:o}}}function Ds(e,t){return e==null?null:e.spatialReference.equals(t)?e.clone():ri(e,t)}function yl(e,t){const i=e.operations;if(!i)return null;const s=i.data.geometry,n=qr(t);if(s.spatialReference.equals(n))return Oi(e,i,()=>{});if(s.type!=="mesh"){const o=Ds(s,n);if(o==null)return null;const a=s.spatialReference;return Oi(e,Zi.fromGeometry(o,i.viewingMode),()=>{const c=ri(s,a);i.trySetGeometry(c)})}if(Yr(s)){const o=Ds(s.origin,n);if(!o)return null;const a=s.spatialReference,c=Zi.fromGeometry(o,i.viewingMode);return Oi(e,i,()=>{const p=ri(c.data.geometry,a),d=p.x-s.origin.x,u=p.y-s.origin.y,h=(p.z??0)-(s.origin.z??0);i.move(d,u,h)})}return null}function Oi(e,t,i){let s=0,n=0,o=0;return{move:(a,c,p,d)=>{var y;d==="start"&&(s=0,n=0,o=0);const u=a-s,h=c-n,m=p-o;t.move(u,h,m),s+=u,n+=h,o+=m,i(),d==="end"&&((y=e.endInteraction)==null||y.call(e))}}}function jp(e,t=null,i){var a;let s=null;const n=t==null||(a=e.spatialReference)!=null&&a.equals(t)?c=>c:c=>c!=null?ri(c,t):c,o={exclude:[],...i};return c=>{if(c.action==="start"&&(s=n(e.toMap(c.screenStart,o))),s==null)return null;const p=n(e.toMap(c.screenEnd,o));return p!=null?{...c,mapStart:s,mapEnd:p}:null}}function Kp(e){const t=e.map(i=>ml(i)).filter(le);return i=>{const s=i.mapEnd.x-i.mapStart.x,n=i.mapEnd.y-i.mapStart.y,o=i.mapEnd.z-i.mapStart.z;return t.forEach(a=>a(i)),{...i,translationX:s,translationY:n,translationZ:o}}}function _l(e){var i;const t=(i=e.operations)==null?void 0:i.createResetState();return s=>(t==null||t.remove(),s)}function Qp(e){const t=e.map(i=>_l(i)).filter(i=>i!=null);return i=>(t.forEach(s=>s(i)),i)}function Jp(){let e=0,t=0,i=0;return s=>{s.action==="start"&&(e=s.mapStart.x,t=s.mapStart.y,i=s.mapStart.z);const n=s.mapEnd.x-e,o=s.mapEnd.y-t,a=s.mapEnd.z-i;return e=s.mapEnd.x,t=s.mapEnd.y,i=s.mapEnd.z,{...s,mapDeltaX:n,mapDeltaY:o,mapDeltaZ:a,mapDeltaSpatialReference:s.mapStart.spatialReference}}}function ed(){let e=0,t=0;return i=>{i.action==="start"&&(e=i.screenStart.x,t=i.screenStart.y);const s=i.screenEnd.x-e,n=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,{...i,screenDeltaX:s,screenDeltaY:n}}}function td(e,t){let i=null,s=0,n=0;return o=>{var d;if(o.action==="start"&&(i=(d=e.toScreen)==null?void 0:d.call(e,t),i!=null&&(i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(s=o.screenStart.x-i.x,n=o.screenStart.y-i.y))),i==null)return null;const a=Ii(o.screenEnd.x-s,0,e.width),c=Ii(o.screenEnd.y-n,0,e.height),p=ci(a,c);return o.screenStart=i,o.screenEnd=p,o}}const vl=()=>{};let Ni=class Rn{constructor(){this.execute=vl}next(t,i=new Rn){return t!=null&&(this.execute=s=>{const n=t(s);n!=null&&i.execute(n)}),i}};function fl(e,t,i=[]){if(e.type==="2d")return n=>n;let s=null;return n=>{n.action==="start"&&(s=e.toMap(n.screenStart,{exclude:i}),s!=null&&(s.z=oi(s,e,t)));const o=e.toMap(n.screenEnd,{exclude:i});o!=null&&(o.z=oi(o,e,t));const a=s!=null&&o!=null?{sceneStart:s,sceneEnd:o}:null;return{...n,scenePoints:a}}}function As(e,t,i){const s=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,n=pi(e);return n.z=s,n.hasZ=!0,n.z=oi(n,t,i),n}function id(e,t){if(e.type==="2d")return s=>s;let i=null;return s=>{s.action==="start"&&(i=As(s.mapStart,e,t));const n=As(s.mapEnd,e,t),o=i!=null&&n!=null?{sceneStart:i,sceneEnd:n}:null;return{...s,scenePoints:o}}}let Ui=class{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ,this.drawConstraints=e.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}},je=class extends ce{constructor(e){super(e),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=ji(async(t,i,s,n)=>{const o=this._frameTask;if(o==null)return;const a=await o.schedule(()=>i.snap({...t,context:s,signal:n}),n);a.valid&&await o.schedule(()=>{this.stagedPoint=a.apply(),t!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=i.update({...this._snapPoints,context:s}))},n)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var t,i;const e=this.view.type==="3d"?(i=(t=this.view)==null?void 0:t.resourceController)==null?void 0:i.scheduler:null;this._frameTask=e!=null?e.registerTask(vn.SNAPPING):fn}destroy(){this._abortController=Ai(this._abortController),this._frameTask=rt(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:s,scenePoint:n}=e,o=t.update({point:s,scenePoint:n,context:i});return this.stagedPoint=o,o}async snap(e,t,i){const{point:s,scenePoint:n}=e;return this.stagedPoint=t.update({point:s,scenePoint:n,context:i}),this._snapPoints=e,this._abortController==null&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){this._snapPoints!=null&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=Ai(this._abortController),this._snapPoints=null}};r([l({constructOnly:!0})],je.prototype,"view",void 0),r([l()],je.prototype,"stagedPoint",null),r([l()],je.prototype,"constrainResult",void 0),r([l()],je.prototype,"_stagedPoint",void 0),je=r([R("esri.views.interactive.snapping.SnappingOperation")],je);function zs(e){let t,i,s=[],n=!1;function o(...a){return n&&t===this&&wl(a,s)||(i=e.apply(this,a),t=this,s=a,n=!0),i}return o}function wl(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}const In="click";let bl=class{constructor({consumesClicks:e,grabbableForEvent:t}){this.events=new He,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=t}destroy(){}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};function sd(e,t,i,s,n,o){let a="geodesic",c=sa(i);const p=bt();return es(e,t,s,p),p[2]=0,c&&di(p,i,p,c)||(a="euclidean",c=i),{mode:a,view:t,elevationInfo:s,hasZ:n,directionMode:o,spatialReference:e.spatialReference,measurementSR:c,origin:p}}function Tl(e,t,i){if(t==null||e==null)return;const s=lr(i.measurementSR);if(s==null)return;const n=ui(e,i);if(n==null)return;const o=ss(t,s);return new Tr(n,o)}function xl(e,t,i,s){if(i==null||e==null)return;const n=ui(e,s);if(n==null)return;const o=ft(i),a=10,c=d=>{if(d==null)return;const u=bt(),h=ia(d,"degrees","geographic");return Er(u,n,s.measurementSR,a,h,s.mode)?new Mr(n,u):void 0},p=()=>{if(t!=null&&e!=null)return ft(hn(t,e))};switch(s.directionMode){case vt.Absolute:return c(o);case vt.Relative:{const d=p();return d==null?void 0:c(d+o)}case vt.RelativeBilateral:{const d=p();return d==null?void 0:dn([c(d+o),c(d-o)])}}}function Dn(e,t){const i=gi(e,t);return i!=null?new xr(i):void 0}function An(e,t,i){const{context:s,longitude:n,latitude:o,direction:a,distance:c,elevation:p}=i;if(n!=null||o!=null||c!=null||p!=null||a!=null){if(n!=null||o!=null){const d=ft(n),u=ft(o),h=gi(p,s);return new pn(d,u,h)}return El(e,t,i)}}function El(e,t,{context:i,direction:s,distance:n,elevation:o}){if(t==null)return Dn(o,i);const{view:a,elevationInfo:c,measurementSR:p}=i,d=es(t,a,c);if(!p||!di(d,t.spatialReference,Gs,p))return;const[u,h]=Gs,m=n!=null?ss(n,"meters"):void 0,y=ft(s),b=gi(o,i),f=D=>{const B=new Sr([u,h],p,m,b,D);return m==null||D==null||b==null&&i.hasZ?B:new Cr(B.closestTo(d))};if(y==null)return f(void 0);const N=()=>{if(e!=null&&t!=null)return ft(hn(e,t))};switch(i.directionMode){case vt.Absolute:return f(y);case vt.Relative:{const D=N();return D==null?void 0:f(D+y)}case vt.RelativeBilateral:{const D=N();return D==null?void 0:dn([f(D+y),f(D-y)])}}}function Ml(e){return e.context.mode==="geodesic"?An(null,null,e):zn(e)}function Sl(e,t,i){const{context:s,x:n,y:o,distance:a,direction:c,elevation:p}=i;return s.mode==="geodesic"?An(t,e,i):n!=null||o!=null?zn(i):Cl([Tl(e,a,s),xl(e,t,c,s),Dn(p,s)])}function zn({x:e,y:t,elevation:i,context:s}){Xt.x=(e==null?void 0:e.value)??0,Xt.y=(t==null?void 0:t.value)??0,Xt.spatialReference=s.spatialReference;const n=ui(Xt,s,Ol);return new pn(e!=null&&n!=null?n[0]:void 0,t!=null&&n!=null?n[1]:void 0,gi(i,s))}function Cl(e){let t;for(const i of e)i&&(t=(t==null?void 0:t.intersect(i))??i);return t}function ui(e,t,i=bt()){const{view:s,elevationInfo:n,measurementSR:o,origin:a,mode:c}=t;if(es(e,s,n,i),di(i,e.spatialReference,i,o))return c!=="geodesic"&&_n(i,i,a),i}function Pl(e,t,i,s){const{view:n,measurementSR:o,spatialReference:a,origin:c,mode:p}=i;if(p==="geodesic"?yt(Vt,e):mt(Vt,e,c),di(Vt,o,Vt,a))return _r(Vt,n,t,i,s)}function gi(e,t){var i;return((i=Vl(e,t))==null?void 0:i.value)??void 0}function Vl(e,{view:t,origin:i,elevationInfo:s,hasZ:n,measurementSR:o}){if(e==null||!n)return;const a=Wo(o);if(a==null)return;const[c,p]=i,d=ss(e,a),u=(t==null?void 0:t.type)==="3d"?wr(t,c,p,d,o,s):d;return u!=null?ta(u,a):void 0}const Gs=bt(),Ol=bt(),Vt=bt(),Xt=ns(0,0,0,Gt.WGS84);function Ll({predicate:e=()=>!0,snappingManager:t,snappingContext:i,updatingHandles:s,useZ:n=!0}){const o=new Ni;if(t==null)return{snappingStep:[$s,o],cancelSnapping:$s};let a,c=null,p=null,d=null;const u=()=>{c=Ai(c),t.doneSnapping(),p==null||p.frameTask.remove(),p=null,a=rt(a),d=null},h=kl(t,n,o);let m=null,y=null,b=null;return{snappingStep:[f=>{if(!e(f))return f;const{action:N}=f;if(N==="start"){const{info:D}=f,B=Rl(t.view);if(p=Il(i,f,B),p.context.selfSnappingZ=null,!n&&D!=null){const me=Al(i.coordinateHelper,D.handle.component);me!=null&&(p.context.selfSnappingZ={value:me,elevationInfo:i.elevationInfo??gr})}}if(p!=null){const{context:D,originalScenePos:B,originalPos:me}=p,{mapEnd:Fe,mapStart:Ze,scenePoints:se}=f,Le=Gn(me,Wi(Fe,Ze)),lt=Wi(Ze,me),_={...f,action:"update"},w=p.context,v=Dl(B,se),L=t.update({point:Le,scenePoint:v,context:D});if(b=L,$n(Fe,L,lt,n),m=Le,y=v,N!=="end"){const{frameTask:z}=p;c==null&&(c=new AbortController),d=pe=>{s.addPromise(Ge(h({frameTask:z,event:_,context:w,point:Le,scenePoint:v,delta:lt,getLastState:()=>({point:m,scenePoint:y,updatePoint:pe.forceUpdate?null:b})},c.signal)))},d({forceUpdate:!1}),a==null&&(a=I(()=>t.options.effectiveEnabled,()=>d==null?void 0:d({forceUpdate:!0})))}}return N==="end"&&u(),f},o],cancelSnapping:f=>(u(),f)}}function kl(e,t,i){return ji(async({frameTask:s,point:n,scenePoint:o,context:a,event:c,delta:p,getLastState:d},u)=>{const h=await s.schedule(()=>e.snap({point:n,scenePoint:o,context:a,signal:u}),u);if(h.valid){let m=await s.schedule(()=>h.apply(),u);const y=d();y.point!=null&&n!==y.point&&(m=e.update({point:y.point,scenePoint:y.scenePoint,context:a})),y.updatePoint!=null&&ti(m,y.updatePoint)||($n(c.mapEnd,m,p,t),i.execute(c))}})}function Rl(e){return e.type==="3d"?e.resourceController.scheduler.registerTask(vn.SNAPPING):fn}function Il(e,t,i){return{context:new Ui({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:t.info!=null?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:t.snapOrigin!=null?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:t.scenePoints!=null?t.scenePoints.sceneStart:null,frameTask:i}}function Gn(e,[t,i,s]){const n=pi(e);return n.x+=t,n.y+=i,n.hasZ&&(n.z+=s),n}function Dl(e,t){return e==null||t==null?null:Gn(e,Wi(t.sceneEnd,t.sceneStart))}function Wi(e,t){const i=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,i]}function $n(e,t,[i,s,n],o){e.x=t.x+i,e.y=t.y+s,o&&e.hasZ&&t.hasZ&&(e.z=t.z+n)}function Al(e,t){if(!e.hasZ())return null;const i=t.vertices;let s=null;for(const n of i){const o=e.getZ(n.pos);if(s!=null&&o!=null&&Math.abs(o-s)>1e-6)return null;s==null&&(s=o)}return s}function $s(e){return e}const zl="crosshair",Gl="progress",Hs=Symbol(),Bs=Symbol();let x=class extends He.EventedMixin(ce){constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new kr,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new Dr,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=zs(Ml),this._getPolylineOrPolygonConstraint=zs(Sl),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new on,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,e.elevationInfo==null&&(this.elevationInfo=mr(!!e.hasZ))}initialize(){const{geometryType:e,view:t}=this,i=t.spatialReference,s="viewingMode"in t.state?t.state.viewingMode:gn.Local,n=e==="segment"||e==="multipoint"?"polyline":e;this.coordinateHelper=Tn(this.hasZ,this.hasM,i),this._editGeometryOperations=new Zi(new Hi(n,this.coordinateHelper),s),this._snappingOperation=new je({view:t}),this.addHandles([I(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:c,constraint:p},d)=>{const{snappingOptions:u}=this;if(u&&(u.forceDisabled=p!=null&&vr(p)),d!=null&&c===d.stagedPoint&&p!==d.constraint)return this._onKeyboardBasedChange();this._processCursor(c??this._screenToMap(this._stagedScreenPoint))},{equals:(c,p)=>c.stagedPoint===p.stagedPoint&&Io(c.constraint,p.constraint)}),I(()=>this.view.viewpoint,(c,p)=>{c&&p&&Ir(c,p)&&this._onKeyboardBasedChange()})]),this._activeComponent=new hi(i,s),this._editGeometryOperations.data.components.push(this._activeComponent);const o=this.segmentLabels;o!=null&&(o.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(I(()=>this.labelOptions.enabled,c=>{o.visible=c},It))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],c=>{var y,b,f,N;const p=c.vertices.map(D=>({componentIndex:0,vertexIndex:D.index,coordinates:this.coordinateHelper.vectorToArray(D.pos)})),d=p.map(D=>D.coordinates),u=this.coordinateHelper.vectorToDehydratedPoint((y=this._activeComponent.getFirstVertex())==null?void 0:y.pos)??null;ti(u,this.firstVertex)||(this.firstVertex=u);const h=this.coordinateHelper.vectorToDehydratedPoint((b=this._activeComponent.getLastVertex())==null?void 0:b.pos)??null;ti(h,this.lastVertex)||(this.lastVertex=h);const m=this.coordinateHelper.vectorToDehydratedPoint((N=(f=this._activeComponent.edges.at(-1))==null?void 0:f.leftVertex)==null?void 0:N.pos)??null;switch(ti(m,this.secondToLastVertex)||(this.secondToLastVertex=m),this._processCursor(this.cursorVertex),c.type){case"vertex-add":this.emit(c.type,{...c,added:d,vertices:p});break;case"vertex-update":this.emit(c.type,{...c,updated:d,vertices:p});break;case"vertex-remove":this.emit(c.type,{...c,removed:d,vertices:p})}}));const a=this._manipulator=new bl({consumesClicks:!1,grabbableForEvent:c=>this.drawingMode!=="click"||c.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(a),a.grabbable=e!=="point"&&e!=="multipoint",this.addHandles([a.events.on("immediate-click",c=>this._onImmediateClick(c)),a.events.on("immediate-double-click",c=>this._onImmediateDoubleClick(c)),I(()=>this.drawingMode,()=>{this.removeHandles(Hs),this.addHandles(this._createManipulatorDragPipeline(a),Hs)},It),I(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:c})=>{a.cursor=c},It)]),yr(this,()=>{const c=this.view.inputManager.latestPointerType??"mouse",p=this._getSnappingContext(c);if(this.snappingManager!=null){const d=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,p);this._updatingHandles.addPromise(Ge(d))}})}destroy(){Ee(this.segmentLabels),Ee(this._snappingOperation),this._editGeometryOperations=Ee(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:e,_manipulator:t}=this;return e!=null&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const e=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}get _constraint(){const{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case"point":case"multipoint":return this._getPointConstraint(e);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set("drawingMode",e??In)}get effectiveCursor(){return this.loading?Gl:this._hideDefaultCursor?null:this.cursor||zl}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:e,lastVertex:t,firstVertex:i,geometryType:s}=this;return s==="polygon"&&Pi(e,i)||Pi(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:e,committableVertex:t,coordinateHelper:i}=this,s=e.slice();return t!=null&&s.push(i.pointToArray(t)),s}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:e}=this;e!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}complete(e){var o;const t=(e==null?void 0:e.aborted)||!1;this._snappingOperation.abort(),(o=this.snappingManager)==null||o.doneSnapping();const{geometryType:i,numCommittedVertices:s}=this,n=i==="multipoint"&&s===0||i==="polyline"&&s<2||i==="polygon"&&s<3;i!=="segment"&&i!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!n,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((a,c)=>({componentIndex:0,vertexIndex:c,coordinates:a})),aborted:t,type:"complete"}))}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){var a,c;const t=Di(this.cursorVertex),i=Di(e),s=i&&(((a=this._updateAndGetEffectiveDrawSurface())==null?void 0:a.constrainZ(i))??i),n=this._snapToClosingVertex(s),o=this._applyConstraints(n);Pi(t,o)||(this._set("cursorVertex",o),(c=this.segmentLabels)==null||c.set("stagedVertex",o!=null?this.coordinateHelper.pointToVector(o):null),o==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(o)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(e){if(e==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return e;const t=this._mapToScreen(e);if(!t)return e;const i=this._activeComponent;return this._vertexWithinPointerDistance(i.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(i.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return Vi(e,(t,i,s,n)=>{const o=n==="touch"&&this._snappingEnabled;if(this.isCompleted||!o)return;const{snappingStep:a,cancelSnapping:c}=Ll({predicate:()=>o,snappingManager:this.snappingManager,snappingContext:new Ui({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:n,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});s=s.next(p=>(o&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),p)).next(c),i.next(this._screenToMapDragEventStep()).next(p=>(p.action==="start"&&(this._processCursor(p.mapStart),(this.geometryType==="segment"||o&&!this.numCommittedVertices)&&this.commitStagedVertex()),p)).next(fl(this.view,this.elevationInfo)).next(...a).next(p=>(o&&(this._processCursor(p.mapEnd),p.action==="end"&&this.commitStagedVertex()),p)).next(p=>(p.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),p))})}_createManipulatorDragPipelineFreehand(e){return Vi(e,(t,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(s=>(s.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(s.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),s)).next(s=>{switch(s.action){case"start":case"update":this._processCursor(s.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return s})})}_createManipulatorDragPipelineHybrid(e){return Vi(e,(t,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(s=>(s.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),Bs),this._processCursor(s.mapStart),this.commitStagedVertex()),s)).next(s=>{switch(s.action){case"start":case"update":this._processCursor(s.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(Bs),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return s})})}get _drawAtFixedElevation(){const{constraintsEnabled:e,constraintZ:t,geometryType:i,numCommittedVertices:s}=this;return e?t!=null||i==="segment"&&s>0:(i==="segment"||i==="polygon")&&s>0}_updateAndGetEffectiveDrawSurface(){var p;const{constraintsEnabled:e,coordinateHelper:t,drawSurface:i,elevationDrawSurface:s,snapToSceneEnabled:n}=this;if(s==null)return i;if(!this.hasZ)return s.defaultZ=null,s;const o=(p=this.elevationInfo)==null?void 0:p.mode;let a=this.defaultZ,c=e||o==="absolute-height";return n!=null&&(c=n),o==="on-the-ground"&&(c=!1),this._drawAtFixedElevation&&(a=(e?this.constraintZ:null)??t.getZ(this._activeComponent.vertices[0].pos),c=!1),c?i:(s.defaultZ=a,s)}_mapToScreen(e){var t;return(t=this._updateAndGetEffectiveDrawSurface())==null?void 0:t.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),this.drawingMode==="click"&&e.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!(e.pointerType==="mouse"&&e.button===2||this._manipulator.dragging))try{const{drawingMode:t,geometryType:i}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;const s=this._screenToMap(e.screenPoint);if(s==null||s==null||t==="freehand"&&i!=="point"&&i!=="multipoint")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(s),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),e.pointerType!=="mouse"&&this._processCursor(null),(t==="freehand"&&this.geometryType!=="multipoint"||i==="point"||i==="segment"&&this.numCommittedVertices===2||i==="segment"&&t==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),e.stopPropagation())}_onPointerMove(e){const t=ci(e.x,e.y);this._stagedScreenPoint=t,this._stagedPointerType=e.pointerType,this._stagedPointerId=e.pointerId,this._isDragging?this._snappingOperation.abort():(e.stopPropagation(),this._processCursorMovementRelativeToSurface(t,e.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){var c;const i=this._snappingOperation,s=this._screenToMap(e),n=this._requiresScenePoint?(c=this.drawSurface)==null?void 0:c.screenToMap(e):null;if(s==null)return this._hideDefaultCursor=!0,this._processCursor(null),void i.abort();this._hideDefaultCursor=!1;const o=this.snappingManager;if(o==null)return this._processCursor(s),void i.abort();const a=this._getSnappingContext(t);this._updatingHandles.addPromise(Ge(i.snap({point:s,scenePoint:n},o,a)))}_applyConstraints(e){const{_constraint:t,constraints:i}=this;if(!e||!i||!t)return e;const{context:s}=i,n=ui(e,s),o=n?t.closestTo(n):void 0;if(!o)return e;const a=Pl(o,e,s),c=this.view.type==="2d"||s.elevationInfo.mode!=="absolute-height";return a!=null&&c&&this.constraintZ!=null&&this.hasZ&&(a.z=this.constraintZ),a}_screenToMap(e){var t;return e?(t=this._updateAndGetEffectiveDrawSurface())==null?void 0:t.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if(t.action==="start"&&(e=this._screenToMap(t.screenStart)),e==null)return null;const i=this._screenToMap(t.screenEnd);return i!=null?{...t,mapStart:e,mapEnd:i}:null}}_vertexWithinPointerDistance(e,t){const i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return i!=null&&$l(i,t,25)}_getSnappingContext(e){var i;const t=this._drawAtFixedElevation?(i=this.elevationDrawSurface)==null?void 0:i.defaultZ:null;return new Ui({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:t!=null?{value:t,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function $l(e,t,i){const s=e.x-t.x,n=e.y-t.y;return s*s+n*n<=i}r([l()],x.prototype,"_hideDefaultCursor",void 0),r([l()],x.prototype,"_stagedPointerId",void 0),r([l()],x.prototype,"_isDragging",null),r([l()],x.prototype,"_snappingOperation",void 0),r([l()],x.prototype,"_snappingEnabled",null),r([l({constructOnly:!0})],x.prototype,"graphic",void 0),r([l()],x.prototype,"constraintsEnabled",void 0),r([l()],x.prototype,"constraints",void 0),r([l()],x.prototype,"_constraint",null),r([l()],x.prototype,"constraintZ",void 0),r([l()],x.prototype,"defaultZ",void 0),r([l()],x.prototype,"isDraped",void 0),r([l({value:In})],x.prototype,"drawingMode",null),r([l({constructOnly:!0})],x.prototype,"elevationDrawSurface",void 0),r([l({constructOnly:!0})],x.prototype,"elevationInfo",void 0),r([l({constructOnly:!0,type:on})],x.prototype,"labelOptions",void 0),r([l({constructOnly:!0})],x.prototype,"geometryType",void 0),r([l({constructOnly:!0})],x.prototype,"hasM",void 0),r([l({constructOnly:!0})],x.prototype,"hasZ",void 0),r([l()],x.prototype,"cursor",void 0),r([l()],x.prototype,"effectiveCursor",null),r([l()],x.prototype,"loading",void 0),r([l({constructOnly:!0})],x.prototype,"manipulators",void 0),r([l({constructOnly:!0})],x.prototype,"drawSurface",void 0),r([l({constructOnly:!0})],x.prototype,"segmentLabels",void 0),r([l({constructOnly:!0})],x.prototype,"snappingManager",void 0),r([l({constructOnly:!0})],x.prototype,"snappingVisualizer",void 0),r([l()],x.prototype,"snapToSceneEnabled",void 0),r([l({readOnly:!0})],x.prototype,"cursorVertex",null),r([l({readOnly:!0})],x.prototype,"visualizationCursorVertex",null),r([l()],x.prototype,"committableVertex",null),r([l()],x.prototype,"firstVertex",void 0),r([l()],x.prototype,"lastVertex",void 0),r([l()],x.prototype,"secondToLastVertex",void 0),r([l()],x.prototype,"updating",null),r([l({constructOnly:!0})],x.prototype,"view",void 0),x=r([R("esri.views.draw.DrawOperation")],x);let nd=class{constructor(e,t,i,s=null){this._elevationInfo=e,this.defaultZ=t,this._view=i,this._excludeGraphics=s}screenToMap(e){const{defaultZ:t,_view:i}=this,s=i.sceneIntersectionHelper.intersectElevationFromScreen(lo(e.x,e.y),this._elevationInfo,t??0,this._excludeGraphics);return t==null&&s!=null&&(s.z=void 0),s}mapToScreen(e){const t=ns(e.x,e.y,rn(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}constrainZ(e){const{defaultZ:t}=this;return t!=null&&e.z!==t&&((e=pi(e)).z=t),e}},od=class{constructor(e,t,i=[]){this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude,excludeLabels:!0});return t!=null&&(t.z=oi(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return this.elevationInfo!=null&&(t=ns(e.x,e.y,rn(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}constrainZ(e){return e}},rd=class{constructor(e,t=!1,i=0){this.view=e,this.hasZ=t,this.defaultZ=i,this.mapToScreen=s=>e.toScreen(s),this.screenToMap=t?s=>{const n=e.toMap(s);return n.z=i,n}:s=>e.toMap(s)}constrainZ(e){const{defaultZ:t}=this;return this.hasZ&&e.z!==t&&((e=pi(e)).z=t),e}},Xi=class Hn{screenToMap(t){const{x:i,y:s}=t;return new Z({x:i,y:s,spatialReference:Hn.spatialReference})}mapToScreen(t){return ci(t.x,t.y)}constrainZ(t){return t}};Xi.spatialReference=new Gt;function ai(e,t,i=null){return i!=null?[e,t,i]:[e,t]}function A(e,t,i=null){return i!=null?{x:e,y:t,z:i}:{x:e,y:t}}let Bn=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(t=>this.mapToLocal(t)).filter(le)}get doUnnormalization(){return!1}};class Fn extends Bn{constructor(t,i,s=null){super(i),this._defaultZ=s,this.transform=vs(),this.transformInv=vs(),this.transform=Lr(t),oa(this.transformInv,this.transform)}makeMapPoint(t,i){return ai(t,i,this._defaultZ)}mapToLocal(t){return A(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return ai(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}}let Hl=class extends Bn{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=P(),this.tangentFrameUpWS=P(),this.tangentFrameRightWS=P(),this.tangentFrameForwardWS=P(),this.localFrameRightWS=P(),this.localFrameUpWS=P(),this.worldToLocalTransform=Cs(),this.localToWorldTransform=Cs(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Ti.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Ti.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Ti.Z,this.tangentFrameForwardWS);const s=P();zi(s,this.tangentFrameForwardWS,ei(i,this.tangentFrameForwardWS)),_n(this.localFrameRightWS,i,s),gt(this.localFrameRightWS,this.localFrameRightWS),ut(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),ra(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),aa(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,t){return ai(e,t,this.defaultZ)}mapToLocal(e){const t=P();this.view.renderCoordsHelper.toRenderCoords(new Z({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Es(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new Z({spatialReference:this.view.spatialReference}));return i!=null?A(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=P();this.view.renderCoordsHelper.toRenderCoords(new Z({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Es(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new Z({spatialReference:this.view.spatialReference}));return i!=null?ai(i.x,i.y,this.defaultZ):null}};function ad(e,t){if(e.type==="2d")return new Fn(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if(e.type==="3d"){const i=t.length>2?new Z({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new Z({x:t[0],y:t[1],spatialReference:e.spatialReference});return new Hl(e,i)}return null}const Bl={absolute:"absolute-direction",relative:"relative-direction"},Fl={hide:"hide",hideChildren:"hide-children"};function li(e){return(e==null?void 0:e.listMode)??void 0}function Zl(e){return e!=null&&"minScale"in e&&e.minScale!=null?e.minScale:void 0}function Nl(e){return e!=null&&"maxScale"in e&&e.maxScale!=null?e.maxScale:void 0}function Ul(e){if(!e)return"inherited";const t=Xl(Nn(e)?e.layer:e);return t!=null?t?"independent":"inherited":"visibilityMode"in e&&e.visibilityMode!=null?e.visibilityMode:"independent"}function Zn(e){if(e&&(!("type"in e)||e.type!=="wmts"))return"sublayers"in e?"sublayers":"layers"in e?"layers":void 0}function rs(e){return li(e)!==Fl.hide}function Wl(e,t){if(!e||t==null||isNaN(t))return!1;const i=Zl(e),s=Nl(e),n=i!=null&&!isNaN(i)&&i>0&&t>i,o=s!=null&&!isNaN(s)&&s>0&&t<s;return n||o}function Fs(e){const t=e==null?void 0:e.layer;return t&&"layers"in t?t.layers:null}function Nn(e){return e!=null&&"layer"in e&&e.layer!=null}function Xl(e){const t=Yl(e);return t!=null&&"supportsSublayerVisibility"in t?t.supportsSublayerVisibility:void 0}function Yl(e){return e&&"capabilities"in e&&e.capabilities!=null&&"exportMap"in e.capabilities?e.capabilities.exportMap:void 0}let j=class extends qs.IdentifiableMixin(Oe){constructor(e,t){super(e,t),this._legend=null,this.className=null,this.content=null,this.flowEnabled=!1,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles([I(()=>this._canCreateLegend,()=>this._createLegend(),ue),I(()=>[this._legend,this._legendOptions],()=>this._updateLegend(),ue)])}destroy(){this._legend=Ee(this._legend)}get _canCreateLegend(){const{content:e,listItem:t}=this;if(!t)return!1;const i="legend";return e===i||e!=null&&!!Array.isArray(e)&&e.includes(i)}get _legendOptions(){const{listItem:e,_legendLayerInfo:t}=this,i=e==null?void 0:e.view;return t&&i?{view:i,layerInfos:[t]}:{}}get _legendLayerInfo(){var o;const e=(o=this.listItem)==null?void 0:o.layer;if(!e||e.type==="subtype-sublayer")return null;const t=Nn(e)?e:null,i=e==null?void 0:e.parent,s=i!=null&&"type"in i&&i.type==="map-image"?t==null?void 0:t.source:null,n="";return s&&i?{layer:i,title:n,sublayerIds:[s.mapLayerId]}:{layer:e,title:n}}get disabled(){var s;const{listItem:e,_legend:t,content:i}=this;return!e||!(Array.isArray(i)&&i.length>1)&&!!t&&(!((s=t.activeLayerInfos)!=null&&s.length)||!e.visibleAtCurrentScale||!e.visible)}set disabled(e){this._overrideIfSome("disabled",e)}get icon(){const{image:e}=this,t=this._getFirstWidget();return this._get("icon")??(!e&&t?t.icon:null)}set icon(e){this._overrideIfSome("icon",e)}get title(){var e;return this._get("title")||(((e=this._getFirstWidget())==null?void 0:e.label)??"")}set title(e){this._override("title",e)}render(){return g("div",{class:"esri-list-item-panel"},this._renderContents())}_renderContent(e){const{_legend:t,disabled:i,open:s}=this;return e&&!i&&s?e==="legend"&&t?g("div",{key:"legend-widget"},t.render()):typeof e=="string"?g("div",{innerHTML:e,key:e}):fs(e)?g("div",{key:"content-widget"},e.render()):e instanceof HTMLElement?g("div",{afterCreate:this._attachToNode,bind:e,key:"content-element"}):null:null}_renderContents(){const{content:e,open:t}=this;return t?Array.isArray(e)?e.map(i=>this._renderContent(i)):this._renderContent(e):null}async _createLegend(){if(Ee(this._legend),this._legend=null,!this._canCreateLegend)return;const{default:e}=await S(()=>import("./Legend-C1YLx_LO-CTVIzdQ5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59]),import.meta.url),t=new e(this._legendOptions);this._legend=t}_attachToNode(e){e.appendChild(this)}_updateLegend(){const e=this._legend;e&&e.set(this._legendOptions)}_getWidget(e){return e==="legend"?this._legend:fs(e)?e:null}_getFirstWidget(){const{content:e}=this;return Array.isArray(e)?e.map(t=>this._getWidget(t)).find(t=>t):this._getWidget(e)}};r([l()],j.prototype,"_legend",void 0),r([l()],j.prototype,"_canCreateLegend",null),r([l()],j.prototype,"_legendOptions",null),r([l()],j.prototype,"_legendLayerInfo",null),r([l()],j.prototype,"className",void 0),r([l()],j.prototype,"content",void 0),r([l()],j.prototype,"disabled",null),r([l()],j.prototype,"flowEnabled",void 0),r([l()],j.prototype,"icon",null),r([l()],j.prototype,"image",void 0),r([l()],j.prototype,"listItem",void 0),r([l()],j.prototype,"open",void 0),r([l()],j.prototype,"title",null),r([l()],j.prototype,"visible",void 0),j=r([R("esri.widgets.LayerList.ListItemPanel")],j);const Un=j;var Rt;const ql=Me.ofType({key:"type",defaultKeyValue:"button",base:co,typeMap:{button:po,toggle:ho}}),Wn=Me.ofType(ql),Li="layer",Yt="child-list-mode",jl="hide";let k=Rt=class extends qs.IdentifiableMixin(ce){constructor(e){super(e),this.actionsSections=new Wn,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(Me.ofType(Rt)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.open=!1,this.panel=null,this.parent=null,this.view=null}initialize(){if(this.addHandles([I(()=>{var e;return[this.layer,(e=this.layer)==null?void 0:e.listMode,this.listModeDisabled]},()=>this._watchLayerProperties(this.layer),ue),I(()=>this.checkPublishStatusEnabled,e=>this._updateChildrenPublishing(e),ue),I(()=>this.view,e=>this._updateChildrenView(e),ue),I(()=>this.panel,e=>this._setListItemOnPanel(e),ue)]),typeof this.listItemCreatedFunction=="function"){const e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){var e;(e=this.panel)==null||e.destroy(),this.children.destroyAll(),this.view=null}get connectionStatus(){const{layerView:e,publishing:t}=this;if(!t&&e&&"connectionStatus"in e)return e.connectionStatus}get error(){var e;return(e=this.layer)==null?void 0:e.loadError}get incompatible(){const{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e))&&!e.spatialReferenceSupported}get layerView(){const{layer:e,view:t}=this;if(!e||!t||e.type==="sublayer")return null;const i=e.type==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(s=>s.layer===i)??null}castPanel(e){var t;return(t=this.panel)!=null&&t.open&&!e.hasOwnProperty("open")&&(e.open=!0),e?new Un(e):null}get sortable(){var e;return((e=this.layer)==null?void 0:e.type)!=="knowledge-graph-sublayer"&&this._get("sortable")}set sortable(e){this._set("sortable",e)}get title(){const e=Ft(this,"layer.layer");return(!e||e&&Ft(this,"layer.layer.loaded"))&&Ft(this,"layer.title")||Ft(this,"layer.attributes.title")||""}set title(e){this._override("title",e)}get publishing(){var i;const{layer:e,checkPublishStatusEnabled:t}=this;return!!(t&&e&&"publishingInfo"in e&&((i=e.publishingInfo)==null?void 0:i.status)==="publishing")}get updating(){const{layerView:e,connectionStatus:t,layer:i,publishing:s}=this;return!s&&!t&&(e?e.updating:(i==null?void 0:i.loadStatus)==="loading"||!1)}get visible(){var e;return!!((e=this.layer)!=null&&e.visible)}set visible(e){const t=this.layer;t&&(t.visible=e)}get visibleAtCurrentScale(){var e,t;return((e=this.layerView)==null?void 0:e.visibleAtCurrentScale)??!Wl(this.layer,(t=this.view)==null?void 0:t.scale)}get visibleAtCurrentTimeExtent(){var e;return((e=this.layerView)==null?void 0:e.visibleAtCurrentTimeExtent)??!0}get visibilityMode(){return Ul(this.layer)}clone(){return new Rt({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildrenPublishing(e){var t;(t=this.children)==null||t.forEach(i=>i.checkPublishStatusEnabled=e)}_updateChildrenView(e){const t=this.children;t&&t.forEach(i=>i.view=e)}_createChildren(e){const{listModeDisabled:t,children:i}=this,s=e.filter(n=>!i.some(o=>o.layer===n));i.addMany(this._createChildItems(s,t))}_destroyChildren(e){const{children:t}=this,i=t.filter(s=>!!s.layer&&!e.includes(s.layer));t.destroyMany(i)}_sortChildren(e){this.children.sort((t,i)=>e.indexOf(i.layer)-e.indexOf(t.layer))}_destroyAllChildren(){this.removeHandles(Yt),this.children.destroyAll()}_watchChildLayerListMode(e){this.removeHandles(Yt),this.listModeDisabled||this.addHandles(e.toArray().map(t=>I(()=>t.listMode,()=>this._compileChildren(e))),Yt)}_compileChildren(e){const t=this.listModeDisabled?e:e==null?void 0:e.filter(i=>li(i)!==jl);e!=null&&e.length?(this._createChildren(t),this._destroyChildren(t),this._sortChildren(t),this._watchChildLayerListMode(e)):this._destroyAllChildren()}_watchSublayerChanges(e){e&&this.addHandles(e.on("change",()=>this._compileChildren(e)),Li)}_initializeChildLayers(e){this._compileChildren(e),this._watchSublayerChanges(e)}_createChildItems(e,t){return e.reverse().map(i=>t||rs(i)?new Rt({layer:i,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,parent:this,view:this.view}):null).filter(le)}_watchLayerProperties(e){if(this.removeHandles(Li),this.removeHandles(Yt),!e)return;if((!this.listModeDisabled&&li(e))==="hide-children")return void this.children.destroyAll();const t=Zn(e);t&&this.addHandles(I(()=>e[t],i=>{e.hasOwnProperty(t)&&this._initializeChildLayers(i)},ue),Li)}};r([l({type:Wn})],k.prototype,"actionsSections",void 0),r([l()],k.prototype,"actionsOpen",void 0),r([l()],k.prototype,"checkPublishStatusEnabled",void 0),r([l({type:Me.ofType(k)})],k.prototype,"children",void 0),r([l()],k.prototype,"childrenSortable",void 0),r([l({readOnly:!0})],k.prototype,"connectionStatus",null),r([l({readOnly:!0})],k.prototype,"error",null),r([l()],k.prototype,"hidden",void 0),r([l({readOnly:!0})],k.prototype,"incompatible",null),r([l()],k.prototype,"layer",void 0),r([l({readOnly:!0})],k.prototype,"layerView",null),r([l()],k.prototype,"listItemCreatedFunction",void 0),r([l({nonNullable:!0})],k.prototype,"listModeDisabled",void 0),r([l()],k.prototype,"open",void 0),r([l({type:Un})],k.prototype,"panel",void 0),r([js("panel")],k.prototype,"castPanel",null),r([l()],k.prototype,"parent",void 0),r([l({value:!0})],k.prototype,"sortable",null),r([l()],k.prototype,"title",null),r([l({readOnly:!0})],k.prototype,"publishing",null),r([l({readOnly:!0})],k.prototype,"updating",null),r([l()],k.prototype,"view",void 0),r([l()],k.prototype,"visible",null),r([l({readOnly:!0})],k.prototype,"visibleAtCurrentScale",null),r([l({readOnly:!0})],k.prototype,"visibleAtCurrentTimeExtent",null),r([l({readOnly:!0})],k.prototype,"visibilityMode",null),k=Rt=r([R("esri.widgets.LayerList.ListItem")],k);const as=k;let de=class extends ce{constructor(e){super(e),this.colorSelection=!0,this.dynamicScaleToggle=!0,this.gridEnabledToggle=!0,this.numericInputs=!0,this.gridSnapEnabledToggle=!0,this.lineIntervalInput=!0,this.outOfScaleWarning=!0,this.placementButtons=!0,this.rotateWithMapToggle=!0}};r([l({type:Boolean,nonNullable:!0})],de.prototype,"colorSelection",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"dynamicScaleToggle",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"gridEnabledToggle",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"numericInputs",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"gridSnapEnabledToggle",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"lineIntervalInput",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"outOfScaleWarning",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"placementButtons",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"rotateWithMapToggle",void 0),de=r([R("esri.widgets.support.GridControls.VisibleElements")],de);const Xn=de;let he=class extends ce{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.gridEnabledToggle=!0,this.header=!1,this.layerList=!0,this.gridControls=!0,this.gridControlsElements=new Xn({gridSnapEnabledToggle:!1,gridEnabledToggle:!1}),this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};r([l({type:Boolean,nonNullable:!0})],he.prototype,"enabledToggle",void 0),r([l({type:Boolean,nonNullable:!0})],he.prototype,"featureEnabledToggle",void 0),r([l({type:Boolean,nonNullable:!0})],he.prototype,"gridEnabledToggle",void 0),r([l({type:Boolean,nonNullable:!0})],he.prototype,"header",void 0),r([l({type:Boolean,nonNullable:!0})],he.prototype,"layerList",void 0),r([l({type:Boolean,nonNullable:!0})],he.prototype,"gridControls",void 0),r([l({type:Xn,nonNullable:!0})],he.prototype,"gridControlsElements",void 0),r([l({type:Boolean,nonNullable:!0})],he.prototype,"layerListToggleLayersButton",void 0),r([l({type:Boolean,nonNullable:!0})],he.prototype,"selfEnabledToggle",void 0),he=r([R("esri.widgets.support.SnappingControls.VisibleElements")],he);const mi=he,Yn=()=>Be({icon:()=>S(()=>import("./index-Buwx-j9b-Bq8GcmfZ.js"),__vite__mapDeps([60,3,1,2,4,5,61,62]),import.meta.url).then(e=>e.i),label:()=>S(()=>import("./index-Hni9f9UA-XY4iOmW6.js"),__vite__mapDeps([63,3,1,2,4,5,64,61]),import.meta.url),switch:()=>S(()=>import("./index-8PAcNuSr-D3QltZa1.js"),__vite__mapDeps([65,3,1,2,4,5,66,61,67,68,69,64,70]),import.meta.url),tooltip:()=>S(()=>import("./index-D4Uosrk4-vvFsHmyw.js"),__vite__mapDeps([71,3,1,2,4,5,66,72,61,73,74,75,76,77]),import.meta.url)}),Ot="esri-labeled-switch",Lt={label:`${Ot}__label`,labelContent:`${Ot}__label-content`,iconInfo:`${Ot}__icon_info`,iconWarning:`${Ot}__icon_warning`,tooltip:`${Ot}__tooltip`};function _t({checked:e,disabled:t,hint:i,key:s,label:n,onChange:o,hintIcon:a,hintKind:c}){return g("calcite-label",{class:Lt.label,disabled:t,key:s,layout:"inline-space-between",scale:"s"},i?g("div",{class:Lt.labelContent,key:"label-content"},g("div",null,n),g("calcite-icon",{class:c!=="warning"?Lt.iconInfo:Lt.iconWarning,icon:a??"information",id:s,scale:"s",tabIndex:0}),g("calcite-tooltip",{class:Lt.tooltip,overlayPositioning:"fixed",referenceElement:s},i)):n,g("calcite-switch",{checked:e,disabled:t,scale:"s",onCalciteSwitchChange:p=>o(p.currentTarget.checked)}))}let Ke=class extends ce{constructor(e){super(e),this.directionModePicker=!1,this.header=!1,this.labelsToggle=!0,this.tooltipsToggle=!0}};r([l({type:Boolean,nonNullable:!0})],Ke.prototype,"directionModePicker",void 0),r([l({type:Boolean,nonNullable:!0})],Ke.prototype,"header",void 0),r([l({type:Boolean,nonNullable:!0})],Ke.prototype,"labelsToggle",void 0),r([l({type:Boolean,nonNullable:!0})],Ke.prototype,"tooltipsToggle",void 0),Ke=r([R("esri.widgets.support.SketchTooltipControls.VisibleElements")],Ke);const ls=Ke,kt="esri-sketch-tooltip-controls",qt={base:kt,block:`${kt}__block`,blockContent:`${kt}__block-content`,hintIcon:`${kt}__hint-icon`,radioButtonLabelWrapper:`${kt}__radio-button-label-wrapper`};let Ie=class extends Oe{constructor(e,t){super(e,t),this.viewModel=null,this.visibleElements=new ls,this.sketchOptions=new an,this.viewType=void 0,this._onTooltipsEnabledChange=i=>{this.sketchOptions.tooltips.enabled=i},this._onLabelsEnabledChange=i=>{this.sketchOptions.labels.enabled=i},this._onDirectionModeChange=i=>{this.sketchOptions.values.directionMode=i.currentTarget.selectedItem.value}}loadDependencies(){return Promise.all([Be({block:()=>S(()=>import("./index-J94OCPzp-DsOvsxIM.js"),__vite__mapDeps([78,79,3,1,2,4,5,74,80,81,66,62,61,60,82,72,73,68,69,70,75,83,84,77,85,86,87,88,89,90,91,76,92,93]),import.meta.url),label:()=>S(()=>import("./index-Hni9f9UA-XY4iOmW6.js"),__vite__mapDeps([63,3,1,2,4,5,64,61]),import.meta.url),icon:()=>S(()=>import("./index-Buwx-j9b-Bq8GcmfZ.js"),__vite__mapDeps([60,3,1,2,4,5,61,62]),import.meta.url).then(e=>e.i),"radio-button":()=>S(()=>import("./index-DjLe4PDK-w2Y_1umE.js"),__vite__mapDeps([94,3,1,2,4,5,66,93,61,67,68,64,70]),import.meta.url),"radio-button-group":()=>S(()=>import("./index-GmJqqGd6--Fm4TzBT.js"),__vite__mapDeps([95,60,3,1,2,4,5,61,62,96,70,97]),import.meta.url)}),Yn()])}render(){const{label:e,visibleElements:t}=this,i=this._renderContent();return g("div",{"aria-label":e,class:this.classes(qt.base,ts.widget)},i?g("calcite-block",{class:qt.block,heading:t.header?this.label:"",key:"content-block",label:this.label,open:!0},g("div",{class:qt.blockContent,key:"content"},i)):void 0)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}_renderContent(){const{visibleElements:e,viewType:t}=this,i=[e.tooltipsToggle?this._renderTooltipsToggle():null,e.labelsToggle&&t!=="2d"?this._renderLabelsToggle():null,e.directionModePicker?this._renderDirectionModePicker():null].filter(le);return i.length===0?null:i}_renderTooltipsToggle(){const{messages:e,sketchOptions:t}=this;return g(_t,{checked:t.tooltips.effectiveEnabled,hint:e.tooltipsToggleHint,key:`${this.id}__tooltips`,label:e.tooltipsToggle,onChange:this._onTooltipsEnabledChange})}_renderLabelsToggle(){const{messages:e,sketchOptions:t}=this;return g(_t,{checked:t.labels.enabled,hint:e.labelsToggleHint,key:`${this.id}__labels`,label:e.labelsToggle,onChange:this._onLabelsEnabledChange})}_renderDirectionModePicker(){const{messages:e,sketchOptions:t}=this,{directionMode:i}=t.values;return g("calcite-label",{key:"direction-mode",layout:"default",scale:"s"},e.directionModePicker,g("calcite-radio-button-group",{key:"radio-button-group",layout:"horizontal",name:this.id,scale:"s",value:i,onCalciteRadioButtonGroupChange:this._onDirectionModeChange},this._renderDirectionModeOption("relative",i,e.directionModeRelative),this._renderDirectionModeOption("absolute",i,e.directionModeAbsolute)))}_renderDirectionModeOption(e,t,i){return g("calcite-label",{key:e,layout:"inline",scale:"s"},g("calcite-radio-button",{checked:e===t,scale:"s",value:e}),g("div",{class:qt.radioButtonLabelWrapper,key:"label-wrapper"},g("calcite-icon",{icon:Bl[e],scale:"s"}),i))}};r([l()],Ie.prototype,"label",null),r([l({type:ls,nonNullable:!0})],Ie.prototype,"visibleElements",void 0),r([l(),$e("esri/widgets/support/SketchTooltipControls/t9n/SketchTooltipControls")],Ie.prototype,"messages",void 0),r([l({nonNullable:!0,type:an})],Ie.prototype,"sketchOptions",void 0),r([l({type:String})],Ie.prototype,"viewType",void 0),Ie=r([R("esri.widgets.support.SketchTooltipControls")],Ie);const Kl=Ie,ye={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},Ql="hide",qn=Me.ofType(as);let be=class extends He.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new qn,this.view=null}initialize(){this.addHandles([I(()=>{var e;return((e=this.view)==null?void 0:e.ready)===!0},()=>this._viewHandles(),ue),I(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),I(()=>Ps(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],ye.view)}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:e}=this;return e!=null&&e.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,s){var m,y;const n=e==null?void 0:e.layer;if(!n||n.type==="subtype-sublayer"||n.type==="sublayer")return;const o=(y=(m=this.view)==null?void 0:m.map)==null?void 0:y.layers,a=t?Fs(t):o,c=i?Fs(i):o;if(!a||!c)return;const{operationalItems:p}=this,d=(t==null?void 0:t.children)||p,u=(i==null?void 0:i.children)||p,h=c.length-s;e.parent=i||null,d.remove(e),a.remove(n),u.includes(e)||u.add(e,h),c.includes(n)||c.add(n,h),this._compileList()}_createLayerViewHandles(e){this.removeHandles(ye.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),ye.layerViews)}_createMapLayerHandles(e){this.removeHandles(ye.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),ye.mapLayers)}_createListItem(e){const{view:t,listItemCreatedFunction:i,checkPublishStatusEnabled:s,listModeDisabled:n}=this;return new as({checkPublishStatusEnabled:s,listModeDisabled:n,layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(t=>li(t)!==Ql):void 0}_watchLayersListMode(e){this.removeHandles(ye.layerListMode),e&&!this.listModeDisabled&&this.addHandles(I(()=>e.filter(t=>"listMode"in t).map(t=>t.listMode).toArray(),()=>this._compileList()),ye.layerListMode)}_compileList(){var s,n;const e=(n=(s=this.view)==null?void 0:s.map)==null?void 0:n.layers,t=Ps(this.view)&&!this.view.inGeographicLayout?e==null?void 0:e.filter(({type:o})=>o==="link-chart"):e;this._watchLayersListMode(t);const i=this._getViewableLayers(t);i!=null&&i.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(i=>{t.some(s=>s.layer===i)||t.add(this._createListItem(i))})}_removeItems(e){const{operationalItems:t}=this,i=[];t.forEach(s=>{s&&e&&e.includes(s.layer)||i.push(s)}),t.destroyMany(i)}_sortItems(e){const{operationalItems:t}=this;t.sort((i,s)=>{const n=e.indexOf(i.layer),o=e.indexOf(s.layer);return n>o?-1:n<o?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([ye.mapLayers,ye.layerViews,ye.viewLayers]),e!=null&&e.ready?this.addHandles([I(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.allLayers},t=>this._createMapLayerHandles(t),ue),I(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},t=>this._createLayerViewHandles(t),ue)],ye.viewLayers):this._removeAllItems()}};r([l()],be.prototype,"checkPublishStatusEnabled",void 0),r([l()],be.prototype,"listItemCreatedFunction",void 0),r([l({nonNullable:!0})],be.prototype,"listModeDisabled",void 0),r([l({type:qn})],be.prototype,"operationalItems",void 0),r([l({readOnly:!0})],be.prototype,"state",null),r([l()],be.prototype,"totalItems",null),r([l()],be.prototype,"view",void 0),be=r([R("esri.widgets.LayerList.LayerListViewModel")],be);const Jl=be,cs=e=>ec(e)||tc(e),ec=e=>{if(!("type"in e))return!1;switch(e.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":case"subtype-sublayer":return!0;default:return!1}},tc=e=>{const t=Zn(e);if(t!=null&&e.hasOwnProperty(t)&&e[t]!=null){for(const i of e[t])if(cs(i))return!0}return!1},ii=(e,t)=>t!=null&&e!=null&&(t.test(e.title)?"self":!!e.children.some(i=>ii(i,t)!==!1)&&"children");var Yi;let Ce=Yi=class extends as{constructor(e){super(e),this.children=new Me,this.parent=null}get enabled(){const{children:e}=this;if(e.length===0)return this.featureSource!=null&&this.featureSource.enabled?"enabled":"disabled";let t=!1,i=!1;for(const s of e){if(s.enabled==="indeterminate")return s.enabled;if(s.enabled==="enabled"?t=!0:s.enabled==="disabled"&&(i=!0),i&&t)return"indeterminate"}return i?"disabled":"enabled"}get childLayerIds(){return this.children.toArray().flatMap(e=>{var t;return[(t=e.layer)==null?void 0:t.id,...e.childLayerIds]})}get featureSource(){const{layer:e,getFeatureSnappingSources:t}=this;return t().find(i=>i.layer===e)}_initializeChildLayers(e){if(!e)return;const t=e.filter(cs);super._initializeChildLayers(t)}_createChildItems(e){return e.map(t=>rs(t)?new Yi({layer:t,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null).filter(le).reverse()}};r([l()],Ce.prototype,"enabled",null),r([l()],Ce.prototype,"children",void 0),r([l()],Ce.prototype,"childLayerIds",null),r([l()],Ce.prototype,"featureSource",null),r([l({constructOnly:!0})],Ce.prototype,"getFeatureSnappingSources",void 0),r([l()],Ce.prototype,"parent",void 0),Ce=Yi=r([R("esri.widgets.support.SnappingControls.SnappingListItem")],Ce);let Qe=class extends Jl{constructor(){super(...arguments),this.featureSnappingSources=new Me}get operationalItemsFlat(){return this.operationalItems.flatten(e=>e.children)}get selectableItems(){return this.operationalItemsFlat.filter(e=>{var t;return!((t=e.children)!=null&&t.length)})}_compileList(){var s,n;const e=(n=(s=this.view)==null?void 0:s.map)==null?void 0:n.layers;if(!e)return;const t=e.filter(cs);this._watchLayersListMode(t);const i=this._getViewableLayers(t);i!=null&&i.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createListItem(e){return new Ce({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}};r([l()],Qe.prototype,"featureSnappingSources",void 0),r([l()],Qe.prototype,"operationalItems",void 0),r([l()],Qe.prototype,"operationalItemsFlat",null),r([l()],Qe.prototype,"selectableItems",null),Qe=r([R("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],Qe);let Te=class extends ce{constructor(e){super(e),this.layerListViewModel=new Qe,this.snappingOptions=new ln,this.view=null}initialize(){this.addHandles([I(()=>({viewModel:this.layerListViewModel,view:this.view}),({viewModel:e,view:t})=>{e.view=t},ue),I(()=>{var e;return{viewModel:this.layerListViewModel,sources:(e=this.snappingOptions)==null?void 0:e.featureSources}},({viewModel:e,sources:t})=>{e.featureSnappingSources=t},ue)])}get allLayersEnabled(){var e;return(((e=this.layerListViewModel)==null?void 0:e.selectableItems)??[]).every(t=>t.enabled==="enabled")}get allLayersDisabled(){var e;return(((e=this.layerListViewModel)==null?void 0:e.selectableItems)??[]).every(t=>!t.enabled)}get layersEnabledCount(){var e,t;return((t=(e=this.layerListViewModel)==null?void 0:e.selectableItems)==null?void 0:t.filter(i=>i.enabled==="enabled").length)??0}get state(){return this.snappingOptions?"ready":"disabled"}toggleSnappingForLayers(e,t){e==null||e.forEach(i=>t?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i))}toggleSnappingForAllLayers(e){this.layerListViewModel.selectableItems.forEach(({layer:t})=>{const i=t==null?void 0:t.id;e?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i)})}enableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e);t&&(t.enabled=!0)}disableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e);t&&(t.enabled=!1)}updateEnabledFeatureSources(e){for(const t of this.snappingOptions.featureSources)rs(t.layer)&&(t.enabled=e.includes(t.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find(t=>t.layer.id===e)}_makeSnappingSourceForLayer(e){var s;const t=(s=this.layerListViewModel.operationalItemsFlat.find(n=>{var o;return((o=n.layer)==null?void 0:o.id)===e}))==null?void 0:s.layer;if(!t)throw new Xo("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);if(t.type==="group")return;const i=new br({layer:t});return this.snappingOptions.featureSources.add(i),i}};r([l()],Te.prototype,"allLayersEnabled",null),r([l()],Te.prototype,"allLayersDisabled",null),r([l({constructOnly:!0})],Te.prototype,"layerListViewModel",void 0),r([l()],Te.prototype,"layersEnabledCount",null),r([l({type:ln,nonNullable:!0})],Te.prototype,"snappingOptions",void 0),r([l()],Te.prototype,"state",null),r([l()],Te.prototype,"view",void 0),Te=r([R("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],Te);const ic=Te,_e="esri-snapping-controls",ve={base:_e,container:`${_e}__container`,item:`${_e}__item`,toggleBlock:`${_e}__toggle-block`,layerListBlock:`${_e}__layer-list-block`,layerList:`${_e}__layer-list`,layerListFilter:`${_e}__layer-list__filter`,layerListButton:`${_e}__layer-list__button`,layerListItem:`${_e}__layer-list__item`,layerListGroup:`${_e}__layer-list__group`,nestedContainer:`${_e}__nested-container`};let F=class extends Oe{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this._gridLoadTask=null,this.layerListOpen=!0,this.gridOptionsOpen=!1,this.messages=null,this.messagesCommon=null,this.snappingManager=null,this.visibleElements=new mi,this._enableSnappingSwitchChange=o=>{this.snappingOptions.enabled=o},this._featureEnabledSwitchChange=o=>{this.snappingOptions.featureEnabled=o},this._gridEnabledSwitchChange=o=>{this.snappingOptions.gridEnabled=o,o&&this._startLoadGrid()},this._selfEnabledSwitchChange=o=>{this.snappingOptions.selfEnabled=o},this._onToggleLayersButtonClick=o=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),Vr(o.target)};const{snappingOptions:i,view:s,viewModel:n}=e;this.viewModel=n??(this._defaultViewModel=new ic({snappingOptions:i,view:s}))}normalizeCtorArgs(e){const{snappingOptions:t,view:i,viewModel:s,...n}=e;return n}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=Ee(this._defaultViewModel))}loadDependencies(){return Promise.all([Be({block:()=>S(()=>import("./index-J94OCPzp-DsOvsxIM.js"),__vite__mapDeps([78,79,3,1,2,4,5,74,80,81,66,62,61,60,82,72,73,68,69,70,75,83,84,77,85,86,87,88,89,90,91,76,92,93]),import.meta.url),button:()=>S(()=>import("./index-BUYNV2Id-D3nItuMw.js"),__vite__mapDeps([98,79,3,1,2,4,5,74,80,60,61,62,66,91,67,68,64,70,85]),import.meta.url),input:()=>S(()=>import("./index-DBbiKKfA-Cr_5FJoU.js"),__vite__mapDeps([99,60,3,1,2,4,5,61,62,96,100,101,66,69,77,91,67,68,64,70,85,97,80]),import.meta.url),list:()=>S(()=>import("./index-CWPudE9o-DaYsCjG_.js"),__vite__mapDeps([102,79,3,1,2,4,5,74,80,81,66,62,61,77,60,96,100,99,101,69,91,67,68,64,70,85,97,73,103]),import.meta.url),"list-item":()=>S(()=>import("./index-CDdEHo-w-9EOp_OnV.js"),__vite__mapDeps([104,60,3,1,2,4,5,61,62,82,66,72,73,74,68,69,70,75,83,79,80,84,77,85,86,87,88,89,103,105]),import.meta.url),checkbox:()=>S(()=>import("./index-CGKRKPuM-CBtp12n5.js"),__vite__mapDeps([106,3,1,2,4,5,66,61,67,68,69,64,70]),import.meta.url),loader:()=>S(()=>import("./index-Cezzb5s0-CBl7RI9K.js"),__vite__mapDeps([79,3,1,2,4,5,74,80]),import.meta.url)}),Yn()])}initialize(){this.addHandles(I(()=>{var e;return((e=this.view)==null?void 0:e.type)==="2d"&&!!this.view.grid},e=>{this.visibleElements.gridControls&&(this.snappingOptions.gridEnabled=e)}))}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(this._defaultViewModel!=null&&this._defaultViewModel===e||(this._defaultViewModel=Ee(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return g("div",{"aria-label":e,class:this.classes(ve.base,ts.widget)},g("div",{class:ve.container},this._renderContent()))}_renderContent(){var e;return[this._renderToggles(),this._renderLayerList(),((e=this.view)==null?void 0:e.type)==="2d"&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){const{visibleElements:e,view:t}=this,i=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null,e.gridEnabledToggle&&(t==null?void 0:t.type)==="2d"?this._renderGridEnabledToggle():null].filter(le),s=[e.enabledToggle?this._renderEnabledToggle():null,i.length>0?g("div",{class:ve.nestedContainer},i):null].filter(le);return s.length===0?null:g("calcite-block",{class:ve.toggleBlock,heading:e.header?this.label:"",key:"toggle-block",label:this.label,open:!0},s)}_renderEnabledToggle(){return g(_t,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return g(_t,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return g(_t,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return g(_t,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){var a;if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,i=t.layerListViewModel.operationalItems.length>9?g("calcite-input",{class:ve.layerListFilter,clearable:!0,placeholder:e==null?void 0:e.searchLayers,onCalciteInputInput:({currentTarget:{value:c}})=>{this._layerListFilter=c===""?null:new RegExp(c,"i")}}):null,s=this._secondaryElementsDisabled,n=this.layerListOpen&&!s,o=(a=t.layerListViewModel.operationalItems)==null?void 0:a.find(c=>!!c.children.length);return g("calcite-block",{class:ve.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,heading:e.snappingLayers,key:"list-block",open:n,onCalciteBlockToggle:c=>this.layerListOpen=c.currentTarget.open},i,this._renderToggleLayersButton(),g("calcite-list",{class:ve.layerList,displayMode:o?"nested":"flat",label:e==null?void 0:e.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems)))}_renderGridOptions(){var d;const{view:e,visibleElements:t,snappingManager:i,snappingOptions:s,_openAndReady:n}=this,{gridEnabled:o,enabled:a}=s;(n||(e==null?void 0:e.type)==="2d"&&e.grid)&&this._startLoadGrid();const c=(d=this._gridLoadTask)==null?void 0:d.value,p=c&&(e==null?void 0:e.type)==="2d"&&g(c,{snappingManager:i,snappingOptions:s,view:e,visibleElements:t.gridControlsElements});return g("calcite-block",{class:ve.layerListBlock,collapsible:!0,disabled:!o||!a,heading:this.messages.gridOptionsHeading,key:"grid-block",open:n,onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},p??g("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}async _startLoadGrid(){var e;!this._gridLoadTask&&this.visibleElements.gridControls&&((e=this.view)==null?void 0:e.type)==="2d"&&(this._gridLoadTask=sn(async()=>(await S(async()=>{const{default:t}=await import("./GridControls-CEUIsZ2n-U4cB-MU1.js");return{default:t}},__vite__mapDeps([107,1,2,4,108,109,46,47,48,30,110,3,5,111,15,112,113,114,115,11,116,10,117,118,119,120,37,121,122,123,124,125,126,127,128,56,129,130,12,8,9,131,26,132,133,134,135,136,137,38,138,139,140,58,141,142,143,144,145,146,147,148,149,35,150,151,152,153,154,155,156,44,33,34,157,158,159,50,160,161,162,163,41,164,165,166,167,168,52,169,59,170,171]),import.meta.url)).default))}_renderLayerListItemCollection(e){const t=this._layerListFilter;return e.map(i=>{switch(t?ii(i,t):null){case"children":{const s=i.children.filter(n=>ii(n,t)!==!1);return this._renderLayerListItemGroup(i,s)}case"self":case null:return this._renderLayerListItemOrGroup(i);case!1:return ii(i.parent,t)==="self"?this._renderLayerListItemOrGroup(i):null}}).toArray().filter(le)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,i=e?t.disableAllLayers:t.enableAllLayers;return g("calcite-button",{appearance:"transparent",class:ve.layerListButton,label:i,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},i)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);const{messages:{untitledLayer:t}}=this,i=e.title||t,s=()=>{var n;this.viewModel.toggleSnappingForLayers([(n=e.layer)==null?void 0:n.id],e.enabled!=="enabled")};return g("calcite-list-item",{class:ve.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:i,onCalciteListItemSelect:n=>{n.stopPropagation(),s()}},g("calcite-checkbox",{checked:e.enabled==="enabled",slot:"actions-start",onCalciteCheckboxChange:s}))}_renderLayerListItemGroup(e,t){const{messages:i}=this,{children:s,title:n}=e,o=n||i.untitledLayer,a=n&&n!==""?n:Yo(),c=!!(t!=null&&t.length),p=t??s,d=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,e.enabled!=="enabled")},u=p==null?void 0:p.find(h=>!!h.children.length);return g("calcite-list-item",{class:ve.layerListGroup,key:a,label:o,open:c,onCalciteListItemSelect:h=>{h.stopPropagation(),d()}},g("calcite-checkbox",{checked:e.enabled==="enabled",indeterminate:e.enabled==="indeterminate",slot:"actions-start",onCalciteCheckboxChange:d}),g("calcite-list",{displayMode:u?"nested":"flat",label:i==null?void 0:i.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(p)))}get _enabledToggleDisabled(){const e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};r([l()],F.prototype,"_defaultViewModel",void 0),r([l()],F.prototype,"_layerListFilter",void 0),r([l()],F.prototype,"_gridLoadTask",void 0),r([l()],F.prototype,"_openAndReady",null),r([l()],F.prototype,"label",null),r([l({type:Boolean,nonNullable:!0})],F.prototype,"layerListOpen",void 0),r([l({type:Boolean,nonNullable:!0})],F.prototype,"gridOptionsOpen",void 0),r([l(),$e("esri/widgets/support/SnappingControls/t9n/SnappingControls")],F.prototype,"messages",void 0),r([l(),$e("esri/t9n/common")],F.prototype,"messagesCommon",void 0),r([l()],F.prototype,"snappingOptions",null),r([l()],F.prototype,"snappingManager",void 0),r([l()],F.prototype,"view",null),r([l()],F.prototype,"viewModel",null),r([l({type:mi,nonNullable:!0})],F.prototype,"visibleElements",void 0),r([l()],F.prototype,"_enabledToggleDisabled",null),r([l()],F.prototype,"_secondaryElementsDisabled",null),F=r([R("esri.widgets.support.SnappingControls")],F);const sc=F;let ae=class extends ce{constructor(e){super(e),this.point=!0,this.polyline=!0,this.polygon=!0,this.rectangle=!0,this.circle=!0,this.multipoint=!0,this.mesh=!0,this.freehandPolyline=!1,this.freehandPolygon=!1}};r([l({type:Boolean,nonNullable:!0})],ae.prototype,"point",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"polyline",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"polygon",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"rectangle",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"circle",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"multipoint",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"mesh",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"freehandPolyline",void 0),r([l({type:Boolean,nonNullable:!0})],ae.prototype,"freehandPolygon",void 0),ae=r([R("esri.widgets.Sketch.VisibleElements.CreateToolVisibilityMap")],ae);let nt=class extends ce{constructor(e){super(e),this["rectangle-selection"]=!0,this["lasso-selection"]=!0,this["custom-selection"]=!0}};r([l({nonNullable:!0})],nt.prototype,"rectangle-selection",void 0),r([l({nonNullable:!0})],nt.prototype,"lasso-selection",void 0),r([l({nonNullable:!0})],nt.prototype,"custom-selection",void 0),nt=r([R("esri.widgets.Sketch.VisibleElements.SelectionToolVisibilityMap")],nt);let Q=class extends ce{constructor(e){super(e),this.createTools=new ae,this.directionModePicker=!1,this.duplicateButton=!0,this.deleteButton=!0,this.selectionCountLabel=!0,this.labelsToggle=!0,this.selectionTools=new nt,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new mi,this.tooltipsToggle=!0,this.undoRedoMenu=!0}};r([l({type:ae,nonNullable:!0})],Q.prototype,"createTools",void 0),r([l({type:Boolean,nonNullable:!0})],Q.prototype,"directionModePicker",void 0),r([l({type:Boolean,nonNullable:!0})],Q.prototype,"duplicateButton",void 0),r([l({type:Boolean,nonNullable:!0})],Q.prototype,"deleteButton",void 0),r([l({type:Boolean,nonNullable:!0})],Q.prototype,"selectionCountLabel",void 0),r([l({type:Boolean,nonNullable:!0})],Q.prototype,"labelsToggle",void 0),r([l({type:nt,nonNullable:!0})],Q.prototype,"selectionTools",void 0),r([l({type:Boolean,nonNullable:!0})],Q.prototype,"settingsMenu",void 0),r([l({type:Boolean,nonNullable:!0})],Q.prototype,"snappingControls",void 0),r([l({type:mi,nonNullable:!0})],Q.prototype,"snappingControlsElements",void 0),r([l({type:Boolean,nonNullable:!0})],Q.prototype,"tooltipsToggle",void 0),r([l({type:Boolean,nonNullable:!0})],Q.prototype,"undoRedoMenu",void 0),Q=r([R("esri.widgets.Sketch.VisibleElements")],Q);const J={groupSeparator:1,action:{s:32,m:48,l:64},splitButtonPart:{horizontal:{s:16,m:16,l:24},vertical:{s:16,m:24,l:40}}},jn={splitButton:{horizontal:"chevron-down",vertical:"ellipsis"},overflow:"ellipsis"};function Kn(e,t){var i;return e.vnodeSelector===t?[e]:((i=e.children)==null?void 0:i.flatMap(s=>Kn(s,t)))??[]}const ps=e=>{let t=class extends e{constructor(){super(...arguments),this.priority=0,this.scale="m",this.slot=void 0,this.lastActiveKey=null,this.layout="horizontal"}destroy(){var i;(i=this.measurementManager)==null||i.managedElements.remove(this),this.measurementManager=null}set measurementManager(i){const s=this._get("measurementManager");i!==s&&(s&&s.managedElements.remove(this),this._set("measurementManager",i),i==null||i.managedElements.add(this))}set budgetedLength(i){this.budgetedLength!==i&&(this._set("budgetedLength",i),this.scheduleRender())}get actionChildren(){var i;return((i=this.children)==null?void 0:i.flatMap(s=>Kn(s,"calcite-action")))??[]}get activeChildElement(){var s;const i=this.actionChildren.find(n=>{var o;return((o=n.properties)==null?void 0:o.active)===!0});return i?(this._set("lastActiveKey",(s=i.properties)==null?void 0:s.key),i):this.lastActiveKey?this.actionChildren.find(n=>{var o;return((o=n.properties)==null?void 0:o.key)===this.lastActiveKey}):void 0}_handleClick(i){i!=null&&i.dataset&&"dataset"in i&&i.dataset.actionKey&&(this.lastActiveKey=i.dataset.actionKey)}};return r([l()],t.prototype,"priority",void 0),r([l()],t.prototype,"measurementManager",null),r([l()],t.prototype,"budgetedLength",null),r([l()],t.prototype,"actionChildren",null),r([l()],t.prototype,"activeChildElement",null),r([l()],t.prototype,"scale",void 0),r([l()],t.prototype,"slot",void 0),r([l()],t.prototype,"lastActiveKey",void 0),r([l()],t.prototype,"layout",void 0),t=r([R("esri.widgets.Sketch.support.ResponsiveToolbar.ToolbarGroupBase")],t),t},Zs=Symbol("on-resize-handle-key");let Je=class extends ps(Oe){constructor(e){super(e),this._measuredWidth=0,this._measuredHeight=0,this._measuredElement=null}destroy(){this._measuredElement=null}get lengthOptions(){return[this.layout==="horizontal"?this._measuredWidth:this._measuredHeight]}render(){return g("div",{afterCreate:e=>{this._measuredElement=e.firstElementChild,this.addHandles(Pr(this._measuredElement,()=>{var t,i;this._measuredWidth=((t=this._measuredElement)==null?void 0:t.clientWidth)??0,this._measuredHeight=((i=this._measuredElement)==null?void 0:i.clientHeight)??0}),Zs)},afterRemoved:()=>this.removeHandles(Zs)},this.children)}};r([l()],Je.prototype,"_measuredWidth",void 0),r([l()],Je.prototype,"_measuredHeight",void 0),r([l()],Je.prototype,"lengthOptions",null),r([l()],Je.prototype,"_measuredElement",void 0),Je=r([R("esri.widgets.Sketch.support.ResponsiveToolbar.MeasuredContentGroup")],Je);const nc=Je;let De=class extends ps(Oe){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return Be({action:()=>S(()=>import("./index-CytjfAQD-Rb2XCUlV.js"),__vite__mapDeps([84,79,3,1,2,4,5,74,80,60,61,62,77,66,68,70,85]),import.meta.url),"action-group":()=>S(()=>import("./index-KqP5VmvP-UaYMSNYv.js"),__vite__mapDeps([172,79,3,1,2,4,5,74,80,60,61,62,84,77,66,68,70,85,90,72,73,75,91,76,69,92,93]),import.meta.url).then(e=>e.i),"action-menu":()=>S(()=>import("./index-VtdpGf3k-DTqNxPxa.js"),__vite__mapDeps([92,79,3,1,2,4,5,74,80,60,61,62,84,77,66,68,70,85,90,72,73,75,91,76,69,93]),import.meta.url).then(e=>e.i)})}get minimumLength(){const{actionChildren:e,scale:t}=this;return e.length?this.allowCollapse?J.groupSeparator+J.action[t]*Math.min(e.length,2):J.groupSeparator+J.action[t]*e.length:0}get lengthOptions(){const{actionChildren:e,scale:t,minimumLength:i,allowCollapse:s,priority:n}=this,o=[i];if(e.length<=2||!s||n<1)return o;for(let a=1;a<e.length-1;a++)o.push(i+J.action[t]*a);return o}render(){if(!this.actionChildren.length)return g(un,null,void 0);const{budgetedLength:e,actionChildren:t,activeChildElement:i,layout:s,slot:n,scale:o}=this,a=Math.floor(e/J.action[o]),c=[],p=[];if(a>=t.length)c.push(...t);else{const d=i??c.at(0);if(c.push(...t.slice(0,a-1)),p.push(...t.slice(a-1)),d&&p.includes(d)){const[u]=p.splice(p.indexOf(d),1),h=c.pop();c.push(u),h&&p.unshift(h)}}return g("calcite-action-group",{key:"overflow-button-group",layout:s,onclick:d=>this._handleClick(d.target),slot:n},c.map(d=>this._renderManagedAction(d)),p.length>0?g("calcite-action-menu",{key:"split-button-dropdown",label:this.messagesCommon.more,overlayPositioning:"fixed"},g("calcite-action",{icon:jn.overflow,key:"split-button-dropdown-trigger",scale:o,slot:"trigger",text:this.messagesCommon.more}),p.map(d=>this._renderManagedAction(d))):void 0)}_renderManagedAction(e){var t,i;return g("calcite-action",{...e==null?void 0:e.properties,"data-action-key":(t=e==null?void 0:e.properties)==null?void 0:t.key,text:((i=e==null?void 0:e.properties)==null?void 0:i.text)??""})}};De.vnodeSelector="calcite-action-group",r([l()],De.prototype,"allowCollapse",void 0),r([l()],De.prototype,"minimumLength",null),r([l(),$e("esri/t9n/common")],De.prototype,"messagesCommon",void 0),r([l()],De.prototype,"lengthOptions",null),De=r([R("esri.widgets.Sketch.support.ResponsiveToolbar.OverflowGroup")],De);const oc=De;let Ae=class extends ce{constructor(){super(...arguments),this.measuredElement=null,this.managedElements=new Me,this.availableLength=0,this.layout="horizontal",this._resizeObserver=new ResizeObserver(()=>{this._measure()})}get _sortedElements(){return[...this.managedElements].sort((e,t)=>t.priority-e.priority)}connect(e){this._resizeObserver.disconnect(),this.measuredElement=e,this._resizeObserver.observe(e),this._measure()}allocate(){const e=new Map,{availableLength:t,_sortedElements:i}=this;let s=0;for(const n of i){const o=n.lengthOptions[0];e.set(n,o),s+=o}for(const n of i)for(;s<t;){const o=e.get(n);if(!o)break;const a=n.lengthOptions.find(p=>p>o);if(!a)break;const c=s-o+a;if(c>t)break;e.set(n,a),s=c}for(const[n,o]of e)n.budgetedLength=o}_measure(){const e=this.measuredElement;this.availableLength=e?this.layout==="horizontal"?e.clientWidth??0:e.clientHeight??0:0,this.allocate()}destroy(){this._resizeObserver.disconnect()}};r([l()],Ae.prototype,"measuredElement",void 0),r([l()],Ae.prototype,"managedElements",void 0),r([l()],Ae.prototype,"_sortedElements",null),r([l()],Ae.prototype,"availableLength",void 0),r([l()],Ae.prototype,"layout",void 0),Ae=r([R("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbarManager")],Ae);const rc=Ae,ac={base:"esri-split-button",splitButtonBase:"esri-split-button--split-part"};let et=class extends ps(Oe){constructor(e){super(e),this.messagesCommon=null}loadDependencies(){return Be({action:()=>S(()=>import("./index-CytjfAQD-Rb2XCUlV.js"),__vite__mapDeps([84,79,3,1,2,4,5,74,80,60,61,62,77,66,68,70,85]),import.meta.url),"action-group":()=>S(()=>import("./index-KqP5VmvP-UaYMSNYv.js"),__vite__mapDeps([172,79,3,1,2,4,5,74,80,60,61,62,84,77,66,68,70,85,90,72,73,75,91,76,69,92,93]),import.meta.url).then(e=>e.i),"action-menu":()=>S(()=>import("./index-VtdpGf3k-DTqNxPxa.js"),__vite__mapDeps([92,79,3,1,2,4,5,74,80,60,61,62,84,77,66,68,70,85,90,72,73,75,91,76,69,93]),import.meta.url).then(e=>e.i)})}get minimumLength(){const e=this.actionChildren;return e.length?e.length===1?J.action[this.scale]+J.groupSeparator:J.action[this.scale]+J.splitButtonPart[this.layout][this.scale]+J.groupSeparator:0}get lengthOptions(){const{actionChildren:e,minimumLength:t,layout:i,scale:s,priority:n}=this;if(e.length<2||n<0)return[t];const o=J.groupSeparator+J.action[s]*e.length;return[J.groupSeparator+J.action[s]+J.splitButtonPart[i][s],o]}render(){if(!this.actionChildren.length)return g(un,null,void 0);const{actionChildren:e,minimumLength:t,budgetedLength:i,layout:s,slot:n}=this,o=e.length<2||i>t;return g("calcite-action-group",{key:"split-button-group",layout:s,onclick:a=>this._handleClick(a.target),slot:n},o?this._renderUnSplit():this._renderSplit())}_renderSplit(){const{activeChildElement:e,layout:t,actionChildren:i,scale:s,messagesCommon:n}=this,o=e??i.at(0);if(!o)return;const a=i.filter(c=>c!==o);return[this._renderManagedAction(o),g("calcite-action-menu",{key:"split-button-dropdown",label:n.more,overlayPositioning:"fixed",placement:t==="horizontal"?"bottom-end":"right-end"},g("calcite-action",{class:`${ac.splitButtonBase}--${t}--${this.scale}`,compact:t==="horizontal",icon:jn.splitButton[t],key:"split-button-dropdown-trigger",scale:s,slot:"trigger",text:n.more}),a==null?void 0:a.map(c=>this._renderManagedAction(c)))]}_renderUnSplit(){return this.actionChildren.map(e=>this._renderManagedAction(e))}_renderManagedAction(e){var t,i;return g("calcite-action",{...e==null?void 0:e.properties,"data-action-key":(t=e==null?void 0:e.properties)==null?void 0:t.key,text:((i=e==null?void 0:e.properties)==null?void 0:i.text)??""})}};et.vnodeSelector="calcite-action-group",r([l()],et.prototype,"minimumLength",null),r([l()],et.prototype,"lengthOptions",null),r([l(),$e("esri/t9n/common")],et.prototype,"messagesCommon",void 0),et=r([R("esri.widgets.Sketch.support.ResponsiveToolbar.SplitButton")],et);const fe="esri-responsive-toolbar",we={rulerBase:`${fe}__ruler`,rulerBarHorizontal:`${fe}__ruler--bar`,rulerBarVertical:`${fe}__ruler--bar--vertical`,rulerPadVertical:`${fe}__ruler--pad--vertical`,rulerPadHorizontal:`${fe}__ruler--pad--horizontal`,bar:`${fe}__bar`,barHorizontal:`${fe}__bar--horizontal`,barVertical:`${fe}__bar--vertical`,pad:`${fe}__pad`,padVertical:`${fe}__pad--vertical`,padHorizontal:`${fe}__pad--horizontal`};let ze=class extends Oe{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new rc,this._managedWidgets=new Map}loadDependencies(){return Be({"action-bar":()=>S(()=>import("./index-f5siJR3U-8jlmXN-u.js"),__vite__mapDeps([173,79,3,1,2,4,5,74,80,60,61,62,84,77,66,68,70,85,90,72,73,75,91,76,69,92,93,172,174]),import.meta.url),"action-pad":()=>S(()=>import("./index-DK_RfN06-TOPGHlIc.js"),__vite__mapDeps([175,79,3,1,2,4,5,74,80,60,61,62,84,77,66,68,70,85,90,72,73,75,91,76,69,92,93,172,174]),import.meta.url)})}destroy(){this._measurementManager=Ee(this._measurementManager),this._managedWidgets.forEach(e=>e.destroy()),this._managedWidgets.clear()}set layout(e){const t=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),t!==e&&this.scheduleRender()}render(){const{layout:e,scale:t,barStyle:i}=this,s={layout:e,scale:t,expandDisabled:!0,key:"measured-toolbar"},n=i==="docked"?e==="vertical"?we.rulerBarVertical:we.rulerBarHorizontal:e==="horizontal"?we.rulerPadHorizontal:we.rulerPadVertical;return g("div",null,g("div",{afterCreate:o=>{var a;(a=this._measurementManager)==null||a.connect(o)},class:this.classes(we.rulerBase,n)}),i==="docked"?g("calcite-action-bar",{...s,classes:{[we.barHorizontal]:this.layout==="horizontal",[we.barVertical]:this.layout==="vertical",[we.bar]:!0},overflowActionsDisabled:!0},this._renderChildren()):g("calcite-action-pad",{...s,class:this.classes(we.pad,e==="horizontal"?we.padHorizontal:we.padVertical)},this._renderChildren()))}_renderChildren(){var s;if(!this.children)return;const e=this.children.filter(n=>{var o;return((o=n.properties)==null?void 0:o.key)!==void 0&&"group-kind"in n.properties}),t=new Set,i=e.map(n=>{const o=n.properties,a=o.key;t.add(a);const c=this.barStyle==="docked"?o.slot??void 0:void 0,p=o.priority??0,d=o["group-kind"]??"overflow-group",u=o["allow-collapse"]??!0,h=this._managedWidgets.get(a);if(h)return h.children=n.children,h.priority=p,"allowCollapse"in h&&(h.allowCollapse=u),h.slot=c,h.layout=this.layout,h.scale=this.scale,h.measurementManager=this._measurementManager,h;const m={scale:this.scale,priority:p,measurementManager:this._measurementManager,children:n.children,slot:c,layout:this.layout};switch(d){case"split-button":{const y=new et({...m});return this._managedWidgets.set(a,y),y}case"overflow-group":{const y=new oc({...m,allowCollapse:u});return this._managedWidgets.set(a,y),y}case"measured-content":{const y=new nc({...m});return this._managedWidgets.set(a,y),y}}}).filter(le);return Array.from(this._managedWidgets.keys()).filter(n=>!t.has(n)).forEach(n=>{var o;(o=this._managedWidgets.get(n))==null||o.destroy(),this._managedWidgets.delete(n)}),(s=this._measurementManager)==null||s.allocate(),i.map(n=>n.render())}};r([l()],ze.prototype,"scale",void 0),r([l({value:"horizontal"})],ze.prototype,"layout",null),r([l()],ze.prototype,"barStyle",void 0),r([l()],ze.prototype,"_measurementManager",void 0),r([l()],ze.prototype,"_managedWidgets",void 0),ze=r([R("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],ze);const Ns=ze;function ot(e,t){const i=new Z({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function ld(e,t){return new uo({points:e,spatialReference:t})}function cd(e,t,i){const s=new Pe({paths:e,spatialReference:t});return i&&Ks(s),s}function yi(e,t,i,s=!0){const n=Di(e);n.forEach(a=>{const c=a[0],p=a[a.length-1];zt(c,p)&&a.length!==1||a.push(a[0])});let o=new ie({rings:n,spatialReference:t});return o.rings.forEach(a=>{Qs(a)||a.reverse()}),i&&Ks(o),s&&o.isSelfIntersecting&&Js(t)&&(o=bn(o)),o}function lc(e,t,i){const s=t.mapToLocalMultiple(e),n=[],o={x:s[0].x,y:s[0].y},a={x:s[1].x,y:s[1].y},c=Math.round(a.x-o.x),p=Math.round(a.y-o.y),d=Math.max(Math.abs(c),Math.abs(p));if(i){const u={x:o.x+d,y:o.y+d},h={x:o.x-d,y:o.y-d};n.push(A(u.x,h.y),A(h.x,h.y),A(h.x,u.y),A(u.x,u.y))}else{const u={x:c>0?o.x+d:o.x-d,y:p>0?o.y+d:o.y-d};n.push(A(o.x,o.y),A(u.x,o.y),A(u.x,u.y),A(o.x,u.y))}return Qn(yi([n.map(u=>t.localToMap(u)).filter(le)],t.spatialReference,t.doUnnormalization,!0),n,t)}function cc(e,t,i){let s=t.mapToLocalMultiple(e);if(s.length===1){const c=s[0];s=[A(c.x-48,c.y+48),A(c.x+48,c.y-48),A(c.x+48,c.y-48),A(c.x-48,c.y+48)]}const n=[],o={x:s[0].x,y:s[0].y},a={x:s[1].x,y:s[1].y};if(i){const c=Math.round(a.x-o.x),p=Math.round(a.y-o.y);n.push(A(o.x-c,o.y-p),A(a.x,o.y-p),A(a.x,a.y),A(o.x-c,a.y))}else n.push(A(o.x,o.y),A(a.x,o.y),A(a.x,a.y),A(o.x,a.y));return Qn(yi([n.map(c=>t.localToMap(c)).filter(le)],t.spatialReference,t.doUnnormalization,!0),n,t)}function Qn(e,t,i){const s=jt(t[3],t[2],i),n=jt(t[1],t[2],i),o=jt(t[0],t[1],i),a=jt(t[0],t[3],i);return{geometry:e,midpoints:s!=null&&n!=null&&o!=null&&a!=null?{top:s,right:n,bottom:o,left:a}:null}}function jt(e,t,i){dt[0]=e.x,dt[1]=e.y,dt[2]=0,ht[0]=t.x,ht[1]=t.y,ht[2]=0,is(dt,dt,ht,.5),Kt.x=dt[0],Kt.y=ht[1],Kt.z=ht[2];const s=i.localToMap(Kt);return s!=null?ot(s,i.spatialReference):null}const Kt=A(0,0,0),dt=P(),ht=P();function pc(e,t,i,s){const n=t.mapToLocalMultiple(e);let o=null,a=null;if(i)o=n[0],a=n[1];else{const b=n[0],f=n[1],N=Math.round(f.x-b.x),D=Math.round(f.y-b.y),B=Math.max(Math.abs(N),Math.abs(D));o=A(N>0?b.x+B/2:b.x-B/2,D>0?b.y+B/2:b.y-B/2),a=A(Math.abs(N)>Math.abs(D)?o.x-B/2:o.x,Math.abs(N)>Math.abs(D)?o.y:o.y-B/2)}const c=t.localToMap(o),p=t.localToMap(a);if(c==null||p==null)return null;t.doUnnormalization&&go([[c,p]],t.spatialReference);const d=ot(c,t.spatialReference),u=ot(p,t.spatialReference),h=mo(t.spatialReference);let m=0;if(Js(t.spatialReference))m=h*wn(d,u,null);else{const b=o.x-a.x,f=o.y-a.y;m=h*Math.sqrt(b*b+f*f)*(s||1)}const y=new pa({center:d,radius:m,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:yi(y.rings,y.spatialReference,!1),center:d,edge:u}}function dc(e,t,i){const s=t.mapToLocalMultiple(e),n=s[0],o=s[1],a=Math.round(o.x-n.x),c=Math.round(o.y-n.y),p=A(i?n.x:n.x+a/2,i?n.y:n.y+c/2),d=i?a:a/2,u=i?c:c/2,h=60,m=[],y=2*Math.PI/h;function b(se){const Le=Math.cos(se),lt=Math.sin(se);return A(d*Le+p.x,u*lt+p.y)}for(let se=0;se<h;se++)m.push(b(se*y));m.push(m[0]);const{spatialReference:f,doUnnormalization:N}=t,D=yi([m.map(se=>t.localToMap(se)).filter(le)],f,N,!1),B=t.localToMap(b(Math.PI/2)),me=t.localToMap(b(0)),Fe=t.localToMap(b(-Math.PI/2)),Ze=t.localToMap(b(Math.PI));return{geometry:D,midpoints:B!=null&&me!=null&&Fe!=null&&Ze!=null?{top:ot(B,f),right:ot(me,f),bottom:ot(Fe,f),left:ot(Ze,f)}:null}}let ee=class extends ce{constructor(e){super(e),this.coordinates=void 0,this.strokeDash=[],this.strokeWidth=1,this.strokeColor=[0,0,0,1],this.strokeDashColor=[255,255,255,1],this.fillColor=[0,0,0,0],this.visible=!0,this.isDecoration=!0}get _strokeStyle(){const e=this.strokeColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _strokeBackgroundStyle(){const e=this.strokeDashColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _fillStyle(){const e=this.fillColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _renderCoordinates(){const e=[];if(!this.coordinates)return{coordinates:e,rect:us};const t=qo(jo(Ko(us),this.coordinates),2*this.strokeWidth);t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]+.5),t[3]=Math.ceil(t[3]+.5);for(const i of this.coordinates)e.push([Math.floor(i[0]-t[0])+.5,Math.floor(i[1]-t[1])+.5]);return e.reverse(),{coordinates:e,rect:t}}render(){const{coordinates:e,rect:t}=this._renderCoordinates,i=Qo(t),s=Jo(t);return g("div",{classes:{"esri-outline-overlay-item":!0},styles:{left:t[0]+"px",top:t[1]+"px",width:i+"px",height:s+"px",visibility:this.visible?"visible":"hidden"}},g("svg",{height:s,styles:{display:"block"},width:i},g("polygon",{fill:this._fillStyle,points:e.map(([n,o])=>`${n},${o}`).join(" "),stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),g("polygon",{fill:"transparent",points:e.map(([n,o])=>`${n},${o}`).join(" "),stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.length?this.strokeDash.join(" "):void 0,"stroke-width":this.strokeWidth})))}renderCanvas(){}};r([l()],ee.prototype,"coordinates",void 0),r([l()],ee.prototype,"strokeDash",void 0),r([l()],ee.prototype,"strokeWidth",void 0),r([l()],ee.prototype,"strokeColor",void 0),r([l()],ee.prototype,"strokeDashColor",void 0),r([l()],ee.prototype,"fillColor",void 0),r([l()],ee.prototype,"visible",void 0),r([l()],ee.prototype,"isDecoration",void 0),r([l({readOnly:!0})],ee.prototype,"_strokeStyle",null),r([l({readOnly:!0})],ee.prototype,"_strokeBackgroundStyle",null),r([l({readOnly:!0})],ee.prototype,"_fillStyle",null),r([l({readOnly:!0})],ee.prototype,"_renderCoordinates",null),ee=r([R("esri.views.overlay.OutlineOverlayItem")],ee);const hc=ee;let re=class extends He.EventedMixin(q){constructor(e){super(e),this._overlayItem=void 0,this.geometryType=null,this.mode=null,this.type="draw-screen"}initialize(){this.drawOperation=this._makeDrawOperation();const e=t=>this.drawOperation.on(t,i=>{this._updateVisuals(),this.emit(t,i)});this.addHandles([e("vertex-add"),e("vertex-remove"),e("vertex-update"),e("cursor-update"),e("complete")]),this.finishToolCreation()}destroy(){this.drawOperation=Ee(this.drawOperation),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centeredToggled(e){this._set("centeredToggled",e),this._updateVisuals()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set uniformSizeToggled(e){this._set("uniformSizeToggled",e),this._updateVisuals()}get updating(){var e;return((e=this.drawOperation)==null?void 0:e.updating)??!1}get cursor(){return this.geometryType==="point"?"default":"crosshair"}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}undo(){this.drawOperation.undo()}reset(){}_makeDrawOperation(){const{view:e}=this;return new x({view:e,manipulators:this.manipulators,geometryType:uc(this.geometryType),drawingMode:this.mode,hasZ:!1,defaultZ:0,snapToSceneEnabled:!1,drawSurface:new Xi,hasM:!1,snappingManager:null,snappingVisualizer:null,graphic:null,cursor:this.cursor})}get coordinates(){var o,a,c;const{drawOperation:e}=this;if(!(e!=null&&e.geometryIncludingUncommittedVertices.length))return[];const{coordinateHelper:t}=e,i=e.committableVertex,s=e.committedVertices.slice();i!=null&&s.push(t.pointToArray(i));const n=s.length;switch(this.geometryType){case"circle":case"rectangle":{const p=new Fn(Or,Xi.spatialReference),d=this.geometryType==="circle"?pc:lc,u=this.geometryType==="circle"?dc:cc;if(n===1&&e.isCompleted){const h=s[0],m=p.makeMapPoint(h[0]+gc,h[1]);return((o=d([h,m],p,!0))==null?void 0:o.geometry.rings[0])??[]}if(n===2){const h=this.geometryType!=="rectangle",m=this.centeredToggled!==h,y=this.geometryType!=="rectangle";return(this.uniformSizeToggled!==y?(a=d(s,p,m))==null?void 0:a.geometry.rings[0]:(c=u(s,p,m))==null?void 0:c.geometry.rings[0])??[]}return[]}}return s}_updateVisuals(){var e;if(!this._overlayItem){const t=new hc({strokeDash:[5],strokeDashColor:[255,255,255,255]});(e=this.view.overlay)==null||e.addItem(t),this.addHandles(it(()=>{var i;(i=this.view.overlay)==null||i.removeItem(t),t==null||t.destroy(),this._overlayItem=void 0})),this._overlayItem=t}this._overlayItem.coordinates=this.coordinates}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}};function uc(e){switch(e){case"polygon":case"point":return e;case"circle":case"rectangle":return"segment"}}r([l({value:!1})],re.prototype,"centeredToggled",null),r([l()],re.prototype,"drawOperation",void 0),r([l({value:!0})],re.prototype,"enabled",null),r([l({value:!1})],re.prototype,"uniformSizeToggled",null),r([l({constructOnly:!0})],re.prototype,"geometryType",void 0),r([l({constructOnly:!0})],re.prototype,"mode",void 0),r([l({readOnly:!0})],re.prototype,"type",void 0),r([l({readOnly:!0})],re.prototype,"updating",null),r([l({constructOnly:!0,nonNullable:!0})],re.prototype,"view",void 0),r([l()],re.prototype,"cursor",null),re=r([R("esri.views.draw.DrawScreenTool")],re);const gc=48;async function mc(){return S(()=>import("./geometryEngineJSON-CGn_tfx8-CijjZxZ3.js"),__vite__mapDeps([176,166,167,177]),import.meta.url).then(e=>e.g)}async function yc(){return mc().then(({contains:e,intersects:t,overlaps:i,simplify:s})=>({contains:e,intersects:t,overlaps:i,simplify:s}))}async function _c(e){const{currentSelection:t,selector:i,signal:s,sources:n,view:o}=e;if(!(n!=null&&n.length))return{added:[],removed:[]};const{layers:a,layerViews:c,graphicsLayers:p}=bc(n),d=(await Qi(Promise.all([fc(i,a,o,s),wc(i,c,o,s),vc(i,p,o)]),s)).flat();if(!t)return{added:d,removed:[]};const u=t.toArray(),h=d.filter(y=>!Us(u,y)),m=u.filter(y=>!Us(d,y));return t.removeMany(m),t.addMany(h),{added:h,removed:m}}const vc=async(e,t,i)=>Mc({candidates:t.flatMap(s=>s.graphics.toArray())??[],selector:e,view:i}),fc=async(e,t,i,s)=>{const n=await Ge(xc({selector:e,signal:s,layers:t,view:i}));return n?Jn(n):[]},wc=async(e,t,i,s)=>{const n=await Ge(Tc({selector:e,signal:s,layerViews:t,view:i}));return n?Jn(n):[]};function Jn(e){const t=[];for(let i=0;i<e.length;i++){const s=e[i];s.status==="fulfilled"&&t.push(...s.value)}return t}function bc(e){const t=[],i=[],s=[];return e.forEach(n=>{var o,a;er(n)?t.push(n):(en(n)||tn(n))&&((o=n.layers)!=null&&o.length)?t.push(...n.layers.toArray()):tr(n)&&((a=n.sublayers)!=null&&a.length)?s.push(...n.sublayers.toArray()):ir(n)?s.push(n):Qt(n)&&i.push(n)}),{layers:t,layerViews:i,graphicsLayers:s}}function Us(e,t){if(e.includes(t))return!0;const i=t.getObjectId(),s=i!=null,{layer:n,uid:o}=t;return s?e.some(a=>{if(n===a.layer)return i===a.getObjectId()}):e.some(a=>{if(n===a.layer)return o===a.uid})}async function Tc(e){const{layerViews:t,selector:i,signal:s,view:n}=e;return Qi(Promise.allSettled(t.map(async o=>{const a=o.createQuery(),{geometry:c}=eo(i,o.layer,n);return a.outFields=["*"],a.geometry=c,a.returnGeometry=!0,a.outSpatialReference=n.spatialReference,o.queryFeatures(a,{signal:s}).then(({features:p})=>p)})),s)}async function xc(e){const{layers:t,selector:i,signal:s,view:n}=e;return Qi(Promise.allSettled(t.map(async o=>o.queryFeatures(Ec(o.createQuery(),i,o,n),{signal:s}).then(({features:a})=>a))),s)}function eo(e,t,i){var p;const s="renderer"in t?la({renderer:t.renderer}):0,n=e.type==="point"?ca(e,s,i):e,o="displayField"in t?t.displayField:null,a=sr({displayField:o,fields:t.fields}),c=[t.objectIdField];if(a!=null&&t.fieldsIndex.has(a)&&c.push(a),"globalIdField"in t&&t.globalIdField!=null&&t.fieldsIndex.has(t.globalIdField)&&c.push(t.fieldsIndex.get(t.globalIdField).name),gs(t)&&t.subtypeField!=null&&t.fieldsIndex.has(t.subtypeField)&&c.push(t.fieldsIndex.get(t.subtypeField).name),"utilityNetworks"in i.map&&((p=i.map.utilityNetworks)==null?void 0:p.length)&&(gs(t)||t.type==="feature")){const d=t.fieldsIndex.get("assetgroup"),u=t.fieldsIndex.get("assettype");d!=null&&d.name&&c.push(d.name),u!=null&&u.name&&c.push(u.name)}return{geometry:n,outFields:c}}function Ec(e,t,i,s){const{outFields:n,geometry:o}=eo(t,i,s);return e.outFields=n,e.geometry=o,e.returnGeometry=!0,e.outSpatialReference=s.spatialReference,e}async function Mc(e){const{selector:t,candidates:i,view:s}=e;if(!(i!=null&&i.length)||!t)return[];const{spatialReference:n}=s,o=t,a=await yc();return i.filter(c=>c.geometry&&c.geometry.type!=="mesh"&&a.intersects(n,o,c.geometry))}const Sc=100;let tt=class extends He.EventedAccessor{constructor(e){super(e),this._processTask=null,this.options=null,this.selection=new Me,this.sources=null,this._process=ji(async(t,i)=>{const{callback:s,selector:n,completed:o}=t,a=sn(async c=>{var m;const{options:p,sources:d,selection:u,view:h}=this;if(!(!(d!=null&&d.length)&&!(h!=null&&h.selectionManager.sources.length))&&h){if(n&&d!=null){const y=await _c({currentSelection:u,selector:n,signal:c,sources:d,view:h});o&&(p==null?void 0:p.persistSelection)!==!1&&((m=h.selectionManager)==null||m.updateSelection({current:u.toArray(),...y}))}s&&s()}else u.removeAll()});return Do(i,()=>a.abort()),this._processTask=a,a.promise},Sc)}initialize(){this._setup()}cancel(){var e;this.removeAllHandles(),(e=this._processTask)==null||e.abort()}async _setup(){const{view:e}=this;if(await e.whenReady(),this.destroyed)return;const t=this.options,i=(t==null?void 0:t.createTool)??"rectangle",s=(t==null?void 0:t.mode)??(i==="polygon"?"click":"hybrid"),n=Symbol();this._tool=new re({view:e,mode:s,geometryType:i}),t!=null&&t.selectOnComplete||this.addHandles(this._tool.on(["cursor-update","vertex-add","vertex-remove"],()=>Ge(this._process({selector:this._selectionArea}))),n),this.addHandles([e.on("key-down",o=>{if(!o.repeat)switch(o.key){case Wt.constraint:this._tool.uniformSizeToggled=!0,o.stopPropagation();break;case Wt.center:this._tool.centeredToggled=!0,o.stopPropagation()}}),e.on("key-up",o=>{switch(o.key){case Wt.constraint:this._tool.uniformSizeToggled=!1,o.stopPropagation();break;case Wt.center:this._tool.centeredToggled=!1,o.stopPropagation()}}),this._tool.on("complete",async o=>{this.removeHandles(n);const a=()=>{this.removeAllHandles(),this.emit("complete",{aborted:o.aborted,selection:this.selection.toArray()})};o.aborted?(this.cancel(),this.selection.removeAll(),a()):await this._process({selector:this._selectionArea,callback:a,completed:!0})})],n),this.addHandles(it(()=>e.tools.remove(this._tool))),e.addAndActivateTool(this._tool)}get _selectionArea(){const e=ci(),t=this._tool.coordinates,i=this.view.spatialReference,s=o=>{e.x=o[0],e.y=o[1];const{x:a,y:c}=this.view.toMap(e);return[a,c]};if(t.length===0)return;if(t.length===1||t.every(([o,a])=>o===t[0][0]&&a===t[0][1])){const[o,a]=s(t[0]);return new Z({x:o,y:a,spatialReference:i})}const n=t.map(s);if(n.length!==0)return Qs(n)||n.reverse(),new ie({spatialReference:i,rings:[n]})}};r([l()],tt.prototype,"options",void 0),r([l({readOnly:!0})],tt.prototype,"selection",void 0),r([l()],tt.prototype,"sources",void 0),r([l({constructOnly:!0})],tt.prototype,"view",void 0),tt=r([R("esri.widgets.support.Selector2D.SelectionOperation")],tt);const Cc=tt;let xe=class extends He.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.layerViewPreferenceEnabled=!0,this.sources=null}initialize(){this.addHandles([I(()=>this._sources,e=>{this.activeOperation&&(this.activeOperation.sources=e)})])}destroy(){this._operationHandlesGroup=rt(this._operationHandlesGroup)}get _sources(){const{layerViewPreferenceEnabled:e,sources:t,view:i}=this;return i&&(t!=null&&t.length)?t.flatMap(s=>{if(Qt(s))return s;if(en(s)||tn(s)){const o=s.layers||[],a=o.map(c=>{const p=_s(i,c)||void 0;return e&&Qt(p)?p:c});return a.length?a.toArray():o.length?o.toArray():s}if(!e)return s;const n=_s(i,s)||void 0;return Qt(n)?n:s}):[]}get layers(){return ni($t.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){ni($t.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){const{_sources:e,view:t}=this,i=!(e!=null&&e.length)&&!(t!=null&&t.selectionManager.sources.length);return this.activeOperation?"active":t!=null&&t.ready&&!i?"ready":"disabled"}cancel(){var e;this.state==="active"&&((e=this.activeOperation)==null||e.cancel(),this._set("activeOperation",null))}activate(e){const{_sources:t,state:i,view:s}=this,n=!(t!=null&&t.length)&&!(s!=null&&s.selectionManager.sources.length);if(i==="disabled"||n||!this.view)return;i==="active"&&this.cancel();const o=new Cc({view:this.view,sources:t,options:e});return this._operationHandlesGroup=Ki([o.selection.on("change",a=>this.emit("selection-change",a)),o.once("complete",a=>this._onOperationComplete(a))]),this._set("activeOperation",o),o}_onOperationComplete(e){this._operationHandlesGroup=rt(this._operationHandlesGroup),this._set("activeOperation",null),this.emit("complete",e)}};r([l()],xe.prototype,"_sources",null),r([l({readOnly:!0})],xe.prototype,"activeOperation",void 0),r([l()],xe.prototype,"layers",null),r([l()],xe.prototype,"layerViewPreferenceEnabled",void 0),r([l()],xe.prototype,"sources",void 0),r([l({readOnly:!0})],xe.prototype,"state",null),r([l()],xe.prototype,"view",void 0),xe=r([R("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],xe);const Pc=xe,Ws={lassoTool:!0,rectangleTool:!0},ki="esri-selection-toolbar",Ri={base:ki,container:`${ki}__container`,toolButton:`${ki}__tool-button`};let H=class extends Oe{constructor(e,t){super(e,t),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.defaultLassoToolOptions={createTool:"polygon",mode:"freehand"},this.defaultRectangleToolOptions={createTool:"rectangle"},this.messages=null,this.toolConfigs=[],this.viewModel=new Pc,this.visibleElements={...Ws},this.scale="s",this.layout="horizontal",this._viewModelHandlesGroup=Ki([this.viewModel.on("complete",i=>{this._set("activeToolInfo",null),this.emit("complete",i)})])}destroy(){this._viewModelHandlesGroup=rt(this._viewModelHandlesGroup)}loadDependencies(){return Be({action:()=>S(()=>import("./index-CytjfAQD-Rb2XCUlV.js"),__vite__mapDeps([84,79,3,1,2,4,5,74,80,60,61,62,77,66,68,70,85]),import.meta.url)})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layers(){return ni($t.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(e){ni($t.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=e}get layerViewPreferenceEnabled(){return this.viewModel.layerViewPreferenceEnabled}set layerViewPreferenceEnabled(e){this.viewModel.layerViewPreferenceEnabled=e}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...Ws,...e}}get state(){return this.viewModel.state}get visibleToolCount(){const{view:e,toolConfigs:t,visibleElements:i}=this;return((t==null?void 0:t.length)??0)+((e==null?void 0:e.type)==="2d"?(i.lassoTool?1:0)+(i.rectangleTool?1:0):0)}activate(e){if(this.cancel(),this.state!=="disabled")switch(e){case"lasso":this._activateTool("lasso");break;case"rectangle":this._activateTool("rectangle");break;default:this._activateTool(e)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return g("div",{"aria-label":this.label,class:this.classes(Ri.base,ts.widget)},g("div",{class:Ri.container},this._renderDefaultTools(),this._renderCustomTools()))}_renderDefaultTools(){var e;if(((e=this.view)==null?void 0:e.type)==="2d")return[this._renderRectangleTool(),this._renderLassoTool()]}_renderCustomTools(){var e;if((e=this.toolConfigs)!=null&&e.length)return this.toolConfigs.map(({toolName:t,icon:i,toolKey:s})=>this._renderToolWithTooltip(t,s,i))}_renderLassoTool(){const{messages:e,visibleElements:t}=this;if(!t.lassoTool)return;const i=e.selectByLasso;return this._renderToolWithTooltip("lasso","lasso","lasso-select",i)}_renderRectangleTool(){const{messages:e,visibleElements:t}=this;if(!t.rectangleTool)return;const i=e.selectByRectangle;return this._renderToolWithTooltip("rectangle","rectangle","cursor-marquee",i)}_renderToolWithTooltip(e,t,i,s=e){var o;const n=`${this.id}-tool-${t}`;return g("calcite-action",{active:((o=this.activeToolInfo)==null?void 0:o.toolName)===e,bind:this,class:Ri.toolButton,disabled:this.state==="disabled",icon:i||"selection",id:n,key:n,onclick:()=>this._toggleTool(e),scale:this.scale,text:s,title:s})}_activateTool(e){const t=this._getToolOptions(e);if(!t)return;const i=this.viewModel.activate(t);i&&this._set("activeToolInfo",{toolName:e,operation:i})}_toggleTool(e){if(this.activeToolInfo){const t=this.activeToolInfo.toolName;if(this.cancel(),t===e)return}this._activateTool(e)}_getToolOptions(e){return e==="lasso"?this.defaultLassoToolOptions:e==="rectangle"?this.defaultRectangleToolOptions:this.toolConfigs.find(t=>t.toolName===e)}};r([l({readOnly:!0})],H.prototype,"activeToolInfo",void 0),r([l()],H.prototype,"defaultLassoToolOptions",void 0),r([l()],H.prototype,"defaultRectangleToolOptions",void 0),r([l()],H.prototype,"label",null),r([l()],H.prototype,"layers",null),r([l()],H.prototype,"layerViewPreferenceEnabled",null),r([l(),$e("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],H.prototype,"messages",void 0),r([l()],H.prototype,"sources",null),r([l()],H.prototype,"toolConfigs",void 0),r([l()],H.prototype,"view",null),r([l()],H.prototype,"viewModel",void 0),r([l()],H.prototype,"visibleElements",void 0),r([js("visibleElements")],H.prototype,"castVisibleElements",null),r([l()],H.prototype,"scale",void 0),r([l()],H.prototype,"state",null),r([l()],H.prototype,"layout",void 0),r([l()],H.prototype,"visibleToolCount",null),H=r([R("esri.widgets.support.SelectionToolbar")],H);const Vc=H,ke="esri-sketch",Se={base:ke,vertical:`${ke}--vertical`,docked:`${ke}-bar`,floating:`${ke}-pad`,chipHorizontal:`${ke}__selection-count-chip--horizontal`,chipVertical:`${ke}__selection-count-chip--vertical`,chipVerticalSmall:`${ke}__selection-count-chip--vertical--s`,popoverWrapper:`${ke}__popover-wrapper`},Oc={point:"pin",polyline:"line",polygon:"polygon",rectangle:"rectangle",circle:"circle",multipoint:"pins",mesh:"i3-d-building",freehandPolygon:"freehand-area",freehandPolyline:"freehand"};let M=class extends Oe{constructor(e,t){super(e,t),this._activeCustomToolOptions=null,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.customToolOptions=null,this.customActions=null,this.toolbarKind="floating",this.contextualToolLocation="separate",this.groupCollapsePriorities=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new Q,this._defaultViewModel=null,this._calcitePopoverReferenceElement=null,this._relativeLocation="top",this._popoverOpen=!1,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=(e==null?void 0:e.viewModel)||(this._defaultViewModel=new cn({creationMode:(e==null?void 0:e.creationMode)??"continuous"}))}initialize(){const{layer:e,view:t}=this,i=new Vc({view:(t==null?void 0:t.type)==="2d"?t:null,sources:e?[e]:null,scale:this.scale});this.addHandles([I(()=>this.viewModel,s=>{this._viewModelHandlesGroup=rt(this._viewModelHandlesGroup),s&&(this._viewModelHandlesGroup=Ki([s.on("create",()=>this.scheduleRender()),s.on("update",()=>this.scheduleRender()),s.on("delete",n=>this.emit("delete",n)),s.on("undo",()=>this.scheduleRender()),s.on("redo",()=>this.scheduleRender()),I(()=>s.layer,n=>{this._selectionToolbar&&(this._selectionToolbar.sources=n?[n]:null)}),I(()=>s.view,n=>{this._selectionToolbar&&(this._selectionToolbar.view=(n==null?void 0:n.type)==="2d"?n:null)}),I(()=>s.state,()=>this.notifyChange("state"))]))},It),nr(()=>i.activeToolInfo,()=>this.viewModel.cancel()),i.on("complete",s=>this._onSelectionOperationComplete(s)),I(()=>{const{selectionTools:s}=this.visibleElements;return{lassoTool:!!(s!=null&&s["lasso-selection"]),rectangleTool:!!(s!=null&&s["rectangle-selection"])}},s=>{Object.assign(i.visibleElements,s)},It)]),this._selectionToolbar=i}loadDependencies(){return Be({action:()=>S(()=>import("./index-CytjfAQD-Rb2XCUlV.js"),__vite__mapDeps([84,79,3,1,2,4,5,74,80,60,61,62,77,66,68,70,85]),import.meta.url),chip:()=>S(()=>import("./index-BxtEfqZ2-Hel1rVMr.js"),__vite__mapDeps([178,60,3,1,2,4,5,61,62,66,70,68,69,85,80]),import.meta.url),popover:()=>S(()=>import("./index-B-rP10qG-CYTKs1iL.js"),__vite__mapDeps([90,79,3,1,2,4,5,74,80,60,61,62,84,77,66,68,70,85,72,73,75,91,76,69]),import.meta.url).then(e=>e.i)})}destroy(){var e;(e=this._selectionToolbar)==null||e.destroy(),this._viewModelHandlesGroup=rt(this._viewModelHandlesGroup)}get activeTool(){var n;const e=(n=this._selectionToolbar)==null?void 0:n.activeToolInfo;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}const t=this._effectiveAvailableCreateTools,{activeTool:i,activeCreateToolDrawMode:s}=this.viewModel;return i==="polygon"&&s==="freehand"&&(t!=null&&t.includes("freehandPolygon"))?"freehandPolygon":i==="polyline"&&s==="freehand"&&(t!=null&&t.includes("freehandPolyline"))?"freehandPolyline":this.viewModel.activeTool}get activeTooltip(){return this.viewModel.activeTooltip}get createGraphic(){return this.viewModel.createGraphic}get creationMode(){return this.viewModel.creationMode}set creationMode(e){this.viewModel.creationMode=e}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(e){this.viewModel.defaultUpdateOptions=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}set layout(e){this._set("layout",e),this._selectionToolbar&&(this._selectionToolbar.layout=e)}set scale(e){this._set("scale",e),this._selectionToolbar&&(this._selectionToolbar.scale=e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get state(){var e;return(e=this._selectionToolbar)!=null&&e.activeToolInfo?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get updateGraphics(){return this.viewModel.updateGraphics}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){const t=this._get("viewModel");e!==t&&(t&&t===this._defaultViewModel&&Ee(t),this._set("viewModel",e))}get _effectiveAvailableCreateTools(){const{availableCreateTools:e,view:t,visibleElements:i}=this,s=e==null?void 0:e.filter(n=>{var o;return!!((o=i.createTools)!=null&&o[n])});return(t==null?void 0:t.type)==="3d"?s==null?void 0:s.filter(n=>n!=="multipoint"):s}create(e,t,i){const s=(i==null?void 0:i.createOptions)??t;return this._activeCustomToolOptions=i,Ge(this.viewModel.create(e,s))}update(e,t){return Ge(this.viewModel.update(e,t))}complete(){this.viewModel.complete()}cancel(){var e;(e=this._selectionToolbar)==null||e.cancel(),this.viewModel.cancel(),this._activeCustomToolOptions=null}undo(){var e;this.viewModel.undo(),(e=this.view)==null||e.focus()}redo(){var e;this.viewModel.redo(),(e=this.view)==null||e.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}dismissFloatingElements(){this._popoverOpen=!1}render(){var n,o,a;const{toolbarKind:e,layout:t,scale:i}=this,s=(n=this.customActions)==null?void 0:n.filter(c=>c.position==="selection-toolbar");return g("div",null,g("div",{classes:{[Se.base]:!0,[Se.floating]:e==="floating",[Se.docked]:e==="docked",[Se.vertical]:t==="vertical"}},g(Ns,{barStyle:e,layout:t,scale:i},this._renderSelectionSetItemGroupInline(),g("div",{"group-kind":"split-button",key:"selection-split-button",priority:((o=this.groupCollapsePriorities)==null?void 0:o.get("selectionTools"))??St.Low},this._renderDefaultSelectionButton(),(a=this._selectionToolbar)==null?void 0:a.render(),s==null?void 0:s.map(c=>this._renderToolbarItem(c))),this._renderCreateToolActionGroup(),this._renderUndoRedoMenuItemGroup(),this._renderSettingsMenuItemGroup()),this._renderSelectionSetToolbar(),this._renderSettingsMenuPopover()))}_renderSettingsMenuPopover(){const{messagesCommon:e,snappingOptions:t,view:i,viewModel:s,visibleElements:n}=this;if(!this._calcitePopoverReferenceElement)return;const o={directionModePicker:n.directionModePicker,labelsToggle:n.labelsToggle,tooltipsToggle:n.tooltipsToggle},a=this.layout==="horizontal"?this._relativeLocation==="top"?"bottom-end":"top-end":"right-end";return g("calcite-popover",{closable:!0,focusTrapDisabled:!0,heading:e.settings,label:e.settings,open:this._popoverOpen,overlayPositioning:"fixed",placement:a,referenceElement:this._calcitePopoverReferenceElement,scale:this.scale,onCalcitePopoverBeforeClose:()=>this._popoverOpen=!1,onCalcitePopoverBeforeOpen:c=>this._remeasurePopoverSizes(c.currentTarget),onCalcitePopoverClose:()=>this._refocusOnView()},g("div",{class:Se.popoverWrapper},Object.values(o).includes(!0)?g(Kl,{sketchOptions:s.sketchOptions,viewType:i==null?void 0:i.type,visibleElements:new ls(o)}):void 0,n.snappingControls&&i&&t?g(sc,{snappingManager:this.viewModel.snappingManager,snappingOptions:t,view:i,visibleElements:n.snappingControlsElements}):void 0))}_renderSelectionSetToolbar(){if(this.contextualToolLocation!=="separate")return;const e=this._renderSelectionSetItemGroup();return e!=null&&e.length?g(Ns,{barStyle:this.toolbarKind,layout:this.layout,scale:this.scale},e):void 0}_renderSelectionSetItemGroupInline(){return this.contextualToolLocation==="separate"?[]:this._renderSelectionSetItemGroup()}_renderUndoRedoMenuItemGroup(){var e;return g("div",{"group-kind":"split-button",key:"undo-redo-menu",priority:((e=this.groupCollapsePriorities)==null?void 0:e.get("undoRedo"))??St.Medium,slot:"actions-end"},this._renderUndoButton(),this._renderRedoButton())}_renderSettingsMenuItemGroup(){var s,n;const e=[],t=[];(s=this.customActions)==null||s.forEach(o=>{o.position==="settings-before"?t.push(o):o.position==="settings-after"&&e.push(o)});const i=[...t.map(o=>this._renderToolbarItem(o)),this._renderSettingsMenuButton(),...e.map(o=>this._renderToolbarItem(o))].filter(le);if(i.length)return g("div",{"allow-collapse":!1,"group-kind":"overflow-group",key:"settings-menu",priority:((n=this.groupCollapsePriorities)==null?void 0:n.get("settings"))??St.Max,slot:"actions-end"},i)}_renderSelectionSetItemGroup(){var n,o,a;if(!this.updateGraphics.length)return[];const e=this.contextualToolLocation==="inline-end"?"actions-end":void 0,t=(n=this.customActions)==null?void 0:n.filter(c=>c.position==="before-selection-set"),i=(o=this.customActions)==null?void 0:o.filter(c=>c.position==="after-selection-set"),s=((a=this.groupCollapsePriorities)==null?void 0:a.get("selectionSet"))??St.High;return[g("div",{"group-kind":"measured-content",key:"selection-count-chip-group",priority:s,slot:e},this._renderFeatureCountChip()),g("div",{"allow-collapse":!1,"group-kind":"overflow-group",key:"selection-set-tool-group",priority:s,slot:e},t==null?void 0:t.map(c=>this._renderToolbarItem(c)),this._renderDuplicateButton(),this._renderDeleteButton(),i==null?void 0:i.map(c=>this._renderToolbarItem(c)))]}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return[];const{messages:e,state:t}=this;return this._renderToolbarItem({id:"pointer-select",text:e.selectFeature,icon:"cursor",onclick:this._activateDefaultSelectTool,active:t==="ready"})}_renderCreateToolActionGroup(){var i,s,n;const e=((i=this._effectiveAvailableCreateTools)==null?void 0:i.flatMap(o=>this._renderBuiltInCreateToolItem(o)))??[],t=((s=this.customToolOptions)==null?void 0:s.flatMap(o=>this._renderCustomToolItem(o)))??[];return g("div",{"group-kind":"overflow-group",key:"create-tools-group",priority:((n=this.groupCollapsePriorities)==null?void 0:n.get("createTools"))??St.High},e,t)}_renderBuiltInCreateToolItem(e){return this._renderToolbarItem({id:`${e}-button`,text:this.messages.draw[e],icon:Oc[e],onclick:()=>this._activateCreateTool(e),active:this.activeTool===e&&!this._activeCustomToolOptions})}_renderCustomToolItem(e){var i;const{toolKey:t}=e;return this._renderToolbarItem({id:`custom-${e.toolKey}`,text:e.label,icon:e.icon,onclick:()=>this._activateCreateTool(e.toolName,null,e),active:((i=this._activeCustomToolOptions)==null?void 0:i.toolKey)===t})}_renderUndoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"undo-button",text:this.messages.undo,icon:"undo",disabled:!this.viewModel.canUndo(),onclick:this.undo,flipRTL:!0}):[]}_renderRedoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"redo-button",text:this.messages.redo,icon:"redo",disabled:!this.viewModel.canRedo(),onclick:this.redo,flipRTL:!0}):[]}_renderSettingsMenuButton(){return this.visibleElements.settingsMenu?this._renderToolbarItem({id:"settings-menu-action",text:this.messagesCommon.settings,icon:"gear",active:this._popoverOpen,onclick:()=>this._popoverOpen=!this._popoverOpen,afterCreate:e=>this._calcitePopoverReferenceElement=e,afterUpdate:e=>this._calcitePopoverReferenceElement=e,afterRemoved:()=>this._calcitePopoverReferenceElement=null}):[]}_renderFeatureCountChip(){if(!this.visibleElements.selectionCountLabel)return[];const{layout:e,messages:t,scale:i,id:s,updateGraphics:{length:n}}=this,o=Vs(t.selectedCount,{count:n}),a=i==="s"?99:999,c=n>a?Vs(t.selectedCountTruncated,{truncated:a}):n,p=i==="s"&&e==="vertical",d=p?`${s}-selection-chip-small`:`${s}-selection-chip`;return[p?g("span",{classes:{[Se.chipVertical]:!0,[Se.chipVerticalSmall]:this.scale==="s"},id:d,tabIndex:0,title:o},c):g("calcite-chip",{appearance:"outline",class:e==="horizontal"?Se.chipHorizontal:Se.chipVertical,id:d,kind:"brand",label:o,scale:i==="l"?"m":"s",tabIndex:0,title:e==="vertical"?o:void 0},e==="vertical"?c:o)]}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return[];const{messages:e}=this;return this._renderToolbarItem({id:"duplicate",text:this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature,icon:"copy",onclick:this._onDuplicateSelect})}_renderDeleteButton(){if(!this.visibleElements.deleteButton)return[];const{messages:e}=this,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return this._renderToolbarItem({id:"delete",text:t,icon:"trash",onclick:this.delete})}_renderToolbarItem({id:e,text:t,icon:i,disabled:s,onclick:n,active:o,flipRTL:a,afterCreate:c,afterUpdate:p,afterRemoved:d}){const u=`${this.id}-${e}`;return[g("calcite-action",{active:o,afterCreate:c,afterRemoved:d,afterUpdate:p,bind:this,"data-testid":e,disabled:s||this.state==="disabled",icon:i,iconFlipRtl:a??!1,id:u,key:e,onclick:n,scale:this.scale,text:t,title:t})]}_remeasurePopoverSizes(e){var t,i,s,n,o,a;try{const c=e.parentElement,p=(i=(t=this==null?void 0:this.view)==null?void 0:t.container)==null?void 0:i.getBoundingClientRect(),d=c==null?void 0:c.style;if(!(c&&p&&d&&((n=(s=this.view)==null?void 0:s.container)!=null&&n.contains(c))))return;const u=this._calcitePopoverReferenceElement;if(!u)return;const{bottom:h,top:m}=u.getBoundingClientRect();if(this.layout==="horizontal"){const b=h<p.height/2;b!==(this._relativeLocation==="top")&&(this._relativeLocation=b?"top":"bottom"),b?(d==null||d.setProperty("--sketch-view-height-offset",h-p.top+"px"),d==null||d.setProperty("--sketch-view-margin-offset","30px")):(d==null||d.setProperty("--sketch-view-height-offset",p.bottom-m+"px"),d==null||d.setProperty("--sketch-view-margin-offset","15px"))}else this.layout==="vertical"&&(d.setProperty("--sketch-view-height-offset","15px"),d.setProperty("--sketch-view-margin-offset","15px"));const y=(a=(o=e.shadowRoot)==null?void 0:o.querySelector("div.header"))==null?void 0:a.getBoundingClientRect().height;d.setProperty("--sketch-popover-header-offset",`${y}px`)}catch(c){$t.getLogger(this.declaredClass).warnOnce("Sketch failed to lay out settings menu.",c)}}_activateCreateTool(e,t,i){var n;const s=this._activeCustomToolOptions;if(i||s){if((i==null?void 0:i.toolKey)===(s==null?void 0:s.toolKey))return void this.cancel()}else if(this.activeTool===e)return void this.cancel();(n=this._selectionToolbar)==null||n.cancel(),this.create(e,t,i)}_onDuplicateSelect(){const e=this.duplicate(),t=this.viewModel.activeTool;t!=="transform"&&t!=="reshape"||this.update(e,{tool:t})}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:i}=e;if(!e.aborted&&i.length){const s=t.tool,n=i.length>1&&s==="reshape"?"transform":s;this.update(i,{...t,tool:n})}this.notifyChange("state")}_activateDefaultSelectTool(){var e;this.cancel(),(e=this.view)==null||e.focus()}_refocusOnView(){var e;this.activeTool&&((e=this.view)==null||e.focus())}};r([l()],M.prototype,"_activeCustomToolOptions",void 0),r([l()],M.prototype,"activeTool",null),r([l({readOnly:!0})],M.prototype,"activeTooltip",null),r([l({cast:e=>{if(!(e!=null&&e.length))return null;const t=new Set(["point","polyline","polygon","rectangle","circle","multipoint","freehandPolyline","freehandPolygon","mesh"]);return e.filter(i=>t.has(i))}})],M.prototype,"availableCreateTools",void 0),r([l({readOnly:!0})],M.prototype,"createGraphic",null),r([l()],M.prototype,"creationMode",null),r([l()],M.prototype,"customToolOptions",void 0),r([l()],M.prototype,"customActions",void 0),r([l()],M.prototype,"defaultCreateOptions",null),r([l()],M.prototype,"defaultUpdateOptions",null),r([l()],M.prototype,"icon",null),r([l()],M.prototype,"label",null),r([l()],M.prototype,"labelOptions",null),r([l()],M.prototype,"layer",null),r([l({type:["horizontal","vertical"],value:"horizontal"})],M.prototype,"layout",null),r([l({value:"m"})],M.prototype,"scale",null),r([l()],M.prototype,"toolbarKind",void 0),r([l()],M.prototype,"contextualToolLocation",void 0),r([l()],M.prototype,"groupCollapsePriorities",void 0),r([l(),$e("esri/widgets/Sketch/t9n/Sketch")],M.prototype,"messages",void 0),r([l(),$e("esri/t9n/common")],M.prototype,"messagesCommon",void 0),r([l()],M.prototype,"snappingOptions",null),r([l()],M.prototype,"state",null),r([l()],M.prototype,"tooltipOptions",null),r([l({readOnly:!0})],M.prototype,"updateGraphics",null),r([l({type:fr,nonNullable:!0})],M.prototype,"valueOptions",null),r([l()],M.prototype,"view",null),r([l({type:cn}),Rr(["create","update","undo","redo"])],M.prototype,"viewModel",null),r([l({type:Q,nonNullable:!0})],M.prototype,"visibleElements",void 0),r([l()],M.prototype,"_effectiveAvailableCreateTools",null),r([l()],M.prototype,"_defaultViewModel",void 0),r([l()],M.prototype,"_calcitePopoverReferenceElement",void 0),r([l()],M.prototype,"_relativeLocation",void 0),r([l()],M.prototype,"_popoverOpen",void 0),M=r([R("esri.widgets.Sketch")],M);const Lc=M,kc=(e,t,i)=>{const s=e[t];return s?typeof s=="function"?s():Promise.resolve(s):new Promise((n,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==i?". Note that variables only represent file names one level deep.":""))))})},Rc=(e,t)=>(i,s)=>Dc(i,e,s);class Ic extends pr{constructor(t,i,s){super(t,i,s),this._watchedViewModelProperties=new Map,this._watchedVisibleElementsProperties={},this._isBindingViewModel={value:!0},Object.defineProperty(this.exports,"viewModel",{value:xi.makeGetterProxy(t,this._watchedViewModelProperties,this._isBindingViewModel)}),Object.defineProperty(this.exports,"visibleElements",{value:this._makeVisibleElementsBinder()})}hostConnected(){super.hostConnected(),this._isBindingViewModel.value=!1,this.component.manager.loadedCalled&&Ut(this.component)}async hostLoad(){if(this._watchedProperties.delete("viewModel"),await super.hostLoad(),this.component.manager.destroyed)return;this._watchMetaProperties(),this.onLifecycle(()=>this.reactiveUtils.watch(()=>this._instance.viewModel,s=>{this.component.viewModel=s},{initial:!0}));const t=this._instance.viewModel;typeof t=="object"&&(xi.watchComponentUpdates(this,t,this._watchedViewModelProperties),xi.watchAccessorUpdates(this,t,this._watchedViewModelProperties));const i=Object.entries(this._watchedVisibleElementsProperties);i.length>0&&this.onLifecycle(()=>i.map(([s,n])=>{let o=this._instance.visibleElements??{},a;for(const d of n.slice(0,-1))if(typeof o[d]=="object"&&o[d]!==null)o=o[d];else{a=!!o[d];break}a===void 0&&(a=!!(o[n.slice(-1)[0]]??!0)),s.startsWith("hide");const c=s.startsWith("hide")||s.startsWith("show")?s.startsWith("hide"):a,p=this.component;return typeof p[s]=="boolean"?this._updateWidgetVisibleElement(n,p[s],c):p[s]=!1,Ei(this.component,s,d=>this._updateWidgetVisibleElement(n,d,c))}))}_updateWidgetVisibleElement(t,i,s){let n=this._instance.visibleElements??{};for(const a of t.slice(0,-1))(typeof n[a]!="object"||n[a]===null)&&(n[a]={}),n=n[a];const o=!!(s?!i:i);n[t.at(-1)]=o}hostLoaded(){const{el:t}=this.component;t.childElem??(t.childElem=document.createElement("div")),this._instance.container=t.childElem;let i=!1;const s=this.component.el.view;Object.defineProperty(this.component.el,"view",{get:()=>{var n;return this._instance.view??((n=this._instance.viewModel)==null?void 0:n.view)},set:n=>{!("view"in this._instance)&&typeof this._instance.viewModel=="object"?this._instance.viewModel.view=n:this._instance.view=n,!("map"in this._instance)&&typeof this._instance.viewModel=="object"?this._instance.viewModel.map=n.map:this._instance.map=n.map,this._watchViewDestroy(),n&&!i&&(i=!0,this.component.arcgisReady.emit())},configurable:!0,enumerable:!0}),s&&(this._instance.view=s),this.component.el.isConnected&&(Ut(this.component),this._watchViewDestroy())}hostDisconnected(){var t,i;typeof this.component.el.childElem=="object"&&((i=(t=this.component.el.view)==null?void 0:t.ui)==null||i.remove(this.component.el.childElem))}hostDestroy(){var t;super.hostDestroy(),(t=this._watchViewDestroyHandle)==null||t.remove()}_watchMetaProperties(){Ei(this.component,"position",t=>{this.component.el.childElem!=null&&typeof t=="string"&&Ut(this.component)}),Ei(this.component,"referenceElement",()=>Ut(this.component))}_makeVisibleElementsBinder(){return new Proxy({},{has:(t,i)=>typeof i=="string"||Reflect.has(t,i),get:(t,i)=>{if(typeof i=="symbol"||i in Promise.prototype)return Reflect.get(t,i);const s=[i],n=this._makeRecursiveProxy(s);return dr(this.component,o=>{const a=o;this.component[a]=!1,this._watchedVisibleElementsProperties[a]=s},n)}})}_makeRecursiveProxy(t){const i=new Proxy({},{get:(s,n)=>{const o=Reflect.get(s,n);return typeof n=="symbol"||n in Promise.prototype?o:(t.push(n),i)}});return i}_watchViewDestroy(){var t;(t=this._watchViewDestroyHandle)==null||t.remove(),this._watchViewDestroyHandle=this.reactiveUtils.when(()=>{var i;return((i=this.component.el.view)==null?void 0:i.destroyed)===!0},()=>void this.component.destroy().catch(console.error),{sync:!0})}}const Dc=or(Ic),Ac=yo`@layer{arcgis-sketch{display:block}}`,zc=Rc(Lc),At=class At extends _o{constructor(){super(),this.widget=zc(this,{editConstructorProperties:this._editConstructorProperties}),this.viewModel=this.widget.viewModel,this.activeTool=this.widget.activeTool,this.autoDestroyDisabled=!1,this.availableCreateTools=this.widget.availableCreateTools,this.createGraphic=this.widget.createGraphic,this.creationMode=this.widget.creationMode,this.defaultCreateOptions=this.widget.defaultCreateOptions,this.defaultGraphicsLayerDisabled=!1,this.defaultUpdateOptions=this.widget.defaultUpdateOptions,this.hideCreateToolsCircle=this.widget.visibleElements.createTools.circle,this.hideCreateToolsPoint=this.widget.visibleElements.createTools.point,this.hideCreateToolsPolygon=this.widget.visibleElements.createTools.polygon,this.hideCreateToolsPolyline=this.widget.visibleElements.createTools.polyline,this.hideCreateToolsRectangle=this.widget.visibleElements.createTools.rectangle,this.hideDuplicateButton=this.widget.visibleElements.duplicateButton,this.hideDeleteButton=this.widget.visibleElements.deleteButton,this.hideSelectionCountLabel=this.widget.visibleElements.selectionCountLabel,this.hideLabelsToggle=this.widget.visibleElements.labelsToggle,this.hideSelectionToolsLassoSelection=this.widget.visibleElements.selectionTools["lasso-selection"],this.hideSelectionToolsRectangleSelection=this.widget.visibleElements.selectionTools["rectangle-selection"],this.hideSettingsMenu=this.widget.visibleElements.settingsMenu,this.hideSnappingControls=this.widget.visibleElements.snappingControls,this.hideSnappingControlsElementsEnabledToggle=this.widget.visibleElements.snappingControlsElements.enabledToggle,this.hideSnappingControlsElementsFeatureEnabledToggle=this.widget.visibleElements.snappingControlsElements.featureEnabledToggle,this.hideSnappingControlsElementsLayerList=this.widget.visibleElements.snappingControlsElements.layerList,this.hideSnappingControlsElementsSelfEnabledToggle=this.widget.visibleElements.snappingControlsElements.selfEnabledToggle,this.hideTooltipsToggle=this.widget.visibleElements.tooltipsToggle,this.hideUndoRedoMenu=this.widget.visibleElements.undoRedoMenu,this.icon=this.widget.icon,this.label=this.widget.label,this.labelOptions=this.widget.labelOptions,this.layer=this.widget.layer,this.layout=this.widget.layout,this.pointSymbol=this.viewModel.pointSymbol,this.polygonSymbol=this.viewModel.polygonSymbol,this.polylineSymbol=this.viewModel.polylineSymbol,this.position="bottom-left",this.scale=this.widget.scale,this.toolbarKind=this.widget.toolbarKind,this.showSnappingControlsElementsHeader=this.widget.visibleElements.snappingControlsElements.header,this.snappingOptions=this.widget.snappingOptions,this.state=this.widget.state,this.tooltipOptions=this.widget.tooltipOptions,this.updateGraphics=this.widget.updateGraphics,this.arcgisCreate=Mt(()=>this.widget,"create"),this.arcgisDelete=Mt(()=>this.widget,"delete"),this.arcgisPropertyChange=vo()("state"),this.arcgisReady=fo(),this.arcgisRedo=Mt(()=>this.widget,"redo"),this.arcgisUndo=Mt(()=>this.widget,"undo"),this.arcgisUpdate=Mt(()=>this.widget,"update"),this.listen("arcgisReady",this._arcgisReadyHandler)}async cancel(){var t;(t=this.widget)==null||t.cancel()}async complete(){var t;(t=this.widget)==null||t.complete()}async create(t,i){var s;await((s=this.widget)==null?void 0:s.create(t,i))}async delete(){var t;(t=this.widget)==null||t.delete()}async destroy(){await this.manager.destroy()}async duplicate(){var t;(t=this.widget)==null||t.duplicate()}async redo(){var t;(t=this.widget)==null||t.redo()}async triggerUpdate(t,i){var s;(s=this.widget)==null||s.update(t,i)}async undo(){var t;(t=this.widget)==null||t.undo()}_arcgisReadyHandler(){var t;this.defaultGraphicsLayerDisabled||((t=this.el.view)==null||t.map.add(this.widget.layer))}async _editConstructorProperties(t){return this.defaultGraphicsLayerDisabled||(t.layer??(t.layer=new hr({title:"Sketch Layer"}))),t}};At.properties={activeTool:3,autoDestroyDisabled:5,availableCreateTools:0,createGraphic:0,creationMode:1,defaultCreateOptions:0,defaultGraphicsLayerDisabled:5,defaultUpdateOptions:0,hideCreateToolsCircle:5,hideCreateToolsPoint:5,hideCreateToolsPolygon:5,hideCreateToolsPolyline:5,hideCreateToolsRectangle:5,hideDuplicateButton:5,hideDeleteButton:5,hideSelectionCountLabel:5,hideLabelsToggle:5,hideSelectionToolsLassoSelection:5,hideSelectionToolsRectangleSelection:5,hideSettingsMenu:5,hideSnappingControls:5,hideSnappingControlsElementsEnabledToggle:5,hideSnappingControlsElementsFeatureEnabledToggle:5,hideSnappingControlsElementsLayerList:5,hideSnappingControlsElementsSelfEnabledToggle:5,hideTooltipsToggle:5,hideUndoRedoMenu:5,icon:1,label:1,labelOptions:0,layer:0,layout:1,pointSymbol:0,polygonSymbol:0,polylineSymbol:0,position:1,referenceElement:1,scale:1,toolbarKind:1,showSnappingControlsElementsHeader:5,snappingOptions:0,state:3,tooltipOptions:0,updateGraphics:0},At.shadowRootOptions=wo,At.styles=Ac;let qi=At;bo("arcgis-sketch",qi);const si="RampDrawGraphicsLayer",Gc=To({__name:"draw",setup(e){const{t}=Ao(),i=_=>t(_?`draw.${_}`:"draw.unknown"),s=zo("iApi"),n=Ji();let o=null;const a=Go("sketchEl");let c=null,p=null,d=null,u=null,h=!1,m=null,y=[];const b=$o([]),f=_=>{var v;if(u&&(p==null||p.remove(u),u=null),!_)return;let w;switch((v=_.geometry)==null?void 0:v.type){case"point":case"multipoint":w=new cr({color:[255,255,0,.8],size:16,outline:{color:[255,165,0,1],width:3}});break;case"polyline":w=new ms({color:[255,255,0,.8],width:6});break;default:w=new Nt({color:[255,255,0,.3],outline:{color:[255,165,0,1],width:3}})}u=new Xe({geometry:_.geometry,symbol:w}),p==null||p.add(u)};hs(()=>n.selectedGraphicId,(_,w)=>{if(!(!o||!p)){if(!_)o.cancel(),f();else if(_!==w){const v=p.graphics.toArray().find(L=>L.attributes&&L.attributes.id===_);v&&(o.triggerUpdate([v]),f(v))}}});const N=async()=>{var z,pe;if(!p||!o||n.activeTool!=="edit")return;await s.geo.map.viewPromise;const _=s.geo.map.esriView,w={x:_.width/2,y:_.height/2},v={x:w.x,y:w.y,width:20,height:20},L=(await _.hitTest(v)).results.filter(W=>{var K;return!("graphic"in W)||W.graphic.layer!==p?!1:!!((K=W.graphic.attributes)!=null&&K.id)});L.length>0?(d=L[0].graphic,o.triggerUpdate([d]),(z=d.attributes)!=null&&z.id&&n.selectGraphic(d.attributes.id),s.updateAlert(t("draw.graphic.selected",{type:i((pe=d.attributes)==null?void 0:pe.type)}))):(o.cancel(),d=null,n.clearSelection())},D=async()=>{if(!o||!n.activeTool)return;await s.geo.map.viewPromise;const _=s.geo.map.esriView,w={x:Math.floor(_.width/2),y:Math.floor(_.height/2)},v=_.toMap(w),L=_.extent,z=L.width,pe=L.height,W=Math.min(z,pe)/10;let K;switch(n.activeTool){case"point":K=new Xe({geometry:new Z({x:v.x,y:v.y,spatialReference:_.spatialReference}),symbol:o.pointSymbol});break;case"polyline":K=new Xe({geometry:new Pe({paths:[[[v.x-W/2,v.y],[v.x+W/2,v.y]]],spatialReference:_.spatialReference}),symbol:o.polylineSymbol});break;case"polygon":case"rectangle":const T=W/2;K=new Xe({geometry:new ie({rings:[[[v.x-T,v.y-T],[v.x+T,v.y-T],[v.x+T,v.y+T],[v.x-T,v.y+T],[v.x-T,v.y-T]]],spatialReference:_.spatialReference}),symbol:o.polygonSymbol||new Nt({color:[0,255,0,.3],outline:{color:[0,255,0,1],width:1}})});break;case"circle":const G=W/2,ct=36,Tt=[];for(let Ne=0;Ne<=ct;Ne++){const pt=Ne/ct*2*Math.PI,X=v.x+G*Math.cos(pt),Bt=v.y+G*Math.sin(pt);Tt.push([X,Bt])}K=new Xe({geometry:new ie({rings:[Tt],spatialReference:_.spatialReference}),symbol:o.polygonSymbol||new Nt({color:[255,0,255,.3],outline:{color:[255,0,255,1],width:1}})});break;default:console.warn("Unknown tool type:",n.activeTool);return}if(K){const T=`graphic-${Date.now()}`;K.attributes={id:T,type:n.activeTool},p==null||p.add(K),n.addGraphic({id:T,type:n.activeTool,geometry:K.geometry,attributes:K.attributes}),n.activeTool!=="point"&&(n.clearSelection(),n.setActiveTool(null),o.cancel()),s.updateAlert(t("draw.graphic.created",{type:i(n.activeTool)}))}},B=_=>{var v;const w=(v=s.geo.map.esriView)==null?void 0:v.container;if(!(!document.activeElement||!(w!=null&&w.contains(document.activeElement))))switch(_.key){case"Enter":if(_.preventDefault(),n.activeTool&&n.activeTool!=="edit")if((n.activeTool==="polyline"||n.activeTool==="polygon")&&(h||y.length===0)){const z=s.geo.map.esriView,pe={x:Math.floor(z.width/2),y:Math.floor(z.height/2)},W=z.toMap(pe);h?(y.push([W.x,W.y]),n.activeTool==="polyline"?m.geometry=new Pe({paths:[y],spatialReference:z.spatialReference}):m.geometry=new ie({rings:[y],spatialReference:z.spatialReference}),s.updateAlert(t("draw.multiPoint.pointAdded",{type:i(n.activeTool),count:y.length}))):(h=!0,y=[[W.x,W.y]],n.activeTool==="polyline"?m=new Xe({geometry:new Pe({paths:[y],spatialReference:z.spatialReference}),symbol:(o==null?void 0:o.polylineSymbol)||new ms({color:[0,0,255,1],width:2})}):m=new Xe({geometry:new ie({rings:[y],spatialReference:z.spatialReference}),symbol:(o==null?void 0:o.polygonSymbol)||new Nt({color:[0,255,0,.3],outline:{color:[0,255,0,1],width:1}})}),m.attributes={id:`temp-graphic-${Date.now()}`,type:n.activeTool},p==null||p.add(m),s.updateAlert(t("draw.multiPoint.started",{type:i(n.activeTool),count:1})))}else D();else N();break;case"Delete":case"Backspace":const L=s.geo.map.esriView;h&&y.length>1?(_.preventDefault(),y.pop(),n.activeTool==="polyline"?m.geometry=new Pe({paths:[y],spatialReference:L.spatialReference}):m.geometry=new ie({rings:[y],spatialReference:L.spatialReference}),m.set("geometry",m==null?void 0:m.geometry),s.updateAlert(t("draw.multiPoint.pointRemoved",{type:i(n.activeTool??void 0),count:y.length}))):h&&y.length===1?(_.preventDefault(),m&&(p==null||p.remove(m)),m=null,y=[],h=!1,s.updateAlert(t("draw.multiPoint.canceled"))):d&&(_.preventDefault(),o==null||o.delete(),p==null||p.remove(d),typeof n.removeGraphic=="function"&&n.removeGraphic(d.attributes.id),d=null,f(void 0),s.updateAlert(t("draw.graphic.deleted")));break;case"Escape":n.setActiveTool(null),o==null||o.cancel(),d=null,f(void 0),n.clearSelection(),s.updateAlert(t("draw.tool.canceled"));break}},me=_=>{var Bt;const w=s.geo.map.esriView.container;if(!document.activeElement||!(w!=null&&w.contains(document.activeElement))||!d||!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(_.key))return;_.preventDefault(),_.stopPropagation();const v=10,L=_.shiftKey,z=_.altKey,pe=s.geo.map.esriView;let W=0,K=0;_.key==="ArrowLeft"&&(W=-v),_.key==="ArrowRight"&&(W=v),_.key==="ArrowUp"&&(K=-v),_.key==="ArrowDown"&&(K=v);const T=d.geometry;let G;if(T.type==="point")G={x:T.x,y:T.y};else{const U=T.extent;G={x:(U.xmin+U.xmax)/2,y:(U.ymin+U.ymax)/2}}const ct=pe.toScreen(new Z({x:G.x,y:G.y,spatialReference:pe.spatialReference}));ct.x+=W,ct.y+=K;const Tt=pe.toMap(ct),Ne=Tt.x-G.x,pt=Tt.y-G.y;let X;if(T.type==="point")!L&&!z?X=new Z({x:T.x+Ne,y:T.y+pt,spatialReference:T.spatialReference}):L?(X=T.clone(),s.updateAlert(t("draw.point.resize.unsupported"))):z&&(X=T.clone(),s.updateAlert(t("draw.point.rotate.unsupported")));else if(T.type==="polyline"){if(!L&&!z){const U=T.paths.map(Y=>Y.map(([ne,oe])=>[ne+Ne,oe+pt]));X=new Pe({paths:U,spatialReference:T.spatialReference})}else if(L){const U=T,Y=_.key==="ArrowUp"||_.key==="ArrowRight"?1.05:.95,ne=U.paths.map(oe=>oe.map(([Ue,We])=>[G.x+(Ue-G.x)*Y,G.y+(We-G.y)*Y]));X=new Pe({paths:ne,spatialReference:T.spatialReference})}else if(z){const U=T,Y=_.key==="ArrowLeft"?-.05:_.key==="ArrowRight"?.05:0;if(Y!==0){const ne=Math.cos(Y),oe=Math.sin(Y),Ue=U.paths.map(We=>We.map(([_i,vi])=>{const xt=_i-G.x,Et=vi-G.y,fi=xt*ne-Et*oe,wi=xt*oe+Et*ne;return[G.x+fi,G.y+wi]}));X=new Pe({paths:Ue,spatialReference:T.spatialReference})}else X=T.clone()}}else if(T.type==="polygon"){if(!L&&!z){const U=T.rings.map(Y=>Y.map(([ne,oe])=>[ne+Ne,oe+pt]));X=new ie({rings:U,spatialReference:T.spatialReference})}else if(L){const U=T,Y=_.key==="ArrowUp"||_.key==="ArrowRight"?1.05:.95,ne=U.rings.map(oe=>oe.map(([Ue,We])=>[G.x+(Ue-G.x)*Y,G.y+(We-G.y)*Y]));X=new ie({rings:ne,spatialReference:T.spatialReference})}else if(z){const U=T,Y=_.key==="ArrowLeft"?-.05:_.key==="ArrowRight"?.05:0;if(Y!==0){const ne=Math.cos(Y),oe=Math.sin(Y),Ue=U.rings.map(We=>We.map(([_i,vi])=>{const xt=_i-G.x,Et=vi-G.y,fi=xt*ne-Et*oe,wi=xt*oe+Et*ne;return[G.x+fi,G.y+wi]}));X=new ie({rings:Ue,spatialReference:T.spatialReference})}else X=T.clone()}}if(X){d.geometry=X,d.set("geometry",X),f(d),(Bt=d.attributes)!=null&&Bt.id&&n.updateGraphicGeometry(d.attributes.id,X);const U=L?"resized":z?"rotated":"moved";s.updateAlert(t(`draw.graphic.${U}`))}},Fe=async _=>{const w=(await s.geo.map.esriView.hitTest(_)).results.find(v=>{var L;return"graphic"in v&&v.graphic.layer===p&&!!((L=v.graphic.attributes)!=null&&L.id)});w&&n.activeTool==="edit"?o==null||o.triggerUpdate([w.graphic]):(o==null||o.cancel(),d=null,n.clearSelection(),f())},Ze=async()=>{var _,w;await s.geo.map.viewPromise,s.geo.layer.getLayer(si)?p=s.geo.layer.getLayer(si).esriLayer:(p=s.geo.layer.createLayer({id:si,layerType:rr.GRAPHIC,cosmetic:!0,system:!0,url:""}),await s.geo.map.addLayer(p)),p!=null&&p.esriLayer&&(p=p.esriLayer),Object.assign(a.value,{view:s.geo.map.esriView,layer:p,availableCreateTools:["point","multipoint","polyline","polygon","rectangle","circle"],updateOnGraphicClick:!0,visibleElements:{createTools:{point:!0,polyline:!0,polygon:!0,rectangle:!0,circle:!0},selectionTools:{enable:!0},settingsMenu:!1},defaultUpdateOptions:{highlightOptions:{enabled:!1}}}),s.geo.map.esriView.ui.add(a.value,"bottom-right"),(_=a.value)==null||_.addEventListener("arcgisCreate",v=>Le(v.detail)),(w=a.value)==null||w.addEventListener("arcgisUpdate",v=>lt(v.detail)),c={remove:()=>{var v;return(v=a.value)==null?void 0:v.removeEventListener("arcgisCreate",L=>Le(L.detail))}},o=a.value,s.geo.map.esriView.on("click",Fe),document.addEventListener("keydown",B),document.addEventListener("keydown",me,{capture:!0})},se=()=>{o&&(s.geo.map.esriView&&s.geo.map.esriView.ui.remove(o),c&&c.remove(),o.destroy()),document.removeEventListener("keydown",B),document.removeEventListener("keydown",me,{capture:!0}),h=!1,m=null,y=[],o=null,p=null},Le=_=>{if(_.state==="complete"){const w=_.graphic,v=`graphic-${Date.now()}`;w.attributes=w.attributes||{},w.attributes.id=v,n.addGraphic({id:v,type:_.tool,geometry:w.geometry,attributes:w.attributes}),_.tool!=="point"&&n.setActiveTool(null)}},lt=_=>{var v,L,z;const w=_.graphics[0];if(w)if(_.state==="start"){if(n.activeTool!=="edit"){o.cancel();return}d=w,(v=w.attributes)!=null&&v.id&&(n.selectGraphic(w.attributes.id),s.updateAlert(t("draw.graphic.selected",{type:i((L=w.attributes)==null?void 0:L.type)})))}else _.state==="active"?f(w):_.state==="complete"&&((z=w.attributes)!=null&&z.id)&&(n.updateGraphicGeometry(w.attributes.id,w.geometry),s.updateAlert(t("draw.graphic.updated")))};return Ho(()=>{Ze(),b.push(s.event.on(nn.MAP_DESTROYED,()=>{se()}))}),hs(()=>n.activeTool,_=>{o.cancel(),f(),m=null,y=[],h=!1,_&&_!="edit"&&o.create(_)}),Bo(()=>{se(),b.forEach(_=>s.event.off(_))}),(_,w)=>(Fo(),Zo("arcgis-sketch",{ref_key:"sketchEl",ref:a,style:{display:"none"}},null,512))}}),Xs=[{type:"point"},{type:"polyline"},{type:"polygon"},{type:"circle"},{type:"rectangle"}];class $c extends ar{constructor(i,s){super(i,s);ds(this,"store");this.store=Ji(this.$vApp.$pinia)}_parseConfig(i){if(!i){this.store.setSupportedTypes(Xs);return}if(i.types!==void 0){const s=(i.types===null?[]:i.types).filter(n=>n.enabled!==!1);this.store.setSupportedTypes(s)}else this.store.setSupportedTypes(Xs);i.defaultTool&&this.store.setActiveTool(i.defaultTool)}get graphicsLayerId(){return si}}const Hc={en:{"draw.multiPoint.started":"{type} drawing started with 1 point","draw.multiPoint.pointAdded":"Point added {count} points total","draw.multiPoint.pointRemoved":"Point removed {count} points remaining","draw.multiPoint.canceled":"Drawing canceled","draw.multiPoint.completed":"{type} completed with {count} points","draw.multiPoint.notEnoughPoints":"Not enough points for {type} minimum {min} required","draw.graphic.created":"{type} created","draw.graphic.selected":"{type} selected","draw.graphic.deselected":"Graphic deselected","draw.graphic.deleted":"Graphic deleted","draw.graphic.updated":"Graphic updated","draw.graphic.none":"No graphic found","draw.tool.canceled":"Drawing tool canceled","draw.point.resize.unsupported":"Resizing not supported for point graphics","draw.point.rotate.unsupported":"Rotation not supported for point graphics","draw.move.up":"Moved up","draw.move.down":"Moved down","draw.move.left":"Moved left","draw.move.right":"Moved right","draw.resize.increase":"Increased size","draw.resize.decrease":"Decreased size","draw.rotate.clockwise":"Rotated clockwise","draw.rotate.counterclockwise":"Rotated counter-clockwise","draw.button.point":"Draw point","draw.button.polyline":"Draw line","draw.button.polygon":"Draw polygon","draw.button.rectangle":"Draw rectangle","draw.button.circle":"Draw circle","draw.point.tooltip":"Draw point","draw.polyline.tooltip":"Draw polyline","draw.polygon.tooltip":"Draw polygon","draw.circle.tooltip":"Draw circle","draw.rectangle.tooltip":"Draw rectangle","draw.edit.tooltip":"Edit Mode","draw.graphic.moved":"Graphic moved","draw.shape":"shape","draw.point":"point","draw.multipoint":"multipoint","draw.polyline":"polyline","draw.polygon":"polygon","draw.rectangle":"rectangle","draw.circle":"circle","draw.unknown":"unknown"},fr:{"draw.multiPoint.started":"Dessin de {type} commencé avec 1 point","draw.multiPoint.pointAdded":"Point ajouté","draw.multiPoint.pointRemoved":"Point supprimé","draw.multiPoint.canceled":"Dessin annulé","draw.multiPoint.completed":"{type} terminé avec {count} points","draw.multiPoint.notEnoughPoints":"Pas assez de points pour {type}","draw.graphic.created":"{type} créé","draw.graphic.selected":"{type} sélectionné","draw.graphic.deselected":"Graphique désélectionné","draw.graphic.deleted":"Graphique supprimé","draw.graphic.updated":"Graphique mis à jour","draw.graphic.none":"Aucun graphique trouvé","draw.tool.canceled":"Outil de dessin annulé","draw.point.resize.unsupported":"Le redimensionnement n'est pas pris en charge pour les points","draw.point.rotate.unsupported":"La rotation n'est pas prise en charge pour les points","draw.move.up":"Déplacé vers le haut","draw.move.down":"Déplacé vers le bas","draw.move.left":"Déplacé vers la gauche","draw.move.right":"Déplacé vers la droite","draw.resize.increase":"Taille augmentée","draw.resize.decrease":"Taille réduite","draw.rotate.clockwise":"Rotation dans le sens horaire","draw.rotate.counterclockwise":"Rotation dans le sens antihoraire","draw.button.point":"Dessiner un point","draw.button.polyline":"Dessiner une ligne","draw.button.polygon":"Dessiner un polygone","draw.button.rectangle":"Dessiner un rectangle","draw.button.circle":"Dessiner un cercle","draw.point.tooltip":"Dessiner un point","draw.polyline.tooltip":"Dessiner une polyligne","draw.polygon.tooltip":"Dessiner un polygone","draw.circle.tooltip":"Dessiner un cercle","draw.rectangle.tooltip":"Dessiner un rectangle","draw.edit.tooltip":"Mode édition","draw.graphic.moved":"Graphique déplacé","draw.shape":"forme","draw.point":"indiquer","draw.multipoint":"multipoint","draw.polyline":"polyligne","draw.polygon":"polygone","draw.rectangle":"rectangle","draw.circle":"cercle","draw.unknown":"inconnue"}};class Bc extends $c{async init(){const{el:t}=this.mount(Gc,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(t.childNodes[0]),Object.entries(Hc).forEach(i=>this.$iApi.$i18n.mergeLocaleMessage(...i)),this._parseConfig(this.config),Ji(this.$vApp.$pinia).supportedTypes.forEach(i=>{const s=`${i.type}-icon`;this.$iApi.component(s,No(kc(Object.assign({"./icons/circle-icon.vue":()=>S(()=>import("./circle-icon-DrE2wWqh-aNymG_5_.js"),__vite__mapDeps([179,1,2]),import.meta.url),"./icons/edit-icon.vue":()=>S(()=>import("./edit-icon-C_tqZ1EG-ztyYcxJi.js"),__vite__mapDeps([180,1,2]),import.meta.url),"./icons/point-icon.vue":()=>S(()=>import("./point-icon-BSJft8AI-BjqrE-JQ.js"),__vite__mapDeps([181,1,2]),import.meta.url),"./icons/polygon-icon.vue":()=>S(()=>import("./polygon-icon-BrXtjiJl-BEDXU0n5.js"),__vite__mapDeps([182,1,2]),import.meta.url),"./icons/polyline-icon.vue":()=>S(()=>import("./polyline-icon-CqjafPK0-RbEy109X.js"),__vite__mapDeps([183,1,2]),import.meta.url),"./icons/rectangle-icon.vue":()=>S(()=>import("./rectangle-icon-D8mTZj4O-WrMVsxVN.js"),__vite__mapDeps([184,1,2]),import.meta.url)}),`./icons/${i.type}-icon.vue`,3)))})}async added(){this.$iApi.event.on(nn.MAP_CREATED,()=>{this.init()})}}const pd=Object.freeze(Object.defineProperty({__proto__:null,default:Bc},Symbol.toStringTag,{value:"Module"}));export{_l as A,qp as B,Za as C,ed as D,Zi as E,ad as F,od as G,nd as H,Jp as I,Qp as J,Ll as K,pc as L,td as M,Fi as N,al as O,Na as P,fl as Q,cd as R,Kp as S,lc as T,id as U,Yp as V,pd as W,sd as Z,Tn as a,Yn as b,cc as c,ti as d,Ui as e,ld as f,tl as g,rl as h,ll as i,yi as j,cl as k,Bl as l,x as m,q as n,_t as o,rd as p,Vi as q,Xn as r,jp as s,zs as t,te as u,dc as v,Ni as w,ge as x,Hi as y,ml as z};
