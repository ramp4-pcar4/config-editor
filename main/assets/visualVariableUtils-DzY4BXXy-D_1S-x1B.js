import{d8 as q,P as O,bp as D,bw as I}from"./index-BeTPrQ6f.js";import{m as A}from"./lengthUtils-CopeXEyE-DjCEitlq.js";function P(a){return a&&a.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function g(a){return a!=null&&!isNaN(a)&&isFinite(a)}function Z(a){return a.valueExpression?"expression":a.field&&typeof a.field=="string"?"field":"unknown"}function ae(a,i){const t=i||Z(a),e=a.valueUnit||"unknown";return t==="unknown"?"constant":a.stops?"stops":a.minSize!=null&&a.maxSize!=null&&a.minDataValue!=null&&a.maxDataValue!=null?"clamped-linear":e==="unknown"?a.minSize!=null&&a.minDataValue!=null?a.minSize&&a.minDataValue?"proportional":"additive":"identity":"real-world-size"}const M=()=>O.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),z=a=>M().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${a}`),w=()=>M().error("Use of arcade expressions requires an arcade context"),k=new I,y=Math.PI,_=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function R(a,i,t){var h;const e="visualVariables"in a?(h=a.visualVariables)==null?void 0:h.find(u=>u.type==="color"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void z("ColorVariable");const n=typeof i=="number",l=n?null:i,r=l==null?void 0:l.attributes;let o=n?i:null;const s=e.field,{ipData:f,hasExpression:v}=e.cache;let c=e.cache.compiledFunc;if(!s&&!v){const u=e.stops;return u&&u[0]&&u[0].color}if(typeof o!="number")if(v){if((t==null?void 0:t.arcade)==null)return void w();const u={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},d=t.arcade.arcadeUtils,V=d.getViewInfo(u),x=d.createExecContext(l,V,t.timeZone);if(!c){const F=d.createSyntaxTree(e.valueExpression);c=d.createFunction(F),e.cache.compiledFunc=c}o=d.executeFunction(c,x)}else r&&(o=r[s]);const p=e.normalizationField,m=r!=null&&p!=null?parseFloat(r[p]):void 0;if(o!=null&&(!p||n||!isNaN(m)&&m!==0)){g(m)&&!n&&(o/=m);const u=E(o,f);if(u){const d=u[0],V=u[1],x=d===V?e.stops[d].color:D.blendColors(e.stops[d].color,e.stops[V].color,u[2],t==null?void 0:t.color);return new D(x)}}}function C(a,i,t){var h;const e="visualVariables"in a?(h=a.visualVariables)==null?void 0:h.find(u=>u.type==="opacity"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void z("OpacityVariable");const n=typeof i=="number",l=n?null:i,r=l==null?void 0:l.attributes;let o=n?i:null;const s=e.field,{ipData:f,hasExpression:v}=e.cache;let c=e.cache.compiledFunc;if(!s&&!v){const u=e.stops;return u&&u[0]&&u[0].opacity}if(typeof o!="number")if(v){if((t==null?void 0:t.arcade)==null)return void w();const u={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},d=t.arcade.arcadeUtils,V=d.getViewInfo(u),x=d.createExecContext(l,V,t.timeZone);if(!c){const F=d.createSyntaxTree(e.valueExpression);c=d.createFunction(F),e.cache.compiledFunc=c}o=d.executeFunction(c,x)}else r&&(o=r[s]);const p=e.normalizationField,m=r!=null&&p!=null?parseFloat(r[p]):void 0;if(o!=null&&(!p||n||!isNaN(m)&&m!==0)){g(m)&&!n&&(o/=m);const u=E(o,f);if(u){const d=u[0],V=u[1];if(d===V)return e.stops[d].opacity;{const x=e.stops[d].opacity;return x+(e.stops[V].opacity-x)*u[2]}}}}function N(a,i,t){var m;const e="visualVariables"in a?(m=a.visualVariables)==null?void 0:m.find(h=>h.type==="rotation"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void z("RotationVariable");const n=e.axis||"heading",l=n==="heading"&&e.rotationType==="arithmetic"?90:0,r=n==="heading"&&e.rotationType==="arithmetic"?-1:1,o=typeof i=="number"?null:i,s=o==null?void 0:o.attributes,f=e.field,{hasExpression:v}=e.cache;let c=e.cache.compiledFunc,p=null;if(!f&&!v)return p;if(v){if((t==null?void 0:t.arcade)==null)return void w();const h={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},u=t.arcade.arcadeUtils,d=u.getViewInfo(h),V=u.createExecContext(o,d,t.timeZone);if(!c){const x=u.createSyntaxTree(e.valueExpression);c=u.createFunction(x),e.cache.compiledFunc=c}p=u.executeFunction(c,V)}else s&&(p=s[f]);return p=typeof p!="number"||isNaN(p)?null:l+r*p,p}function $(a,i,t){const e=typeof i=="number",n=e?null:i,l=n==null?void 0:n.attributes;let r=e?i:null;const{isScaleDriven:o}=a.cache;let s=a.cache.compiledFunc;if(o){const v=t==null?void 0:t.scale,c=t==null?void 0:t.view;r=v==null||c==="3d"?j(a):v}else if(!e)switch(a.inputValueType){case"expression":{if((t==null?void 0:t.arcade)==null)return void w();const v={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},c=t.arcade.arcadeUtils,p=c.getViewInfo(v),m=c.createExecContext(n,p,t.timeZone);if(!s){const h=c.createSyntaxTree(a.valueExpression);s=c.createFunction(h),a.cache.compiledFunc=s}r=c.executeFunction(s,m);break}case"field":l&&(r=l[a.field]);break;case"unknown":r=null}if(!g(r))return null;if(e||!a.normalizationField)return r;const f=l?parseFloat(l[a.normalizationField]):null;return g(f)&&f!==0?r/f:null}function j(a){let i=null,t=null;const e=a.stops;return e?(i=e[0].value,t=e[e.length-1].value):(i=a.minDataValue||0,t=a.maxDataValue||0),(i+t)/2}function S(a,i,t){var l;const e="visualVariables"in a?(l=a.visualVariables)==null?void 0:l.find(r=>r.type==="size"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void z("SizeVariable");const n=U($(e,i,t),e,i,t,e.cache.ipData);return n==null||isNaN(n)?void 0:n}function b(a,i,t){return a==null?null:P(a)?S(a,i,t):g(a)?a:null}function T(a,i,t){return g(t)&&a>t?t:g(i)&&a<i?i:a}function B(a,i,t,e){const n=b(i.minSize,t,e)||i.minDataValue;return a==null&&n==null?null:(a??0)+(n??0)}function G(a,i,t){const e=a.stops;let n=(e==null?void 0:e.length)&&e[0].size;return n==null&&(n=a.minSize),b(n,i,t)}function L(a,i,t,e){const n=b(i.minSize,t,e);if(a==null)return n;const{minDataValue:l,maxDataValue:r}=i;if(l==null||r==null)return null;const o=(a-l)/(r-l),s=b(i.maxSize,t,e),f=e==null?void 0:e.shape;if(a<=l)return n;if(a>=r)return s;if(n==null||s==null)return null;if(i.scaleBy==="area"&&f){const v=f==="circle",c=v?y*(n/2)**2:n*n,p=c+o*((v?y*(s/2)**2:s*s)-c);return v?2*Math.sqrt(p/y):Math.sqrt(p)}return n+o*(s-n)}function X(a,i,t,e){const n=b(i.minSize,t,e);if(a==null||n==null)return n;const l=e==null?void 0:e.shape,{minDataValue:r}=i;if(r==null)return null;const o=a/r,s=b(i.maxSize,t,e);let f=null;return f=l==="circle"?2*Math.sqrt(o*(n/2)**2):l==="square"||l==="diamond"||l==="image"?Math.sqrt(o*n**2):o*n,T(f,n,s)}function H(a,i,t,e,n){var s,f,v;if(a==null)return null;const[l,r,o]=E(a,n);if(l===r)return b((s=i.stops)==null?void 0:s[l].size,t,e);{const c=b((f=i.stops)==null?void 0:f[l].size,t,e),p=b((v=i.stops)==null?void 0:v[r].size,t,e);return c==null||p==null?null:c+(p-c)*o}}function J(a,i,t,e){const n=((e==null?void 0:e.resolution)??1)*A[i.valueUnit],l=b(i.minSize,t,e),r=b(i.maxSize,t,e),{valueRepresentation:o}=i;if(a==null)return l;let s=null;return s=o==="area"?2*Math.sqrt(a/y)/n:o==="radius"||o==="distance"?2*a/n:a/n,T(s,l,r)}function U(a,i,t,e,n){switch(i.transformationType){case"additive":return B(a,i,t,e);case"constant":return G(i,t,e);case"clamped-linear":return L(a,i,t,e);case"proportional":return X(a,i,t,e);case"stops":return H(a,i,t,e,n);case"real-world-size":return J(a,i,t,e);case"identity":return a;case"unknown":return null}}function K(a,i,t){const{isScaleDriven:e}=a.cache;if(!(e&&t==="3d"||i))return null;const n={scale:i,view:t};let l=b(a.minSize,k,n),r=b(a.maxSize,k,n);if(l!=null||r!=null){if(l>r){const o=r;r=l,l=o}return{minSize:l,maxSize:r}}}function Q(a,i,t){if(!a.visualVariables)return;const e=[],n=[],l=[],r=[],o=[];for(const s of a.visualVariables)switch(s.type){case"color":n.push(s);break;case"opacity":l.push(s);break;case"rotation":o.push(s);break;case"size":r.push(s)}return n.forEach(s=>{const f=R(s,i,t);e.push({variable:s,value:f})}),l.forEach(s=>{const f=C(s,i,t);e.push({variable:s,value:f})}),o.forEach(s=>{const f=N(s,i,t);e.push({variable:s,value:f})}),r.forEach(s=>{const f=S(s,i,t);e.push({variable:s,value:f})}),e}function E(a,i){if(!i)return;let t=0,e=i.length-1;return i.some((n,l)=>a<n?(e=l,!0):(t=l,!1)),[t,e,(a-i[t])/(i[e]-i[t])]}function W(a,i,t){const e=["proportional","proportional","proportional"];for(const n of a){const l=n.useSymbolValue?"symbol-value":S(n,i,t)??"proportional";switch(n.axis){case"width":e[0]=l;break;case"depth":e[1]=l;break;case"height":e[2]=l;break;case"width-and-depth":e[0]=l,e[1]=l;break;case"all":case void 0:case null:e[0]=l,e[1]=l,e[2]=l;break;default:q(n.axis)}}return e}const te=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:W,getColor:R,getOpacity:C,getRotationAngle:N,getSize:S,getSizeForValue:U,getSizeFromNumberOrVariable:b,getSizeRangeAtScale:K,getVisualVariableValues:Q,viewScaleRE:_},Symbol.toStringTag,{value:"Module"}));export{Q as D,W as U,Z as i,ae as l,N as m,P as n,_ as p,te as v};
