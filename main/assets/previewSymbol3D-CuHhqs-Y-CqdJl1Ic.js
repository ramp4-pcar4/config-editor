import{bX as Q,gj as w,l as I,P as Y,lu as J,lA as K}from"./index-BeTPrQ6f.js";import{C as V,f as _}from"./colorUtils-DlmOacVt-BnN0T6wa.js";import{U as tt,W as et,F as st,z as X,G as lt}from"./utils-DvP1Tc7W-CK5sH9q2.js";import{u as $,v as P,f as rt,Z as ot,r as it,y as nt,i as at,M as pt,d as ct,h as ut,L as ht}from"./previewUtils-1NSa4tp5-BqMe2dmc.js";import{o as R,b as mt}from"./symbolUtils-BWODOwTq-BEtrWlLF.js";import{resolveWebStyleSymbol as yt}from"./webStyleSymbolUtils-CyolzL_F-CG3O75V3.js";import"./vec42-DHp-FUwt-Br7hmYJs.js";import"./vec4f64-DD-nkcCV-CSNWKRqG.js";import"./asyncUtils-Cu__bxqs-ecCTUaGV.js";import"./jsonUtils-Bl9MVnOR-Be8hf0yA.js";import"./parser-CXoJuqeV-C7irlk5U.js";import"./mat4f32-BdRMyjXW-CWt6U0BP.js";import"./mat4-R0VY9B_E-DoEP887i.js";import"./cimSymbolUtils-BJ01Nooc-BfOR3Irv.js";import"./utils-CIm5uQvO-CtKf129F.js";import"./defaultCIMValues-BWu-APou-XI-Li77m.js";import"./LRUCache-CvGiiws0-B3io5Jp4.js";import"./MemCache-TG-MhOJy-BkjKRNR7.js";import"./jsxFactory-DN-m49_5-CUFCpKPo.js";import"./intl-DRhjUnwt-Dihhq8dq.js";import"./messages-DQ10DjvF-6kk0dzjG.js";import"./uuid-CFz2qBzH-cIdlpVG-.js";import"./sanitizerUtils-CrdmaILo-DztC6Qnx.js";import"./mat2df32-fg3OHsAI-BF2V2zqo.js";import"./mat2d-Cf4xHr3Z-u09Kv-lR.js";import"./devEnvironmentUtils-CxrVv3RG-ktR0Kqgv.js";import"./styleUtils-DoTsJ8ze-DHY40A2q.js";import"./webStyleAcceptedFormats-DsfCZOwz-CG7ZQ6BV.js";const L=22,F=120,U=80,A=50,q=20;function j(e){const t=e.outline,o=e.material!=null?e.material.color:null,s=o!=null?o.toHex():null;if(t==null||"pattern"in t&&t.pattern!=null&&t.pattern.type==="style"&&t.pattern.style==="none")return e.type==="fill"&&s==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const p=w(t.size)||0;return{color:"rgba("+(t.color!=null?t.color.toRgba():"255,255,255,1")+")",width:Math.min(p,U),style:"pattern"in t&&t.pattern!=null&&t.pattern.type==="style"?X(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}async function ft(e,t){var s,p,f;if((s=e.thumbnail)!=null&&s.url)return e.thumbnail.url;if(t.type==="icon"&&((p=t==null?void 0:t.resource)!=null&&p.href))return lt(t);const o=Q("esri/images/Legend/legend3dsymboldefault.png");if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){const l=await yt(e.styleOrigin,{portal:e.styleOrigin.portal}).catch(()=>null);if(l&&"thumbnail"in l&&((f=l.thumbnail)!=null&&f.url))return l.thumbnail.url}return o}function W(e,t=1){const o=e.a,s=V(e),p=s.h,f=s.s/t,l=100-(100-s.v)/t,{r:i,g:h,b:a}=_({h:p,s:f,v:l});return[i,h,a,o]}function Z(e){var t;return e.type==="water"?e.color==null?null:e.color:((t=e.material)==null?void 0:t.color)==null?null:e.material.color}function n(e,t=0){const o=Z(e);if(!o){if(e.type==="fill")return null;const p=et.r,f=$(p,t);return[f,f,f,100]}const s=o.toRgba();for(let p=0;p<3;p++)s[p]=$(s[p],t);return s}async function dt(e,t){const o=e.style;return o==="none"?null:{type:"pattern",x:0,y:0,src:await tt(Q(`esri/symbols/patterns/${o}.png`),t.toCss(!0)),width:5,height:5}}function B(e){return e.outline?j(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function N(e,t){const o=Z(e);if(!o)return null;let s="rgba(";return s+=$(o.r,t)+",",s+=$(o.g,t)+",",s+=$(o.b,t)+",",s+o.a+");"}function G(e,t){const o=e.edges;return!o||!o.color||!o.size?null:{color:o.color.toCss(!0),width:Math.min(w(o.size),t,U),join:"round"}}function E(e,t){var p;const o=N(e,t);if(!o||"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"&&e.pattern.style==="none")return null;const s={color:o,width:Math.min(e.size?w(e.size):.75,U)};return"pattern"in e&&((p=e.pattern)==null?void 0:p.type)==="style"&&(s.style=X(e.pattern.style)),"cap"in e&&e.cap&&(s.cap=e.cap),"join"in e&&e.join&&(s.join=e.join==="miter"?w(2):e.join),s}function O(e,t,o){const s=o!=null?.75*o:0;return{type:"linear",x1:s?.25*s:0,y1:s?.5*s:0,x2:s||4,y2:s?.5*s:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function bt(e){const t=e.depth,o=e.height,s=e.width;return s!==0&&t!==0&&o!==0&&s===t&&s!=null&&o!=null&&s<o}function kt(e,t,o){var p,f;const s=[];if(!e)return s;switch(e.type){case"icon":{const l=t,i=t;switch(((p=e.resource)==null?void 0:p.primitive)??K){case"circle":s.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:n(e,0),stroke:j(e)});break;case"square":s.push({shape:{type:"path",path:[{command:"M",values:[0,i]},{command:"L",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,i]},{command:"Z",values:[]}]},fill:n(e,0),stroke:j(e)});break;case"triangle":s.push({shape:{type:"path",path:[{command:"M",values:[0,i]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,i]},{command:"Z",values:[]}]},fill:n(e,0),stroke:j(e)});break;case"cross":s.push({shape:{type:"path",path:[{command:"M",values:[.5*l,0]},{command:"L",values:[.5*l,i]},{command:"M",values:[0,.5*i]},{command:"L",values:[l,.5*i]}]},stroke:B(e)});break;case"x":s.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,i]},{command:"M",values:[l,0]},{command:"L",values:[0,i]}]},stroke:B(e)});break;case"kite":s.push({shape:{type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,.5*i]},{command:"L",values:[.5*l,i]},{command:"Z",values:[]}]},fill:n(e,0),stroke:j(e)})}break}case"object":switch(((f=e.resource)==null?void 0:f.primitive)??J){case"cone":{const l=O(n(e,0),n(e,-.6),o?q:t),i=pt(t,o);s.push({shape:i[0],fill:l},{shape:i[1],fill:l});break}case"inverted-cone":{const l=n(e,0),i=O(l,n(e,-.6),t),h=at(t);s.push({shape:h[0],fill:i},{shape:h[1],fill:l});break}case"cube":{const l=nt(t,o);s.push({shape:l[0],fill:n(e,0)},{shape:l[1],fill:n(e,-.3)},{shape:l[2],fill:n(e,-.5)});break}case"cylinder":{const l=O(n(e,0),n(e,-.6),o?q:t),i=it(t,o);s.push({shape:i[0],fill:l},{shape:i[1],fill:l},{shape:i[2],fill:n(e,0)});break}case"diamond":{const l=ot(t);s.push({shape:l[0],fill:n(e,-.3)},{shape:l[1],fill:n(e,0)},{shape:l[2],fill:n(e,-.3)},{shape:l[3],fill:n(e,-.7)});break}case"sphere":{const l=O(n(e,0),n(e,-.6));l.x1=0,l.y1=0,l.x2=.25*t,l.y2=.25*t,s.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:l});break}case"tetrahedron":{const l=rt(t);s.push({shape:l[0],fill:n(e,-.3)},{shape:l[1],fill:n(e,0)},{shape:l[2],fill:n(e,-.6)});break}}break}return s}function T(e){const t=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null;return t?w(t):null}function vt(e){return e.type==="icon"?"multiply":"tint"}async function gt(e,t){const o=T(t),s=t!=null&&t.maxSize?w(t.maxSize):null,p=(t==null?void 0:t.disableUpsampling)??!1,f=e.symbolLayers,l=[],i=[];let h=!1,a=0,d=0,g=0;f.forEach(r=>{var k,v,M,z;if(r.type!=="icon"&&r.type!=="object")return;r&&r.type==="icon"&&(g=Math.max(r.size&&w(r.size),g));const u=r.type==="icon"?r.size&&w(r.size):0,m=o||u?Math.ceil(Math.min(o||u,s||F)):L;let y=r.type==="icon"?r.angle:null;if((t==null?void 0:t.rotation)!=null&&(y=(y??0)+t.rotation),i.push(y),(k=r==null?void 0:r.resource)==null?void 0:k.href){const S=ft(e,r).then(x=>{var H;const C=(H=r==null?void 0:r.material)==null?void 0:H.color,D=vt(r);return mt(x,m,C,D,p)}).then(x=>{const C=x.width,D=x.height;return a=Math.max(a,C),d=Math.max(d,D),y&&(h=!0),[{shape:{type:"image",x:0,y:0,width:C,height:D,src:x.url},fill:null,stroke:null}]});l.push(S)}else{let S=m;r.type==="icon"&&o&&(S=m*(u/g));const x=(t==null?void 0:t.symbolConfig)==="tall"||((v=t==null?void 0:t.symbolConfig)==null?void 0:v.isTall)||r.type==="object"&&bt(r);a=Math.max(a,x?q:S),d=Math.max(d,S),y&&((M=r.resource)!=null&&M.primitive)&&["square","triangle","x"].includes((z=r.resource)==null?void 0:z.primitive)&&(h=!0),l.push(Promise.resolve(kt(r,S,x)))}});const c=await Promise.allSettled(l),b=[];return c.forEach(r=>{r.status==="fulfilled"?b.push(r.value):r.reason&&Y.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",r.reason)}),R(b,[a,d],{node:t==null?void 0:t.node,scale:!1,opacity:t==null?void 0:t.opacity,ariaLabel:t==null?void 0:t.ariaLabel,rotations:i,useRotationSize:h})}function Mt(e,t){const o=e.symbolLayers,s=[],p=st(e),f=T(t),l=(t!=null&&t.maxSize?w(t.maxSize):null)||U;let i,h=0,a=0;return o.forEach((d,g)=>{if(!d||d.type!=="line"&&d.type!=="path")return;const c=[];switch(d.type){case"line":{const b=E(d,0);if(b==null)break;const r=(b==null?void 0:b.width)||0;g===0&&(i=r);const u=Math.min(f||r,l),m=g===0?u:f?u*(r/i):u,y=m>A/2?2*m:A;a=Math.max(a,m),h=Math.max(h,y),b.width=m,c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[h,.5*a]}]},stroke:b});break}case"path":{const b=Math.min(f||L,l),r=n(d,0),u=n(d,-.2),m=N(d,-.4),y=m?{color:m,width:1}:{};if(d.profile==="quad"){const k=d.width,v=d.height,M=ct(k&&v?k/v:1,v===0,k===0),z={...y,join:"bevel"};c.push({shape:M[0],fill:u,stroke:z},{shape:M[1],fill:u,stroke:z},{shape:M[2],fill:r,stroke:z})}else c.push({shape:P.pathSymbol3DLayer[0],fill:u,stroke:y},{shape:P.pathSymbol3DLayer[1],fill:r,stroke:y});a=Math.max(a,b),h=a}}s.push(c)}),Promise.resolve(R(s,[h,a],{node:t==null?void 0:t.node,scale:p,opacity:t==null?void 0:t.opacity,ariaLabel:t==null?void 0:t.ariaLabel}))}async function wt(e,t){const o=e.type==="mesh-3d",s=e.symbolLayers,p=T(t),f=t!=null&&t.maxSize?w(t.maxSize):null,l=p||L,i=[];let h=0,a=0,d=!1;for(let g=0;g<s.length;g++){const c=s.at(g),b=[];if(!o||c.type==="fill"){switch(c.type){case"fill":{const r=Math.min(l,f||F);if(h=Math.max(h,r),a=Math.max(a,r),d=!0,o){const u=P.meshSymbol3DFill,m=N(c,-.4),y=G(c,.05*r)??(m?{join:"round",color:m,width:1}:null);b.push({shape:u[0],fill:n(c,0),stroke:y},{shape:u[1],fill:n(c,-.2),stroke:y},{shape:u[2],fill:n(c,-.6),stroke:y})}else{let u=n(c,0);const m="pattern"in c?c.pattern:null,y=j(c),k=Z(c);m!=null&&m.type==="style"&&m.style!=="solid"&&k&&(u=await dt(m,k)),b.push({shape:P.fill[0],fill:u,stroke:y})}break}case"line":{const r=E(c,0);if(r==null)break;const u={stroke:r,shape:P.fill[0]};h=Math.max(h,L),a=Math.max(a,L),b.push(u);break}case"extrude":{const r=n(c,0),u=n(c,-.2),m=Math.min(l,f||F),y=ht(m),k=L,v=.7*L+.5*m,M=G(c,.1*Math.min(k,v))??{join:"round",...E(c,-.4),width:1};b.push({shape:y[0],fill:u,stroke:M},{shape:y[1],fill:u,stroke:M},{shape:y[2],fill:r,stroke:M}),h=Math.max(h,k),a=Math.max(a,v);break}case"water":{const r=Z(c),u=W(r),m=W(r,2),y=W(r,3),k=ut();d=!0,b.push({shape:k[0],fill:u},{shape:k[1],fill:m},{shape:k[2],fill:y});const v=Math.min(l,f||F);h=Math.max(h,v),a=Math.max(a,v);break}}i.push(b)}}return R(i,[h,a],{node:t==null?void 0:t.node,scale:d,opacity:t==null?void 0:t.opacity,ariaLabel:t==null?void 0:t.ariaLabel})}function Kt(e,t){if(e.symbolLayers.length===0)return Promise.reject(new I("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return gt(e,t);case"line-3d":return Mt(e,t);case"polygon-3d":case"mesh-3d":return wt(e,t)}return Promise.reject(new I("symbolPreview: swatchInfo3D","symbol not supported."))}export{dt as getPatternDescriptor,T as getSizeFromOptions,n as getSymbolLayerFill,Kt as previewSymbol3D};
