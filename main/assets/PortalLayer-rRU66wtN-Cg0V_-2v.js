const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./layersLoader-JnzSqnBy-Cl783YA9.js","./index-uAe2c5m-.js","./index-CliIjrnX.css","./fetchService-Bp_4TwIU-CVBxZxOO.js","./loadUtils-qPQbuxA4-DTyKlEhW.js","./associatedFeatureServiceUtils-DCapzd9d-BrNQr86w.js","./PortalItem-CJetnHeq-CsH2tzgE.js","./jsonContext-D_JQG_uA-DQRi7iI1.js","./portalItemUtils-DsrxEt4W-Bf14tL4H.js","./projection-m8vi7Cxv-B0qO7Oqc.js","./styleUtils-DbPBpaXg-Dalf5BcY.js"])))=>i.map(i=>d[i]);
import{v as n,I as l,a1 as oe,J as _,U as v,co as q,t as c,z as N,Y as le,S as ve,cp as Se,ab as j,cq as be,cr as we,N as I,ak as fe,bM as pe,cs as Ie,ct as Le,s as K,T as Te,cu as Ee,c as O,cv as Oe,cw as Ge,bd as Ae,_ as Me,H as _e,R as je,a8 as Pe,G as w,A as Ce,l as P,cx as Ne,cy as Re,an as Z,Z as Y,cn as Ue,b as xe,cz as Fe,bQ as $e,cA as D,O as b,cB as De,cC as Be}from"./index-uAe2c5m-.js";import{o as u}from"./layerContainerType-ChWdCT09-G5sdAsSy.js";import{S as We}from"./ElevationInfo-DkWlof50-DknL-Kif.js";import{j as Q}from"./TimeExtent-gZaEUVeW-CVNwGJ9K.js";import R from"./PortalItem-CJetnHeq-CsH2tzgE.js";import{R as Ve}from"./portalItemUtils-DsrxEt4W-Bf14tL4H.js";let ke=class ye{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(D),this._values=new Map,this.multipleOriginsSupported=!0}clone(r){const e=new ye,t=this._originStores[b.DEFAULTS];t&&t.forEach((i,a)=>{e.set(a,N(i),b.DEFAULTS)});for(let i=b.SERVICE;i<D;i++){const a=this._originStores[i];a&&a.forEach((o,p)=>{r&&r.has(p)||e.set(p,N(o),i)})}return e}get(r,e){const t=e===void 0?this._values:this._originStores[e];return t?t.get(r):void 0}keys(r){const e=r==null?this._values:this._originStores[r];return e?[...e.keys()]:[]}set(r,e,t=b.USER){let i=this._originStores[t];if(i||(i=new Map,this._originStores[t]=i),i.set(r,e),!this._values.has(r)||this._propertyOriginMap.get(r)<=t){const a=this._values.get(r);return this._values.set(r,e),this._propertyOriginMap.set(r,t),a!==e}return!1}delete(r,e=b.USER){const t=this._originStores[e];if(!t)return;const i=t.get(r);if(t.delete(r),this._values.has(r)&&this._propertyOriginMap.get(r)===e){this._values.delete(r);for(let a=e-1;a>=0;a--){const o=this._originStores[a];if(o&&o.has(r)){this._values.set(r,o.get(r)),this._propertyOriginMap.set(r,a);break}}}return i}has(r,e){const t=e===void 0?this._values:this._originStores[e];return!!t&&t.has(r)}revert(r,e){for(;e>0&&!this.has(r,e);)--e;const t=this._originStores[e],i=t==null?void 0:t.get(r),a=this._values.get(r);return this._values.set(r,i),this._propertyOriginMap.set(r,e),a!==i}originOf(r){return this._propertyOriginMap.get(r)||b.DEFAULTS}forEach(r){this._values.forEach(r)}};const ue=s=>{let r=class extends s{constructor(...e){super(...e);const t=j(this),i=t.store,a=new ke;t.store=a,be(t,i,a)}read(e,t){we(this,e,t)}getAtOrigin(e,t){const i=U(this),a=I(t);if(typeof e=="string")return i.get(e,a);const o={};return e.forEach(p=>{o[p]=i.get(p,a)}),o}originOf(e){return fe(this.originIdOf(e))}originIdOf(e){return U(this).originOf(e)}revert(e,t){const i=U(this),a=I(t),o=j(this);let p;p=typeof e=="string"?e==="*"?i.keys(a):[e]:e,p.forEach(d=>{o.invalidate(d),i.revert(d,a),o.commit(d)})}};return r=n([c("esri.core.ReadOnlyMultiOriginJSONSupport")],r),r};function U(s){return j(s).store}let X=class extends ue(pe){};X=n([c("esri.core.ReadOnlyMultiOriginJSONSupport")],X);const He=s=>{let r=class extends s{constructor(...e){super(...e)}clear(e,t="user"){return x(this).delete(e,I(t))}write(e,t){return De(this,e=e||{},t),e}setAtOrigin(e,t,i){j(this).setAtOrigin(e,t,I(i))}removeOrigin(e){const t=x(this),i=I(e),a=t.keys(i);for(const o of a)t.originOf(o)===i&&t.set(o,t.get(o,i),b.USER)}updateOrigin(e,t){const i=x(this),a=I(t),o=Be(this,e);for(let p=a+1;p<D;++p)i.delete(e,p);i.set(e,o,a)}toJSON(e){return this.write({},e)}};return r=n([c("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],r),r.prototype.toJSON.isDefaultToJSON=!0,r};function x(s){return j(s).store}const Je=s=>{let r=class extends He(ue(s)){constructor(...e){super(...e)}};return r=n([c("esri.core.MultiOriginJSONSupport")],r),r};let ee=class extends Je(pe){};ee=n([c("esri.core.MultiOriginJSONSupport")],ee);const te={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},re={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},ie={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},ze={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,Object3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,ViewshedLayer:!0,Voxel:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":te,"web-map/basemap":re,"web-map/tables":ie,"link-chart/operational-layers":{...te,LinkChartLayer:!0},"link-chart/basemap":re,"link-chart/tables":ie,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0,WCS:!0},"portal-item/tables":{ArcGISFeatureLayer:!0,SubtypeGroupTable:!0}};let f=class extends le{constructor(s){super(s),this.description=null,this.label=null,this.type=null}};n([l({type:String,json:{write:!0}})],f.prototype,"description",void 0),n([l({type:String,json:{write:!0}})],f.prototype,"label",void 0),n([l()],f.prototype,"type",void 0),f=n([c("esri.tables.elements.AttributeTableElement")],f);const L=f;var B;let G=B=class extends L{constructor(s){super(s),this.displayType="auto",this.type="attachment"}clone(){return new B({description:this.description,displayType:this.displayType,label:this.label})}};n([l({type:["auto"],json:{write:!0}})],G.prototype,"displayType",void 0),n([l({type:["attachment"],readOnly:!0,json:{read:!1,write:!0}})],G.prototype,"type",void 0),G=B=n([c("esri.tables.elements.AttributeTableAttachmentElement")],G);const ae=G;var W;let A=W=class extends L{constructor(s){super(s),this.fieldName=null,this.type="field"}clone(){return new W({description:this.description,fieldName:this.fieldName,label:this.label})}};n([l({type:String,json:{write:!0}})],A.prototype,"fieldName",void 0),n([l({type:String,json:{read:!1,write:!0}})],A.prototype,"type",void 0),A=W=n([c("esri.tables.elements.AttributeTableFieldElement")],A);const se=A;var V;let M=V=class extends L{constructor(s){super(s),this.relationshipId=null,this.type="relationship"}clone(){return new V({description:this.description,label:this.label,relationshipId:this.relationshipId})}};n([l({type:Number,json:{write:!0}})],M.prototype,"relationshipId",void 0),n([l({type:["relationship"],json:{read:!1,write:!0}})],M.prototype,"type",void 0),M=V=n([c("esri.tables.elements.AttributeTableRelationshipElement")],M);const ne=M;function ce(s){return{typesWithGroup:{base:L,key:"type",typeMap:{attachment:ae,field:se,group:s,relationship:ne}},typesWithoutGroup:{base:L,key:"type",typeMap:{attachment:ae,field:se,relationship:ne}}}}function de(s,r,e=!0){if(!s)return null;const t=e?r.typesWithGroup.typeMap:r.typesWithoutGroup.typeMap;return s.filter(i=>t[i.type]).map(i=>t[i.type].fromJSON(i))}function he(s,r,e=!0){if(!s)return null;const t=e?r.typesWithGroup.typeMap:r.typesWithoutGroup.typeMap;return s.filter(i=>t[i.type]).map(i=>i.toJSON())}function me(s,r,e=!0){return s?s.map(t=>Ie(e?r.typesWithGroup:r.typesWithoutGroup,t)):null}var k;let m=k=class extends L{constructor(s){super(s),this.elements=null,this.type="group"}castElements(s){return me(s,F,!1)}readElements(s,r){return de(r.attributeTableElements,F,!1)}writeElements(s,r){r.attributeTableElements=he(s,F,!1)}clone(){return new k({description:this.description,elements:N(this.elements),label:this.label})}};n([l({json:{write:!0}})],m.prototype,"elements",void 0),n([oe("elements")],m.prototype,"castElements",null),n([_("elements",["attributeTableElements"])],m.prototype,"readElements",null),n([v("elements")],m.prototype,"writeElements",null),n([l({type:String,json:{read:!1,write:!0}})],m.prototype,"type",void 0),m=k=n([c("esri.tables.elements.AttributeTableGroupElement")],m);const F=ce(m),qe=m;var H;const $=ce(qe);let g=H=class extends le{constructor(s){super(s),this.elements=null,this.orderByFields=null}castElements(s){return me(s,$)}readElements(s,r){return de(r.attributeTableElements,$)}writeElements(s,r){r.attributeTableElements=he(s,$)}clone(){return new H({elements:N(this.elements),orderByFields:this.orderByFields})}};n([l({json:{write:!0}})],g.prototype,"elements",void 0),n([oe("elements")],g.prototype,"castElements",null),n([_("elements",["attributeTableElements"])],g.prototype,"readElements",null),n([v("elements")],g.prototype,"writeElements",null),n([l({type:[Object],json:{write:!0}})],g.prototype,"orderByFields",void 0),g=H=n([c("esri.tables.AttributeTableTemplate")],g);const Ke=g,it={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:u}}},at={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(s,r)=>!r.disablePopup},write:{enabled:!0,writer(s,r,e){r[e]=!s}}}},st={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:u}}},nt={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Le}}},ot={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:u}}},lt={value:null,type:We,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:u}}};function pt(s){return{type:s,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const ge={write:{enabled:!0,layerContainerTypes:u},read:!0},J={type:Number,json:{origins:{"web-document":ge,"portal-item":{write:{layerContainerTypes:u}}}}},yt={...J,json:{...J.json,origins:{"web-document":{...ge,write:{enabled:!0,layerContainerTypes:u,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(s,r,e)=>{var t;return e&&e.origin!=="service"||!r.drawingInfo||r.drawingInfo.transparency===void 0?(t=r.layerDefinition)!=null&&t.drawingInfo&&r.layerDefinition.drawingInfo.transparency!==void 0?q(r.layerDefinition.drawingInfo.transparency):void 0:q(r.drawingInfo.transparency)}}}},ut={type:K,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(s,r)=>{const e=K.fromJSON(s);return r.spatialReference!=null&&typeof r.spatialReference=="object"&&(e.spatialReference=Te.fromJSON(r.spatialReference)),e}}}},read:!1}},ct={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},dt={type:Number,json:{origins:{service:{write:{enabled:!1}}},name:"layerDefinition.minScale",write:{layerContainerTypes:u}}},ht={type:Number,json:{origins:{service:{write:{enabled:!1}}},name:"layerDefinition.maxScale",write:{layerContainerTypes:u}}},Ze={json:{write:{ignoreOrigin:!0,layerContainerTypes:u},origins:{"web-map":{read:!1,write:!1}}}},mt={type:Ke,json:{name:"attributeTableInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}},gt=s=>{let r=class extends s{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(e,t,i){var a;return((a=i==null?void 0:i.portalItem)==null?void 0:a.type)==="Group Layer"?void 0:e}writeListMode(e,t,i,a){(a&&a.layerContainerType==="ground"||e&&Ee(this,i,{},a))&&(t[i]=e)}writeOperationalLayerType(e,t,i){e&&(t[i]=e)}writeTitle(e,t){t.title=e??"Layer"}readVisibilityTimeExtent(e){return e?Q.fromArray(e):null}writeVisibilityTimeExtent(e,t,i,a){e&&a.layerContainerType!=="tables"&&(e.isEmpty?a!=null&&a.messages&&a.messages.push(new O("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):t[i]=e.toArray())}read(e,t){t&&(t.layer=this),Oe(this,e,i=>super.read(e,i),t)}write(e,t){var o,p,d;if(!this.persistenceEnabled&&!(t!=null&&t.ignorePersistenceEnabled))return null;if(t!=null&&t.origin){const y=`${t.origin}/${t.layerContainerType||"operational-layers"}`;let h=!!((o=ze[y])!=null&&o[this.operationalLayerType]);if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&y==="web-scene/operational-layers"&&(h=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&y==="web-map/operational-layers"&&(h=!1),!h)return(p=t.messages)==null||p.push(new O("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${y}'`,{layer:this})),null}const i=super.write(e,{...t,layer:this}),a=!!t&&!!t.messages&&!!t.messages.filter(y=>y instanceof O&&y.name==="web-document-write:property-required").length;return Ge(i==null?void 0:i.url)?((d=t==null?void 0:t.messages)==null||d.push(new O("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&a?null:i}beforeSave(){}};return n([l({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],r.prototype,"id",void 0),n([_("id",["id"])],r.prototype,"readId",null),n([l(Ze)],r.prototype,"listMode",void 0),n([v("listMode")],r.prototype,"writeListMode",null),n([l({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:u,isRequired:!0}}}}})],r.prototype,"operationalLayerType",void 0),n([v("operationalLayerType")],r.prototype,"writeOperationalLayerType",null),n([l(J)],r.prototype,"opacity",void 0),n([l({type:Boolean,readOnly:!1})],r.prototype,"persistenceEnabled",void 0),n([l({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],r.prototype,"title",void 0),n([v("title"),v(["web-scene"],"title")],r.prototype,"writeTitle",null),n([l({type:Q,json:{origins:{"web-scene":{write:{layerContainerTypes:u}}}}})],r.prototype,"visibilityTimeExtent",void 0),n([_("visibilityTimeExtent")],r.prototype,"readVisibilityTimeExtent",null),n([v(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[ve,Se]]}})],r.prototype,"writeVisibilityTimeExtent",null),n([l({type:Boolean,json:{name:"visibility",write:{layerContainerTypes:u}}})],r.prototype,"visible",void 0),r=n([c("esri.layers.mixins.OperationalLayer")],r),r},vt=s=>{let r=class extends s{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Ae(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,i){if(t.itemId)return new R({id:t.itemId,portal:i==null?void 0:i.portal})}writePortalItem(e,t){e!=null&&e.id&&(t.itemId=e.id)}async loadFromPortal(e,t){var i;if((i=this.portalItem)!=null&&i.id)try{const{load:a}=await Me(()=>import("./layersLoader-JnzSqnBy-Cl783YA9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url);return _e(t),await a({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData,layerModuleTypeMap:e.layerModuleTypeMap,populateGroupLayer:e.populateGroupLayer},t)}catch(a){throw je(a)||Pe.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${a}`),a}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(e).catch(t=>(w(t),!0)))}async setUserPrivileges(e,t){if(!Ce.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(t);if(this.url)try{const{features:{edit:i,fullEdit:a},content:{updateItem:o}}=await this._fetchUserPrivileges(e,t);this._set("userHasEditingPrivileges",i),this._set("userHasFullEditingPrivileges",a),this._set("userHasUpdateItemPrivileges",o)}catch(i){w(i)}}async _fetchUserPrivileges(e,t){var E,z;let i=this.portalItem;if(!e||!i||!i.loaded||i.sourceUrl)return this._fetchFallbackUserPrivileges(t);const a=!((E=P)!=null&&E.findCredential(this.url)),o=e===i.id;if(o&&i.portal.user)return this._getUserPrivileges(i,a);let p,d;if(o)p=i.portal.url;else try{p=await Ne(this.url,t)}catch(S){w(S)}if(!p||!Re(p,i.portal.url))return this._fetchFallbackUserPrivileges(t);try{const S=t!=null?t.signal:null;d=await((z=P)==null?void 0:z.getCredential(`${p}/sharing`,{prompt:!1,signal:S}))}catch(S){w(S)}const y=!0,h=!1,T=!1;if(!d)return{features:{edit:y,fullEdit:h},content:{updateItem:T}};try{if(o?await i.reload():(i=new R({id:e,portal:{url:p}}),await i.load(t)),i.portal.user)return this._getUserPrivileges(i,a)}catch(S){w(S)}return{features:{edit:y,fullEdit:h},content:{updateItem:T}}}_getUserPrivileges(e,t){const i=Ve(e);return t&&(i.features.edit=!0),i}async _fetchFallbackUserPrivileges(e){let t=!0;try{t=await this._fetchUserHasEditingPrivileges(e)}catch(i){w(i)}return{features:{edit:t,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(e){var a;const t=this.url?(a=P)==null?void 0:a.findCredential(this.url):null;if(!t)return!0;const i=C.credential===t?C.user:await this._fetchEditingUser(e);return C.credential=t,C.user=i,(i==null?void 0:i.privileges)==null||i.privileges.includes("features:user:edit")}async _fetchEditingUser(e){var h,T,E;const t=(T=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:T.user;if(t)return t;const i=(E=P)==null?void 0:E.findServerInfo(this.url??"");if(!(i!=null&&i.owningSystemUrl))return null;const a=`${i.owningSystemUrl}/sharing/rest`,o=Z.getDefault();if(o&&o.loaded&&Y(o.restUrl)===Y(a))return o.user;const p=`${a}/community/self`,d=e!=null?e.signal:null,y=await Ue(xe(p,{authMode:"no-prompt",query:{f:"json"},signal:d}));return y.ok?Fe.fromJSON(y.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){var o;const i=t==null?void 0:t.portal,a=((o=this.portalItem)==null?void 0:o.id)&&(this.portalItem.portal||Z.getDefault());return i&&a&&!$e(a.restUrl,i.restUrl)?(t.messages&&t.messages.push(new O("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return n([l({type:R})],r.prototype,"portalItem",null),n([_("web-document","portalItem",["itemId"])],r.prototype,"readPortalItem",null),n([v("web-document","portalItem",{itemId:{type:String}})],r.prototype,"writePortalItem",null),n([l({clonable:!1})],r.prototype,"resourceReferences",void 0),n([l({type:Boolean,readOnly:!0})],r.prototype,"userHasEditingPrivileges",void 0),n([l({type:Boolean,readOnly:!0})],r.prototype,"userHasFullEditingPrivileges",void 0),n([l({type:Boolean,readOnly:!0})],r.prototype,"userHasUpdateItemPrivileges",void 0),r=n([c("esri.layers.mixins.PortalLayer")],r),r},C={credential:null,user:null};export{ee as F,it as K,st as Q,nt as X,ot as Y,lt as Z,ct as a,dt as b,pt as e,Ke as h,Je as i,J as j,vt as l,Ze as m,mt as n,gt as o,ut as r,ht as s,yt as t,at as z};
