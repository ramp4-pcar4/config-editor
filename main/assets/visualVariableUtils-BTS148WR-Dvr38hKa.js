import{ba as I,ad as C,ci as A,a6 as O}from"./index-DBm8NF9m.js";import{m as P}from"./lengthUtils-C61nRlXw-ikARGJpS.js";var S,v;function L(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function y(e){return e!=null&&!isNaN(e)&&isFinite(e)}function Z(e){return e.valueExpression?S.Expression:e.field&&typeof e.field=="string"?S.Field:S.Unknown}function te(e,r){const t=r||Z(e),n=e.valueUnit||"unknown";return t===S.Unknown?v.Constant:e.stops?v.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?v.ClampedLinear:n==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?v.Proportional:v.Additive:v.Identity:v.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(S||(S={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(v||(v={}));const D=()=>O.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),g=e=>D().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),w=()=>D().error("Use of arcade expressions requires an arcade context"),R=new I,z=Math.PI,_=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function M(e,r,t){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(c=>c.type==="color"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void g("ColorVariable");const i=typeof r=="number",l=i?null:r,s=l==null?void 0:l.attributes;let o=i?r:null;const a=n.field,{ipData:f,hasExpression:m}=n.cache;let u=n.cache.compiledFunc;if(!a&&!m){const c=n.stops;return c&&c[0]&&c[0].color}if(typeof o!="number")if(m){if((t==null?void 0:t.arcade)==null)return void w();const c={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},p=t.arcade.arcadeUtils,V=p.getViewInfo(c),x=p.createExecContext(l,V,t.timeZone);if(!u){const k=p.createSyntaxTree(n.valueExpression);u=p.createFunction(k),n.cache.compiledFunc=u}o=p.executeFunction(u,x)}else s&&(o=s[a]);const d=n.normalizationField,b=s!=null&&d!=null?parseFloat(s[d]):void 0;if(o!=null&&(!d||i||!isNaN(b)&&b!==0)){y(b)&&!i&&(o/=b);const c=E(o,f);if(c){const p=c[0],V=c[1],x=p===V?n.stops[p].color:C.blendColors(n.stops[p].color,n.stops[V].color,c[2],t==null?void 0:t.color);return new C(x)}}}function U(e,r,t){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(c=>c.type==="opacity"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void g("OpacityVariable");const i=typeof r=="number",l=i?null:r,s=l==null?void 0:l.attributes;let o=i?r:null;const a=n.field,{ipData:f,hasExpression:m}=n.cache;let u=n.cache.compiledFunc;if(!a&&!m){const c=n.stops;return c&&c[0]&&c[0].opacity}if(typeof o!="number")if(m){if((t==null?void 0:t.arcade)==null)return void w();const c={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},p=t.arcade.arcadeUtils,V=p.getViewInfo(c),x=p.createExecContext(l,V,t.timeZone);if(!u){const k=p.createSyntaxTree(n.valueExpression);u=p.createFunction(k),n.cache.compiledFunc=u}o=p.executeFunction(u,x)}else s&&(o=s[a]);const d=n.normalizationField,b=s!=null&&d!=null?parseFloat(s[d]):void 0;if(o!=null&&(!d||i||!isNaN(b)&&b!==0)){y(b)&&!i&&(o/=b);const c=E(o,f);if(c){const p=c[0],V=c[1];if(p===V)return n.stops[p].opacity;{const x=n.stops[p].opacity;return x+(n.stops[V].opacity-x)*c[2]}}}}function N(e,r,t){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(b=>b.type==="rotation"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void g("RotationVariable");const i=n.axis||"heading",l=i==="heading"&&n.rotationType==="arithmetic"?90:0,s=i==="heading"&&n.rotationType==="arithmetic"?-1:1,o=typeof r=="number"?null:r,a=o==null?void 0:o.attributes,f=n.field,{hasExpression:m}=n.cache;let u=n.cache.compiledFunc,d=null;if(!f&&!m)return d;if(m){if((t==null?void 0:t.arcade)==null)return void w();const b={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},c=t.arcade.arcadeUtils,p=c.getViewInfo(b),V=c.createExecContext(o,p,t.timeZone);if(!u){const x=c.createSyntaxTree(n.valueExpression);u=c.createFunction(x),n.cache.compiledFunc=u}d=c.executeFunction(u,V)}else a&&(d=a[f]);return d=typeof d!="number"||isNaN(d)?null:l+s*d,d}function $(e,r,t){const n=typeof r=="number",i=n?null:r,l=i==null?void 0:i.attributes;let s=n?r:null;const{isScaleDriven:o}=e.cache;let a=e.cache.compiledFunc;if(o){const m=t==null?void 0:t.scale,u=t==null?void 0:t.view;s=m==null||u==="3d"?j(e):m}else if(!n)switch(e.inputValueType){case S.Expression:{if((t==null?void 0:t.arcade)==null)return void w();const m={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},u=t.arcade.arcadeUtils,d=u.getViewInfo(m),b=u.createExecContext(i,d,t.timeZone);if(!a){const c=u.createSyntaxTree(e.valueExpression);a=u.createFunction(c),e.cache.compiledFunc=a}s=u.executeFunction(a,b);break}case S.Field:l&&(s=l[e.field]);break;case S.Unknown:s=null}if(!y(s))return null;if(n||!e.normalizationField)return s;const f=l?parseFloat(l[e.normalizationField]):null;return y(f)&&f!==0?s/f:null}function j(e){let r=null,t=null;const n=e.stops;return n?(r=n[0].value,t=n[n.length-1].value):(r=e.minDataValue||0,t=e.maxDataValue||0),(r+t)/2}function F(e,r,t){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(l=>l.type==="size"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void g("SizeVariable");const i=q($(n,r,t),n,r,t,n.cache.ipData);return i==null||isNaN(i)?void 0:i}function h(e,r,t){return e==null?null:L(e)?F(e,r,t):y(e)?e:null}function T(e,r,t){return y(t)&&e>t?t:y(r)&&e<r?r:e}function W(e,r,t,n){const i=h(r.minSize,t,n)||r.minDataValue;return e==null&&i==null?null:(e??0)+(i??0)}function B(e,r,t){const n=e.stops;let i=(n==null?void 0:n.length)&&n[0].size;return i==null&&(i=e.minSize),h(i,r,t)}function G(e,r,t,n){const i=h(r.minSize,t,n);if(e==null)return i;const{minDataValue:l,maxDataValue:s}=r;if(l==null||s==null)return null;const o=(e-l)/(s-l),a=h(r.maxSize,t,n),f=n==null?void 0:n.shape;if(e<=l)return i;if(e>=s)return a;if(i==null||a==null)return null;if(r.scaleBy==="area"&&f){const m=f==="circle",u=m?z*(i/2)**2:i*i,d=u+o*((m?z*(a/2)**2:a*a)-u);return m?2*Math.sqrt(d/z):Math.sqrt(d)}return i+o*(a-i)}function Y(e,r,t,n){const i=h(r.minSize,t,n);if(e==null||i==null)return i;const l=n==null?void 0:n.shape,{minDataValue:s}=r;if(s==null)return null;const o=e/s,a=h(r.maxSize,t,n);let f=null;return f=l==="circle"?2*Math.sqrt(o*(i/2)**2):l==="square"||l==="diamond"||l==="image"?Math.sqrt(o*i**2):o*i,T(f,i,a)}function H(e,r,t,n,i){var a,f,m;if(e==null)return null;const[l,s,o]=E(e,i);if(l===s)return h((a=r.stops)==null?void 0:a[l].size,t,n);{const u=h((f=r.stops)==null?void 0:f[l].size,t,n),d=h((m=r.stops)==null?void 0:m[s].size,t,n);return u==null||d==null?null:u+(d-u)*o}}function J(e,r,t,n){const i=((n==null?void 0:n.resolution)??1)*P[r.valueUnit],l=h(r.minSize,t,n),s=h(r.maxSize,t,n),{valueRepresentation:o}=r;if(e==null)return l;let a=null;return a=o==="area"?2*Math.sqrt(e/z)/i:o==="radius"||o==="distance"?2*e/i:e/i,T(a,l,s)}function q(e,r,t,n,i){switch(r.transformationType){case v.Additive:return W(e,r,t,n);case v.Constant:return B(r,t,n);case v.ClampedLinear:return G(e,r,t,n);case v.Proportional:return Y(e,r,t,n);case v.Stops:return H(e,r,t,n,i);case v.RealWorldSize:return J(e,r,t,n);case v.Identity:return e;case v.Unknown:return null}}function K(e,r,t){const{isScaleDriven:n}=e.cache;if(!(n&&t==="3d"||r))return null;const i={scale:r,view:t};let l=h(e.minSize,R,i),s=h(e.maxSize,R,i);if(l!=null||s!=null){if(l>s){const o=s;s=l,l=o}return{minSize:l,maxSize:s}}}function Q(e,r,t){if(!e.visualVariables)return;const n=[],i=[],l=[],s=[],o=[];for(const a of e.visualVariables)switch(a.type){case"color":i.push(a);break;case"opacity":l.push(a);break;case"rotation":o.push(a);break;case"size":s.push(a)}return i.forEach(a=>{const f=M(a,r,t);n.push({variable:a,value:f})}),l.forEach(a=>{const f=U(a,r,t);n.push({variable:a,value:f})}),o.forEach(a=>{const f=N(a,r,t);n.push({variable:a,value:f})}),s.forEach(a=>{const f=F(a,r,t);n.push({variable:a,value:f})}),n}function E(e,r){if(!r)return;let t=0,n=r.length-1;return r.some((i,l)=>e<i?(n=l,!0):(t=l,!1)),[t,n,(e-r[t])/(r[n]-r[t])]}function X(e,r,t){const n=["proportional","proportional","proportional"];for(const i of e){const l=i.useSymbolValue?"symbol-value":F(i,r,t)??"proportional";switch(i.axis){case"width":n[0]=l;break;case"depth":n[1]=l;break;case"height":n[2]=l;break;case"width-and-depth":n[0]=l,n[1]=l;break;case"all":case void 0:case null:n[0]=l,n[1]=l,n[2]=l;break;default:A(i.axis)}}return n}const re=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:X,getColor:M,getOpacity:U,getRotationAngle:N,getSize:F,getSizeForValue:q,getSizeFromNumberOrVariable:h,getSizeRangeAtScale:K,getVisualVariableValues:Q,viewScaleRE:_},Symbol.toStringTag,{value:"Module"}));export{Q as D,X as N,te as a,re as b,L as e,N as h,v as i,Z as t,_ as v};
