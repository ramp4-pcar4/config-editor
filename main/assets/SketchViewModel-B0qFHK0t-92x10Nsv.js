const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SelfSnappingEngine-CXO0G0NU-CD4COHBF.js","./index-JysQxb7m.js","./index-BQSptJp9.css","./Cyclical-DgD7_U1C-DWXsOhyZ.js","./quantityUtils-B1Ov7DZK-GyqFFU0L.js","./elevationInfoUtils-Ccn2Wfoe-CzrZeLi4.js","./ElevationInfo-DE5to86a-D9mR-AIA.js","./lengthUtils-C61nRlXw-CbFzxkTc.js","./vec2-BnynUbeJ-CKtGJQAy.js","./common-CYWrYyJl-E8-sukrT.js","./vec2f64-CkowXrDb-3zFQ3LNH.js","./vec32-Cj8pVsU0-Cq-HgVHC.js","./UpdatingHandles-Bd2FQ26N-CoxDITBt.js","./projectionUtils-B-CplN3q-DYZZu_-u.js","./GraphicsLayer-BiEC2-gS-X1BXWd5O.js","./GraphicsCollection-uWAVmks7-C1GM3TJR.js","./Layer-DvVVmz9x-CQh7OSfC.js","./TimeExtent-Cf2Pienb-DstDmVgA.js","./BlendLayer-DjW_5k0v-HONeExWo.js","./layerContainerType-ChWdCT09-G5sdAsSy.js","./jsonUtils-BwLwuQj7-Bu_6JrpW.js","./parser-CWccHtwJ-ClH7aFqe.js","./mat4f32-BdRMyjXW-CWt6U0BP.js","./mat4-OOmHNWi7-d4wDSfI3.js","./ScaleRangeLayer-x42fwED3-DuReLbie.js","./editableLayers-DFUBlMJy-CghCkhUG.js","./utils-Dd8gTonD-CQWa1OZh.js","./Queue-DV3gpSdl-D_5qVZo7.js","./Version-CnwD6MZa-BFgcISMZ.js","./projectVectorToVector-DcyiGOWJ-DQfXK2e-.js","./projectPointToVector-BZJhoF_5-Dr300XgW.js","./geodesicUtils-DKS2UG72-CDZ866Ix.js","./asyncUtils-BPUlNCrX-BS2LVKAY.js","./Query-n1aoaaFC-BH8Wj8dd.js","./Field-BIQ-quF4-CELMLVTM.js","./fieldType-PhcL4ff8-Dx3imvn-.js","./vec42-D8CJyqHG-DnfLTeQH.js","./vec4f64-DD-nkcCV-CSNWKRqG.js","./plane-Cf3Koz3c-DCCEvwZa.js","./vectorStacks-5ZZtmT9E-Yd4fhXgC.js","./mat3f64-BnNZDR5l-Bz3OL2oI.js","./mat4f64-xsZDPPj0-Dq35B4BL.js","./quatf64-C16JxGFv-BKWK1F8U.js","./sphere-zPMQWhGG-DHiNq8Z2.js","./mat3-DOnW3DjW-C3hbW9XY.js","./geodeticLengthOperator-DHGBHzf3-CiCC-N0K.js","./geodeticCurveType-D_etKnbP-CirnHLSB.js","./earcut-C6NeZYSh-Da0ULCQ5.js","./triangle-BM89wdHY-C4RiBl_1.js","./lineSegment-BAWQVP9P-BrsFXHnG.js","./spatialReferenceEllipsoidUtils-BK0OQJn2-ErlLtZyA.js","./GridSnappingEngine-DCu-2xRk-DdlzA0yp.js","./normalizeUtils-u00NGW3M-DJIcJS3H.js","./normalizeUtilsCommon-ClagynAA-DgLRsjpR.js","./utils-BO8hgPs3-ESkgk50Y.js","./utils-DpLVEUvg-Cr3RAbYo.js","./scaleUtils-Br-smv3A-Bls3RUkB.js","./gridUtils-ZkKc2j-y-Cmdlvifl.js","./FeatureSnappingEngine-D6B44S6e-D_X6ljl1.js","./FeatureFilter-DXpQKGs4-OZKJ-5W6.js","./floorFilterUtils-4r-vVdzs-u-jw2p7F.js","./layerViewUtils-DLIaYA64-Cmoz-a_j.js","./geometryEngine-C83waDS7-DKgu_PyR.js","./geometryEngineBase-BcMV6k0z-DS0IsP1z.js","./_commonjsHelpers-BITg13Vk-KnjfkSck.js","./hydrated-CNNw1XFI-CdSHHYO8.js","./editingTools-7dqMzBcg-CAY1_GRS.js","./SnappingVisualizer2D-Di4uotAR-QCFNoXzX.js","./enums-a_LDTPYU-CBIcy3mM.js","./TooltipInfoWithCoordinates-Xxefy9Or-B6QV_dI5.js","./PointSnappingHint-OKXicQ1z-a9fau__y.js","./SketchTooltipInfo-CkyYTifq-H7inpL0a.js","./intl-BAA1onnp-C2vVW-wX.js","./MeshTransform-ByFk-Izc-CqQwUDWc.js","./quat-DQgq9Ar5-l74UySta.js","./axisAngleDegrees-BTSCyz4U-B00uoLpw.js","./meshVertexSpaceUtils-CCr86FVF-opav0sZZ.js","./MeshLocalVertexSpace-Cfxtmv6L-zIucdlNT.js","./modeUtils-deizL-Tg-C4WiXKJs.js","./jsxFactory-Cua8zWVZ-Dy_I6Z9a.js","./uuid-Dj9mdEVg-BaKSCiyT.js","./sanitizerUtils-B1yRmbO2-B7KG_jBT.js","./a11yUtils-CoCwThtH-BK5NhuWf.js","./memoize-DvEt8OkT-Cy_RrfpZ.js","./unitFormatUtils-FAypDaT5-DDHGvEe-.js","./ByteSizeUnit-DL8UhsB0-B2-AmVRx.js","./index-kib5quT9-B-WDaRMv.js","./draw-store-DnCf4IRI-C-poRxOw.js","./drapedUtils-DARF9dbf-KyxEnbNy.js","./utils-C0LvbFCo-RMQaTNpt.js","./widget-p2YDjs4S-8UkSSTCU.js","./substitute-B3zxyWVi-D3MtH9Oa.js","./editPlaneUtils-DmK-4boe-CX4FJmDE.js","./drawSurfaces-DQUGW1oK-CcnryDvr.js","./distanceOperator-CZDvZf3O-Cf7-Tx1B.js","./Point2D-CaHJVGk1-JqvJXjLr.js","./ProjectionTransformation-DQ4GElxa-Ca2aDxt1.js","./Envelope2D-DlBzXkgv-eKRxGysX.js","./Transformation2D-CXWnDKXs-bixc63yn.js","./SimpleGeometryCursor-DSF_YyIm-TAMgMsbK.js","./OperatorDefinitions-DJdq_wrt-DP7_WWTp.js","./apiConverter-CSuukuP9-D8wHo0F-.js","./jsonConverter-tsQ40CV0-KXut-8kD.js","./simplifyOperator-BW9Vrh-l-BARN8Z_W.js","./operatorSimplify-CjcRb60U-BeEpfXGu.js","./mat2d-BQA-1WB--Pnyy0dhf.js","./mat2df64-DDXwUeaJ-Tu7q-7Mk.js","./ReactiveSet-CRNikQMW-CuhRhVRQ.js","./diffUtils-BxG8DCnW-CSbmQiv7.js","./ViewingMode-CdRKcXnc-Dab70bGf.js","./SnappingContext-OY7xJ98b-Da_pDC4P.js","./hydratedFeatures-oobA80ei-DfjmQ8NW.js","./Scheduler-BV4C4cVP-DpxzNRMY.js","./debugFlags-8tOwPnHK-Boy4z9Pk.js","./boundedPlane-QDtjx5eO-9qnLVMa0.js","./cimSymbolUtils-DCedSSCN-C5MSTcya.js","./utils-BfXZnjCE-CGCN-wqd.js","./defaultCIMValues-BcSaJjm--58G-soMN.js","./GraphicManipulator-D_ewLKOT-Cp95xv5g.js","./colorUtils-Eg6lOlXm-BTgDJreF.js","./drawUtils-pJlGx3nm-D7jbfYvb.js","./ImageMaterial.glsl-4GA395N2-BIovsip-.js","./TextOverlayItem-BwTcOTWP-CawSVjCL.js","./Octree-B7mLL9lS-B_uMQwhE.js","./BufferView-wDxx79o3-D6bX1Vjh.js","./RibbonLine.glsl-B_euRL9h-KPS81-Tg.js","./orientedBoundingBox-CSC169JG-D2AdqLxV.js","./computeTranslationToOriginAndRotation-e-ft1lOz-DlYgTKZ8.js","./OutputColorHighlightOID.glsl-BdXTjs7_-b7pB-v53.js","./videoUtils-Scb4DgCQ-Di-w4w4a.js","./requestImageUtils-B2YN5Eb9-LXcNbcw6.js","./basicInterfaces-Dsf65ICa-DkQ9Rsnx.js","./TextureFormat-Cl0ugX3E-DD0Aw8RG.js","./enums-wEDHPbCF-Cf76M5_x.js","./Texture-D5XWO2GQ-Ci0c00Q9.js","./getDataTypeBytes-DYbftOSj-BNZIboqJ.js","./Indices-BuIC5D20-c3vAII3R.js","./VertexAttribute-hUz6pozM-Bx3V-z96.js","./glsl-Z5uYj8ka-BRgh2Cgo.js","./BindType-CKbZk6AG-Bqvzo9NX.js","./ShaderOutput-CUn9tpiG-CW1Nc608.js","./renderState-BM-MCKUz-CkGIEsl7.js","./InterleavedLayout-C2YUDwKf-aJK3Ayvw.js","./types-l27bT09Q-DE0QfIFp.js","./dehydratedFeatureUtils-OR1UjA48-BDRQ1AGR.js","./vec3f32-GX_cKsFD-UJPpzdNc.js","./floatRGBA-DRFmbkvz-CiE6BMWo.js","./ShaderBuilder-CU5v4tk1-Czjcr6AQ.js","./DefaultLayouts-Dxx39D6p-DXwL4qXw.js","./triangulationUtils--8_1p-hL-DLfwg3jo.js","./deduplicate-DRKoZSEv-D0sp8eAU.js","./VertexElementDescriptor-DLvjNrmQ-BHK9ksow.js","./VertexArrayObject-CieliEx4-AfldqzY9.js","./memoryEstimations-DeWfxwaV-BnbU1TaS.js","./NestedMap-DL9KstBd-DzPVXgde.js","./glUtil-0ZzWJjlL-C5xhkIWX.js","./HUDMaterial.glsl-9ciK4G-4-3z19ntLr.js","./SelectedVertexTooltipInfo-4SubR9ql-BDN_4kBi.js","./IntersectorType-D6ZupXNg-DQZQEhlR.js","./TranslateTooltipInfo-A8pO5CNj-CQ2cH281.js","./utils-Cb2uXNfG-CNhH8kmH.js","./LRUCache-DPWdPNTF-BhV6gJVw.js","./MemCache-qDGoejB7-Bz_y0gIH.js","./IViewEvents-BE10MM98-CvMfjolG.js","./ExtentScaleTooltipInfo-BgG7HiRF-DQeuQNYa.js","./LineCallout.glsl-0Cou_Qxw-CvMIvgk5.js","./projectionUtils-Dt6hj1Xh-Di7i_LJV.js","./HeightModelInfo-C4voFc4k-DAjCnFqr.js","./visualVariableUtils-BTS148WR-Dyd05Xj4.js","./dehydratedFeatures-CE8L86IW-BCIr3-MZ.js","./UniqueValueRenderer-CLXHFtg9-CCNP90Rp.js","./commonProperties-CJLeiNuA-BW_T4GrI.js","./colorRamps-trM-CPFS-CXhs1IBF.js","./ColorStop-CL7v3R-A-D498Ru50.js","./RendererLegendOptions-Bil_IDab-ch3YvyVz.js","./styleUtils-DBPDLVBX-CtpDyPkG.js","./rendererConversion-koUEkXyy-6yh6IRQ4.js","./RealisticTree.glsl-DzbI6Sba-D05B5ZRg.js","./DefaultMaterial-7UvmJfZD-h_XrENHl.js","./NormalAttribute.glsl-BnbqDItl-CFtRyIV6.js","./edgeUtils-Dic9zHbc-C93HSWPO.js","./OptimizedFeature-mIz_HhJg-lEv_dFEg.js","./OptimizedGeometry-pzfNw1AT--wT_d_bU.js","./optimizedFeatureQueryEngineAdapter-LiTJLGWN-lauJM7ec.js","./vec2f32-hTAvipMV-C0AQcwEv.js","./featureConversionUtils-Bjjlcfdo-BG5IulME.js","./OptimizedFeatureSet-Dz5hF8Qm-B1brSkRC.js","./PooledRBush-DfSXIoUa-Df1QVG8c.js","./quickselect-DHTstthl-Ds_Aj0x5.js","./popupUtils-B9dNptlM-vUbzqOHE.js","./LayerView-DdANuT-Y-D64ZMD3d.js","./GraphicMover-BruWidUQ-BTLPaj29.js","./Box-C1MLNNLE-DGCtOQd2.js","./settings-Dt5EB2Ay-C_tYUqmb.js","./Reshape-Zlegijc9-C5lhAcEY.js","./symbolUtils-D5Wjfwrf-CUkrB206.js","./mat2df32-fg3OHsAI-BF2V2zqo.js","./webStyleSymbolUtils-r0H5toyk-Qw6xGx8C.js","./devEnvironmentUtils-CxrVv3RG-ktR0Kqgv.js"])))=>i.map(i=>d[i]);
import{v as c,S as h,a0 as Lt,du as m,gD as St,a8 as Zn,K as ai,ac as ct,a1 as At,_ as I,u as Ve,Y as Wn,ci as Kn,eu as Ri,eK as Xn,eJ as Jn,gE as Qn,gF as to,a3 as Mi,ak as re,ai as eo,ao as $e,s as Gi,ap as te,gG as io,gH as no,gI as it,gJ as Pi,a6 as Qi,h as oo,ah as Ai,aU as ro,n as H,a7 as ao,gr as so,gK as lo,gL as me,X as tn,ad as _e,a9 as po,bJ as co,gM as ho,aj as Wt,eW as uo,cf as yo,aG as go,gN as fo,ag as vo,b3 as Li,ef as zt,df as si,dC as mo,gO as _o,gP as Eo,dr as en,gQ as bo,gR as nn,B as wo,gS as To,dq as So,ds as Oo,dp as Ro}from"./index-JysQxb7m.js";import{i as Mo}from"./UpdatingHandles-Bd2FQ26N-CoxDITBt.js";import{O as Je,Q as Go,L as Po,k as Ao,K as Lo,i as Co}from"./projectionUtils-B-CplN3q-DYZZu_-u.js";import Do from"./GraphicsLayer-BiEC2-gS-X1BXWd5O.js";import{b as It,c as on,$ as xo,R as No,k as Io,q as rn,d as ko}from"./elevationInfoUtils-Ccn2Wfoe-CzrZeLi4.js";import{c as Ho}from"./editableLayers-DFUBlMJy-CghCkhUG.js";import{g as A,w as Ci,V as G,$ as Di,v as Uo,d as Vo}from"./utils-Dd8gTonD-CQWa1OZh.js";import{l as $o,a as Fo}from"./Cyclical-DgD7_U1C-DWXsOhyZ.js";import{t as Jt,g as li,i as _t,s as pi}from"./quantityUtils-B1Ov7DZK-GyqFFU0L.js";import{i as U,l as Dt,P as Ut,y as st,f as zo,D as qo,b as jo,h as an,M as sn,v as Yo,k as Bo,A as Zo,m as ln,E as xi}from"./vec2-BnynUbeJ-CKtGJQAy.js";import{o as Z,O as Wo,r as ge,l as Ko}from"./vec2f64-CkowXrDb-3zFQ3LNH.js";import{N,p as Qe,R,k as F,v as pn,y as $,S as Ee,l as Xo,r as Ae,P as Jo,X as Qo,_ as Le,A as q,T as tr,g as Kt,U as ti}from"./vec32-Cj8pVsU0-Cq-HgVHC.js";import{s as ee,p as wt,f as cn}from"./projectVectorToVector-DcyiGOWJ-DQfXK2e-.js";import{u as ei,D as Ce,$ as be,C as De,I as hn,c as er,h as ir}from"./geodesicUtils-DKS2UG72-CDZ866Ix.js";import{g as nr}from"./asyncUtils-BPUlNCrX-BS2LVKAY.js";import{z as or}from"./TimeExtent-Cf2Pienb-DstDmVgA.js";import{R as rr}from"./Query-n1aoaaFC-BH8Wj8dd.js";import{y as ar,w as sr}from"./vec42-D8CJyqHG-DnfLTeQH.js";import{o as lr}from"./vec4f64-DD-nkcCV-CSNWKRqG.js";import{y as W,n as dn,O as pr,i as un,e as cr,z as xe,u as yn,N as ii,$ as ci,G as gn,K as hr,r as dr}from"./plane-Cf3Koz3c-DCCEvwZa.js";import{G as ur,F as yr,B as gr,w as fr,U as vr}from"./sphere-zPMQWhGG-DHiNq8Z2.js";import{n as Qt}from"./common-CYWrYyJl-E8-sukrT.js";import{m as mr,l as fn}from"./geodeticLengthOperator-DHGBHzf3-CiCC-N0K.js";import{m as _r}from"./earcut-C6NeZYSh-Da0ULCQ5.js";import{_ as Er}from"./triangle-BM89wdHY-C4RiBl_1.js";import{m as br,q as wr}from"./spatialReferenceEllipsoidUtils-BK0OQJn2-ErlLtZyA.js";let mt=class extends ct{constructor(t){super(t),this.length=null,this.verticalLength=null,this.area=null}};c([h()],mt.prototype,"length",void 0),c([h()],mt.prototype,"verticalLength",void 0),c([h()],mt.prototype,"area",void 0),mt=c([H("esri.views.interactive.sketch.Units")],mt);var V;function Tr(t,e){if(t==null||e==null)return;const i=ni(t,e);return i!=null?Jt(i,"radians","geographic"):void 0}(function(t){t.Absolute="absolute",t.Relative="relative",t.RelativeBilateral="relative-bilateral"})(V||(V={}));const ni=(()=>{const t=m(),e=m();return(i,n)=>(q(t,i.x,i.y,i.z??0),q(e,n.x,n.y,n.z??0),Sr(t,e,i.spatialReference,n.spatialReference))})(),Sr=(()=>{const t=Z(),e=m(),i=m();return(n,o,r,s)=>{if(R(n,o))return;const a=ei(r),p=ei(s);if(a&&p&&te(a,p)&&wt(n,r,e,a)&&wt(o,s,i,p)){const{azimuth:d}=Ce(Rr,e,i,a);return d!=null?si(d,"degrees","radians"):void 0}t[0]=o[0]-n[0],t[1]=o[1]-n[1];let l=qo(Wo,t);return t[0]<0&&(l=Mr-l),l}})();function zs(t,e,i,n=V.Absolute){if(e&&i)switch(n){case V.Absolute:return Tr(e,i);case V.Relative:return Ii(Ni(t,e,i),V.Relative);case V.RelativeBilateral:return Ii(Ni(t,e,i),V.RelativeBilateral)}}function Ni(t,e,i){if(!t||!e||!i)return;const n=ni(t,e),o=ni(e,i);return n!=null&&o!=null?Jt(o-n,"radians","geographic"):void 0}function Ii(t,e){if(t!=null)switch(e){case V.Absolute:return Or(t);case V.Relative:{const i=we(t);let n=ki.normalize(i,0,!0);return n===-180&&(n=180),Jt(n,"degrees","geographic")}case V.RelativeBilateral:{const i=we(t),n=Math.abs(ki.normalize(i,0,!0));return Jt(n,"degrees","geographic")}}}function Or(t){const e=we(t),i=Gr.normalize(e,0,!0);return Jt(i,"degrees","geographic")}const qs=(()=>{const t=m();return(e,i,n,o,r,s="geodesic")=>{Le(t,i);const a=we(r);if(s==="geodesic"){const g=ei(n);if(g&&wt(t,n,t,g))return be(e,t,a,o,g),e[2]=i[2],!!wt(e,g,e,n)}const p=li(a,"geographic","arithmetic"),l=si(p,"degrees","radians"),d=i[0]+o*Math.cos(l),u=i[1]+o*Math.sin(l),y=i[2];return q(e,d,u,y),!0}})();function we(t){if(t!=null)return li(vn(t),t.rotationType,"geographic")}function js(t){if(t!=null)return li(vn(t),t.rotationType,"arithmetic")}function vn(t){return si(t.value,t.unit,"degrees")}const Rr=new De,Mr=2*Math.PI,Gr=$o,ki=new Fo(-180,180);let at=class extends ct{constructor(t){super(t),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?V.RelativeBilateral:V.Relative;case"absolute":return V.Absolute}}get displayUnits(){return this._get("displayUnits")??new mt}set displayUnits(t){this._set("displayUnits",t)}get inputUnits(){return this._get("inputUnits")??new mt}set inputUnits(t){this._set("inputUnits",t)}};c([h({type:String,nonNullable:!0})],at.prototype,"directionMode",void 0),c([h({type:Boolean,nonNullable:!0})],at.prototype,"relativeDirectionIsBilateral",void 0),c([h()],at.prototype,"effectiveDirectionMode",null),c([h({type:mt,nonNullable:!0})],at.prototype,"displayUnits",null),c([h({type:mt,nonNullable:!0})],at.prototype,"inputUnits",null),at=c([H("esri.views.interactive.sketch.SketchValueOptions")],at);function Hi(t){switch(t){case b.SUPPORTED:break;case b.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case b.GEOMETRY_MISSING:return"no geometry";case b.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case b.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case b.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var b;(function(t){t[t.SUPPORTED=0]="SUPPORTED",t[t.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",t[t.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",t[t.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",t[t.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",t[t.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(b||(b={}));function Pr(t){var n,o;if(t.graphic&&((n=t.graphic.layer)==null?void 0:n.type)!=="graphics")return b.GRAPHICS_LAYER_MISSING;const e=(o=t.operations)==null?void 0:o.data.type;if(!e)return b.GEOMETRY_TYPE_UNSUPPORTED;switch(e){case"polygon":case"point":case"polyline":case"mesh":break;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const i=t.elevationInfo;return on(i)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}function Ar(t){return Lr(t).result}function Lr(t){var n;if(t.graphic&&((n=t.graphic.layer)==null?void 0:n.type)!=="graphics")return{result:b.GRAPHICS_LAYER_MISSING};if(!t.operations)return{result:b.GEOMETRY_MISSING};if(on(t.elevationInfo))return{result:b.ELEVATION_MODE_UNSUPPORTED};const e=t.operations.data.type,i=t.operations.data.geometry;return e==="point"||e==="mesh"||e==="polyline"||e==="polygon"?{result:b.SUPPORTED,geometry:i}:{result:b.GEOMETRY_TYPE_UNSUPPORTED}}function Cr(t){var i;if(((i=t.layer)==null?void 0:i.type)!=="graphics")return b.GRAPHICS_LAYER_MISSING;if(t.geometry==null)return b.GEOMETRY_MISSING;switch(t.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return b.SUPPORTED;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const e=t.symbol!=null&&t.symbol.type==="point-3d"&&t.symbol.symbolLayers;return!e||!e.some(n=>n.type==="object")?b.SYMBOL_TYPE_UNSUPPORTED:xo(t)!=="on-the-ground"&&No(t)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}function Ui(t,e,i){if(!e||!(t!=null&&t.map))return;const{map:n}=t;n.layers.find(o=>o===e)||n.add(e,i)}function Ys(t,e){const i=(e==null?void 0:e.type)==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(n=>{const o=n.layer;return o===i||"sublayers"in o&&o.sublayers!=null&&o.sublayers.includes(i)})}function Bs(t){return Ho(t)||ao(t)||so(t)||lo(t)}let Nt=class extends ct{constructor(t){super(t),this.enabled=!1}};c([h({type:Boolean,nonNullable:!0})],Nt.prototype,"enabled",void 0),Nt=c([H("esri.views.interactive.sketch.SketchLabelOptions")],Nt);let Xt=class extends ct{constructor(t){super(t),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};c([h({type:String,nonNullable:!0})],Xt.prototype,"mode",void 0),Xt=c([H("esri.views.interactive.sketch.SketchTooltipElevationOptions")],Xt);let C=class extends ct{constructor(t){super(t),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};c([h({type:Boolean,nonNullable:!0})],C.prototype,"area",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"coordinates",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"direction",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"distance",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"elevation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"header",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"helpMessage",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"orientation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"radius",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"rotation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"scale",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"size",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"totalLength",void 0),C=c([H("esri.views.interactive.sketch.SketchTooltipVisibleElements")],C);let x=class extends ct{constructor(t){super(t),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new Xt,this.placement="auto",this.offset=null,this.visibleElements=new C,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};c([h({type:Boolean,nonNullable:!0})],x.prototype,"enabled",void 0),c([h()],x.prototype,"forceEnabled",void 0),c([h()],x.prototype,"effectiveEnabled",null),c([h()],x.prototype,"helpMessage",void 0),c([h()],x.prototype,"helpMessageIcon",void 0),c([h({type:Boolean,nonNullable:!0})],x.prototype,"inputEnabled",void 0),c([h({type:Xt,nonNullable:!0})],x.prototype,"elevation",void 0),c([h()],x.prototype,"placement",void 0),c([h()],x.prototype,"offset",void 0),c([h({type:C,nonNullable:!0})],x.prototype,"visibleElements",void 0),c([h()],x.prototype,"visualVariables",void 0),c([h()],x.prototype,"xyMode",void 0),x=c([H("esri.views.interactive.sketch.SketchTooltipOptions")],x);let Pt=class extends ct{constructor(t){super(t),this.labels=new Nt,this.tooltips=new x,this.values=new at}};c([h({nonNullable:!0,type:Nt})],Pt.prototype,"labels",void 0),c([h({nonNullable:!0,type:x})],Pt.prototype,"tooltips",void 0),c([h({nonNullable:!0,type:at})],Pt.prototype,"values",void 0),Pt=c([H("esri.views.interactive.sketch.SketchOptions")],Pt);var xt;function mn(t,e,i){return j(t,e,i)}function j(t=0,e=0,i=0){return me(t,e,i)}function Zs(t){return t}function Ws(t){return t}function Ot(t,e,i){return me(t,e,i)}function kt(t){const[e,i,n]=t;return t.length>3?[e,i,n,t[3]]:[e,i,n]}function Fe(t){return t[3]=((t.length>3?t[3]:void 0)??xt.NONE)|xt.TARGET,t}function Ks(t){return!!(((t.length>3?t[3]:void 0)??xt.NONE)&xt.TARGET)}function Vi(t,e,{coordinateHelper:i,elevationInfo:n},o){return t?Zt(i.vectorToDehydratedPoint(t,Dr),e,n,o):null}function Zt(t,e,i,n=j()){return n[0]=t.x,n[1]=t.y,n[2]=t.z??0,e==null||(e.type==="2d"?n[2]=0:n[2]=Io(e,t,i,It)??0),n}function Xs(t,e,i){return i?(cn(i,t[0],t[1],t[2],e),i):ee(t[0],t[1],t[2],e)}function $i(t,e,{z:i,m:n},o,r){const{spatialReference:s,elevationInfo:a}=o;let p;i==null&&n==null?p=void 0:e==null||e.type==="2d"?p=i??void 0:p=rn(e,t,s,It,a)??0;const[l,d]=t;return r?cn(r,l,d,p,s):r=ee(l,d,p,s),n!=null&&(r.m=n,r.hasM=!0),r}function Js(t,e,i,n,o=j()){const[r,s]=t;return o[0]=r,o[1]=s,t.length>3&&(o[3]=t[3]??xt.NONE),(i==null?void 0:i.type)!=="3d"?(o[2]=e.value,o):(o[2]=ko(i,r,s,e.value,n,e.elevationInfo,It)??0,o)}(function(t){t[t.NONE=0]="NONE",t[t.TARGET=1]="TARGET"})(xt||(xt={}));const Dr=ee(0,0,0,null);let tt=class extends tn{constructor(){super(...arguments),this.enabled=!0}};c([h({type:Boolean})],tt.prototype,"enabled",void 0),tt=c([H("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],tt);let S=class extends tn{constructor(t){super(t),this.lineSnapper=new tt,this.parallelLineSnapper=new tt,this.rightAngleSnapper=new tt,this.rightAngleTriangleSnapper=new tt,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new _e([255,127,0]),this.orangeTransparent=new _e([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};c([h({type:tt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"lineSnapper",void 0),c([h({type:tt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"parallelLineSnapper",void 0),c([h({type:tt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleSnapper",void 0),c([h({type:tt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleTriangleSnapper",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"shortLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"distance",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"intersectionParallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"parallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"verticalLineThresholdMeters",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"touchSensitivityMultiplier",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointOnLineThreshold",void 0),c([h({type:_e,nonNullable:!0})],S.prototype,"orange",void 0),c([h({type:_e,nonNullable:!0})],S.prototype,"orangeTransparent",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthReference",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthTarget",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"lineHintFadedExtensions",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"parallelLineHintWidth",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],S.prototype,"parallelLineHintLength",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"parallelLineHintOffset",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],S.prototype,"rightAngleHintSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],S.prototype,"rightAngleHintOutlineSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"satisfiesConstraintScreenThreshold",void 0),S=c([H("esri.views.interactive.snapping.Settings.Defaults")],S);const Te=new S;var k;(function(t){t[t.FEATURE=1]="FEATURE",t[t.SELF=2]="SELF",t[t.ALL=3]="ALL"})(k||(k={}));let gt=class extends ct{constructor(t){super(t),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new Lt}};c([h({constructOnly:!0})],gt.prototype,"layer",void 0),c([h()],gt.prototype,"enabled",void 0),c([h()],gt.prototype,"updating",void 0),c([h()],gt.prototype,"availability",void 0),c([h()],gt.prototype,"sublayerSources",void 0),gt=c([H("esri.views.interactive.snapping.FeatureSnappingLayerSource")],gt);let L=class extends ct{constructor(t){super(t),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new Lt,this.distance=Te.distance,this.touchSensitivityMultiplier=Te.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var a;const t=this.featureSources;t.some(Fi)&&Qi.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const e=t.filter(Nr),i=((a=this._get("_effectiveFeatureSources"))==null?void 0:a.filter(Fi))??new Lt;for(const p of e){const l=i.find(d=>d.layer===p.layer.parent);if(l)l.sublayerSources.includes(p)||l.sublayerSources.add(p);else if(p.layer.parent){const d=new gt({layer:p.layer.parent});d.sublayerSources.add(p),i.add(d)}}for(const p of i){const l=p.sublayerSources.filter(d=>!e.includes(d));p.sublayerSources.removeMany(l)}i.removeMany(i.filter(p=>p.sublayerSources.length===0));const n=t.filter(xr),o=this._get("_effectiveFeatureSources")??new Lt,{added:r,removed:s}=po(o.toArray(),[...n,...i]);return o.removeMany(s),o.addMany(r),o}};function Fi(t){return t.layer.type==="subtype-group"}function xr(t){return t.layer.type!=="subtype-group"}function Nr(t){return t.layer.type==="subtype-sublayer"}c([h()],L.prototype,"enabled",void 0),c([h()],L.prototype,"enabledToggled",void 0),c([h()],L.prototype,"forceDisabled",void 0),c([h()],L.prototype,"selfEnabled",void 0),c([h()],L.prototype,"featureEnabled",void 0),c([h()],L.prototype,"gridEnabled",void 0),c([h()],L.prototype,"attributeRulesEnabled",void 0),c([h({type:Lt.ofType(gt)})],L.prototype,"featureSources",void 0),c([h()],L.prototype,"distance",void 0),c([h()],L.prototype,"touchSensitivityMultiplier",void 0),c([h({readOnly:!0})],L.prototype,"effectiveEnabled",null),c([h({readOnly:!0})],L.prototype,"effectiveGridEnabled",null),c([h({readOnly:!0})],L.prototype,"effectiveSelfEnabled",null),c([h({readOnly:!0})],L.prototype,"effectiveFeatureEnabled",null),c([h({readOnly:!0})],L.prototype,"_effectiveFeatureSources",null),L=c([H("esri.views.interactive.snapping.SnappingOptions")],L);const Qs=Symbol("grid-placement-graphic");function _n(t,e){const i=t.x-e.x,n=t.y-e.y;return i*i+n*n}function tl(t,e){return Math.sqrt(_n(t,e))}function Ir(t,e){e.sort((i,n)=>Qe(i.targetPoint,t)-Qe(n.targetPoint,t))}var K;function el({parameters:{point:t,distance:e,returnEdge:i,vertexMode:n,coordinateHelper:{spatialReference:o},filter:r},mode:s,returnZ:a,filter:p}){const l=(p==null?void 0:p.clone())??new rr({where:"1=1"});return l.returnZ=a??s==="3d",r&&(l.geometry=r.geometry,l.distance=r.distance,l.spatialRelationship=r.spatialRelationship,l.where=co(l.where,r.where),l.timeExtent=or(l.timeExtent,r.timeExtent),l.objectIds=kr(l.objectIds,r.objectIds)),{point:ee(t[0],t[1],t[2],o.toJSON()),mode:s,distance:e,returnEdge:i,vertexMode:n,query:l.toJSON()}}function kr(t,e){return t||e?e?t?Array.from(ho(new Set(t),new Set(e))):e:t:null}function il(t,e,i){return{left:Vi(t.leftVertex.pos,e,i),right:Vi(t.rightVertex.pos,e,i)}}(function(t){t[t.TARGET=0]="TARGET",t[t.REFERENCE=1]="REFERENCE",t[t.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(K||(K={}));const zi=Symbol("snapping-toggle");function Hr(t,e=()=>{}){const i=At(()=>({view:t.view,snappingOptions:t.snappingOptions}),({view:n,snappingOptions:o})=>{if(t.removeHandles(zi),!n||!o)return;const r=A.TOOL,s=[n.on("key-down",a=>{a.key!==Di.toggle||a.repeat||(o.enabledToggled=!0,e())},r),n.on("key-up",a=>{a.key===Di.toggle&&(o.enabledToggled=!1,e())},r),n.on("pointer-move",a=>{const p=a.native.ctrlKey;o.enabledToggled!==p&&(o.enabledToggled=p,e())},r)];t.addHandles(s,zi)},Wt);t.addHandles(i)}function nl(t){var e;return Uo(t)&&"utilityNetworks"in t&&!!((e=t.utilityNetworks)!=null&&e.length)}function ze(t,e){return t[0]*e[1]-t[1]*e[0]}function Ur(t,e,i){const n=Ut(i,e)/Dt(i);return Yo(t,i,n)}function ol(t,e,i,n,o=i){return U(Ct,n,i),U(Se,e,o),Ur(Ht,Se,Ct),jo(t,o,Ht)}function rl(t,e,i,n){U(Ct,e,i);const o=n/an(Ct);return st(t,i,Ct,o)}function al(t,e){const i=t.start,n=t.end,o=e.start,r=e.end,s=U(Ct,n,i),a=U(En,r,o),p=ze(s,a);if(Math.abs(p)<=$r)return[];const l=U(Se,i,o),d=ze(a,l)/p,u=ze(s,l)/p;if(d>=0){if(u>=0||e.type===M.LINE)return[st(Ht,i,s,d)]}else if(t.type===M.LINE&&(u>=0||e.type===M.LINE))return[st(Ht,i,s,d)];return[]}function Vr(t,e,i){const n=[],o=U(Ct,t.end,t.start),r=U(En,t.start,e),s=Dt(o),a=2*Ut(o,r),p=a*a-4*s*(Dt(r)-i*i);if(p===0){const l=-a/(2*s);(t.type===M.LINE||l>=0)&&n.push(st(Ht,t.start,o,l))}else if(p>0){const l=Math.sqrt(p),d=(-a+l)/(2*s);(t.type===M.LINE||d>=0)&&n.push(st(Ht,t.start,o,d));const u=(-a-l)/(2*s);(t.type===M.LINE||u>=0)&&n.push(st(Se,t.start,o,u))}return n}var M;(function(t){t[t.RAY=0]="RAY",t[t.LINE=1]="LINE"})(M||(M={}));const $r=1e-6,Ct=Z(),En=Z(),Se=Z(),Ht=Z();function hi({start:t,end:e,type:i},n,o){const r=[],s=U(ie,e,t),a=U(Ne,t,n),p=Dt(s),l=2*Ut(s,a),d=l*l-4*p*(Dt(a)-o*o);if(d===0){const u=-l/(2*p);(i===z.PLANE||u>=0)&&r.push(st(Z(),t,s,u))}else if(d>0){const u=Math.sqrt(d),y=(-l+u)/(2*p);(i===z.PLANE||y>=0)&&r.push(st(Z(),t,s,y));const g=(-l-u)/(2*p);(i===z.PLANE||g>=0)&&r.push(st(Z(),t,s,g))}return r}function bn(t,e){const i=t.start,n=t.end,o=U(ie,n,i),r=q(ke,-o[1],o[0],0),s=e.start,a=e.end,p=F(ui,a,s),l=$(p,r),d=q(Pn,i[0],i[1],0),u=F(An,d,s),y=$(u,r),g=Qt();if(Math.abs(l)<g)return[];const v=N(Ln,s,p,y/l);if(e.type===M.RAY){const f=F(oi,v,s);if($(f,p)<-g)return[]}if(t.type===z.HALF_PLANE){const f=Bo(Ne,v,i);if(Ut(f,o)<-g)return[]}return[St(v)]}function Fr(t,e){return qr(Oe(yi,e[2],t),e)}function wn(t,e){return Mn(Oe(yi,0,t),Oe(Zr,0,e)).map(([i,n])=>ge(i,n))}function Tn(t,e,i){return On(t,Oe(yi,t[2],e),i)}function Sn(t,e,i,n=m()){const o=U(ie,t,e),r=an(o);return st(n,e,o,r===0?1:i/r),n[2]=t[2],n}function On(t,{start:e,end:i,type:n},o=m()){const r=F(Ie,t,e),s=F(ke,i,e),a=$(r,s)/$(s,s);return N(o,e,s,n===M.RAY?Math.max(a,0):a)}const zr=(()=>{const t=m(),e=m(),i=m();return({start:n,end:o},{center:r,radius:s,normal:a,slicePlane:p})=>{const l=xe(r,a,Br);if(T(ii(l,n),0)&&T(ii(l,o),0)){yn(a,t,e);const u=(v,f)=>(Ae(i,f,r),ln(v,$(i,t),$(i,e)),v),y=Vr({start:u(ie,n),end:u(Ne,o),type:M.LINE},Ko,s),g=[];for(const[v,f]of y){const _=Le(m(),r);N(_,_,t,v),N(_,_,e,f),p&&!Tt(p,_)||g.push(_)}return g}const d=m();return dn(l,n,o,d)?!T(Kt(d,r),s)||p&&!Tt(p,d)?[]:[d]:[]}})();function Rn({start:t,end:e,type:i},n,o){const r=[],s=Ae(Ie,e,t),a=U(Ne,t,n),p=Dt(s),l=2*Ut(s,a),d=l*l-4*p*(Dt(a)-o*o);if(d===0){const u=-l/(2*p);(i===M.LINE||u>=0)&&r.push(N(m(),t,s,u))}else if(d>0){const u=Math.sqrt(d),y=(-l+u)/(2*p);(i===M.LINE||y>=0)&&r.push(N(m(),t,s,y));const g=(-l-u)/(2*p);(i===M.LINE||g>=0)&&r.push(N(m(),t,s,g))}return r}function Mn(t,e){const i=t.start,n=t.end,o=e.start,r=e.end,s=F(Ie,n,i),a=F(ke,r,o),p=F(ui,o,i),l=Ee(Pn,s,a);if(!T($(p,l),0))return[];const d=ti(l);if(T(d,0))return[];const u=Ee(An,p,a),y=$(u,l)/d,g=N(Ln,i,s,y);if(t.type===M.RAY){const v=F(oi,g,i);if($(s,v)<-Qt())return[]}if(e.type===M.RAY){const v=F(oi,g,o);if($(a,v)<-Qt())return[]}return[St(g)]}function qr({start:t,end:e,type:i},n){const o=F(Ie,n,t),r=F(ke,e,t),s=Ee(ui,r,o),a=ti(s)/ti(r),p=Qt();if(a<p)switch(i){case M.LINE:return[St(n)];case M.RAY:return $(r,o)<-p?[]:[St(n)]}return[]}function di(t,e,i,n){const[o,r]=t,[s,a]=i,p=s-o,l=a-r,d=p*p+l*l,u=Math.sqrt(d);if(u>e+n)return[];if(u<Math.abs(e-n))return[];if(T(u,0)&&T(e,n))return[];const y=(e*e-n*n+d)/(2*u),g=Math.sqrt(e*e-y*y),v=g*l/u,f=g*p/u,[_,O]=Zo(ie,t,i,y/u);return T(v,f)?[ge(_,O)]:[ge(_+v,O-f),ge(_-v,O+f)]}function Oe(t,e,{start:i,end:n,type:o}){return q(t.start,i[0],i[1],e),q(t.end,n[0],n[1],e),t.type=Yr[o],t}function Gn(t,e){return T(t[2],e[2])}function T(t,e){return uo(Math.abs(t-e),0,Qt())}function jr(t,e){return e.filter(i=>Tt(t,i))}function Tt(t,e){return cr(t,e)}var z;(function(t){t[t.PLANE=0]="PLANE",t[t.HALF_PLANE=1]="HALF_PLANE"})(z||(z={}));const Yr={[z.PLANE]:M.LINE,[z.HALF_PLANE]:M.RAY},ie=Z(),Ne=Z(),Ie=m(),ke=m(),ui=m(),Pn=m(),An=m(),Ln=m(),oi=m(),Br=W(),yi={start:m(),end:m(),type:M.LINE},Zr={start:m(),end:m(),type:M.LINE};class X{intersect(e){return ht(this,e)}closestPoints(e){return[this.closestTo(e)]}}class Vt extends X{constructor(e){super(),this.point=e}equals(e){return this===e||J(e)&&R(this.point,e.point)}closestTo(){return kt(this.point)}}class gi extends X{constructor(e,i,n){super(),this.start=e,this.end=i,this.lineLike={start:e,end:i,type:n}}equals(e){return this===e||nt(e)&&this.lineLike.type===e.lineLike.type&&R(this.start,e.start)&&R(this.end,e.end)}closestTo(e){const i=j();return On(e,this.lineLike,i),i}}class fi extends gi{constructor(e,i){super(e,i,M.LINE)}}class Wr extends gi{constructor(e,i){super(e,i,M.RAY)}}class Cn extends X{constructor(e){super(),this.constraints=e}equals(e){return this===e||ri(e)&&yo(this.constraints,e.constraints,(i,n)=>i.equals(n))}closestTo(e){let i,n=1/0;for(const o of this.constraints){const r=o.closestTo(e),s=Qe(e,r);s<n&&(n=s,i=r)}return kt(i??e)}closestPoints(e){return this.constraints.flatMap(i=>i===this?[]:i.closestPoints(e))}}class Dn extends X{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||rt(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const i=j();return Sn(e,this.center,this.radius,i),i}}class vi extends X{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||ut(e)&&R(this.center,e.center)&&this.radius===e.radius}closestTo(e){const i=j();return Sn(e,this.center,this.radius,i),i[2]=this.center[2],i}asCircle(){return new mi(kt(this.center),this.radius,Ot(0,0,1))}}class mi extends X{constructor(e,i,n,o=void 0){super(),this.center=e,this.radius=i,this.normal=n,this.slicePlane=o}equals(e){return this===e||bt(e)&&R(this.center,e.center)&&R(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){var l;const{center:i,radius:n}=this;un(this.getPlane(Kr),e,qe);const o=F(qe,qe,i),r=pn(o);if(T(r,0))return kt(e);const s=n/Math.sqrt(r),a=j();N(a,i,o,s);const{slicePlane:p}=this;return p&&!Tt(p,a)?((l=Ei(p,this))==null?void 0:l.closestTo(e))??kt(e):a}getPlane(e=W()){return xe(this.center,this.normal,e)}}const qe=m(),Kr=W();class Xr extends X{constructor(e){super(),this.z=e}equals(e){return this===e||dt(e)&&this.z===e.z}closestTo(e){return Ot(e[0],e[1],this.z)}getPlane(e=W()){return q(qi,0,0,this.z),xe(qi,Eo,e)}}const qi=m();class _i extends X{constructor(e,i,n){super(),this.start=e,this.end=i,this.planeLike={start:e,end:i,type:n}}equals(e){return this===e||ot(e)&&this.planeLike.type===e.planeLike.type&&R(this.start,e.start)&&R(this.end,e.end)}closestTo(e){const i=j();return Tn(e,this.planeLike,i),i}closestEndTo(e){const{start:i,end:n}=this.planeLike;return Math.sign(Ut(U(Jr,n,i),U(Qr,e,i)))>0?this.end:this.start}getPlane(e=W()){const i=Le(ji,this.end);return i[2]+=1,gn(this.start,this.end,i,e)}getSlicePlane(e=W()){const{start:i,end:n,type:o}=this.planeLike;if(o===z.PLANE)return;const r=q(ji,i[0],i[1],0),s=q(Yi,n[0],n[1],0),a=Ae(Yi,s,r);return xe(r,a,e),e}}const Jr=Z(),Qr=Z(),ji=m(),Yi=m();class sl extends _i{constructor(e,i){super(e,i,z.HALF_PLANE)}}class xn extends _i{constructor(e,i){super(e,i,z.PLANE)}}class ta extends X{constructor(e,i){super(),this.sphere=yr(e,i)}equals(e){return this===e||yt(e)&&gr(this.sphere,e.sphere)}closestTo(e){const i=j();return fr(this.sphere,e,i),i}get center(){return vr(this.sphere)}get radius(){return this.sphere[3]}}class Nn extends X{constructor(e,i,n){super(),this.start=e,this.end=i,this.getZ=n,this.planeLike={start:e,end:i,type:z.PLANE}}equals(e){return this===e||Re(e)&&R(this.start,e.start)&&R(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return aa(this,e)}addIfOnTheGround(e,i){for(const n of i){const o=this.getZ(n[0],n[1])??0;T(n[2],o)&&(n[2]=o,e.push(n))}}}class ea extends X{constructor(e,i,n){super(),this._x=e,this._y=i,this._z=n}equals(e){return this===e||wa(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,i,n]){return mn(this._x??e,this._y??i,this._z??n)}}class ia extends X{constructor(e,i,n,o,r){super(),this._origin=e,this._spatialReference=i,this._distanceMeters=n,this._z=o,this._directionDegrees=r}equals(e){return this===e||ba(e)&&xi(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,i,n]){return ln(qt,e,i),xi(qt,this._origin)||this._applyDirectionAndDistance(qt),mn(qt[0],qt[1],this._z??n)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)be(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)oa(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:i}=Ce(na,this._origin,e,this._spatialReference);be(e,this._origin,i??0,this._distanceMeters,this._spatialReference)}}}const qt=[0,0],na=new De;function oa(t,e,i,n,o){let{azimuth:r,distance:s}=Ce(ra,e,n,o);r??(r=0);let a=s*Math.cos((r-i)*Co);a=Math.max(0,a),be(t,e,i,a,o)}const ra=new De;function aa(t,e){const i=j();return Tn(e,t.planeLike,i),i[2]=t.getZ(i[0],i[1])??kn,i}function ht(t,e){if(ri(t)){const i=[];for(const n of t.constraints){const o=n.intersect(e);o&&i.push(o)}return bi(i)}if(ri(e))return ht(e,t);if(Re(t))return Bi(t,e);if(Re(e))return Bi(e,t);if(J(t)){const{point:i}=t;if(J(e))return R(i,e.point)?t:void 0;const n=e.closestTo(i);return tr(n,i)?t:void 0}if(nt(t)){if(J(e))return ht(e,t);if(nt(e))return et(Mn(t.lineLike,e.lineLike));if(dt(e))return sa(t,e);if(ot(e))return et(bn(e.planeLike,t.lineLike));if(rt(e))return et(Rn(t.lineLike,e.center,e.radius));if(bt(e))return et(zr(t.lineLike,e));if(ut(e))return la(t,e);if(yt(e))return pa(t,e)}else if(dt(t)){if(J(e)||nt(e))return ht(e,t);if(dt(e))return ca(t,e);if(ot(e))return ha(t,e);if(rt(e))return da(t,e);if(bt(e))return ya(t,e);if(ut(e))return ua(t,e);if(yt(e))return ga(t,e)}else if(ot(t)){if(J(e)||nt(e)||dt(e))return ht(e,t);if(ot(e))return je(wn(t.planeLike,e.planeLike));if(rt(e))return je(hi(t.planeLike,e.center,e.radius));if(bt(e))return va(t,e);if(ut(e))return fa(t,e);if(yt(e))return ma(t,e)}else if(rt(t)){if(J(e)||nt(e)||dt(e)||ot(e))return ht(e,t);if(rt(e))return je(di(t.center,t.radius,e.center,e.radius));if(bt(e))return;if(ut(e))return _a(t,e);if(yt(e))return}else if(bt(t)){if(J(e)||nt(e)||dt(e)||ot(e)||rt(e))return ht(e,t);if(bt(e))return;if(ut(e))return e.asCircle(),void 0;if(yt(e))return}else if(ut(t)){if(J(e)||nt(e)||dt(e)||ot(e)||rt(e)||bt(e))return ht(e,t);if(ut(e))return Ea(e,t);if(yt(e))return}else if(yt(t)){if(J(e)||nt(e)||dt(e)||ot(e)||rt(e)||ut(e))return ht(e,t);if(yt(e))return}}const sa=(()=>{const t=W();return(e,i)=>{const{start:n,end:o}=e;if(Gn(n,o)&&T(n[2],i.z))return e;const r=j();return dn(i.getPlane(t),n,o,r)?new Vt(r):void 0}})();function la({lineLike:t},{center:e,radius:i}){const n=e[2];return et(Rn(t,e,i).filter(o=>T(o[2],n)))}function pa({lineLike:t},{sphere:e}){return et(ur(e,t.start,t.end))}const Ei=(()=>{const t=lr(),e=m(),i=m();return(n,o,r)=>{const{normal:s,center:a,radius:p}=o;yn(s,e,i);const l=ci(n),d=p*$(l,e),u=p*$(l,i);ar(t,a[0],a[1],a[2],1);const y=sr(n,t),g=Math.hypot(d,u),v=T(g,0);if(T(ii(n,a),0)){if(v)return o;if(T(p,0))return!r||Tt(r,a)?new Vt(kt(a)):void 0;Ee(e,l,s),Xo(e,e);const Ue=new Array,ne=St(a);N(ne,ne,e,p),r&&!Tt(r,ne)||Ue.push(ne);const oe=St(a);return N(oe,oe,e,-p),r&&!Tt(r,oe)||Ue.push(oe),et(Ue)}if(v)return;const f=-y/g;if(Math.abs(f)>1||T(f,1))return;const _=Math.atan(d/u),O=mo(f)-_,Ft=Math.PI-O,Rt=new Array,w=m();N(w,a,e,p*Math.cos(O)),N(w,w,i,p*Math.sin(O)),Rt.push(w);const Mt=m();return N(Mt,a,e,p*Math.cos(Ft)),N(Mt,Mt,i,p*Math.sin(Ft)),Rt.push(Mt),et(r?jr(r,Rt):Rt)}})();function ca(t,e){return T(t.z,e.z)?t:void 0}function ha({z:t},{planeLike:e}){const[i,n]=e.start,[o,r]=e.end,s=Ot(i,n,t),a=Ot(o,r,t);return e.type===z.PLANE?new fi(s,a):new Wr(s,a)}function da(t,e){const[i,n]=e.center;return new vi(Ot(i,n,t.z),e.radius)}function ua(t,e){return T(e.center[2],t.z)?e:void 0}const ya=(()=>{const t=W();return(e,i)=>Ei(e.getPlane(t),i,i.slicePlane)})();function ga(t,{center:e,radius:i}){const n=Math.abs(e[2]-t.z);if(n>i&&!T(n,i))return;const o=Ot(e[0],e[1],t.z),r=Math.sqrt(i**2-n**2);return T(r,0)?void 0:new vi(o,r)}const fa=(()=>{const t=W();return(e,{center:i,radius:n})=>{const o=hi(e.planeLike,i,n),r=i[2];e.getSlicePlane(t);const s=new Array;for(const[a,p]of o){const l=[a,p,r];Tt(t,l)&&s.push(l)}return et(s)}})(),va=(()=>{const t=W(),e=W();return(i,n)=>Ei(i.getPlane(t),n,i.getSlicePlane(e))})(),ma=(()=>{const t=W();return(e,{center:i,radius:n})=>{const o=e.getPlane(t),r=pr(o,i),s=Math.abs(r);if(s>n&&!T(s,n))return;const a=Math.sqrt(n**2-r**2);if(T(a,0)){const d=j();return un(o,i,d),new Vt(d)}const p=j(),l=St(ci(o));return N(p,i,l,r),new mi(p,a,l,e.getSlicePlane())}})();function _a(t,e){const i=sn(t.center,e.center);return T(i,0)&&T(t.radius,e.radius)?e:In(di(t.center,t.radius,e.center,e.radius),e.center[2])}function Ea(t,e){if(!Gn(t.center,e.center))return;const i=sn(t.center,e.center);return T(i,0)&&T(t.radius,e.radius)?t:In(di(t.center,t.radius,e.center,e.radius),t.center[2])}function Bi(t,e){const{planeLike:i,getZ:n}=t,o=new Array;if(J(e))t.addIfOnTheGround(o,Fr(i,e.point));else if(nt(e))t.addIfOnTheGround(o,bn(i,e.lineLike));else if(rt(e))for(const[r,s]of hi(i,e.center,e.radius)){const a=n(r,s);a!=null&&o.push(me(r,s,a))}else if(ot(e)||Re(e))for(const[r,s]of wn(i,e.planeLike)){const a=n(r,s)??kn;o.push(me(r,s,a))}return et(o)}function je(t){return bi(t.map(([e,i])=>{const n=Ot(e,i,0),o=Ot(e,i,1);return new fi(n,o)}))}function et(t){return bi(t.map(e=>e?new Vt(e):void 0))}function In(t,e){return et(t.map(([i,n])=>[i,n,e]))}function bi(t){if(t.length!==0)return t.length===1?t[0]??void 0:new Cn(t.filter(Zn))}function ri(t){return t instanceof Cn}function J(t){return t instanceof Vt}function nt(t){return t instanceof gi}function dt(t){return t instanceof Xr}function ot(t){return t instanceof _i}function rt(t){return t instanceof Dn}function ut(t){return t instanceof vi}function bt(t){return t instanceof mi}function yt(t){return t instanceof ta}function Re(t){return t instanceof Nn}function ba(t){return t instanceof ia}function wa(t){return t instanceof ea}const kn=0;let $t=class{constructor(t,e,i,n){this.targetPoint=t,this.constraint=e,this.isDraped=i,this.domain=n}},Hn=class extends $t{constructor({targetPoint:t,objectId:e,constraint:i,isDraped:n}){super(t,i,n,k.FEATURE),this.objectId=e}},He=class{constructor(t,e){this.isDraped=t,this.domain=e}},pt=class Un extends He{constructor(e,i,n,o,r=k.ALL,s=!0,a=!0){super(o,r),this.type=e,this.lineStart=i,this.lineEnd=n,this.fadeLeft=s,this.fadeRight=a}equals(e){return e instanceof Un&&this.type===e.type&&R(this.lineStart,e.lineStart)&&R(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return Kt(this.lineStart,this.lineEnd)}},Ta=class extends Hn{constructor(t){super({...t,isDraped:!0,constraint:new Nn(t.edgeStart,t.edgeEnd,t.getGroundElevation)})}get hints(){return[new pt(K.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Sa=class extends Hn{constructor(t){super({...t,constraint:new fi(t.edgeStart,t.edgeEnd)})}get hints(){return[new pt(K.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Oa=class Vn extends He{constructor(e,i,n=k.ALL){super(i,n),this.intersectionPoint=e}equals(e){return e instanceof Vn&&R(this.intersectionPoint,e.intersectionPoint)}},fe=class extends $t{constructor(t,e,i,n){super(t,new Vt(t),n,k.ALL),this.first=e,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Oa(this.targetPoint,this.isDraped,this.domain)]}},Ra=class extends $t{constructor({lineStart:t,lineEnd:e,targetPoint:i,isDraped:n}){super(i,new xn(t,e),n,k.SELF),this._referenceLineHint=new pt(K.REFERENCE_EXTENSION,t,e,n,this.domain)}get hints(){return[this._referenceLineHint,new pt(K.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},Ma=class $n extends He{constructor(e,i,n,o=k.ALL){super(n,o),this.lineStart=e,this.lineEnd=i}equals(e){return e instanceof $n&&R(this.lineStart,e.lineStart)&&R(this.lineEnd,e.lineEnd)}},Ga=class extends $t{constructor({referenceLine:t,lineStart:e,targetPoint:i,isDraped:n}){const o=St(e),{left:r,right:s}=t;Ae(o,Jo(o,o,s),r),super(i,new xn(e,o),n,k.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new pt(K.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Ma(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(t=>new pt(K.REFERENCE,t.edge.left,t.edge.right,this.isDraped,this.domain,t.fadeLeft,t.fadeRight))]}addReferenceLine(t){const e={edge:t,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{R(t.right,i.edge.left)&&(i.fadeLeft=!1,e.fadeRight=!1),R(t.right,i.edge.right)&&(i.fadeRight=!1,e.fadeRight=!1),R(t.left,i.edge.right)&&(i.fadeRight=!1,e.fadeLeft=!1),R(t.left,i.edge.left)&&(i.fadeLeft=!1,e.fadeLeft=!1)}),this._referenceLines.push(e)}},Fn=class zn extends He{constructor(e,i,n,o,r=k.ALL){super(o,r),this.previousVertex=e,this.centerVertex=i,this.nextVertex=n}equals(e){return e instanceof zn&&R(this.previousVertex,e.previousVertex)&&R(this.centerVertex,e.centerVertex)&&R(this.nextVertex,e.nextVertex)}},Pa=class extends $t{constructor({targetPoint:t,constraint:e,previousVertex:i,otherVertex:n,otherVertexType:o,isDraped:r,selfSnappingType:s,objectId:a,domain:p}){super(t,e,r,p??k.SELF),this.previousVertex=i,this.otherVertex=n,this.otherVertexType=o,this.selfSnappingType=s??Ge.None,this.objectId=a??null}get hints(){const t=this.previousVertex,e=this.otherVertexType===Me.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===Me.CENTER?this.targetPoint:this.otherVertex;return[new pt(K.TARGET,e,i,this.isDraped,this.domain),new pt(K.REFERENCE,t,e,this.isDraped,this.domain),new Fn(this.previousVertex,e,i,this.isDraped,this.domain)]}};var Me,Ge;(function(t){t[t.NEXT=0]="NEXT",t[t.CENTER=1]="CENTER"})(Me||(Me={})),function(t){t[t.None=0]="None",t[t.LastVertex=1]="LastVertex",t[t.FirstVertex=2]="FirstVertex",t[t.ExistingEdge=3]="ExistingEdge"}(Ge||(Ge={}));let Aa=class extends $t{constructor({targetPoint:t,point1:e,point2:i,isDraped:n}){super(t,new Dn(Qo(m(),e,i,.5),.5*zo(e,i)),n,k.SELF),this._p1=e,this._p2=i}get hints(){return[new pt(K.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new pt(K.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new Fn(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function La(t,e,i,n,o=m()){const r=Le(Ca,t);return r[2]=rn(n,r,e,i)||0,n.renderCoordsHelper.toRenderCoords(r,e,o),o}const Ca=m();function Da(t,e,i,n){return n.type==="2d"?(ae.x=t[0],ae.y=t[1],ae.spatialReference=e,n.toScreen(ae)):(La(t,e,i,n,Zi),n.state.camera.projectToScreen(Zi,Ye),go(Ye[0],Ye[1]))}const ae=ee(0,0,0,null),Zi=m(),Ye=fo();function ll(t){return hn(t)||en(t)}function wi(t,e,i,...n){return hn(t)?e.apply(void 0,n):t.isWebMercator?i.apply(void 0,n):null}function xa(t){const{spatialReference:e}=t;return wi(e,Ua,Va,t)}function Na(t,e){if(!te(t.spatialReference,e.spatialReference))return null;const{spatialReference:i}=t;return se[0]=t.x,se[1]=t.y,se[2]=t.hasZ?t.z:0,le[0]=e.x,le[1]=e.y,le[2]=e.hasZ?e.z:0,qn(se,le,i)}function qn(t,e,i){return wi(i,ka,Ha,t,e,i)}const Ia={geodesicLength:xa,geodesicDistanceBetweenPoints:Na,geodesicDistance:qn};async function jn(){return await mr(),Ia}function ka(t,e,i){return _t(Ce(Fa,t,e,i).distance,"meters")}function Ha(t,e,i){return _t(fn($a(t,e,i),{unit:"meters"}),"meters")}function Ua(t){return _t(er([t],"meters")[0],"meters")}function Va(t){return _t(fn(t,{unit:"meters"}),"meters")}function $a(t,e,i){return new wo({spatialReference:i,paths:[[[...t],[...e]]]})}const Fa=new De,se=m(),le=m();let Q=class extends ai.EventedMixin(ct){constructor(t){super(t),this.options=new L,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=ft.MAIN}initialize(){this.addHandles([At(()=>{const{distance:t,touchSensitivityMultiplier:e,effectiveSelfEnabled:i,effectiveFeatureEnabled:n,effectiveGridEnabled:o}=this.options;return{selfEnabled:i,featureEnabled:n,gridEnabled:this.view.type==="2d"&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:t,touchSensitivityMultiplier:e}},(t,e)=>{var i;e&&(this.doneSnapping(),this.emit("changed")),(i=this._loadTask)==null||i.abort(),this._loadTask=nr(n=>this._updateEngines(t,e,n))},Wt),At(()=>this.options,t=>{for(const e of this._engines)e.options=t},vo)])}destroy(){var t;(t=this._loadTask)==null||t.abort(),this._destroyEngines()}get updating(){var t;return this._engines.some(e=>e.updating)||!((t=this._loadTask)!=null&&t.finished)}_destroyEngines(){this._engineCache.forEach(t=>t.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(t,e,i){var r;if(!t.viewReady)return void this._destroyEngines();(e==null?void 0:e.viewSpatialReference)!==t.viewSpatialReference&&this._destroyEngines();const n=this._engineCache,o=await Promise.allSettled([t.featureEnabled&&!n.has("feature")?this._createFeatureSnappingEngine(i):void 0,t.selfEnabled&&!n.has("self")?this._createSelfSnappingEngine(i):void 0,t.gridEnabled&&!n.has("grid")?this._createGridSnappingEngine(i):void 0]);if(i.aborted)for(const s of o)s.status==="fulfilled"&&((r=s.value)==null||r.engine.destroy());else{for(const s of o)s.status==="fulfilled"&&s.value&&n.set(s.value.type,s.value.engine);this._engines=Array.from(n.values())}}async _createSelfSnappingEngine(t){const[{SelfSnappingEngine:e},i]=await Promise.all([I(()=>import("./SelfSnappingEngine-CXO0G0NU-CD4COHBF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]),import.meta.url),jn()]);return Ve(t),{type:"self",engine:new e({view:this.view,options:this.options,geodesicLengthMeasurementUtils:i})}}async _createGridSnappingEngine(t){const{view:e}=this;if(e.type!=="2d")return;const{GridSnappingEngine:i}=await I(()=>import("./GridSnappingEngine-DCu-2xRk-DdlzA0yp.js"),__vite__mapDeps([51,1,2,11,9,13,52,53,54,55,56,57,31,12,14,15,16,17,18,19,20,21,22,23,24,6,7,5,25,26,27,28,3,4,8,10,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]),import.meta.url);return Ve(t),{type:"grid",engine:new i({view:e,options:this.options})}}async _createFeatureSnappingEngine(t){const{FeatureSnappingEngine:e}=await I(()=>import("./FeatureSnappingEngine-D6B44S6e-D_X6ljl1.js"),__vite__mapDeps([58,1,2,32,8,9,11,12,5,6,7,59,33,34,35,17,60,61,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,3,4,10,29,30,31,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]),import.meta.url);Ve(t);const{view:i,options:n}=this,{spatialReference:o}=i;return{type:"feature",engine:new e({view:i,options:n,spatialReference:o})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:t,touchSensitivityMultiplier:e}=this.options,i=t*e;return i*i}snap(t){return ja(t)?this._snapMultiPoint(t):this._snapSinglePoint(t)}update(t){const{point:e,context:i}=t;this._removeVisualization();const n=this._currentMainCandidate;if(n==null)return e;const o=this._selectUpdateInput(t);if(o==null)return e;const{spatialReference:r}=i,s=Je(o,r);if(s==null)return e;const{view:a}=this,{elevationInfo:p,visualizer:l}=i,d=[],u=Zt(s,a,p),y=n.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,y,i)||!Ze(n,i.drawConstraints))return this._resetSnappingState(),e;n.targetPoint=Fe(y),d.push(...n.hints);for(const g of this._currentOtherActiveCandidates)Ze(g,i.drawConstraints)&&(g.targetPoint=Fe(y),d.push(...g.hints));return l!=null&&this.addHandles(l.draw(d,{spatialReference:r,elevationInfo:Ya(i),view:a,selfSnappingZ:i.selfSnappingZ}),Be),$i(y,a,e,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:t,scenePoint:e}){switch(this._currentSnappedType){case ft.MAIN:return t;case ft.SCENE:return e}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=ft.MAIN}_removeVisualization(){this.removeHandles(Be)}async _snapSinglePoint({point:t,context:e,signal:i}){const{view:n}=this,{elevationInfo:o}=e,r=Zt(t,n,o),s=await this._fetchCandidates(r,k.ALL,e,i);return this._createSnapResult(r,ft.MAIN,s,n,t,e,i)}async _snapMultiPoint({point:t,scenePoint:e,context:i,signal:n}){const{view:o}=this,{coordinateHelper:r,elevationInfo:s,spatialReference:a}=i;await Go(e.spatialReference,a);const p=Je(e,a),l=Zt(p,o,s),d=await this._fetchCandidates(l,k.FEATURE,i,n);if(d.length>0){const g=await this._fetchCandidates(l,k.SELF,i,n);return this._createSnapResult(l,ft.SCENE,[...d,...g],o,p,i,n)}const u=Zt(t,o,s),y=await this._fetchCandidates(u,k.SELF,i,n);return this._createSnapResult(u,ft.MAIN,y,o,{z:r.hasZ()&&t.hasZ?t.z??0:void 0,m:r.hasM()&&t.hasM?t.m??0:void 0},i,n)}async _fetchCandidates(t,e,i,n){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(t,e,i,n)))).flat()}_createSnapResult(t,e,i,n,o,r,s){return{get valid(){return!Wn(s)},apply:()=>{const{spatialReference:a}=r,{snappedPoint:p,hints:l}=this._processCandidates(t,e,i,r);return this._removeVisualization(),r.visualizer!=null&&this.addHandles(r.visualizer.draw(l,{spatialReference:a,elevationInfo:It,view:n,selfSnappingZ:r.selfSnappingZ}),Be),$i(p,n,o,r)}}}_processCandidates(t,e,i,n){if(i.length<1)return this.doneSnapping(),{snappedPoint:t,hints:[]};this._currentSnappedType!==e&&this._resetSnappingState(),Ir(t,i);const o=this._currentMainCandidate;if(o!=null){const r=qa(o,i);if(r>=0){if(!(i[r]instanceof fe))return this._intersectWithOtherCandidates(r,i,t,e,n);if(this._arePointsWithinScreenThreshold(t,o.targetPoint,n))return this._updateSnappingCandidate(o,e,i,n)}}return this._intersectWithOtherCandidates(0,i,t,e,n)}_intersectWithOtherCandidates(t,e,i,n,o){const{coordinateHelper:r}=o,s=e[t],a=[];for(let p=0;p<e.length;++p){if(p===t)continue;const l=e[p],d=s.constraint.intersect(l.constraint);if(d)for(const u of d.closestPoints(s.targetPoint))a.push([new fe(Fe(u),s,l,l.isDraped),this._squaredScreenDistance(i,u,r)])}return a.length>0&&(a.sort((p,l)=>p[1]-l[1]),a[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(a[0][0],n,e,o):Ze(s,o.drawConstraints)?this._updateSnappingCandidate(s,n,e,o):{snappedPoint:i,hints:[]}}_updateSnappingCandidate(t,e,i,n){this.doneSnapping(),this._currentMainCandidate=t,this._currentSnappedType=e;const o=this._currentMainCandidate.targetPoint,r=[];r.push(...t.hints);for(const s of i){if(t instanceof fe){if(s.constraint.equals(t.first.constraint)||s.constraint.equals(t.second.constraint))continue}else if(s.constraint.equals(t.constraint))continue;const a=s.constraint.closestTo(o);this._squaredScreenDistance(a,o,n.coordinateHelper)<za()&&(s.targetPoint=o,this._currentOtherActiveCandidates.push(s),r.push(...s.hints))}return{snappedPoint:o,hints:r}}_squaredPointProximityThreshold(t){return t==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(t,e,i){return this._squaredScreenDistance(t,e,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(t,e,i){return _n(this._toScreen(t,i),this._toScreen(e,i))}_toScreen(t,e){return Da(t,e.spatialReference,It,this.view)}get test(){}};var ft;c([h({constructOnly:!0})],Q.prototype,"view",void 0),c([h()],Q.prototype,"options",void 0),c([h({readOnly:!0})],Q.prototype,"updating",null),c([h()],Q.prototype,"_loadTask",void 0),c([h()],Q.prototype,"_engines",void 0),c([h()],Q.prototype,"_squaredMouseProximityThreshold",null),c([h()],Q.prototype,"_squaredTouchProximityThreshold",null),Q=c([H("esri.views.interactive.snapping.SnappingManager")],Q),function(t){t[t.MAIN=0]="MAIN",t[t.SCENE=1]="SCENE"}(ft||(ft={}));const Be="visualization-handle";function za(){return Te.satisfiesConstraintScreenThreshold*Te.satisfiesConstraintScreenThreshold}function Ze(t,e){return!e||e.direction==null&&e.distance==null||!(t instanceof Ta||t instanceof Sa||t instanceof Ra||t instanceof Ga||t instanceof Aa)&&(!(t instanceof Pa)||e.direction==null&&t.selfSnappingType===Ge.LastVertex)}function qa(t,e){return t instanceof fe?We(e,t.first)>=0&&We(e,t.second)>=0?0:-1:We(e,t)}function We(t,e){let i=-1;for(let n=0;n<t.length;++n)if(e.constraint.equals(t[n].constraint)){i=n;break}return i}function ja(t){return t.scenePoint!=null}function Ya({coordinateHelper:t,elevationInfo:e}){return t.hasZ()?It:e}function Ti(t){return To(t)?So(t)||en(t)||Oo(t)||Ro(t)?br:t:wr(t)}function Ba(t,e=Pe()){return Yn(t,e)}function Za(t,e=Pe()){return Yn(t,e,!1)}function Yn(t,e,i=t.hasZ){const n=Ti(t.spatialReference),o=bo(n);if(o==null)return null;const r=(a,p)=>!(p.length<2)&&(q(a,p[0],p[1],i&&p[2]||0),!0);let s=0;for(const a of t.rings){const p=a.length;if(p<3)continue;const{positionsWorldCoords:l}=e;for(;l.length<p;)l.push(m());const d=Wa,u=q(Ka,0,0,0),y=1/p;for(let f=0;f<p;f++){if(!r(d,a[f])||!wt(d,t.spatialReference,l[f],n))return null;N(u,u,l[f],y)}const g=gn(l[0],l[1],u,hr());if(pn(ci(g))===0)continue;for(let f=0;f<p;f++)dr(g,u,l[f],l[f]);const v=Xa(l);for(let f=0;f<v.length;f+=3)s+=Er(l[v[f]],l[v[f+1]],l[v[f+2]])}return pi(s,o)}const Wa=m(),Ka=m();function Pe(){return{positionsWorldCoords:[]}}function Xa(t){return _r(Ja(t),[],2)}function Ja(t){const e=new Float64Array(2*t.length);for(let i=0;i<t.length;++i){const n=t[i],o=2*i;e[o]=n[0],e[o+1]=n[1]}return e}const Qa=t=>({geodesicArea(e){const{spatialReference:i}=e;return wi(i,es,n=>is(t,n),e)}});async function ts(){const t=await I(()=>import("./geometryEngine-C83waDS7-DKgu_PyR.js"),__vite__mapDeps([62,1,2,63,64,65]),import.meta.url);return Qa(t)}function es(t){return pi(Math.abs(ir([t],"square-meters")[0]),"square-meters")}function is(t,e){try{return pi(Math.abs(t.geodesicArea(e,"square-meters")),"square-meters")}catch{return null}}const ns=t=>({autoAreaByElevationMode(e,i,n=Pe()){return i==="on-the-ground"?t.geodesicArea(e)??Za(e,n):Ba(e,n)},autoArea2D(e,i=Pe()){return this.autoAreaByElevationMode(e,"on-the-ground",i)}});let Ke=null;async function pe(){return Ke||(Ke=ns(await ts())),Ke}var lt;function os(t){return rs(t,lt.Horizontal)}function rs(t,e){const{hasZ:i,spatialReference:n}=t,o=Ti(n);let r=0;const s=nn(o);if(s==null)return null;const a=e===lt.Direct?ls:Si;for(const p of t.paths){if(p.length<2)continue;const l=p.length-1;for(let d=0;d<l;++d){const u=p[d];Y[0]=u[0],Y[1]=u[1],Y[2]=i?u[2]:0;const y=p[d+1];B[0]=y[0],B[1]=y[1],B[2]=i?y[2]:0;const g=a(Y,B,n);if(g==null)return null;r+=g.value}}return _t(r,s)}function as(t,e){const{spatialReference:i}=t;return te(i,e.spatialReference)?(Y[0]=t.x,Y[1]=t.y,Y[2]=t.hasZ?t.z:0,B[0]=e.x,B[1]=e.y,B[2]=e.hasZ?e.z:0,Si(Y,B,i)):null}function pl(t,e){const{spatialReference:i}=t;return te(i,e.spatialReference)?(Y[0]=t.x,Y[1]=t.y,Y[2]=t.hasZ?t.z:0,B[0]=e.x,B[1]=e.y,B[2]=e.hasZ?e.z:0,ps(Y,B,i)):null}function cl(t){return t!=null?ss(t.hasZ?t.z:0,t.spatialReference):null}function ss(t,e){const i=_o(e);return i!=null?_t(t??0,i):null}function ls(t,e,i){const n=Oi(t,e,i,lt.Direct);return n!=null?_t(n.direct,n.unit):null}function Si(t,e,i){const n=Oi(t,e,i,lt.Horizontal);return n!=null?_t(n.horizontal,n.unit):null}function ps(t,e,i){const n=Oi(t,e,i,lt.Vertical);return n!=null?_t(n.verticalSigned,n.unit):null}function Oi(t,e,i,n){const o=Ti(i),r=nn(o);if(r==null)return null;const s=e[2]-t[2];if(n===lt.Vertical)return{verticalSigned:s,unit:r};if(!wt(t,i,Xe,o)||!wt(e,i,ce,o))return null;if(n===lt.Direct)return{direct:Kt(ce,Xe),unit:r};if(q(he,t[0],t[1],e[2]),!wt(he,i,he,o))return null;const a=Kt(he,ce);return n===lt.Horizontal?{horizontal:a,unit:r}:{direct:Kt(ce,Xe),horizontal:a,vertical:Math.abs(s),unit:r}}(function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"})(lt||(lt={}));const Y=m(),B=m(),Xe=m(),ce=m(),he=m();function cs(t){return{autoLength2D:e=>t.geodesicLength(e)??os(e),autoDistanceBetweenPoints2D:(e,i)=>t.geodesicDistanceBetweenPoints(e,i)??as(e,i),autoDistance2D:(e,i,n)=>(jt[0]=e[0],jt[1]=e[1],jt[2]=e.length===3?e[2]:0,Yt[0]=i[0],Yt[1]=i[1],Yt[2]=i.length===3?i[2]:0,t.geodesicDistance(jt,Yt,n)??Si(jt,Yt,n))}}async function Gt(){return cs(await jn())}const jt=m(),Yt=m();function hs(t){return(t==null?void 0:t.type)==="graphic"}function ds(t){return t.find(hs)??null}let D=class extends ai.EventedAccessor{constructor(t){super(t),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:Kn(this.activeComponent)}return null}addToHistory(t){this.history.redo=[],this.history.undo.push(t)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){var t;(t=this.activeComponent)==null||t.reset()}refreshComponent(){const t=this.activeComponent;t&&(t.type!=="box"&&t.type!=="reshape"&&t.type!=="graphic-mover"||t.refresh())}set undo(t){this._set("undo",()=>{this.canUndo()&&t()})}set redo(t){this._set("redo",()=>{this.canRedo()&&t()})}};c([h()],D.prototype,"activeComponent",void 0),c([h()],D.prototype,"cancelled",void 0),c([h()],D.prototype,"history",void 0),c([h()],D.prototype,"tool",null),c([h()],D.prototype,"type",void 0),c([h()],D.prototype,"canUndo",null),c([h()],D.prototype,"canRedo",null),c([h()],D.prototype,"onEnd",void 0),c([h()],D.prototype,"undo",null),c([h()],D.prototype,"redo",null),c([h()],D.prototype,"toggleTool",void 0),c([h()],D.prototype,"addToSelection",void 0),c([h()],D.prototype,"removeFromSelection",void 0),D=c([H("esri.widgets.Sketch.support.OperationHandle")],D);let ve=class extends D{};c([h()],ve.prototype,"activeComponent",void 0),ve=c([H("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],ve);let vt=class extends D{};c([h()],vt.prototype,"activeComponent",void 0),vt=c([H("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],vt);function us(t,e){return e==="freehandPolygon"||e==="freehandPolyline"?"freehand":t??(e==="rectangle"||e==="circle"?"hybrid":"click")}function ys(t){switch(t){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return t}}var Wi;(function(t){t[t.ForceCollapse=-1]="ForceCollapse",t[t.Low=0]="Low",t[t.Medium=10]="Medium",t[t.High=100]="High",t[t.Max=1e3]="Max"})(Wi||(Wi={}));const Ki={defaultZ:0},Bt={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:Vo},tool:"transform"};let E=class extends ai.EventedAccessor{constructor(t){var e;super(t),this._defaultSnappingManager=null,this._updatingHandles=new Mo,this._internalGraphicsLayer=new Do({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new Ri({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Xn({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Jn({color:[130,130,130,1],width:2}),this.meshSymbol=new Qn({symbolLayers:new Lt([new to])}),this.updateGraphics=new Lt,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new Ri({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new Pt,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=Ki,this.defaultUpdateOptions=Bt,this.snappingOptions=((e=t==null?void 0:t.snappingManager)==null?void 0:e.options)??(t==null?void 0:t.snappingOptions)??new L}initialize(){this.addHandles([Mi(()=>{var t,e;return(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.layers},"change",t=>{t.removed.includes(this.layer)&&this.cancel()}),Mi(()=>{var t;return(t=this.layer)==null?void 0:t.graphics},"change",t=>{if(this._operationHandle!=null)for(const e of t.removed)this.updateGraphics.includes(e)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(e):this._operationHandle.cancel())}),At(()=>{var t;return((t=this.layer)==null?void 0:t.elevationInfo)??null},t=>{t!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=t)},Wt),At(()=>this.view,t=>{this._defaultSnappingManager=re(this._defaultSnappingManager),t&&(this.snappingManager||(this._defaultSnappingManager=new Q({view:t,options:this.snappingOptions})),t.type==="2d"?I(()=>import("./editingTools-7dqMzBcg-CAY1_GRS.js"),__vite__mapDeps([66,1,2,67,8,9,10,68,69,70,11,4,71,32,72,73,23,41,74,40,42,36,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,6,7,61,88,89,90,91,12,13,5,25,29,30,31,33,34,35,37,38,39,43,44,45,46,47,48,49,50,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120]),import.meta.url):t.type==="3d"&&(I(()=>import("./ImageMaterial.glsl-4GA395N2-BIovsip-.js"),__vite__mapDeps([121,1,2,119,36,9,37,11,5,6,7,72,32,71,4,73,23,41,74,40,42,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,61,88,89,90,91,12,13,25,8,10,29,30,31,33,34,35,38,39,43,44,45,46,47,48,49,50,122,123,124,125,109,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,114,142,143,144,111,145,146,147,148,149,150,151,152,153,154,112,113,155,156,69,70,157,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,158,159,160,115,116,117,68,161,162,163,164,118]),import.meta.url).then(e=>e.e),I(()=>import("./LineCallout.glsl-0Cou_Qxw-CvMIvgk5.js"),__vite__mapDeps([165,1,2,166,167,13,30,29,5,6,7,125,23,9,41,8,10,11,36,37,123,43,44,40,39,42,38,124,109,126,74,50,127,128,129,130,131,132,133,134,135,136,48,49,137,138,139,140,141,114,142,143,144,76,77,111,145,146,147,108,12,16,17,168,33,34,35,162,169,153,112,113,170,171,172,173,174,175,176,22,72,177,158,178,179,180,181,182,183,32,184,185,186,187,188,189,26,27,28,61,190]),import.meta.url).then(e=>e.G)))},Wt),At(()=>{var t;return(t=this.view)==null?void 0:t.spatialReference},(t,e)=>{t&&e&&!t.equals(e)&&this.cancel()})]),Hr(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=re(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){var t;return((t=this._operationHandle)==null?void 0:t.tool)??null}get activeCreateToolDrawMode(){var t;return((t=this._operationHandle)==null?void 0:t.type)==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:t,destroyed:e}=this,i=!e&&t&&"tooltip"in t?t.tooltip:null;return i!=null&&i.visible?i:null}get activeComponent(){var t;return((t=this._operationHandle)==null?void 0:t.activeComponent)??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...Ki,...t})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(t){this._set("defaultUpdateOptions",{...Bt,...t,reshapeOptions:{...Bt.reshapeOptions,...t==null?void 0:t.reshapeOptions},highlightOptions:{...Bt.highlightOptions,...t==null?void 0:t.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(t){this.sketchOptions.labels=t}get snappingOptions(){var t;return((t=this.snappingManager)==null?void 0:t.options)??this._get("snappingOptions")}set snappingOptions(t){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=t),this._set("snappingOptions",t)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(t){if(t)this._isOverridden("snappingManager")||(this._defaultSnappingManager=re(this._defaultSnappingManager)),this._override("snappingManager",t);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new Q({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){var i;const t=!(!((i=this.view)!=null&&i.ready)||!this.layer),e=this._operationHandle;return t&&e?"active":t?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(t){this.sketchOptions.tooltips=t}get valueOptions(){return this.sketchOptions.values}set valueOptions(t){this.sketchOptions.values=t}get view(){return this._get("view")}set view(t){const e=this._get("view");if(e){const{container:n,map:o}=e;n&&(e.cursor=null),o==null||o.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),t&&this.addHandles(eo(()=>t.ready,n=>{this.removeHandles(this._viewHandlesKey),n&&this.addHandles(this._generateViewHandles(t),this._viewHandlesKey)},Wt),i),this._set("view",t)}cancel(){this._moduleLoaderAbortController=$e(this._moduleLoaderAbortController),this._viewReadyAbortController=$e(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:t,updateGraphics:e}=this;if(t==="active"&&e.length){const{activeTool:i,layer:n}=this,o=e.toArray();n.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:i})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const t=this.updateGraphics.map(e=>e.clone()).toArray();return this.layer.addMany(t),this.emit("duplicate",{graphics:t,type:"duplicate"}),t}return[]}async create(t,e){this.cancel(),await this._waitViewReady();const{view:i,layer:n}=this;if(!i||this.state==="disabled")throw n||this._logMissingLayer(),Gi();if(i.activeTool!=null&&(i.activeTool=null),!t)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");Ui(i,this._internalGraphicsLayer);const o=await this._updatingHandles.addPromise(this._setupCreateOperation(t,e));if(o==null||this.destroyed)return void i.map.remove(this._internalGraphicsLayer);const r=()=>{var s;if(o===this._operationHandle){const a=this.createGraphic,p=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),(s=this.view)!=null&&s.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||a==null||n.add(a),this._sketchContinuationFlag=!1,this.emit("create",{graphic:a,state:p?"cancel":"complete",tool:t,toolEventInfo:null,type:"create"}),p||this._sketchContinuationFlag)return;const{creationMode:l}=this;if(l==="continuous"){if(e!=null&&e.geometryToPlace)return;this._updatingHandles.addPromise(Li(this.create(t,e)))}else l==="update"&&a&&this._updatingHandles.addPromise(Li(this.update([a])))}};o.on("complete",r),this._operationHandle=o,i.ready&&i.focus()}async place(t,e){return this.create("mesh",{mode:"click",hasZ:t.hasZ,geometryToPlace:t,...e})}async update(t,e){this.cancel(),await this._waitViewReady();const{layer:i,view:n,state:o}=this;if(!n||o==="disabled")throw i||this._logMissingLayer(),Gi();n.activeTool!=null&&(n.activeTool=null);const r=Array.isArray(t)?t:[t];if(t==null||!(r!=null&&r.length))return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some(a=>a.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):a.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const s=await this._updatingHandles.addPromise(this._setupUpdateOperation(r,e));this.destroyed||s==null||P(s)||(Ui(n,this._internalGraphicsLayer),this._setUpdateOperationHandle(s,e),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:s.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(t){const e=this.view;if(e){t=Array.isArray(t)?t:[t];for(const i of t)i.geometry==null||i.geometry.type==="mesh"||te(i.geometry.spatialReference,e.spatialReference)||(Po(i.geometry.spatialReference,e.spatialReference)||Ao()||await Lo(),i.geometry=Je(i.geometry,e.spatialReference))}else this._logMissingView()}undo(){var t;this.canUndo()&&((t=this._operationHandle)==null||t.undo())}redo(){var t;this.canRedo()&&((t=this._operationHandle)==null||t.redo())}canUndo(){var t;return!!((t=this._operationHandle)!=null&&t.canUndo())}canRedo(){var t;return!!((t=this._operationHandle)!=null&&t.canRedo())}toggleUpdateTool(){var t;(t=this._operationHandle)==null||t.toggleTool()}async _getFirstHit(t){const e=this.view;if(!e)return this._logMissingView(),null;if(e.type==="2d"){const o=[];e.map.allLayers.forEach(s=>{s.type!=="vector-tile"&&s.type!=="imagery"||o.push(s)});const r=await e.hitTest(t,{exclude:o});return ds(r.results)}const i=[e.map.ground];e.map.allLayers.forEach(o=>{io(o.type)&&i.push(o)});const n=await e.hitTest(t,{exclude:i});if(n.results.length>0){const o=n.results[0];if(o!=null&&o.type==="graphic"&&o.graphic&&(!n.ground.mapPoint||e.map.ground.opacity<1||n.ground.distance-(o.distance??0)>-Math.min(3*n.ground.distance,e.viewingMode==="global"?no(e.renderCoordsHelper.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return o}return null}_generateViewHandles(t){return[t.on("immediate-click",async e=>{var n;const i=this.state==="active"&&((n=this._operationHandle)==null?void 0:n.type)==="create";this.state!=="disabled"&&!i&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},A.WIDGET)]}async _handleImmediateClick(t){var n;const e=await t.defer(()=>this._getFirstHit(Ci(t)));let i=null;if(e!=null){const o=e.graphic;this.updateGraphics.includes(o)||o.layer===this.layer?(t.stopPropagation(),i=o):((n=this.view)==null?void 0:n.type)!=="2d"||this._isComponentGraphic(o)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();i==null||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(t,e){const i=this.view;if(!i)return this._logMissingView(),null;const n={hasZ:i.type==="3d",...this.defaultCreateOptions,...e},o=await this._setupDrawGraphicTool(t,i,n);return o==null?null:(i.tools.add(o),i.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(t,e,i){var f;if(t==="multipoint"&&e.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!e)return this._logMissingView(),null;const{cursor:n,defaultZ:o,hasZ:r,geometryToPlace:s,graphicProperties:a,mode:p,preserveAspectRatio:l}=i,d=us(p,t),u=ys(t),y=(f=i==null?void 0:i.optionsPerTool)!=null&&f.has(t)?i.optionsPerTool.get(t):{},g=(y==null?void 0:y.preserveAspectRatio)??l??t!=="rectangle",v={centered:t!=="rectangle"&&!(t==="circle"&&!g),cursor:n,defaultZ:o,forceUniformSize:g,graphicProperties:{...a,attributes:{...a==null?void 0:a.attributes}},geometryToPlace:s,geometryType:u,mode:d,graphicSymbol:this._getGraphicSymbolFromTool(t),hasZ:r,snappingManager:this.snappingManager,snapToScene:!1,view:e,...y};return e.type==="2d"?this._makeDrawGraphicTool2D(v):this._makeDrawGraphicTool3D(v)}async _makeDrawGraphicTool2D(t){const[e,i,n]=await Promise.all([this._requireModule(I(()=>import("./editingTools-7dqMzBcg-CAY1_GRS.js"),__vite__mapDeps([66,1,2,67,8,9,10,68,69,70,11,4,71,32,72,73,23,41,74,40,42,36,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,6,7,61,88,89,90,91,12,13,5,25,29,30,31,33,34,35,37,38,39,43,44,45,46,47,48,49,50,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120]),import.meta.url)),pe(),Gt()]);return P(e)||this.destroyed?null:new e.module.DrawGraphicTool2D({...t,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:fs(t.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:n})}async _makeDrawGraphicTool3D(t){const[e,i,n]=await Promise.all([this._requireModule(I(()=>import("./ImageMaterial.glsl-4GA395N2-BIovsip-.js"),__vite__mapDeps([121,1,2,119,36,9,37,11,5,6,7,72,32,71,4,73,23,41,74,40,42,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,61,88,89,90,91,12,13,25,8,10,29,30,31,33,34,35,38,39,43,44,45,46,47,48,49,50,122,123,124,125,109,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,114,142,143,144,111,145,146,147,148,149,150,151,152,153,154,112,113,155,156,69,70,157,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,158,159,160,115,116,117,68,161,162,163,164,118]),import.meta.url).then(r=>r.e)),pe(),Gt()]);if(P(e)||this.destroyed)return null;const{elevationInfo:o}=this.layer;return new e.module.DrawGraphicTool3D({...t,elevationInfo:o,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:n})}_setupCreateOperationHandle(t){const e=this.view;if(!e)return this._logMissingView(),null;let i=null;const n=t.forceUniformSize,o=t.centered,r=[e.on("key-down",a=>{if(a.key===G.pan)a.stopPropagation(),a.repeat||(t.enabled=!1);else if(a.key===G.complete)a.stopPropagation(),t.completeCreateOperation();else if(a.key!==G.vertexAdd||a.repeat)a.key===G.undo?(a.stopPropagation(),s.undo()):a.key===G.redo?(a.stopPropagation(),s.redo()):a.key!==G.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"||a.repeat?a.key===G.center&&(a.repeat||(t.centered=!o,a.stopPropagation())):(t.forceUniformSize=!n,a.stopPropagation());else{const p=t.drawOperation.geometryType;p!=="polyline"&&p!=="polygon"&&p!=="multipoint"||(a.stopPropagation(),t.drawOperation.commitStagedVertex())}},A.WIDGET),e.on("key-up",a=>{a.key===G.pan?t.enabled=!0:a.key!==G.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"?a.key===G.center&&(t.centered=o,a.stopPropagation()):(t.forceUniformSize=n,a.stopPropagation())},A.WIDGET),t.on("vertex-add",a=>{switch(i=i==null?"start":"active",a.operation){case"apply":this.emit("create",{graphic:t.graphic,state:i,tool:this.activeTool,toolEventInfo:a,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("cursor-update",a=>{t.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:a.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),t.on("vertex-remove",a=>{switch(a.operation){case"apply":this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:a,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("complete",a=>{this._set("createGraphic",a.graphic),i="complete",a.aborted?s&&s.cancel():s&&s.complete()}),At(()=>this._getGraphicSymbolFromTool(t.geometryType),a=>{t.graphicSymbol=a})],s=new ve({activeComponent:t,tool:t.geometryType,type:"create",onEnd:()=>{var a;it(r),(a=e.tools)==null||a.remove(t)},undo:()=>{t.canUndo&&t.undo()},redo:()=>{t.canRedo&&t.redo()},canUndo:()=>t.canUndo,canRedo:()=>t.canRedo});return s}_getGraphicSymbolFromTool(t){switch(t){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(t,e){var s;const{layer:i,view:n}=this;if(!n)return this._logMissingView(),null;const o={...this.defaultUpdateOptions,...e,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...e==null?void 0:e.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...e==null?void 0:e.highlightOptions}};let r=o.tool??Bt.tool;for(const a of t)i.remove(a),i.add(a);if(n.type==="3d"){if(t.length===0)return null;switch(r){case"move":return this._setupMove3DOperation(t,o,n,r);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(t[0],o,n);case"transform":return this._setupGraphicTransform3DOperation(t,o,n)}}switch(r){case"move":return this._setupMove2DOperation(t,o,n);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(t,r,o,n);case"transform":if(t.length===1){const a=(s=t[0].geometry)==null?void 0:s.type;a!=="point"&&a!=="multipoint"||(r="reshape")}return this._setupTransformOrReshape2DOperation(t,r,o,n)}}async _setupMove3DOperation(t,e,i,n,o=!1){const[r,s]=await Promise.all([this._requireModule(I(()=>import("./ImageMaterial.glsl-4GA395N2-BIovsip-.js"),__vite__mapDeps([121,1,2,119,36,9,37,11,5,6,7,72,32,71,4,73,23,41,74,40,42,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,61,88,89,90,91,12,13,25,8,10,29,30,31,33,34,35,38,39,43,44,45,46,47,48,49,50,122,123,124,125,109,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,114,142,143,144,111,145,146,147,148,149,150,151,152,153,154,112,113,155,156,69,70,157,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,158,159,160,115,116,117,68,161,162,163,164,118]),import.meta.url).then(v=>v.e)),Gt()]);if(P(r))return r;const{ManipulatedObject3DGraphic:a,MoveTool3D:p}=r.module,l=new Map,d=()=>{l.forEach(v=>v.destroy()),l.clear()};for(const v of t){const f=new a({view:i,graphic:v}),_=Pr(f);if(_!==b.SUPPORTED)return d(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Hi(_)}).`),null;l.set(v,f)}const u=new p({view:i,enableZ:e.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:s});i.tools.add(u),u.objects.addMany(Array.from(l.values())),o||this.updateGraphics.addMany(t);const y=[],g=new vt({activeComponent:u,tool:n,type:"update",onEnd:()=>{it(y),ye(i,u),d()},undo:()=>{Ji(this.view,u),de(g,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{ue(g,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:v=>{this.updateGraphics.push(v);const f=new a({view:i,graphic:v});l.set(v,f),u.objects.push(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[v],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:v=>{const f=this.updateGraphics.indexOf(v);if(g.history.undo.forEach(O=>O.updates.splice(f,1)),g.history.redo.forEach(O=>O.updates.splice(f,1)),this.updateGraphics.remove(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[v],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void g.complete();const _=l.get(v);_&&(u.objects.remove(_),_.destroy(),l.delete(v))},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1||n!=="transform")return;const v=this.updateGraphics.at(0),f=await this._setupReshape3DOperation(v,e,i,!0);f&&!P(f)&&(g.onEnd(),g.destroy(),this._setUpdateOperationHandle(f,e))}});return y.push(...this._getHandlesForComponent(g,e),i.on("immediate-click",v=>this._getCommonUpdateOperationClickHandlers(g,v,e),A.WIDGET),i.on("key-down",v=>{this._getCommonUpdateOperationKeyDownHandlers(g,v)},A.WIDGET)),g}_setupGraphicTransform3DOperation(t,e,i,n=!1){if(t.length===1&&Cr(t[0])===b.SUPPORTED){const o=t[0],r=o.geometry;if(r!=null&&(r.type==="point"||r.type==="mesh"))return this._setupPointTransform3DOperation(o,e,i);if(r!=null&&(r.type==="polygon"||r.type==="polyline"))return this._setupPolyTransform3DOperation(o,e,i,n)}return this._setupMove3DOperation(t,e,i,"transform",n)}async _setupPointTransform3DOperation(t,e,i){const n="transform",{enableRotation:o,enableScaling:r,enableZ:s}=e,a=await this._requireModule(I(()=>import("./ImageMaterial.glsl-4GA395N2-BIovsip-.js"),__vite__mapDeps([121,1,2,119,36,9,37,11,5,6,7,72,32,71,4,73,23,41,74,40,42,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,61,88,89,90,91,12,13,25,8,10,29,30,31,33,34,35,38,39,43,44,45,46,47,48,49,50,122,123,124,125,109,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,114,142,143,144,111,145,146,147,148,149,150,151,152,153,154,112,113,155,156,69,70,157,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,158,159,160,115,116,117,68,161,162,163,164,118]),import.meta.url).then(v=>v.e));if(P(a))return a;const{TransformTool3D:p,ManipulatedObject3DGraphic:l}=a.module,d=new l({graphic:t,view:i}),u=new p({object:d,view:i,enableRotation:o,enableScaling:r,enableZ:s,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(u),this.updateGraphics.add(t);const y=[],g=new vt({activeComponent:u,tool:n,type:"update",onEnd:()=>{it(y),ye(i,u),d.destroy()},undo:()=>{Ji(this.view,u),de(g,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{ue(g,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async v=>{this.updateGraphics.add(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[v],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();const f=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);P(f)||this._setUpdateOperationHandle(f,e)},removeFromSelection:v=>{this.updateGraphics.remove(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[v],type:"selection-change"},type:"update"}),g.complete()},toggleTool:()=>{}});return y.push(...this._getHandlesForComponent(g,e),i.on("immediate-click",v=>this._getCommonUpdateOperationClickHandlers(g,v,e),A.WIDGET),i.on("key-down",v=>{this._getCommonUpdateOperationKeyDownHandlers(g,v)},A.WIDGET)),g}async _setupPolyTransform3DOperation(t,e,i,n=!1){var Ft,Rt;const o="transform",{enableRotation:r,enableScaling:s,enableZ:a,preserveAspectRatio:p}=e,[l,d]=await Promise.all([this._requireModule(I(()=>import("./ImageMaterial.glsl-4GA395N2-BIovsip-.js"),__vite__mapDeps([121,1,2,119,36,9,37,11,5,6,7,72,32,71,4,73,23,41,74,40,42,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,61,88,89,90,91,12,13,25,8,10,29,30,31,33,34,35,38,39,43,44,45,46,47,48,49,50,122,123,124,125,109,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,114,142,143,144,111,145,146,147,148,149,150,151,152,153,154,112,113,155,156,69,70,157,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,158,159,160,115,116,117,68,161,162,163,164,118]),import.meta.url).then(w=>w.e)),Gt()]);if(P(l))return l;const{ManipulatedObject3DGraphic:u,ExtentTransformTool:y}=l.module,g=(Rt=(Ft=this.view)==null?void 0:Ft.inputManager)==null?void 0:Rt.isModifierKeyDown(G.constraint),v=new u({view:i,graphic:t}),f=new y({object:v,view:i,enableRotation:r,enableScaling:s,enableZ:a,preserveAspectRatio:!!p!=!!g,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:d});i.tools.add(f),n||this.updateGraphics.add(t);const _=[],O=new vt({activeComponent:f,tool:o,type:"update",onEnd:()=>{it(_),ye(i,f),v.destroy()},canUndo:()=>!f.destroyed&&f.canUndo,undo:()=>{f.destroyed||(f.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!f.destroyed&&f.canRedo,redo:()=>{f.destroyed||(f.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async w=>{this.updateGraphics.add(w),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[w],removed:[],type:"selection-change"},type:"update"}),O.onEnd(),O.destroy();const Mt=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);P(Mt)||this._setUpdateOperationHandle(Mt,e)},removeFromSelection:w=>{this.updateGraphics.remove(w),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[w],type:"selection-change"},type:"update"}),O.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1)return;const w=await this._setupReshape3DOperation(t,e,i,!0);w&&!P(w)&&(O.onEnd(),O.destroy(),this._setUpdateOperationHandle(w,e))}});return _.push(...this._getHandlesForComponent(O,e),i.on("immediate-click",w=>this._getCommonUpdateOperationClickHandlers(O,w,e),A.WIDGET),i.on("key-down",w=>this._getCommonUpdateOperationKeyDownHandlers(O,w),A.WIDGET),i.on("key-down",w=>{w.key!==G.constraint||w.repeat||(f.preserveAspectRatio=!f.preserveAspectRatio,w.stopPropagation())},A.WIDGET),i.on("key-up",w=>{w.key===G.constraint&&(f.preserveAspectRatio=!f.preserveAspectRatio,w.stopPropagation())},A.WIDGET)),O}async _setupMove2DOperation(t,e,i){const n="move";this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const o=await this._getGraphicMover(t,e,i);if(P(o))return o;const r=new vt({activeComponent:o,tool:n,type:"update",onEnd:()=>{var l;this._displayDefaultCursor(),it(p),it(a),o.destroy(),(l=this._internalGraphicsLayer)==null||l.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const l=this.updateGraphics.toArray();de(r,l),r.refreshComponent(),this._emitUndoEvent({graphics:l,tool:n})},redo:()=>{const l=this.updateGraphics.toArray();ue(r,l),r.refreshComponent(),this._emitRedoEvent({graphics:l,tool:n})},addToSelection:async l=>{await this._updatingHandles.addPromise(this._updateSpatialReference(l)),this.updateGraphics.push(l),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:l=>{const d=this.updateGraphics.indexOf(l);r.history.undo.forEach(y=>y.updates.splice(d,1)),r.history.redo.forEach(y=>y.updates.splice(d,1)),this.updateGraphics.remove(l);const u=this.updateGraphics.toArray();this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics=u:r.complete()}});let s=!1;const a=[i.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(r,l,e),A.WIDGET),i.on("key-down",l=>{this._getCommonUpdateOperationKeyDownHandlers(r,l),l.key!==G.constraint||l.repeat||(s=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},A.WIDGET),i.on("key-up",l=>{l.key===G.constraint&&s&&(s=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},A.WIDGET)],p=this._getHandlesForComponent(r,e);return r}async _setupReshape3DOperation(t,e,i,n=!1){const o="reshape",[r,s,a]=await Promise.all([this._requireModule(I(()=>import("./ImageMaterial.glsl-4GA395N2-BIovsip-.js"),__vite__mapDeps([121,1,2,119,36,9,37,11,5,6,7,72,32,71,4,73,23,41,74,40,42,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,61,88,89,90,91,12,13,25,8,10,29,30,31,33,34,35,38,39,43,44,45,46,47,48,49,50,122,123,124,125,109,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,114,142,143,144,111,145,146,147,148,149,150,151,152,153,154,112,113,155,156,69,70,157,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,158,159,160,115,116,117,68,161,162,163,164,118]),import.meta.url).then(_=>_.e)),pe(),Gt()]);if(P(r))return r;const{ManipulatedObject3DGraphic:p,ReshapeTool3D:l}=r.module,d=new p({view:i,graphic:t}),u=Ar(d);if(u!==b.SUPPORTED)return d.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Hi(u)}).`),null;const y=e.reshapeOptions,g=new l({view:i,object:d,enableZVertex:e.enableZ&&(y==null?void 0:y.vertexOperation)==="move",enableZShape:e.enableZ&&(y==null?void 0:y.shapeOperation)==="move",enableMoveObject:(y==null?void 0:y.shapeOperation)==="move"||(y==null?void 0:y.shapeOperation)==="move-xy",enableMidpoints:(y==null?void 0:y.edgeOperation)==="split",enableEdgeOffset:(y==null?void 0:y.edgeOperation)==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:s,automaticLengthMeasurementUtils:a});i.tools.add(g),n||this.updateGraphics.add(d.graphic);const v=[],f=new vt({activeComponent:g,tool:o,type:"update",onEnd:()=>{it(v),ye(i,g),d.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async _=>{this.updateGraphics.add(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[_],removed:[],type:"selection-change"},type:"update"}),f.onEnd(),f.destroy();const O=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);P(O)||this._setUpdateOperationHandle(O,e)},removeFromSelection:_=>{this.updateGraphics.remove(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[_],type:"selection-change"},type:"update"}),f.complete()},toggleTool:async()=>{if(e.toggleToolOnClick===!1)return;f.onEnd(),f.destroy();const _=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),e,i,!0);P(_)||this._setUpdateOperationHandle(_,e)}});return v.push(...this._getHandlesForComponent(f,e),i.on("immediate-click",_=>this._getCommonUpdateOperationClickHandlers(f,_,e),A.WIDGET),i.on("key-down",_=>{this._getCommonUpdateOperationKeyDownHandlers(f,_)},A.WIDGET)),f}async _setupTransformOrReshape2DOperation(t,e,i,n){this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const o=e==="transform"?await this._getBox(t,i,n):await this._getReshape(t,i,n);if(P(o))return o;const r=new vt({activeComponent:o,type:"update",onEnd:()=>{it(a),it(s),r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{de(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{ue(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async p=>{let l=r.activeComponent;if((l==null?void 0:l.type)==="reshape"){const d=[...this.updateGraphics,p];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();const u=await this._setupTransformOrReshape2DOperation(d,"transform",i,n);if(P(u))return;this._setUpdateOperationHandle(u,i)}else this.updateGraphics.add(p),l.graphics=this.updateGraphics.toArray(),l.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async p=>{const l=this.updateGraphics.indexOf(p);r.history.undo.forEach(u=>u.updates.splice(l,1)),r.history.redo.forEach(u=>u.updates.splice(l,1)),this.updateGraphics.remove(p);const d=this.updateGraphics.toArray();if(d.length===0)r.complete();else{const u=d[0].geometry;d.length!==1||u==null||u.type!=="point"&&u.type!=="multipoint"?r.activeComponent.graphics=d:r.toggleTool()}this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"})},toggleTool:async()=>{var u;if(this.updateGraphics.length>1)return;const p=this.updateGraphics.at(0),l=p.geometry;if(l!=null&&(r.tool==="reshape"&&(l.type==="point"||l.type==="multipoint")||r.tool==="transform"&&l.type==="extent"))return;let d=null;r.tool==="transform"?d=await this._getReshape([p],i,n):r.tool==="reshape"&&(d=await this._getBox([p],i,n)),P(d)||((u=r.activeComponent)==null||u.destroy(),r.activeComponent=d,r.activeComponent&&(it(a),a=this._getHandlesForComponent(r,i)))}}),s=[n.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(r,p,i),A.WIDGET),n.on("key-down",p=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,p),p.key===G.constraint&&!p.repeat&&r){const l=r.activeComponent;l&&l.type==="box"&&(l.preserveAspectRatio=!l.preserveAspectRatio)}},A.WIDGET),n.on("key-up",p=>{if(p.key===G.constraint&&r){const l=r.activeComponent;l&&l.type==="box"&&(l.preserveAspectRatio=!l.preserveAspectRatio)}},A.WIDGET)];let a=this._getHandlesForComponent(r,i);return r}async _getGraphicMover(t,e,i){const{enableMoveAllGraphics:n,highlightOptions:o}=e,r=await this._requireModule(I(()=>import("./GraphicMover-BruWidUQ-BTLPaj29.js"),__vite__mapDeps([191,1,2,14,15,16,17,18,19,20,21,22,23,9,24,6,7,120,26,27,28,61,118,8,11,13,30,5,88,12,25,3,4,10,29,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]),import.meta.url).then(s=>s.G));return P(r)?r:new r.module.default({enableMoveAllGraphics:n,highlightName:o==null?void 0:o.name,highlightsEnabled:!!(o!=null&&o.enabled),indicatorsEnabled:!1,graphics:t,view:i,callbacks:{onGraphicMoveStart:({dx:s,dy:a,graphic:p})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:a,mover:p,type:"move-start"},type:"update"})},onGraphicMove:({dx:s,dy:a,graphic:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:a,mover:p,type:"move"},type:"update"}),onGraphicMoveStop:({dx:s,dy:a,graphic:p})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:a,mover:p,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayMoveCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(t,e,i){var d,u;const{enableRotation:n,enableScaling:o,highlightOptions:r,preserveAspectRatio:s}=e,[a,p]=await Promise.all([this._requireModule(I(()=>import("./Box-C1MLNNLE-DGCtOQd2.js"),__vite__mapDeps([192,1,2,4,120,191,14,15,16,17,18,19,20,21,22,23,9,24,6,7,26,27,28,61,118,8,11,13,30,5,88,12,25,3,10,29,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,193,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,89,90,91,164,159]),import.meta.url)),Gt()]);if(P(a))return a;const l=(u=(d=this.view)==null?void 0:d.inputManager)==null?void 0:u.isModifierKeyDown(G.constraint);return new a.module.default({graphics:t,enableRotation:n,enableScaling:o,highlightName:r==null?void 0:r.name,highlightsEnabled:!!(r!=null&&r.enabled),preserveAspectRatio:!!s!=!!l,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:p,callbacks:{onMoveStart:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onMove:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onMoveStop:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onScaleStart:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onScale:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onScaleStop:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onRotateStart:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onRotate:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onRotateStop:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"})}})}async _getReshape(t,e,i){const{highlightOptions:n,reshapeOptions:o}=e,r=(o==null?void 0:o.edgeOperation)==="split",s=(o==null?void 0:o.shapeOperation)==="move",[a,p,l]=await Promise.all([this._requireModule(I(()=>import("./Reshape-Zlegijc9-C5lhAcEY.js"),__vite__mapDeps([194,1,2,32,14,15,16,17,18,19,20,21,22,23,9,24,6,7,109,67,8,10,68,69,70,11,4,71,72,73,41,74,40,42,36,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,61,88,89,90,91,12,13,5,25,29,30,31,33,34,35,37,38,39,43,44,45,46,47,48,49,50,195,160,115,116,117,161,162,119,196,105,197,198,175,157,120,191,118,159,193,110]),import.meta.url)),pe(),Gt()]);return P(a)?a:new a.module.default({enableMidpoints:r,enableMovement:s,graphic:t[0],highlightName:n==null?void 0:n.name,highlightsEnabled:!!(n!=null&&n.enabled),layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:p,automaticLengthMeasurementUtils:l,view:i,callbacks:{onReshapeStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshape:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshapeStop:({mover:d,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d,type:u},type:"update"}),onMoveStart:({dx:d,dy:u,mover:y,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:u,mover:y,type:g},type:"update"}),onMove:({dx:d,dy:u,mover:y,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:u,mover:y,type:g},type:"update"}),onMoveStop:({dx:d,dy:u,mover:y,type:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:u,mover:y,type:g},type:"update"}),onVertexAdd:({added:d,type:u,vertices:y})=>{const g=d.map(v=>Pi(v.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:g,vertices:y,type:u},type:"update"})},onVertexRemove:({removed:d,type:u,vertices:y})=>{const g=d.map(v=>Pi(v.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:g,vertices:y,type:u},type:"update"})}}})}_getHandlesForComponent(t,e){const i=t.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:n,viewEvent:o})=>{var r;(r=o.native)!=null&&r.shiftKey&&e.multipleSelectionEnabled&&(o.stopPropagation(),t.removeFromSelection(n))}),i.on("graphic-move-start",n=>t.addToHistory(Et(n.allGraphics)))];case"box":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(t,e,n)),i.on("move-start",n=>t.addToHistory(Et(n.graphics))),i.on("rotate-start",n=>t.addToHistory(Et(n.graphics))),i.on("scale-start",n=>t.addToHistory(Et(n.graphics)))];case"reshape":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(t,e,n)),i.on("move-start",n=>t.addToHistory(Et([n.mover]))),i.on("reshape-start",n=>t.addToHistory(Et([n.graphic]))),i.on("vertex-add",n=>t.addToHistory(Et([n.oldGraphic]))),i.on("vertex-remove",n=>t.addToHistory(Et([n.oldGraphic])))];case"move-3d":return[i.events.on("record-undo",({updates:n})=>{t.addToHistory({updates:n})}),i.events.on("move-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-start"},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n.dx,dy:n.dy,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move"},type:"update"})}),i.events.on("move-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-stop"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,e):t.toggleTool()})];case"transform-3d":return[i.events.on("record-undo",({updates:n})=>{t.addToHistory({updates:n})}),i.events.on("translate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-start"},type:"update"})}),i.events.on("translate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-stop"},type:"update"})}),i.events.on("rotate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-start"},type:"update"})}),i.events.on("rotate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-stop"},type:"update"})}),i.events.on("scale-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-start"},type:"update"})}),i.events.on("scale-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-stop"},type:"update"})}),i.events.on("translate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move"},type:"update"})}),i.events.on("rotate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate"},type:"update"})}),i.events.on("scale",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,e):t.toggleTool()})];case"reshape-3d":return[i.events.on("reshape",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("vertex-add",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("vertex-remove",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,e):t.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(t,e,i){var r;const{graphic:n,viewEvent:o}=i;return(r=o.native)!=null&&r.shiftKey&&n.layer===this.layer?(o.stopPropagation(),t.removeFromSelection(n)):e.toggleToolOnClick?(o.stopPropagation(),t.toggleTool()):void 0}_setUpdateOperationHandle(t,e){var o;this._operationHandle=t;const i=(o=this.view)==null?void 0:o.map;this._disablePopup(e);const n=()=>{if(t===this._operationHandle){const r=this.updateGraphics.toArray(),s=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(e),this.emit("update",{graphics:r,state:"complete",aborted:t.cancelled,tool:s,toolEventInfo:null,type:"update"})}};t.on("complete",n)}async _getCommonUpdateOperationClickHandlers(t,e,i){const n=Ci(e),o=await e.defer(()=>this._getFirstHit(n));if(o==null)return void t.complete();if(e.native.shiftKey&&this._toggleSelection([o.graphic],t,i))return void e.stopPropagation();this.updateGraphics.includes(o.graphic)?e.stopPropagation():t.complete()}_toggleSelection(t,e,i){const n=!!i.multipleSelectionEnabled;return t.some(o=>o!=null&&!(!n||o.layer!==this.layer)&&(this.updateGraphics.includes(o)?e.removeFromSelection(o):e.addToSelection(o),!0))}_getCommonUpdateOperationKeyDownHandlers(t,e){if(!t)return;const i=e.key;i===G.undo&&t.canUndo()?(e.stopPropagation(),t.undo()):i===G.redo&&t.canRedo()?(e.stopPropagation(),t.redo()):i===G.cancel?(e.stopPropagation(),t.cancel()):this.allowDeleteKey&&G.delete.includes(i)&&this._onDeleteKey(e)}_onDeleteKey(t){var n;if(!this._operationHandle||this._operationHandle.type!=="update")return;const e=this.activeComponent,i=this.updateGraphics.toArray();e!=null&&(e.type!=="reshape"||i.length===1&&((n=i[0].geometry)==null?void 0:n.type)==="point")&&(t.stopPropagation(),this.delete())}_removeDefaultLayer(){var t,e;this._internalGraphicsLayer&&((e=(t=this.view)==null?void 0:t.map)==null||e.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=re(this._internalGraphicsLayer))}_isComponentGraphic(t){var i;const{activeComponent:e}=this;return!(!t||e==null)&&(((i=t.attributes)==null?void 0:i.esriSketchTool)||e.type==="draw-2d"&&e.graphic===t||(e.type==="box"||e.type==="reshape")&&e.isUIGraphic(t))}_displayPointerCursor(){var t;(t=this.view)!=null&&t.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){var t;(t=this.view)!=null&&t.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayMoveCursor(){var t;(t=this.view)!=null&&t.container&&this.view.cursor!=="move"&&(this.view.cursor="move")}_displayDefaultCursor(){var t;(t=this.view)!=null&&t.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(t,e,i){Qi.getLogger(this).error(new oo(t,e,i))}async _requireModule(t){const e=new AbortController;this._moduleLoaderAbortController=e;const i=await t;return this._moduleLoaderAbortController!==e||e.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(t){this.emit("undo",{...t,type:"undo"})}_emitRedoEvent(t){this.emit("redo",{...t,type:"redo"})}_emitDeleteEvent(t){this.emit("delete",{...t,type:"delete"})}get test(){}wait(){return Ai(()=>!this.updating)}_disablePopupEnabled(t){var e;return((e=this.view)==null?void 0:e.type)!=="3d"||this.updateOnGraphicClick||((t==null?void 0:t.toggleToolOnClick)??!1)}_disablePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const t=this.view;t?($e(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await ro(Ai(()=>t==null?void 0:t.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",Xi("view"))}_logMissingLayer(){this._logError(gs,Xi("layer"))}};c([h()],E.prototype,"_defaultSnappingManager",void 0),c([h()],E.prototype,"updating",null),c([h({readOnly:!0})],E.prototype,"_updatingHandles",void 0),c([h()],E.prototype,"_operationHandle",void 0),c([h({readOnly:!0})],E.prototype,"activeTool",null),c([h({readOnly:!0})],E.prototype,"activeCreateToolDrawMode",null),c([h()],E.prototype,"activeTooltip",null),c([h({types:zt})],E.prototype,"activeFillSymbol",void 0),c([h()],E.prototype,"activeLineSymbol",void 0),c([h()],E.prototype,"activeVertexSymbol",void 0),c([h()],E.prototype,"allowDeleteKey",void 0),c([h({readOnly:!0})],E.prototype,"createGraphic",null),c([h()],E.prototype,"defaultCreateOptions",null),c([h()],E.prototype,"defaultUpdateOptions",null),c([h({type:Nt,nonNullable:!0})],E.prototype,"labelOptions",null),c([h()],E.prototype,"layer",void 0),c([h({types:zt})],E.prototype,"pointSymbol",void 0),c([h({types:zt})],E.prototype,"polygonSymbol",void 0),c([h({types:zt})],E.prototype,"polylineSymbol",void 0),c([h()],E.prototype,"meshSymbol",void 0),c([h({type:L,nonNullable:!0})],E.prototype,"snappingOptions",null),c([h()],E.prototype,"snappingManager",null),c([h({readOnly:!0})],E.prototype,"state",null),c([h({type:x,nonNullable:!0})],E.prototype,"tooltipOptions",null),c([h({readOnly:!0})],E.prototype,"updateGraphics",void 0),c([h()],E.prototype,"updateOnGraphicClick",void 0),c([h()],E.prototype,"creationMode",void 0),c([h({type:at,nonNullable:!0})],E.prototype,"valueOptions",null),c([h({types:zt})],E.prototype,"vertexSymbol",void 0),c([h({value:null})],E.prototype,"view",null),c([h({constructOnly:!0,type:Pt})],E.prototype,"sketchOptions",void 0),E=c([H("esri.widgets.Sketch.SketchViewModel")],E);const gs="sketch:missing-property",Xi=t=>`Property '${t}' is missing on SketchViewModel.`;function fs(t){return t==="polygon"||t==="rectangle"||t==="circle"}function de(t,e){Bn("undo",t.history.undo,t.history.redo,e)}function ue(t,e){Bn("redo",t.history.redo,t.history.undo,e)}function Bn(t,e,i,n){const o=e.pop();if(!o)return;const r=o.updates,s=[];n.forEach((a,p)=>{const l=r[p];l!=null&&("geometry"in l&&l.geometry!=null&&(s.push({geometry:a.geometry}),a.geometry=l.geometry),"symbol"in l&&l.symbol!=null&&(s.push({symbol:a.symbol}),a.symbol=l.symbol),"undo"in l&&(s.push(l),l[t](a)))}),i.push({updates:s})}function Ji(t,e){t!=null&&e.hasGrabbedManipulators&&(t.activeTool=null)}function Et(t){return{updates:t.map(({geometry:e})=>(e==null?void 0:e.type)==="mesh"?{geometry:e.cloneShallow()}:{geometry:e})}}function ye(t,e){var i;(i=t.tools)==null||i.remove(e),e.destroyed||e.destroy()}function P(t){return"requireError"in t&&t.requireError==="aborted"}export{at as $,cl as A,Da as B,sl as C,k as D,E,ia as F,bi as G,Zt as H,il as I,Te as J,J as K,Nt as L,Vi as M,Vt as N,Gt as O,L as P,Ys as Q,Fe as R,Zs as S,_n as T,ea as U,j as V,we as W,Ra as X,qs as Y,js as Z,Sr as _,Hr as a,On as a0,ol as a1,Ot as a2,Ga as a3,Ge as a4,Pa as a5,Me as a6,rl as a7,Aa as a8,mn as a9,fe as aa,Hn as ab,Sa as ac,Ta as ad,tl as ae,nl as af,Pr as ag,b as ah,La as ai,Xs as aj,Ks as ak,Js as al,K as am,pl as an,ps as ao,Ui as ap,Bs as aq,el as ar,V as b,M as c,Qs as d,ds as e,Dn as f,Ii as g,Oa as h,pe as i,Ma as j,Wi as k,Fn as l,al as m,Ws as n,ss as o,Tr as p,zs as q,gt as r,$i as s,pt as t,Or as u,ll as v,Pt as w,Xr as x,He as y,Ir as z};
