import{e as m}from"./CollectionFlattener-DfZaIx8a-ADmwanro.js";import{m as d,E as u,n as p,a7 as f,P as l,br as c,Q as b,aR as g}from"./index-BeTPrQ6f.js";function w(o){return new m({getCollections:()=>[o.tables,o.layers],getChildrenFunction:i=>{const a=[];return"tables"in i&&a.push(i.tables),"layers"in i&&a.push(i.layers),a},itemFilterFunction:i=>{const a=i.parent;return!!a&&"tables"in a&&a.tables.includes(i)}})}function C(o){for(const i of o.values())i==null||i.destroy();o.clear()}function y(o,i,a){let e,t;if(o)for(let r=0,n=o.length;r<n;r++){if(e=o.at(r),(e==null?void 0:e[i])===a)return e;if((e==null?void 0:e.type)==="group"&&(t=y(e.layers,i,a),t))return t}}const $=o=>{const i=o;let a=class extends i{constructor(...e){super(...e),this.layers=new f;const t=s=>{s.parent&&s.removeFromParent()},r=s=>{s.parent=this,this.layerAdded(s),s.type!=="elevation"&&s.type!=="base-elevation"||l.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as an operational layer and will therefore be ignored.`)},n=s=>{s.parent=null,this.layerRemoved(s)};this.addHandles([this.layers.on("before-add",s=>{if(s.item===this)return s.preventDefault(),void l.getLogger(this).error("#add()","Cannot add layer to itself.");t(s.item)}),this.layers.on("after-add",s=>r(s.item)),this.layers.on("after-remove",s=>n(s.item))])}destroy(){const e=this.layers.toArray();for(const t of e)t.destroy();this.layers.destroy()}removeChildLayer(e){var t;this.layers.remove(e),(t=super.removeChildLayer)==null||t.call(this,e)}set layers(e){this._set("layers",c(e,this._get("layers")))}add(e,t){const r=this.layers;if(t=r.getNextIndex(t),e instanceof b){const n=e;n.parent===this?this.reorder(n,t):r.add(n,t)}else g(e)?e.then(n=>{this.destroyed||this.add(n,t)}):l.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,t){const r=this.layers;let n=r.getNextIndex(t);e.slice().forEach(s=>{s.parent!==this?(r.add(s,n),n+=1):this.reorder(s,n)})}findLayerById(e){return y(this.layers,"id",e)}findLayerByUid(e){return y(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,t){return this.layers.reorder(e,t)}layerAdded(e){}layerRemoved(e){}};return d([u()],a.prototype,"layers",null),a=d([p("esri.support.LayersMixin")],a),a},v=new Set(["feature","subtype-group"]);function h(o,i,a){if(o)for(let e=0,t=o.length;e<t;e++){const r=o.at(e);if(r[i]===a)return r;if((r==null?void 0:r.type)==="group"){const n=h(r.tables,i,a);if(n)return n}}}const A=o=>{const i=o;let a=class extends i{constructor(...e){super(...e),this.tables=new f,this.addHandles([this.tables.on("after-add",t=>{const r=t.item;r.parent&&r.parent!==this&&r.removeFromParent(),r.parent=this,v.has(r.type)||l.getLogger(this).error(`Layer 'title:${r.title}, id:${r.id}' of type '${r.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",t=>{t.item.parent=null})])}destroy(){const e=this.tables.toArray();for(const t of e)t.destroy();this.tables.destroy()}removeChildLayer(e){var t;this.tables.remove(e),(t=super.removeChildLayer)==null||t.call(this,e)}set tables(e){this._set("tables",c(e,this._get("tables")))}findTableById(e){return h(this.tables,"id",e)}findTableByUid(e){return h(this.tables,"uid",e)}};return d([u()],a.prototype,"tables",null),a=d([p("esri.support.TablesMixin")],a),a};export{C as L,w as v,A as w,$ as x};
