const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./lengthOperator-BGZzaL7w-DRGNcDGP.js","./index-BeTPrQ6f.js","./index-BlWAJbpo.css","./Point2D-BVUQyGsf-qih0ZuJV.js","./Envelope2D-2iYexKQo-BCKocNS7.js","./ProjectionTransformation-BXUROh_s-kKBZ5FDB.js","./Transformation2D-CZCvoz9N-B-IhcWnl.js","./SimpleGeometryCursor-DSF_YyIm-TAMgMsbK.js","./OperatorDefinitions-DJdq_wrt-DP7_WWTp.js","./jsonConverter-CiKBkr5U-C590VlCu.js","./apiConverter-Djde5pBD-Dr3vspB4.js"])))=>i.map(i=>d[i]);
import{l as Me,aj as $,as as P,at as V,ar as ne,bc as nt,av as J,nm as Te,N as R,M as rt,ay as ot,aG as ye,eE as Y,a7 as ze,bh as ue,i as at,bw as Le,cI as lt,j as ut,cL as pt,aB as ve,bt as ct,a4 as j,aT as ht,fZ as Ae,c as dt,A as Se,nn as Pe,fX as mt,_ as yt,be as Ue,aa as vt,no as ft,np as gt,ek as ae,bJ as _t,B as wt,bp as qe,al as bt,V as St,H as fe,D as Pt,bD as Et,b4 as Ze,kz as kt,m as a,E as u,n as E,ba as xt,ig as Dt,cW as q,nq as Ct,nr as Rt,ee as ce}from"./index-BeTPrQ6f.js";import{X as Vt}from"./colorUtils-DlmOacVt-BnN0T6wa.js";import{c as $e}from"./throttle-CMh51-SQ-Cn71HPca.js";import He from"./GraphicsLayer-DPoztXf7-DWF8RDJT.js";import{U as Ot}from"./createUtils-QoBeynM5-wXx8RLRA.js";import{N as Ee,W as he,X as Gt}from"./projectionUtils-CsX1UTBu-DsZaU4xz.js";import{g as Fe}from"./asyncUtils-Cu__bxqs-ecCTUaGV.js";import{i as It}from"./LRUCache-CvGiiws0-B3io5Jp4.js";import{_ as Mt}from"./mapCollectionUtils-DHlvEs72-DKXw-TcU.js";import{R as Tt,d as ke,l as zt,E as Lt}from"./elevationInfoUtils-DFX5QvG8-DWLx2t7K.js";import{i as At}from"./getDefaultUnitForView-CEAuCsu_-B1vEtX96.js";import{r as ge}from"./ElevationInfo-tlrAM5SV-D86C1F9d.js";import{S as Ut}from"./vec32-CI1xtKog-DFVYRcgb.js";import{c as qt,E as Zt,$ as $t,O as Ne}from"./geodesicUtils-DHDMXkUY-CP5HeHA5.js";import{j as Ht}from"./Tile-BNoJIjzH-DZ-xZWMb.js";import{r as Ft}from"./Scheduler-D_tOhFWn-SFGb1GBz.js";import{o as Nt}from"./Map-BgzFtTfu-BMsKSgj7.js";import{f as jt}from"./GeometryDescriptor-CGSMioST-BjTCNFpW.js";import{i as Qt}from"./UpdatingHandles-XotKWqvb-CyHJIoZx.js";import{o as Wt}from"./signal-DHxLvooI-Bin-tnuW.js";import{_ as xe}from"./utils-DqlCEhl6-DBO0-7VG.js";import{n as Xt}from"./MapView-CrB-5KSL-IexKdUKM.js";import{b as Bt}from"./SketchViewModel-BCVIeloG-Cwmt4M0t.js";import"./vec42-DHp-FUwt-Br7hmYJs.js";import"./vec4f64-DD-nkcCV-CSNWKRqG.js";import"./GraphicsCollection-CT-y6p3H-4XYPvC_j.js";import"./BlendLayer-D8oJmNCO-A0sTzbOF.js";import"./layerContainerType-CJrPp4UB-BIF7XAYP.js";import"./jsonUtils-Bl9MVnOR-Be8hf0yA.js";import"./parser-CXoJuqeV-C7irlk5U.js";import"./mat4f32-BdRMyjXW-CWt6U0BP.js";import"./mat4-R0VY9B_E-DoEP887i.js";import"./ScaleRangeLayer-DkZwCH6_-C95kTMqN.js";import"./lengthUtils-CopeXEyE-DjCEitlq.js";import"./distanceOperator-C3n_j88h-CjjOO0Zj.js";import"./Point2D-BVUQyGsf-qih0ZuJV.js";import"./Distance2DCalculator-CXhBP-8I-CW7HDKXX-kSux2duE.js";import"./ProjectionTransformation-BXUROh_s-kKBZ5FDB.js";import"./Envelope2D-2iYexKQo-BCKocNS7.js";import"./Transformation2D-CZCvoz9N-B-IhcWnl.js";import"./SimpleGeometryCursor-DSF_YyIm-TAMgMsbK.js";import"./OperatorDefinitions-DJdq_wrt-DP7_WWTp.js";import"./apiConverter-Djde5pBD-Dr3vspB4.js";import"./jsonConverter-CiKBkr5U-C590VlCu.js";import"./simplifyOperator-CK8t6p1S-COLMjdqn.js";import"./operatorSimplify-BRKLCaj2-DisWK8Yh.js";import"./mat2d-Cf4xHr3Z-u09Kv-lR.js";import"./mat2df64-VxtldH1S-CqyKAV7h.js";import"./quat-B6H0knG8-DtO1-hlf.js";import"./quatf64-C16JxGFv-BKWK1F8U.js";import"./projectBuffer-CMNsPBq1-CMpE7Jo3.js";import"./zscale-PLuFqpaL-BIEnWBsg.js";import"./MemCache-TG-MhOJy-BkjKRNR7.js";import"./TileKey-BZu7Ia24-BiyRHU0x.js";import"./Queue-CK6TduSr-C-T211SM.js";import"./ReactiveMap-cp6PWICM-990o5_5b.js";import"./Query-DKLDaFaA-I4zhlfzt.js";import"./Field-Dn1Bgq7n-CJCGLoNR.js";import"./fieldType-DvW5hpfa-DYUbIy_X.js";import"./arcadeUtils-BkvNBhzm-KzAaTYHA.js";import"./quickselect-DHTstthl-Ds_Aj0x5.js";import"./debugFlags-vZXEBr68-Bc51Oe-E.js";import"./Basemap-Dv-hYkd3-V8XC6wCN.js";import"./loadAll-B16dgL0--5EDWWWLE.js";import"./PortalItem-BrQqKoE_-zs2bKsCH.js";import"./messages-DQ10DjvF-6kk0dzjG.js";import"./intl-DRhjUnwt-Dihhq8dq.js";import"./isBasemap-CJN7v_Jq-Dgi2bMj-.js";import"./writeUtils-DKeM2R6Z-BUUAIn2U.js";import"./CollectionFlattener-DfZaIx8a-ADmwanro.js";import"./uuid-CFz2qBzH-cIdlpVG-.js";import"./persistable-vgejqKb5-CBqfEqX1.js";import"./MD5-CXHDUqXT-CMrYdOi6.js";import"./multiOriginJSONSupportUtils-DGETddQl-BrWaY9_8.js";import"./resourceExtension-Boq2U56c-rXLaGMsr.js";import"./PolygonCollection-BEPfGuUm-Bu1vpYsn.js";import"./editableLayers-BTZOOiKD-ByJ-Oydo.js";import"./TablesMixin-Cv7gcoNw-OtczYJk-.js";import"./Version-DSJSGSLA-Cg87msWM.js";import"./Texture-DLw7oaIg-fTsxdRzn.js";import"./Cyclical-Bzwh_QaL-CXh-hbnA.js";import"./enums-DDJfd4_p-D3z9tmVA.js";import"./workers-CixlqDQM-CMoJ1YZN.js";import"./TileInfo-BmHJ3kZT-BCenfvrA.js";import"./TileKey-1TQKLvpf-ByD6Ad6n.js";import"./jsxFactory-DN-m49_5-CUFCpKPo.js";import"./sanitizerUtils-CrdmaILo-DztC6Qnx.js";import"./HeightModelInfo-Cjals-AI-DMpn5Tsh.js";import"./timeZoneUtils-CdK7eU4Y-fyhJ3EFx.js";import"./projectionUtils-BXtVkW1R-Dp6FsH61.js";import"./vec2f64-CkowXrDb-3zFQ3LNH.js";import"./normalizeUtils-DK5542Ty-DtqBcgc2.js";import"./normalizeUtilsCommon-5DjefBp7-CQyUDMQp.js";import"./utils-CRANtbnc-C6zyufvL.js";import"./utils-t279O251-BBk6rV0U.js";import"./mat2df32-fg3OHsAI-BF2V2zqo.js";import"./vec2f32-hTAvipMV-C0AQcwEv.js";import"./a11yUtils-tU3tY6-a-CmHbThdR.js";import"./unitBezier-DhyPAQO8-B9kUb8N6.js";import"./definitions-DVO21zOC-BwakNu1s.js";import"./imageUtils-DITyjHV4-jEv5aA2D.js";import"./capabilities-BaKzUyhi-B84We26i.js";import"./modeUtils-V6BDu_YT-Dq8o_RJK.js";import"./ColorBackground-C0DZs7p1-CENExjrO.js";import"./projectVectorToVector-OCoJKalB-CQIDHzSm.js";import"./projectPointToVector-BHS0gJJf-DOVZH8Fn.js";import"./plane-wUwHaY3K-ZwGBF7HQ.js";import"./vectorStacks-B2ngxq6F-myhPBoPk.js";import"./sphere-CIGsF4vz-C3zVQu9y.js";import"./quantityUtils-v7kjLywD-Cq6IoGLM.js";import"./geodeticLengthOperator-CMi-Z1ZN-WUImro4E.js";import"./geodeticCurveType-D_etKnbP-CirnHLSB.js";import"./earcut-C6NeZYSh-P2HUZ781.js";import"./triangle-DA_o7I-u-CHbj6sRJ.js";import"./lineSegment-D8lwRkdT-CnWWOaLb.js";import"./spatialReferenceEllipsoidUtils-Ty3j4VoE-BUAsRqCF.js";let G=class extends lt(ut){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(e){this._userInteractive=e}get updating(){return!1}get visible(){var e;return(((e=this.parent)==null?void 0:e.visible)&&!this.parent.suspended)??!0}set visible(e){this._overrideIfSome("visible",e)}forceInteractive(){return this._interactiveViewModelCount++,J(()=>this._interactiveViewModelCount--)}};a([u({constructOnly:!0})],G.prototype,"parent",void 0),a([u({constructOnly:!0})],G.prototype,"view",void 0),a([u({type:Boolean})],G.prototype,"interactive",null),a([u()],G.prototype,"_userInteractive",void 0),a([u({readOnly:!0})],G.prototype,"updating",null),a([u()],G.prototype,"visible",null),a([u()],G.prototype,"_interactiveViewModelCount",void 0),G=a([E("esri.views.analysis.AnalysisView")],G);let de=class extends G{};de=a([E("esri.views.2d.analysis.AnalysisView2D")],de);function Jt(e){return bt([P(()=>{const{analysis:t,sketchGraphic:i,toolState:s,visible:n}=e.analysisViewData,{geometryVisualizationVisible:o}=t.viewOptions;return{geometryVisualizationVisible:o,geometry:t.geometry,sketchGraphic:i,toolState:s,visible:n}},({geometryVisualizationVisible:t,sketchGraphic:i,toolState:s,visible:n})=>{if(e.remove(),n)return t&&i!=null&&s!=="reshaping"&&s!=="sketching"?e.show(i):void 0},V)])}let W=class extends ${constructor(e){super(e)}initialize(){this.addHandles(Jt({analysisViewData:this.analysisViewData,remove:()=>{},show:()=>{}}))}get updating(){return!1}};a([u({constructOnly:!0})],W.prototype,"view",void 0),a([u({constructOnly:!0})],W.prototype,"analysisViewData",void 0),a([u()],W.prototype,"updating",null),W=a([E("esri.views.2d.analysis.ElevationProfile.ElevationProfileInputVisualization2D")],W);let je={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:je.noDataValue,demResolution:"auto",maximumAutoTileRequests:150,ignoreInvisibleLayers:!0,signal:null}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:ae(10,"centimeters","meters"),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:"solid",borderWidth:3,borderColor:"#ffffff",boxShadow:"0px 0px 0px 5px rgba(255,255,255,0.2)"}};function Z(){return je}const Yt={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null};function Kt(e,t){e??(e=[]);const i=e.length-1,s=[];let n=[];for(let o=0;o<=i;o++){const{x:r,y:l,z:p}=e[o];p!=null&&n.push([r,l,p]),o!==i&&p!=null||!n.length||(s.push(n),n=[])}return Ot(s,t,!0)}let A=class extends ${constructor(e){super(e),this._graphic=new Le,this._layer=new He({listMode:"hide",internal:!0}),this._updateGeometryThrottled=$e(t=>{var n;if(!t)return void(this._graphic.visible=!1);const i=this._layer,s=(n=this.view.map)==null?void 0:n.layers;s&&(s.includes(i)||s.add(i),s.reorder(i,0)),this._graphic.visible=!0,this._graphic.geometry=Kt(t.samples,t.spatialReference)},Z().profileLinesUpdateThrottleMillis)}initialize(){this._layer.add(this._graphic),this.addHandles([ht(()=>!this.analysisViewData.visible,()=>{this._graphic.visible=!1}),P(()=>this._colorUpdateParameters,e=>this._updateColor(e),V),P(()=>this.analysisViewData.analysis.geometry,()=>{this._graphic.visible=!1},V),P(()=>this._geometryUpdateParameters,e=>this._updateGeometryThrottled(e),V),this._updateGeometryThrottled])}destroy(){var e;(e=this.view.map)==null||e.remove(this._layer),this._layer.destroy(),this._graphic.destroy()}get updating(){return this._updateGeometryThrottled.hasPendingUpdates()}get _result(){const{analysisViewData:e}=this;return e.visible?e.results.find(({available:t,computation:i,rawResult:s})=>t&&i.profile.viewOptions.lineVisible&&(s==null?void 0:s.hasZ)===!0):null}get _geometryUpdateParameters(){const e=this._result;return(e==null?void 0:e.progress)!==1?null:{samples:e.samples,spatialReference:this.view.spatialReference}}get _colorUpdateParameters(){var t;const e=(t=this._result)==null?void 0:t.computation.profile.color;return e?{color:e.toArray(),contrastColor:Vt(e).toArray()}:null}_updateColor(e){e&&(this._graphic.symbol=new Ae({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",capStyle:"Butt",color:e.color,effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],joinStyle:"Round",width:1.5},{type:"CIMSolidStroke",capStyle:"Butt",color:e.contrastColor,joinStyle:"Round",width:1.5}]}}}))}};a([u({constructOnly:!0})],A.prototype,"view",void 0),a([u({constructOnly:!0})],A.prototype,"analysisViewData",void 0),a([u()],A.prototype,"updating",null),a([u()],A.prototype,"_result",null),a([u()],A.prototype,"_geometryUpdateParameters",null),a([u()],A.prototype,"_colorUpdateParameters",null),A=a([E("esri.views.2d.analysis.ElevationProfile.ElevationProfileLineVisualization2D")],A);let H=class extends ${constructor(e){super(e),this.position=null,this.color=new qe("#ffffff"),this.element=ei()}initialize(){var e;this.addHandles([P(()=>this._screenLocation,t=>{t&&(this.element.style.transform=`translate(${t.x}px, ${t.y}px)`)},V),P(()=>this.color.toCss(),t=>{this.element.style.background=t},V)]),(e=this.view.surface)==null||e.appendChild(this.element)}destroy(){this.element.remove()}get _screenLocation(){const{position:e,view:t}=this;t.type==="3d"?(t.commitProperty("size"),t.commitProperty("camera")):t.commitProperty("center");const i=t==null?void 0:t.spatialReference,s=i?Gt(e,i).geometry:null;return s&&(t!=null&&t.ready)?t.toScreen(s):null}};function ei(){const e=document.createElement("div"),{size:t,borderStyle:i,borderColor:s,borderWidth:n,boxShadow:o}=Z().hoveredPointsStyle,{style:r}=e;return r.display="block",r.position="absolute",r.top="0",r.left="0",r.contain="strict",r.boxSizing="border-box",r.width=`${t}px`,r.height=`${t}px`,r.marginTop=`-${t/2}px`,r.marginLeft=`-${t/2}px`,r.border=`${i} ${n}px ${s}`,r.borderRadius=`${t}px`,r.boxShadow=o,e}a([u()],H.prototype,"position",void 0),a([u({type:qe})],H.prototype,"color",void 0),a([u()],H.prototype,"view",void 0),a([u()],H.prototype,"_screenLocation",null),H=a([E("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointVisualization")],H);let F=class extends ${constructor(e){super(e),this._hoveredPoints=new ze}initialize(){const{analysisViewData:e}=this,{analysis:t}=e;this.addHandles([P(()=>{const{hoveredPoints:i,visible:s,updating:n}=e;return s?n?null:i.map((o,r)=>{const l=t.profiles.at(r);return(l==null?void 0:l.viewOptions.hoveredPointVisible)===!0&&o!=null?{hoveredPoint:o,color:l.color}:null}).filter(o=>!!o):[]},i=>this._update(i),V),P(()=>t.geometry,()=>this._update([]),V)])}destroy(){this._hoveredPoints.drain(e=>e.destroy())}get updating(){return!1}_update(e){var n;if(!e)return;const{view:t,_hoveredPoints:i}=this,s=e.length;for(;i.length>s;)(n=i.pop())==null||n.destroy();for(;i.length<s;){const o=new H({view:t});i.push(o)}for(let o=0;o<s;++o){const r=e[o],l=i.at(s-1-o);l.position=r.hoveredPoint,l.color=r.color}}};a([u()],F.prototype,"view",void 0),a([u()],F.prototype,"analysisViewData",void 0),a([u()],F.prototype,"_hoveredPoints",void 0),a([u()],F.prototype,"updating",null),F=a([E("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointsVisualization")],F);let X=class extends ${constructor(e){super(e)}initialize(){const{view:e,analysisViewData:t}=this;this._hoveredPointsVisualization=new F({view:e,analysisViewData:t}),this._inputVisualization=new W({view:e,analysisViewData:t}),this._lineVisualization=new A({view:e,analysisViewData:t})}destroy(){this._inputVisualization.destroy(),this._hoveredPointsVisualization.destroy(),this._lineVisualization.destroy()}get updating(){return this._hoveredPointsVisualization.updating||this._inputVisualization.updating||this._lineVisualization.updating}};a([u()],X.prototype,"view",void 0),a([u()],X.prototype,"analysisViewData",void 0),a([u()],X.prototype,"updating",null),X=a([E("esri.views.2d.analysis.ElevationProfile.ElevationProfileVisualization2D")],X);function C(e,t){let i,s=!1;function n(...o){const r=e.apply(this,o);return s&&i!==void 0&&(t!=null&&t(i,r))?i:(s=!0,i=r,r)}return n}let ti=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,t){this._store.put(e,t)}},ie=class extends Me{constructor(e,t,i){super(e,t,i),this.name="unknown",this.name=e}},oe=class extends ie{constructor(){super("too-complex","The input geometry has too many points.")}},Qe=class extends ie{constructor(){super("invalid-geometry","The input geometry is invalid.")}};class ii extends ie{constructor(){super("elevation-query-error","Error querying elevation from provider.")}}let si=class extends ie{constructor(){super("unknown","Unknown error.")}};async function ni(e,t,i,s,n,o,r){let l,p,c;const h=e.spatialReference,d=h.isGeographic||h.isWebMercator;let m=0;if(!d){const{execute:f}=await yt(()=>import("./lengthOperator-BGZzaL7w-DRGNcDGP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url).then(w=>w.l);R(r),m=f(e,{unit:"meters"}),R(r)}const v=1/j(s);if(d){await Ee([{source:h,dest:s},{source:h,dest:Ue.WGS84}],r);const f=gi(e);l=qt([f],"meters")[0];const w=De(l,n);if(Ve(e,l,w)>o)throw new oe;const y=Ce(f,t,i);({densifiedPath:p,distances:c}=ci(y,w,v)),p=he(p,s)}else{await Ee([{source:h,dest:s}],r),l=m;const f=De(l,n);if(Ve(e,l,f)>o)throw new oe;const w=Ce(e,t,i);({densifiedPath:p,distances:c}=pi(w,f,v)),R(r),p=he(p,s)}return{densifiedPath:p,pathLength:l*v,distances:c}}function De(e,t){const i=e/t.densificationMaxSamples;return Math.max(t.samplingDistance,i)}function Ce(e,t,i){if(t==null)return Re(e);const s=e.spatialReference,n=t.mode,o=zt(t,s);let r=null;switch(i.type){case"2d":r=ri(e,n,o);break;case"3d":r=oi(e,n,o,i)}return r==null?Re(e):new fe({hasZ:!0,hasM:!1,spatialReference:s,paths:We(e.paths,r)})}function ri({hasZ:e},t,i){return t==="absolute-height"?e?([s,n,o])=>[s,n,o+i]:([s,n])=>[s,n,i]:null}function oi({spatialReference:e,hasZ:t},i,s,{elevationProvider:n}){const o=(r,l,p,c)=>(n==null?void 0:n.getElevation(r,l,p,e,c))??0;switch(i){case"on-the-ground":return([r,l])=>[r,l,o(r,l,0,"ground")];case"absolute-height":return t?([r,l,p])=>[r,l,p+s]:([r,l])=>[r,l,s];case"relative-to-ground":return t?([r,l,p])=>[r,l,p+o(r,l,p,"ground")+s]:([r,l])=>[r,l,o(r,l,0,"ground")+s];case"relative-to-scene":return t?([r,l,p])=>[r,l,p+o(r,l,p,"scene")+s]:([r,l])=>[r,l,o(r,l,0,"scene")+s];default:return null}}function Re(e){return e.hasZ?new fe({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:We(e.paths,([t,i])=>[t,i])}):e}function We(e,t){const i=e.length,s=new Array(i);for(let n=0;n<i;++n){const o=e[n],r=o.length,l=new Array(o.length);s[n]=l;for(let p=0;p<r;++p)l[p]=t(o[p])}return s}function Xe(e){return _e(e)&&e.paths.some(t=>t.length>1)}function ai(e){return li(e)&&Xe(e.geometry)}function li(e){return Be(e)&&_e(e==null?void 0:e.geometry)}function _e(e){return!Be(e)&&e!=null&&e.type==="polyline"}function Be(e){return e!=null&&"geometry"in e}function ui(e){const t=e==null?void 0:e.layer;return t!=null&&t.type==="graphics"&&t.internal}function Je(e,t,i,s,n){const{spatialReference:o,hasZ:r}=e,l={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:o,metersPerSR:j(o)},p=[],c=[];let h=0;for(let d=0;d<e.paths.length;++d){const m=e.paths[d],v=new Array,f=new Array;let w=0;for(let y=1;y<m.length;++y){const _=m[y-1],I=m[y],M=s(l,_,I);let T;for(T=w;T<M.distance&&!kt(T,M.distance);T+=t)v.push(n(M,T)),f.push((h+T)*i);w=T-M.distance,h+=M.distance,v.push(I),f.push(h*i)}p[d]=v,c[d]=f}return{densifiedPath:new fe({spatialReference:o,hasZ:r,paths:p}),distances:c}}function pi(e,t,i){const{hasZ:s}=e;return Je(e,t,i,di,s?fi:vi)}function ci(e,t,i){const{hasZ:s}=e;return Je(e,t,i,hi,s?yi:mi)}function hi(e,t,i){return e.distance=0,$t(e,t,i,e.spatialReference),e.from=t,e.to=i,e}function di(e,t,i){return e.from=t,e.to=i,e.distance=xt(i,t)*e.metersPerSR,e}function mi({from:e,azimuth:t,spatialReference:i},s){return Ne([0,0],e,t,s,i)}function yi({from:e,to:t,azimuth:i,distance:s,spatialReference:n},o){const r=o/s,l=[0,0,Ze(e[2],t[2],r)];return Ne(l,e,i,o,n),l}function vi({from:e,to:t,distance:i},s){return Dt([0,0],e,t,s/i)}function fi({from:e,to:t,distance:i},s){return Ut([0,0,0],e,t,s/i)}function gi(e){return Zt(e.spatialReference)?e:he(e,Ue.WGS84)}function Ye(e){return e.paths.reduce((t,i)=>t+i.length,0)}function Ve(e,t,i){return Ye(e)+Math.floor(t/i)+Math.max(0,e.paths.reduce(s=>1+s,0)-1)}function _i(e,t){const i=e.length;if(i===0)return null;const s=e[0],n=s.sampledZ;let o=n,r=n,l=0,p=0,c=null,h=null,d=n??0,m=0,v=0,f=n!=null?1:0,w=0,y=0;const _=j(t),I=Y(t),M=Z().minSlopeSampleDistance/_,T=2*M,Q=new Oe,O=new Oe,le=()=>{st(),Q.copy(O),O.reset()},be=(k,K)=>{le(),k>0&&k-Q.start<=T&&(k=Q.start+M),O.restart(k,K)},st=()=>{if(Q.isHole||O.isHole)return;const k=O.avgElevation-Q.avgElevation,K=O.start-Q.start,ee=k*I,z=K*_,L=ae(Math.atan2(ee,z),"radians","degrees");L>0?(m+=L,c=U(c,L),w++):L<0&&(v-=L,h=U(h,-L),y++)};s.sampledZ!=null&&be(s.distance,s.sampledZ);for(let k=1;k<i;++k){const K=e[k-1],ee=e[k],z=ee.sampledZ;if(z==null){O.isHole||le();continue}f++,d+=z,o=we(o,z),r=U(r,z),O.isHole||ee.distance-O.start>=M?be(ee.distance,z):O.insert(z);const L=K.sampledZ;if(L!=null){const se=z-L;se>0?l+=se:se<0&&(p-=se)}}return le(),f===0?null:{maxDistance:e[i-1].distance,minElevation:o,maxElevation:r,avgElevation:f===0?null:d/f,elevationGain:l,elevationLoss:p,maxPositiveSlope:c,maxNegativeSlope:h,avgPositiveSlope:w===0?null:m/w,avgNegativeSlope:y===0?null:v/y}}function wi(e){const t=e.filter(ve),i=t.length;if(i===0)return null;const s=t[0];if(i===1)return s;let n=s.maxDistance,o=s.minElevation,r=s.maxElevation,l=s.maxPositiveSlope,p=s.maxNegativeSlope;for(let c=1;c<t.length;++c){const h=t[c];n=U(n,h.maxDistance),o=we(o,h.minElevation),r=U(r,h.maxElevation),l=U(l,h.maxPositiveSlope),p=U(p,h.maxNegativeSlope)}return{maxDistance:n,minElevation:o,maxElevation:r,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:l,maxNegativeSlope:p,avgPositiveSlope:null,avgNegativeSlope:null}}function bi(e){let t=null,i=null,s=null;for(const n of e){if(n==null)continue;const{statistics:o,spatialReference:r}=n;if(o==null)continue;const l=j(r);t=U(t,pe(o.maxDistance,l));const p=Y(r);s=we(s,pe(o.minElevation,p)),i=U(i,pe(o.maxElevation,p))}return{minDistance:0,maxDistance:t??0,minElevation:s??0,maxElevation:i??0}}function we(e,t){return t==null?e:e!=null?Math.min(e,t):t}function U(e,t){return t==null?e:e!=null?Math.max(e,t):t}function pe(e,t){return e!=null&&t!=null?e*t:null}class Oe{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(t){this._start=t._start,this._sampleCount=t._sampleCount,this._totalElevation=t._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(t,i){this._start=t,this._sampleCount=1,this._totalElevation=i}insert(t){++this._sampleCount,this._totalElevation+=t}}function Si(e,t,i=[]){if(e>=t||(i.push(e),t-e<2))return i;const s=t-1;i.push(s);const n=me(e+1,s);for(;;){const o=n.next();if(o.done)break;i.push(o.value)}return i}function*me(e,t){if(e>=t)return;const i=e+Math.floor((t-e)/2);yield i;const s=me(e,i),n=me(i+1,t);for(;;){const o=s.next(),r=n.next();if(o.done&&r.done)break;o.done||(yield o.value),r.done||(yield r.value)}}async function*Pi(e,t){const{view:i,geometry:s,elevationInfo:n,providers:o,options:r}=e,l=i.spatialReference;if(!l||s==null||!Xe(s))throw new Qe;const p=o.length;if(p===0)return null;const c=Math.round(r.maxTotalSamples/p);if(Ye(s)>c)throw new oe;const h=await ni(s,n,i,l,r,c,t);R(t);let d=0;const m=new Array(p),v=new Array(p);for(let y=0;y<p;y++){const _=Ri(h);m[y]=_,d+=_.samples.length;const I={...e,provider:o[y],result:_,densificationResult:h};v[y]=Ei(I,t)[Symbol.iterator]()}if(d>r.maxTotalSamples)throw new oe;const f=await Promise.all(v.map(y=>{const _=y.next();return _.done===!0?Promise.resolve(null):_.value}));R(t);for(let y=0;y<p;y++)m[y]=f[y];yield m,await ct(e.delayAfterPreview??Z().delayAfterPreviewMillis,null,t.signal),R(t);const w=[];try{let y;do{y=!1;for(let _=0;_<p;_++){const I=v[_].next();I.done===!1&&(w.push({resultPromise:I.value,index:_}),y=!0)}}while(y)}finally{v.forEach(y=>{var _;return(_=y.return)==null?void 0:_.call(y)})}for(const{resultPromise:y,index:_}of w)m[_]=await y,R(t),yield m;for(const y of m)y!=null&&(y.progress=1);yield m}function*Ei(e,t){const{densificationResult:i}=e,s={...e,abortOptions:t,densificationResult:i},n=Si(0,s.result.samples.length),o=n.slice(0,s.provider.numSamplesForPreview);yield Ge(s,o,!0);const r=gt(n,s.provider.numSamplesPerChunk);for(const l of r)yield Ge(s,l,!1)}async function Ge({densificationResult:e,result:t,provider:i,queue:s,abortOptions:n,cache:o},r,l){const{densifiedPath:p,pathLength:c}=e,h=t.spatialReference,{samples:d}=t,m=[];for(let v=0;v<r.length;v++){const f=d[r[v]];m[v]=[...f.coordinate]}try{return await s.push({geometry:new Pt({spatialReference:h,points:m,hasZ:p.hasZ}),provider:i,indices:r,preview:l,result:t,parameters:{...Z().defaultQueryOptions(),minDemResolution:Math.round(l?c/i.numSamplesForPreview:c/d.length),cache:o}},n),{...t}}catch(v){return Et(v)?null:Yt}}function ki(e){return new Ht({priority:Ft.ELEVATION_PROFILE,concurrency:1,scheduler:e,process:async t=>{R(t.parameters);try{await xi(t)}catch(i){pt(i)}}})}async function xi({geometry:e,provider:t,indices:i,preview:s,result:n,parameters:o}){if(i.length===0)return;const r=(await Gi(t,e,o)).geometry,{hasZ:l,points:p}=r,c=o.noDataValue,{samples:h}=n;for(let d=0;d<i.length;d++){const m=h[i[d]];if(m.isHole)continue;const v=l?p[d][2]:null;v===null||v===c?m.sampledZ=null:(n.hasZ=!0,m.sampledZ=v),m.sampled=!0}Di(h),n.progress=s?0:n.progress+i.length/h.length,n.statistics=_i(n.samples,n.spatialReference)}function Di(e){const t=e.length-1;let i=0;for(let s=1;s<=t;s++)(e[s].sampled||s===t)&&(Ci(e,i,s),i=s)}function Ci(e,t,i){if(i-t===1)return;const s=e[t],n=s.sampledZ,o=e[i],r=o.sampledZ;if(n==null||r==null){for(let c=t+1;c<i;c++)e[c].sampledZ=null;return}const l=s.distance,p=o.distance-l;for(let c=t+1;c<i;c++){const h=e[c],d=(h.distance-l)/p;h.sampledZ=Ze(n,r,d)}}function Ri({densifiedPath:e,distances:t}){const i=e.spatialReference,s=vt(i),n=e.paths,o=n.length,r=[];let l=null,p=0;for(let c=0;c<o;c++){const h=n[c],d=h.length,m=t[c];for(let v=0;v<d;v++){const f=h[v],w=m[v];s&&(f[0]=ft(f[0],s.valid[0],s.valid[1])),l&&v===0&&Vi(r,l,f,p,w),r.push(Oi(f,w)),l=f,p=w}}return{progress:0,samples:r,hasZ:!1,statistics:null,spatialReference:i}}function Vi(e,t,i,s,n){e.push(Ie(t,s)),e.push(Ie(i,n))}function Oi(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!1,isHole:!1}}function Ie(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!0,isHole:!0}}async function Gi(e,t,i){try{return await e.queryElevation(t,i)}catch{throw new ii}}function Ii(e,t,i){if(!e||e.length===0)return;const s=e.length-1,n=e[0];if(t<=i(n))return n;const o=e[s];if(t>=i(o))return o;let r=0,l=0,p=s;for(;r<p;){l=r+Math.floor((p-r)/2);const c=e[l],h=i(c);if(h===t)return c;if(t<h){if(l>0){const d=e[l-1],m=i(d);if(t>m)return t-m>=h-t?c:d}p=l}else{if(l<s){const d=e[l+1],m=i(d);if(t<m)return t-h>=m-t?d:c}r=l+1}}return e[l]}function Ke(e){return e>.999999?1:e}let g=class extends ${constructor(e){super(e),this.error=null,this._getStableEffectiveUnits=C(()=>{const t=bi(this._activeComputations.map(n=>n.result.rawResult)),i=this.analysis.displayUnits,s=At(this.view);return{distance:Rt(t.maxDistance,"meters",i.distance??s),elevation:Ct(t.maxElevation,"meters",i.elevation??s)}},q),this._updateTask=null,this._queue=null,this._currentTileCache=null,this._parametersPerComputation=new Map,this._getStableUpdateParameters=C(()=>({stationary:this.view.stationary??!0,activeComputations:this._activeComputations,generationParameters:this._generationParameters}),q),this._getStableGenerationParameters=C(()=>{const{view:t,analysis:i}=this;return t!=null&&t.ready&&this._queue?{view:t,geometry:i.geometry,geometryIsValid:i.valid,elevationInfo:this.elevationInfo,queue:this._queue,cache:this._tileCache,options:this._options,slicePlane:t.type==="3d"?t.slice.plane:null}:null},q),this._getStableElevationInfo=C(()=>this.analysis.elevationInfo??Mi,ce),this._getStableOptions=C(()=>{const{densificationMaxSamples:t,defaultDemResolution:i,maxTotalSamples:s}=Z();let n=this._minDemResolution??i;return n=parseFloat(n.toFixed(2)),{samplingDistance:n,densificationMaxSamples:Math.round(t/this._activeComputations.length),maxTotalSamples:s}},q),this._updateThrottled=$e(t=>this._update(t),Z().updateThrottleMillis)}initialize(){this._computationsCollection=Mt(()=>this.analysis.profiles,t=>this.computationFactory.create({controller:this,profile:t,onInvalidate:i=>this._invalidateComputation(i)}),{recycleItems:!0}),this.addHandles([this._computationsCollection.on("change",()=>{this._parametersPerComputation.clear(),this._updateThrottled(this._updateParameters)}),P(()=>this._updateParameters,t=>this._updateThrottled(t),V),this._updateThrottled]);const e=this.view.type==="3d"?this.view.resourceController:void 0;this._queue=ki(e==null?void 0:e.scheduler),e==null||e.addUpdatingObject(this)}destroy(){var e;this._abortUpdate(),this._parametersPerComputation.clear(),(e=this._computationsCollection)==null||e.destroy(),this._queue=ne(this._queue),this._currentTileCache=ne(this._currentTileCache)}get effectiveDisplayUnits(){return this._getStableEffectiveUnits()}get progress(){let e=0,t=0;for(const i of this._activeComputations)e++,t+=i.progress;return Ke(e>0?t/e:0)}get updating(){var n;const{progress:e}=this,t=!!((n=this._queue)!=null&&n.updating),i=this._updateThrottled.hasPendingUpdates(),s=this._updateTask!=null&&!this._updateTask.finished;return t||i||s||e>0&&e<1}get results(){return this._computations.map(e=>e.result)}get statistics(){return wi(this._activeComputations.map(e=>e.result.statistics))}get hoveredPoints(){return this._computations.map(e=>e.hoveredPoint)}onElevationChange(e){const{view:t}=this;return(t==null?void 0:t.type)==="3d"?nt(()=>t.elevationProvider,"elevation-change",e,{onListenerAdd:e,onListenerRemove:e}):J()}get _tileCache(){var t;this._currentTileCache=ne(this._currentTileCache);const e=this.view;if((e==null?void 0:e.type)==="3d"){const i=(t=e.basemapTerrain)==null?void 0:t.elevationQueryCache;if(i!=null)return i}return this._currentTileCache==null&&(this._currentTileCache=new ti(new It(20971520))),this._currentTileCache}get _computations(){var e;return((e=this._computationsCollection)==null?void 0:e.toArray())??[]}get _activeComputations(){return this._computations.filter(e=>e.profile.enabled&&e.available)}get _minDemResolution(){const e=this._minDemResolutions;return e.length>0?Te(e):null}get _minDemResolutions(){const e=[];for(const{minDemResolution:t}of this._activeComputations)t!=null&&e.push(t);return e}get _updateParameters(){return this._getStableUpdateParameters()}get _generationParameters(){return this._getStableGenerationParameters()}get elevationInfo(){return this._getStableElevationInfo()}get _options(){return this._getStableOptions()}_update({stationary:e,activeComputations:t,generationParameters:i}){this._abortUpdate(),e&&(i!=null?this._updateTask=Fe(async s=>{this.error=null;const n=t.filter(o=>!this._isComputationValid(o,i));try{if(!i.geometryIsValid)throw new Qe;const o=Pi({...i,providers:n},{signal:s});let r=!1;for await(const l of o){R(s),r||(this._clearInvalidResults(i),r=!0);for(let p=0;p<n.length;p++)n[p].setResult(l[p])}for(const l of n)this._parametersPerComputation.set(l,i)}catch(o){rt(o),this._abortUpdate(),this.error=o instanceof ie?o:new si,n.forEach(r=>{r.clearResult()})}}):this._clearResults())}_abortUpdate(){this._updateTask=ot(this._updateTask)}_isComputationValid(e,t){return this._parametersPerComputation.has(e)&&this._parametersPerComputation.get(e)===t}_invalidateComputation(e){this._parametersPerComputation.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(const t of this._computations)this._isComputationValid(t,e)||(t.clearResult(),this._parametersPerComputation.delete(t))}_clearResults(){for(const e of this._computations)e.clearResult(),this._parametersPerComputation.delete(e)}};a([u({constructOnly:!0})],g.prototype,"analysis",void 0),a([u({constructOnly:!0})],g.prototype,"analysisViewData",void 0),a([u({constructOnly:!0})],g.prototype,"computationFactory",void 0),a([u({constructOnly:!0})],g.prototype,"view",void 0),a([u()],g.prototype,"error",void 0),a([u({readOnly:!0})],g.prototype,"effectiveDisplayUnits",null),a([u()],g.prototype,"progress",null),a([u()],g.prototype,"updating",null),a([u()],g.prototype,"results",null),a([u()],g.prototype,"statistics",null),a([u()],g.prototype,"hoveredPoints",null),a([u()],g.prototype,"_updateTask",void 0),a([u()],g.prototype,"_queue",void 0),a([u()],g.prototype,"_tileCache",null),a([u()],g.prototype,"_computationsCollection",void 0),a([u()],g.prototype,"_computations",null),a([u()],g.prototype,"_activeComputations",null),a([u({readOnly:!0})],g.prototype,"_minDemResolution",null),a([u()],g.prototype,"_minDemResolutions",null),a([u()],g.prototype,"_updateParameters",null),a([u()],g.prototype,"_generationParameters",null),a([u()],g.prototype,"elevationInfo",null),a([u()],g.prototype,"_options",null),g=a([E("esri.views.analysis.ElevationProfile.ElevationProfileController")],g);const Mi=new ge({...Lt});function Ti(e,t){if(e==null||t==null)return null;const{samples:i,spatialReference:s}=e,{distance:n,elevation:o}=t,r=j(s),l=Y(s),p=i.length,c=new Array(p);for(let h=0;h<p;++h){const d=i[h],m=d.sampledZ,v=d.coordinate;c[h]={x:v[0],y:v[1],z:m,distance:et(d.distance,r,n),elevation:B(m,l,o)}}return c}function zi(e,t){if(e==null||t==null||e.statistics==null||e.spatialReference==null)return null;const{distance:i,elevation:s}=t,{statistics:n,spatialReference:o}=e,r=j(o),l=Y(o);return{maxDistance:et(n.maxDistance,r,i),minElevation:B(n.minElevation,l,s),maxElevation:B(n.maxElevation,l,s),avgElevation:B(n.avgElevation,l,s),elevationGain:B(n.elevationGain,l,s),elevationLoss:B(n.elevationLoss,l,s),maxPositiveSlope:n.maxPositiveSlope,maxNegativeSlope:n.maxNegativeSlope,avgPositiveSlope:n.avgPositiveSlope,avgNegativeSlope:n.avgNegativeSlope}}function et(e,t,i){return e==null?null:ae(e*t,"meters",i)}function B(e,t,i){return e==null?null:ae(e*t,"meters",i)}let x=class extends _t{constructor(e){super(e),this._getSamplesMemoized=ke((t,i)=>Ti(t,i)),this._getStatisticsMemoized=ke((t,i)=>zi(t,i)),this.rawResult=null}get available(){const{computation:e}=this;return e.profile.enabled&&e.available}get profile(){return this.computation.profile}get progress(){return Ke(this.rawResult!=null&&this.computation.profile.enabled?this.rawResult.progress:0)}get samples(){return this._getSamplesMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get statistics(){return this._getStatisticsMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get hoveredPoint(){if(!this.computation.profile.enabled)return null;const e=this.computation.controller.analysisViewData.hoveredPosition;if(e==null)return null;const{rawResult:t,samples:i}=this;if(i==null||t==null)return null;const s=i.length;if(s===0)return null;const n=i[s-1].distance,o=Ii(i,e*n,c=>c.distance);if(o==null)return null;const{x:r,y:l,z:p}=o;return p==null?null:new wt({x:r,y:l,z:p,spatialReference:t.spatialReference})}};a([u()],x.prototype,"available",null),a([u({readOnly:!0})],x.prototype,"profile",null),a([u({readOnly:!0})],x.prototype,"progress",null),a([u()],x.prototype,"samples",null),a([u()],x.prototype,"statistics",null),a([u({constructOnly:!0})],x.prototype,"computation",void 0),a([u()],x.prototype,"rawResult",void 0),a([u()],x.prototype,"hoveredPoint",null),x=a([E("esri.views.analysis.ElevationProfile.ElevationProfileResult")],x);let S=class extends ${constructor(e){super(e),this.result=new x({computation:this}),this.numSamplesForPreview=30,this.numSamplesPerChunk=200}initialize(){this.addHandles([P(()=>{const{geometry:e,elevationInfo:t}=this.controller.analysis;return[e,t]},()=>this.onInvalidate(this),ye)])}setResult(e){this.result.rawResult=e}clearResult(){this.setResult(null)}get progress(){return this.result.progress}get hoveredPoint(){return this.result.hoveredPoint}get available(){return!0}get minDemResolution(){return Z().defaultDemResolution}};a([u({constructOnly:!0})],S.prototype,"controller",void 0),a([u({constructOnly:!0})],S.prototype,"profile",void 0),a([u({constructOnly:!0})],S.prototype,"onInvalidate",void 0),a([u()],S.prototype,"result",void 0),a([u({readOnly:!0})],S.prototype,"progress",null),a([u()],S.prototype,"hoveredPoint",null),a([u()],S.prototype,"available",null),a([u()],S.prototype,"numSamplesForPreview",void 0),a([u()],S.prototype,"numSamplesPerChunk",void 0),a([u({readOnly:!0})],S.prototype,"minDemResolution",null),S=a([E("esri.views.analysis.ElevationProfile.ElevationProfileLineComputation")],S);function tt(e){var s;if(e==null)return null;if(Nt(e))return it(e);const t=e.tileInfo;if(t==null)return null;const i=(s=t.lods)==null?void 0:s.at(-1);return i==null?null:i.resolution*j(t.spatialReference)}function it(e){if(e==null)return null;const t=e.layers.items.map(Li).filter(ve);return Te(t)??null}function Li(e){return e&&"tileInfo"in e?tt(e):null}let N=class extends S{constructor(){super(...arguments),this.type="ground",this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getStableQueryElevationDependencies=C(()=>({ground:this._ground,groundLayers:this._getStableGroundLayers()}),q),this._getStableGroundLayers=C(()=>{var e,t;return(t=(e=this._ground)==null?void 0:e.layers)==null?void 0:t.toArray()},q)}get minDemResolution(){return it(this._ground)}get available(){var e;return((e=this._ground)==null?void 0:e.layers.some(t=>t.visible))===!0}initialize(){this.addHandles([P(()=>this._queryElevationDependencies,()=>this.onInvalidate(this))])}async queryElevation(e,t){const i=this._queryElevationDependencies;if(i==null)throw new Error(`${this.declaredClass}: no dependencies`);const{ground:s}=i;if(s==null)throw new Error("No ground configured in the view");const n=await s.queryElevation(e,t),o=Y(e.spatialReference),r=Y(s.layers.at(0).spatialReference);if(o!==r){const l=n.geometry;l.points=l.points.map(([p,c,h])=>[p,c,h===t.noDataValue?h:h*r/o])}return n}get _queryElevationDependencies(){return this._getStableQueryElevationDependencies()}get _ground(){var e,t;return(t=(e=this.controller.view)==null?void 0:e.map)==null?void 0:t.ground}};a([u()],N.prototype,"minDemResolution",null),a([u()],N.prototype,"available",null),a([u()],N.prototype,"_queryElevationDependencies",null),a([u()],N.prototype,"_ground",null),N=a([E("esri.views.analysis.ElevationProfile.ElevationProfileLineGroundComputation")],N);function Ai(e){var t,i;return((i=(t=e==null?void 0:e.map)==null?void 0:t.allLayers)==null?void 0:i.toArray().filter(s=>(s.type!=="graphics"||!s.internal)&&s.visible).map(s=>s.uid))??[]}let re=class extends S{constructor(){super(...arguments),this.type="input",this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this._getStableElevationDependencies=C(()=>{const{view:e}=this.controller;if(!e)return null;const t=this._getStableElevationInfo();return{view:e,stationary:!this._requiresElevationAlignment||e.stationary,elevationInfo:t,visibleLayerIds:this._getStableLayerIds(),spatialReference:this._getStableSpatialReference()}},q),this._getStableElevationInfo=C(()=>this.controller.elevationInfo,ce),this._getStableSpatialReference=C(()=>{var e;return(e=this.controller.view)==null?void 0:e.spatialReference},ce),this._getStableLayerIds=C(()=>{const{view:e}=this.controller;return e.type!=="3d"?[]:Ai(e)},q)}initialize(){const e=()=>this.onInvalidate(this);this.addHandles([P(()=>this._queryElevationDependencies,e,ye),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:t,signal:i}){const s=this._queryElevationDependencies;if(s==null)throw new Error(`${this.declaredClass}: no dependencies`);const{view:n,spatialReference:o}=s;if(this._requiresElevationAlignment&&n.type==="3d"&&o){const r=await jt.fromGeometry(e).project(o,i);if(!r)return{geometry:e,noDataValue:t};const l=n.elevationProvider;return r.coordinates.forEach(p=>{p.z=l.getElevation(p.x,p.y,0,o,"ground")??0}),{geometry:r.export(),noDataValue:t}}return{geometry:e,noDataValue:t}}get _requiresElevationAlignment(){var e;return((e=this.controller.elevationInfo)==null?void 0:e.mode)==="on-the-ground"&&this.controller.view.type==="3d"}get _queryElevationDependencies(){return this._getStableElevationDependencies()}};a([u()],re.prototype,"_queryElevationDependencies",null),re=a([E("esri.views.analysis.ElevationProfile.ElevationProfileLineInputComputation")],re);let te=class extends S{constructor(){super(...arguments),this.type="query",this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return tt(this.profile.source)}get available(){const{source:e}=this.profile;return!!e&&(e.visible==null||e.visible)&&(e.layers==null||e.layers.some(t=>t.visible))}initialize(){this.addHandles(P(()=>this.profile.source,()=>this.onInvalidate(this),ye))}queryElevation(e,t){if(!this.profile.source)throw new Error("No source configured for the elevation profile line");return this.profile.source.queryElevation(e,t)}};a([u({readOnly:!0})],te.prototype,"minDemResolution",null),a([u()],te.prototype,"available",null),te=a([E("esri.views.analysis.ElevationProfile.ElevationProfileLineQueryComputation")],te);class Ui{constructor(){this._currentOperationSignal=Wt(null)}get currentOperationType(){var t;return((t=this._currentOperationSignal.value)==null?void 0:t.type)??null}destroy(){this.stop()}async start(t,i,s){const n=this._currentOperationSignal.value;n==null||n.stop();const o=new AbortController,r=s==null?void 0:s.signal,l=AbortSignal.any([o.signal,r].filter(ve)),p=dt();let c=!1;const h=()=>{c||(c=!0,p.reject(St()))},d={type:t,resolve:m=>{c||(c=!0,p.resolve(m))},reject:h,promise:p.promise,stop:()=>o.abort(),handles:[]};this._currentOperationSignal.value=d,d.handles.push(Se(r,()=>{o.abort()}),Se(l,()=>{Pe(d.handles),c||h()}));try{return n&&(await n.promise.catch(()=>{}),R(l)),await i(d,l),await p.promise}finally{Pe(d.handles),this._currentOperationSignal.value===d&&(this._currentOperationSignal.value=null)}}stop(){var t;(t=this._currentOperationSignal.value)==null||t.stop()}}let D=class extends ${constructor(e){super(e),this._sketchViewModels=new ze,this._updatingHandles=new Qt,this._operationManager=new Ui}initialize(){const{view:e}=this;this._graphicsLayer=new He({listMode:"hide",internal:!0}),this.addHandles([P(()=>({map:e.map,internalGraphicsLayer:this._graphicsLayer,state:this.state,geometryVisualizationVisible:this._analysis.viewOptions.geometryVisualizationVisible,visible:this.analysisViewData.visible}),({map:t,internalGraphicsLayer:i,state:s,geometryVisualizationVisible:n,visible:o})=>{Zi(t,i);const r=this.sketchGraphic;switch(r&&(r.visible=o),s){case"idle":case"reshaping-disabled":r&&!n&&(r.visible=!1),this._operationManager.stop(),this._ensureUpdatedSketchGraphic();break;case"reshaping":ue(this._startReshape());break;case"awaiting-sketch":this.analysisViewData.interactive=!0}},V),P(()=>this._analysis.elevationInfo,t=>{this._graphicsLayer.elevationInfo=t},V)])}destroy(){var t;this._operationManager.destroy(),this._sketchViewModels.drain(i=>ne(i));const e=this._graphicsLayer;(t=this.view.map)==null||t.remove(e),e.destroy()}get sketchGraphic(){return this._get("sketchGraphic")}set sketchGraphic(e){e!==this._get("sketchGraphic")&&(this._set("sketchGraphic",e),this._updateAnalysisFromSketchGraphic())}get state(){const{visible:e,interactive:t}=this.analysisViewData;if(!e)return"idle";switch(this._operationManager.currentOperationType){case"place":return this._sketching?"sketching":"awaiting-sketch";case"pick-feature":return"picking";default:return this._analysis.geometry?t?"reshaping":"reshaping-disabled":"idle"}}get updating(){return this._sketchViewModels.some(e=>e.updating)||this._updatingHandles.updating}get _sketching(){return this._sketchViewModels.some(e=>e.createGraphic===this.sketchGraphic)}get _analysis(){return this.analysisViewData.analysis}get _lineSymbol(){return qi(this.view.type)}place(e){return this._operationManager.start("place",async t=>{const i=this._createSketchViewModel(),s=this._analysis.clone();this._ensureUpdatedSketchGraphic();const n=this.sketchGraphic,o=this._analysis.elevationInfo,r=J(()=>{this.sketchGraphic===n&&(this._graphicsLayer.elevationInfo=o)}),l=i.on("create",p=>{switch(p.state){case"start":this._graphicsLayer.removeAll(),this.sketchGraphic=p.graphic,this._analysis.elevationInfo=this._graphicsLayer.elevationInfo;break;case"active":this._updateAnalysisFromSketchGraphic();break;case"complete":this.sketchGraphic&&(this._updateAnalysisFromSketchGraphic(),this._addSketchGraphic(this.sketchGraphic)),t.stop();break;case"cancel":t.stop()}});t.handles.push(l,J(()=>(l.remove(),i.destroy(),this._sketchViewModels.remove(i),this._updateAnalysisFromSketchGraphic(),this._analysis.valid?at(e)||s.equals(this._analysis)?t.reject():void t.resolve({}):(this._clear(),t.reject()))),r),this._graphicsLayer.elevationInfo=$i,await this._updatingHandles.addPromise(ue(i.create("polyline")))},e)}async pickFeature(e){return this._operationManager.start("pick-feature",async t=>{const{view:i}=this;i.closePopup();let s=null;const n=r=>{r.defer(async()=>{s==null||s.abort(),s=Fe(async l=>{const{results:p}=await i.hitTest(r);R(l);let c=null;for(const h of p)if(h.type==="graphic"&&ai(h.graphic)&&!ui(h.graphic)){c=h.graphic;break}c?(r.preventDefault(),r.stopPropagation(),this.sketchGraphic=null,this._analysis.geometry=c.geometry,this._analysis.elevationInfo=new ge({...Tt(c)}),t.resolve({feature:c}),t.stop()):t.reject()}),await s.promise})},o=r=>{Xt(r)&&(t.reject(),t.stop())};t.handles.push(i.on("immediate-click",n,xe.TOOL),i.on("key-down",o,xe.TOOL),i.acquireCursor("crosshair","high"),J(()=>{s==null||s.abort(),t.reject()})),i.focus()},e)}_startReshape(){const e=this._createSketchViewModel();return this._sketchViewModels.add(e),this._operationManager.start("reshape",async t=>{const i=()=>{const n=this._ensureUpdatedSketchGraphic();return n?this._updatingHandles.addPromise(e.update(n,{tool:"reshape"})):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;const s=e.on("update",n=>{this._updateAnalysisFromSketchGraphic(),n.state==="complete"&&(this.state==="reshaping"?ue(i()):t.resolve())});t.handles.push(s,J(()=>{s.remove(),this._sketchViewModels.remove(e),e.destroy(),t.resolve()})),await i()})}_createSketchViewModel(){return new Bt({layer:this._graphicsLayer,view:this.view,defaultCreateOptions:{mode:"click",hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{shapeOperation:"none"},toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:this._lineSymbol,activeLineSymbol:this._lineSymbol})}_ensureUpdatedSketchGraphic(){const{geometry:e}=this._analysis;if(!e)return this.sketchGraphic=null,this._graphicsLayer.removeAll(),null;const t=this.sketchGraphic??(this.sketchGraphic=new Le({symbol:this._lineSymbol,geometry:e}));return t.geometry=e,this._addSketchGraphic(t),t}_addSketchGraphic(e){const{graphics:t}=this._graphicsLayer;t.includes(e)||t.add(e),t.length!==1&&t.removeMany(t.filter(i=>i!==e))}_clear(){this.sketchGraphic=null,this._analysis.clear()}_updateAnalysisFromSketchGraphic(){var i;let e=(i=this.sketchGraphic)==null?void 0:i.geometry;_e(e)||(e=null);const t=this._analysis;t.geometry!==e&&(t.geometry=e)}};function qi(e){if(e==="2d"){const t={type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5};return new Ae({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{...t,effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],color:[0,0,0,255]},{...t,color:[255,255,255,255]}]}}})}return new mt({color:[0,0,0,0]})}function Zi(e,t){t&&(t.removeFromParent(),e==null||e.add(t))}a([u({constructOnly:!0})],D.prototype,"analysisViewData",void 0),a([u({constructOnly:!0})],D.prototype,"view",void 0),a([u()],D.prototype,"sketchGraphic",null),a([u({nonNullable:!0})],D.prototype,"state",null),a([u()],D.prototype,"updating",null),a([u()],D.prototype,"_sketching",null),a([u()],D.prototype,"_analysis",null),a([u()],D.prototype,"_lineSymbol",null),D=a([E("esri.views.analysis.ElevationProfile.ElevationProfileTool")],D);const $i=new ge({mode:"on-the-ground",offset:0});let b=class extends de{constructor(e){super(e),this.type="elevation-profile-view-2d",this.analysis=null,this.hoveredPosition=null}initialize(){const{analysis:e,view:t}=this;this._controller=new g({analysis:e,analysisViewData:this,view:t,computationFactory:{create:i=>{switch(i.profile.type){case"ground":return new N(i);case"input":return new re(i);case"query":return new te(i);case"scene":throw new Me("elevation-profile-analysis-view-2d:unsupported","The scene profile line type is not supported in 2D views.")}}}}),this._visualization=new X({view:t,analysisViewData:this}),this._sketchTool=new D({view:t,analysisViewData:this})}destroy(){var e,t,i;(e=this._controller)==null||e.destroy(),(t=this._visualization)==null||t.destroy(),(i=this._sketchTool)==null||i.destroy()}get effectiveDisplayUnits(){var e;return((e=this._controller)==null?void 0:e.effectiveDisplayUnits)??{distance:"meters",elevation:"meters"}}get error(){var e;return(e=this._controller)==null?void 0:e.error}get hoveredPoints(){var e;return((e=this._controller)==null?void 0:e.hoveredPoints)??[]}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get progress(){var e;return((e=this._controller)==null?void 0:e.progress)??0}get results(){var e;return((e=this._controller)==null?void 0:e.results)??[]}get statistics(){var e;return(e=this._controller)==null?void 0:e.statistics}get updating(){var e,t,i;return((e=this._controller)==null?void 0:e.updating)===!0||((t=this._visualization)==null?void 0:t.updating)===!0||((i=this._sketchTool)==null?void 0:i.updating)===!0}get visible(){return super.visible}set visible(e){super.visible=e}get sketchGraphic(){var e;return(e=this._sketchTool)==null?void 0:e.sketchGraphic}get toolState(){var e;return((e=this._sketchTool)==null?void 0:e.state)??"idle"}place(e){return this._sketchTool.place(e)}pickFeature(e){return this._sketchTool.pickFeature(e)}};a([u({readOnly:!0})],b.prototype,"type",void 0),a([u({constructOnly:!0,nonNullable:!0})],b.prototype,"analysis",void 0),a([u({readOnly:!0})],b.prototype,"effectiveDisplayUnits",null),a([u({readOnly:!0})],b.prototype,"error",null),a([u()],b.prototype,"hoveredPosition",void 0),a([u()],b.prototype,"hoveredPoints",null),a([u({readOnly:!0})],b.prototype,"progress",null),a([u({readOnly:!0})],b.prototype,"results",null),a([u({readOnly:!0})],b.prototype,"statistics",null),a([u({readOnly:!0})],b.prototype,"updating",null),a([u()],b.prototype,"sketchGraphic",null),a([u()],b.prototype,"toolState",null),a([u()],b.prototype,"_controller",void 0),a([u()],b.prototype,"_visualization",void 0),a([u()],b.prototype,"_sketchTool",void 0),b=a([E("esri.views.2d.analysis.ElevationProfileAnalysisView2D")],b);const Yn=b;export{Yn as default};
