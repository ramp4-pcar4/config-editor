const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ImageMaterial.glsl-4GA395N2-xM94ZX-O.js","./index-aQr1pzMk.js","./index-BQSptJp9.css","./colorUtils-Eg6lOlXm-VkhrseNv.js","./vec42-D8CJyqHG-DnfLTeQH.js","./common-CYWrYyJl-E8-sukrT.js","./vec4f64-DD-nkcCV-CSNWKRqG.js","./vec32-Cj8pVsU0-rAn6oDuj.js","./elevationInfoUtils-Ccn2Wfoe-7Qv8vGZC.js","./ElevationInfo-DE5to86a-Dif5vpxY.js","./lengthUtils-C61nRlXw-CzVJi303.js","./SketchViewModel-B0qFHK0t-BTuGEowy.js","./UpdatingHandles-Bd2FQ26N-D0o90byg.js","./projectionUtils-B-CplN3q-BbhRJk9h.js","./GraphicsLayer-BiEC2-gS-f2Q6Nh51.js","./GraphicsCollection-uWAVmks7-KvlwAqnq.js","./Layer-DvVVmz9x-DXcwhpQA.js","./TimeExtent-Cf2Pienb-BYO88qJi.js","./BlendLayer-DjW_5k0v-CSXvsFcj.js","./layerContainerType-ChWdCT09-G5sdAsSy.js","./jsonUtils-BwLwuQj7-Bl4H4NPY.js","./parser-CWccHtwJ-BmmlC3EC.js","./mat4f32-BdRMyjXW-CWt6U0BP.js","./mat4-OOmHNWi7-DHX-Tx_w.js","./ScaleRangeLayer-x42fwED3-BqbNZfS1.js","./editableLayers-DFUBlMJy-DC6mxTZ5.js","./utils-Dd8gTonD-DroETE_5.js","./Queue-DV3gpSdl-DdymP2a7.js","./Version-CnwD6MZa-DfTCvK9g.js","./Cyclical-DgD7_U1C-BgcrDUEq.js","./quantityUtils-B1Ov7DZK-DnKxWiam.js","./vec2-BnynUbeJ-CKtGJQAy.js","./vec2f64-CkowXrDb-3zFQ3LNH.js","./projectVectorToVector-DcyiGOWJ-BAdltgHe.js","./projectPointToVector-BZJhoF_5-D8QAojxL.js","./geodesicUtils-DKS2UG72-CeOPBgTk.js","./asyncUtils-BPUlNCrX-CgQ-bqnN.js","./Query-n1aoaaFC-B-POeiNR.js","./Field-BIQ-quF4-BtlvGEij.js","./fieldType-PhcL4ff8-x0uMaf6W.js","./plane-Cf3Koz3c-CMtlASO9.js","./vectorStacks-5ZZtmT9E-Bv7Sf72y.js","./mat3f64-BnNZDR5l-Bz3OL2oI.js","./mat4f64-xsZDPPj0-Dq35B4BL.js","./quatf64-C16JxGFv-BKWK1F8U.js","./sphere-zPMQWhGG-C75YL2Lm.js","./mat3-DOnW3DjW-C3hbW9XY.js","./geodeticLengthOperator-DHGBHzf3-DNCLtrqI.js","./geodeticCurveType-D_etKnbP-CirnHLSB.js","./earcut-C6NeZYSh-Da0ULCQ5.js","./triangle-BM89wdHY-SwW9lpY9.js","./lineSegment-BAWQVP9P-ZXi9xCTQ.js","./spatialReferenceEllipsoidUtils-BK0OQJn2-CMEt8kso.js","./intl-BAA1onnp-ubjHiDMN.js","./SketchTooltipInfo-CkyYTifq-BSv201ZI.js","./MeshTransform-ByFk-Izc-DTlSS00a.js","./quat-DQgq9Ar5-NhE9rfpI.js","./axisAngleDegrees-BTSCyz4U-qoidsW1f.js","./meshVertexSpaceUtils-CCr86FVF-hh4hgaxp.js","./MeshLocalVertexSpace-Cfxtmv6L-CoMZ3E57.js","./modeUtils-deizL-Tg-C4WiXKJs.js","./jsxFactory-Cua8zWVZ-CthLb4jb.js","./uuid-Dj9mdEVg-BaKSCiyT.js","./sanitizerUtils-B1yRmbO2-B7KG_jBT.js","./a11yUtils-CoCwThtH-CLYp1_Ta.js","./memoize-DvEt8OkT-Cy_RrfpZ.js","./unitFormatUtils-FAypDaT5-CYycS-OR.js","./ByteSizeUnit-DL8UhsB0-B2-AmVRx.js","./index-kib5quT9-OnnceJ8y.js","./draw-store-DnCf4IRI-BY4bSfym.js","./layerViewUtils-DLIaYA64-D47NUDfp.js","./drapedUtils-DARF9dbf-Bqd8pPG3.js","./utils-C0LvbFCo-RMQaTNpt.js","./widget-p2YDjs4S-CMTLwXqb.js","./substitute-B3zxyWVi-BDGmS5en.js","./TextOverlayItem-BwTcOTWP-CbblMoD7.js","./Octree-B7mLL9lS-kztt5tBX.js","./BufferView-wDxx79o3-D8R28W3_.js","./RibbonLine.glsl-B_euRL9h-CQVYWaCg.js","./ViewingMode-CdRKcXnc-Dab70bGf.js","./orientedBoundingBox-CSC169JG-BF6mXzhD.js","./computeTranslationToOriginAndRotation-e-ft1lOz-C1q1aB8Y.js","./OutputColorHighlightOID.glsl-BdXTjs7_-R7GlIF37.js","./videoUtils-Scb4DgCQ-Vzn3MsOL.js","./requestImageUtils-B2YN5Eb9-BmiLuyLo.js","./basicInterfaces-Dsf65ICa-DkQ9Rsnx.js","./TextureFormat-Cl0ugX3E-DD0Aw8RG.js","./enums-wEDHPbCF-Cf76M5_x.js","./Texture-D5XWO2GQ-BXUlOZm_.js","./getDataTypeBytes-DYbftOSj-BNZIboqJ.js","./Indices-BuIC5D20-BT27t1nX.js","./VertexAttribute-hUz6pozM-Bx3V-z96.js","./glsl-Z5uYj8ka-BRgh2Cgo.js","./BindType-CKbZk6AG-Bqvzo9NX.js","./ShaderOutput-CUn9tpiG-CW1Nc608.js","./renderState-BM-MCKUz-CkGIEsl7.js","./boundedPlane-QDtjx5eO-Dx-oLj9s.js","./InterleavedLayout-C2YUDwKf-CN2iW08X.js","./types-l27bT09Q-DE0QfIFp.js","./dehydratedFeatureUtils-OR1UjA48-D8UMhs__.js","./hydratedFeatures-oobA80ei-BknNjAAw.js","./vec3f32-GX_cKsFD-UJPpzdNc.js","./floatRGBA-DRFmbkvz-Bbcow0tp.js","./ShaderBuilder-CU5v4tk1-DHAl0wxg.js","./glUtil-0ZzWJjlL-C5xhkIWX.js","./VertexElementDescriptor-DLvjNrmQ-BHK9ksow.js","./VertexArrayObject-CieliEx4-DxoAtrrq.js","./memoryEstimations-DeWfxwaV-BEOBMvAl.js","./HUDMaterial.glsl-9ciK4G-4-DYArvtf1.js","./TooltipInfoWithCoordinates-Xxefy9Or-CSYZony3.js","./PointSnappingHint-OKXicQ1z-xbpjqpQD.js","./SelectedVertexTooltipInfo-4SubR9ql-8AMTJymW.js","./editPlaneUtils-DmK-4boe-w6XUGa7-.js","./drawSurfaces-DQUGW1oK-Cyv0sdGJ.js","./distanceOperator-CZDvZf3O-BYcwkajk.js","./Point2D-CaHJVGk1-JqvJXjLr.js","./ProjectionTransformation-DQ4GElxa-B-5LitAV.js","./Envelope2D-DlBzXkgv-eKRxGysX.js","./Transformation2D-CXWnDKXs-bixc63yn.js","./SimpleGeometryCursor-DSF_YyIm-TAMgMsbK.js","./OperatorDefinitions-DJdq_wrt-DP7_WWTp.js","./apiConverter-CSuukuP9-B33Twu7m.js","./jsonConverter-tsQ40CV0-Ds3ts1sY.js","./simplifyOperator-BW9Vrh-l-DM_7k28J.js","./operatorSimplify-CjcRb60U-ChP9ia2B.js","./mat2d-BQA-1WB--Pnyy0dhf.js","./mat2df64-DDXwUeaJ-Tu7q-7Mk.js","./ReactiveSet-CRNikQMW-DFxcU30x.js","./diffUtils-BxG8DCnW-D9r0MZld.js","./SnappingContext-OY7xJ98b-DU9m8U_i.js","./Scheduler-BV4C4cVP-Zy2poEKN.js","./debugFlags-8tOwPnHK-DspbDTNZ.js","./IntersectorType-D6ZupXNg-DQZQEhlR.js","./TranslateTooltipInfo-A8pO5CNj-Dl1zYlQB.js","./utils-Cb2uXNfG-BRHzJTey.js","./cimSymbolUtils-DCedSSCN-Dgta8Y1z.js","./utils-BfXZnjCE-CI1-4GRM.js","./defaultCIMValues-BcSaJjm--58G-soMN.js","./enums-a_LDTPYU-CBIcy3mM.js","./LRUCache-DPWdPNTF-BhV6gJVw.js","./MemCache-qDGoejB7-Bz_y0gIH.js","./IViewEvents-BE10MM98-CvMfjolG.js","./ExtentScaleTooltipInfo-BgG7HiRF-DqyGNaNm.js","./GraphicManipulator-D_ewLKOT-BMGhSXb7.js","./triangulationUtils--8_1p-hL-Cf4PkwK_.js","./deduplicate-DRKoZSEv-D58tPUB5.js","./NestedMap-DL9KstBd-DzPVXgde.js"])))=>i.map(i=>d[i]);
import{v as u,bf as Ae,S as b,dh as Ye,X as Fe,n as B,gL as Ie,a1 as _e,a2 as bt,P as Ee,ki as Je,d7 as Zr,K as ei,aj as zt,a3 as ti,kl as ri,aP as Ce,e4 as ct,b9 as Qe,lM as Ut,kN as ii,_ as re,a6 as si,aE as ai,an as ni,J as Pr,du as Me,bc as oi,gU as li,gt as hi,kb as Ir,gH as ci,lb as Wt,ac as ui,c5 as ut,ci as di}from"./index-aQr1pzMk.js";import{f as gi,W as pi,N as qt,B as wt,z as _i,b as mi,k as fi,J as $t}from"./mat4-OOmHNWi7-DHX-Tx_w.js";import{u as K,n as H}from"./mat4f64-xsZDPPj0-Dq35B4BL.js";import{A as Er,R as vi,_ as $,O as yi,Y as Ar,v as xi,l as bi,L as wi,b as Ci,r as Ti}from"./vec32-Cj8pVsU0-rAn6oDuj.js";import{S as Oi,U as Ri,z as Di}from"./sphere-zPMQWhGG-C75YL2Lm.js";import{V as Si}from"./plane-Cf3Koz3c-CMtlASO9.js";import{o as Pt,m as Pi,I as Ii}from"./vec4f64-DD-nkcCV-CSNWKRqG.js";import{e as ie}from"./InterleavedLayout-C2YUDwKf-CN2iW08X.js";import{o as O,f as dt,e as Gt,t as Ei,h as Fr}from"./ShaderOutput-CUn9tpiG-CW1Nc608.js";import{Y as Se,p as A,aI as Le,a6 as It,h as Ze,am as Ai,a9 as Mr,ax as at,O as Lr,bb as Nr,a8 as Fi,aV as Mi,J as Li,ag as Ni,aj as Hi,d as Vi,f as zi,ak as Ui,al as Wi,r as qi,_ as $i,U as Gi,D as Et,ac as ji,ad as gt,ae as U,bc as Bi,A as M,m as At,bd as ki,u as pt,K as Yi,s as Qi,z as Xi,I as Hr,a1 as se,a2 as ae,be as Ki,bf as Ji,aE as Zi,x as es,aH as ts,aX as rs,b3 as is,M as ss,L as as,j as ns,bg as _t,w as os,aF as jt,aK as ls,aL as hs,aM as cs,aN as us,a4 as ds,aO as gs,aP as ps,aQ as _s,aR as ms,a as Pe,ap as fs,ao as vs,G as Bt,au as kt,aU as Yt}from"./OutputColorHighlightOID.glsl-BdXTjs7_-R7GlIF37.js";import{e as Ft,O as Xe}from"./basicInterfaces-Dsf65ICa-DkQ9Rsnx.js";import{T as _}from"./VertexAttribute-hUz6pozM-Bx3V-z96.js";import{e as C}from"./glsl-Z5uYj8ka-BRgh2Cgo.js";import{v as ne}from"./ShaderBuilder-CU5v4tk1-DHAl0wxg.js";import{K as Z,C as Vr,m as ee,y as ys}from"./renderState-BM-MCKUz-CkGIEsl7.js";import{m as V,B as xs,b as Y,v as me,A as Te,M as Qt,i as fe,P as D,_ as bs,j as Xt,d as ws}from"./vec2-BnynUbeJ-CKtGJQAy.js";import{o as y}from"./vec2f64-CkowXrDb-3zFQ3LNH.js";import{h as Cs,o as Ts}from"./projectionUtils-B-CplN3q-BbhRJk9h.js";import{s as Os}from"./Indices-BuIC5D20-BT27t1nX.js";import{o as zr}from"./ViewingMode-CdRKcXnc-Dab70bGf.js";import{M as k}from"./orientedBoundingBox-CSC169JG-BF6mXzhD.js";import{I as et,N as Ur}from"./triangulationUtils--8_1p-hL-Cf4PkwK_.js";import{g as nt,j as Rs,D as Ds,f as ze,v as Kt,a as Ss,m as Ps,z as Is}from"./RibbonLine.glsl-B_euRL9h-CQVYWaCg.js";import{n as Mt}from"./BindType-CKbZk6AG-Bqvzo9NX.js";import{o as Es,l as Jt,F as Zt}from"./axisAngleDegrees-BTSCyz4U-qoidsW1f.js";import{u as As}from"./utils-Dd8gTonD-DroETE_5.js";import{D as X,F as Fs,G as Wr,R as te,f as er,T as Ms,M as Ls,j as Ue}from"./enums-wEDHPbCF-Cf76M5_x.js";import{c as oe}from"./VertexElementDescriptor-DLvjNrmQ-BHK9ksow.js";import{u as tr,F as Ns}from"./VertexArrayObject-CieliEx4-DxoAtrrq.js";import{Y as qr,_ as Lt}from"./Texture-D5XWO2GQ-BXUlOZm_.js";import{u as Hs}from"./NestedMap-DL9KstBd-DzPVXgde.js";import{c as ve,f as Vs,l as le,i as We}from"./BufferView-wDxx79o3-D8R28W3_.js";import{c as zs}from"./dehydratedFeatureUtils-OR1UjA48-D8UMhs__.js";import{n as Us}from"./mat3f64-BnNZDR5l-Bz3OL2oI.js";import{y as rr,D as Ws}from"./vec42-D8CJyqHG-DnfLTeQH.js";import{r as qs,m as $s}from"./Scheduler-BV4C4cVP-Zy2poEKN.js";var ir,sr;(function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"})(ir||(ir={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(sr||(sr={}));let Gs=class extends Ns{};var j,ar,nr;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(j||(j={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(ar||(ar={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(nr||(nr={}));let or=class{constructor(){this._extent=Qe(),this.resolution=0,this.renderLocalOrigin=Ss(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new js}get extent(){return this._extent}setupGeometryViews(e){if(this._setupGeometryView(),!e)return;const t=.001*e.range;if(this._extent[0]-t<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Ut(this._extent,e.range,0,r)}if(this._extent[2]+t>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Ut(this._extent,-e.range,0,r)}}_setupGeometryView(){this.canvasGeometries.numViews=1,ii(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}},js=class{constructor(){this.extents=[Qe(),Qe(),Qe()],this.numViews=0}};var w;(function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(w||(w={}));let Bs=class{constructor(e,t,r){this._fbos=e,this._format=t,this._name=r}get valid(){var e;return((e=this._handle)==null?void 0:e.getTexture())!=null}dispose(){this._handle=Ee(this._handle)}get texture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}bind(e,t,r){var i,s,a,n;this._handle&&((i=this._handle.fbo)==null?void 0:i.width)===t&&((s=this._handle.fbo)==null?void 0:s.height)===r||((a=this._handle)==null||a.release(),this._handle=this._fbos.acquire(t,r,this._name,this._format)),e.bindFramebuffer((n=this._handle)==null?void 0:n.fbo)}generateMipMap(){var e,t,r,i,s;(r=(t=(e=this._handle)==null?void 0:e.getTexture())==null?void 0:t.descriptor)!=null&&r.hasMipmap&&((s=(i=this._handle)==null?void 0:i.getTexture())==null||s.generateMipmap())}},he=class{constructor(e,t,r,i,s=U.RGBA8UNORM_MIPMAP){this.output=r,this.content=i,this.fbo=new Bs(e,s,t)}get valid(){return this.fbo.valid}},ks=class{constructor(e){this.targets=[new he(e,"overlay color",O.Color,w.Color),new he(e,"overlay IM color",O.Color,w.ColorNoRasterImage),new he(e,"overlay highlight",O.Highlight,w.Highlight,U.RG8UINT),new he(e,"overlay water",O.Normal,w.WaterNormal),new he(e,"overlay occluded",O.Color,w.Occluded)],Hr()&&this.targets.push(new he(e,"overlay olid",O.ObjectAndLayerIdColor,w.ObjectAndLayerIdColor,U.RGBA8UNORM))}getTexture(e){var t;return(t=this.targets[e])==null?void 0:t.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,t,r)=>t.valid?e|=1<<r:e,0)}};var lr;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight",e[e.ViewshedShadowMap=3]="ViewshedShadowMap"})(lr||(lr={}));var G,tt;function Ys(e){return e!=null&&!e.running}(function(e){e[e.Idle=0]="Idle",e[e.Rendering=1]="Rendering",e[e.Ready=2]="Ready",e[e.Fading=3]="Fading"})(G||(G={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA",e[e.COUNT=2]="COUNT"}(tt||(tt={}));var Ct;let qe=Ct=class extends Fe{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new Ct({cloudCover:this.cloudCover})}};u([Ae({cloudy:"cloudy"}),b({json:{write:{isRequired:!0}}})],qe.prototype,"type",void 0),u([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qe.prototype,"cloudCover",void 0),qe=Ct=u([B("esri.views.3d.environment.CloudyWeather")],qe);var Tt;let $e=Tt=class extends Fe{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new Tt({fogStrength:this.fogStrength})}};u([Ae({foggy:"foggy"}),b({json:{write:{isRequired:!0}}})],$e.prototype,"type",void 0),u([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],$e.prototype,"fogStrength",void 0),$e=Tt=u([B("esri.views.3d.environment.FoggyWeather")],$e);var Ot;let Oe=Ot=class extends Fe{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Ot({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([Ae({rainy:"rainy"}),b({json:{write:{isRequired:!0}}})],Oe.prototype,"type",void 0),u([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Oe.prototype,"cloudCover",void 0),u([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Oe.prototype,"precipitation",void 0),Oe=Ot=u([B("esri.views.3d.environment.RainyWeather")],Oe);var Rt;let ce=Rt=class extends Fe{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Rt({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([Ae({snowy:"snowy"}),b({json:{write:{isRequired:!0}}})],ce.prototype,"type",void 0),u([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ce.prototype,"cloudCover",void 0),u([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ce.prototype,"precipitation",void 0),u([b({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],ce.prototype,"snowCover",void 0),ce=Rt=u([B("esri.views.3d.environment.SnowyWeather")],ce);var Dt;let Ge=Dt=class extends Fe{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new Dt({cloudCover:this.cloudCover})}};u([Ae({sunny:"sunny"}),b({json:{write:{isRequired:!0}}})],Ge.prototype,"type",void 0),u([b({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Ge.prototype,"cloudCover",void 0),Ge=Dt=u([B("esri.views.3d.environment.SunnyWeather")],Ge);const mt=1e4,Qs=1e5;class Xs{constructor(){this.startTime=0,this._data=ut(null),this.coverage=0,this.absorption=0,this._readChannels=tt.RG,this.parallax=new hr,this.parallaxNew=new hr,this._anchorPoint=Me(),this._fadeState=ut(m.HIDE),this._fadeFactor=ut(1)}get data(){return this._data.value}set data(t){this._data.value=t}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case m.HIDE:return 0;case m.FADE_OUT:return 1-this.fadeFactor;case m.FADE_IN:return this.fadeFactor;case m.SHOW:case m.CROSS_FADE:return 1}}fade(t,r,i){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=i?Pr((r-this.startTime)/(Js*i),0,1):1,this.fadeFactor===1&&this._endFade()),this._evaluateState(t,r),this._updateParallax(t)}_evaluateState(t,r){const i=t.relativeElevation,s=this._updateAnchorPoint(t);(i>1.7*mt||i<-1e4||s>ur)&&this.opacity>0?this._startFade(m.HIDE,r):this.isFading||(i>mt||i<-.35*mt||s>Zs*ur?this.opacity>0&&this._startFade(m.FADE_OUT,r):Ys(this.data)&&(this.opacity===0?this._startFade(m.FADE_IN,r):this.data.state===G.Ready&&(this.fadeState===m.SHOW?this._startFade(m.CROSS_FADE,r):this._startFade(m.SHOW,r))))}_updateParallax(t){const r=xi(t.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(r-Ye.radius*Ye.radius,0))/Math.sqrt(r),Jt(cr,this.parallax.anchorPoint,ue),$t(this.parallax.transform,K,ue[3],Zt(ue)),Jt(cr,this.parallaxNew.anchorPoint,ue),$t(this.parallaxNew.transform,K,ue[3],Zt(ue))}_updateAnchorPoint(t){var r;return bi(this._anchorPoint,t.eye),wi(this._anchorPoint,this._anchorPoint,Ye.radius),this.fadeState===m.HIDE&&((r=this.data)==null?void 0:r.state)===G.Ready?($(this.parallax.anchorPoint,this._anchorPoint),0):Ci(Ti(Ks,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(t,r){switch(this._fadeState.value=t,this.startTime=r,t){case m.CROSS_FADE:this.requestFade(),this._switchReadChannels(),$(this.parallaxNew.anchorPoint,this._anchorPoint);break;case m.FADE_IN:this.requestFade(),this._switchReadChannels(),$(this.parallax.anchorPoint,this._anchorPoint),$(this.parallaxNew.anchorPoint,this._anchorPoint);break;case m.FADE_OUT:this.requestFade();break;case m.SHOW:this._switchReadChannels(),$(this.parallax.anchorPoint,this._anchorPoint),$(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case m.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==G.Ready&&(this.data.state=G.Idle),this.fadeState){case m.CROSS_FADE:$(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=m.SHOW;break;case m.FADE_IN:this._fadeState.value=m.SHOW;break;case m.FADE_OUT:this._fadeState.value=m.HIDE;break;case m.SHOW:case m.HIDE:break;default:di(this.fadeState)}}_switchReadChannels(){var t;((t=this.data)==null?void 0:t.state)===G.Ready&&(this._readChannels=1-this._readChannels,this.data.state=G.Fading)}get isFading(){return this.fadeState===m.FADE_OUT||this.fadeState===m.FADE_IN||this.fadeState===m.CROSS_FADE}}var m;(function(e){e[e.HIDE=0]="HIDE",e[e.FADE_IN=1]="FADE_IN",e[e.SHOW=2]="SHOW",e[e.CROSS_FADE=3]="CROSS_FADE",e[e.FADE_OUT=4]="FADE_OUT"})(m||(m={}));let hr=class{constructor(){this.anchorPoint=Me(),this.radiusCurvatureCorrection=0,this.transform=H()}};const cr=Ie(0,0,1),ue=Es(),Ks=Me(),Js=1.25,Zs=.5,ur=2e5;function ea(e){e.fragment.uniforms.add(new Pe("cloudAbsorption",t=>t.clouds.absorption),new Pe("cloudCoverage",t=>t.clouds.coverage)).code.add(C`vec4 lookupCloudsFromTextureArray(sampler2DArray cubeMap, vec3 rayDir) {
int faceIndex;
vec2 uv;
if(rayDir.z <= 0.0) {
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudCoverage), abs(dot(rayDir, vec3(0, 0, 1))));
float shading = clamp(1.0 - cloudAbsorption, 0.6, 1.0) * (1.0 - hazeFactor);
float totalTransmittance = hazeFactor;
return vec4(shading, totalTransmittance, shading, totalTransmittance);
}
if (abs(rayDir.x) >= abs(rayDir.y) && abs(rayDir.x) >= abs(rayDir.z)) {
if(rayDir.x > 0.0) {
faceIndex = 0;
uv = rayDir.yz / rayDir.x;
uv = vec2(-uv.x, uv.y);
} else {
faceIndex = 1;
uv = rayDir.yz / rayDir.x;
uv = vec2(-uv.x, -uv.y);
}
} else if (abs(rayDir.y) >= abs(rayDir.x) && abs(rayDir.y) >= abs(rayDir.z)) {
if(rayDir.y > 0.0) {
faceIndex = 2;
uv = rayDir.xz / rayDir.y;
} else {
faceIndex = 3;
uv = rayDir.xz / rayDir.y;
uv = vec2(uv.x, -uv.y);
}
} else {
if(rayDir.y < 0.0) {
faceIndex = 4;
uv = rayDir.xy / rayDir.z;
uv = vec2(uv.x, -uv.y);
} else {
faceIndex = 5;
uv = rayDir.xy / rayDir.z;
uv = vec2(uv.x, -uv.y);
}
}
uv = 0.5 * (uv + 1.0);
if(faceIndex != 5) {
uv.y = uv.y - 0.5;
}
uv.y = uv.y * 2.0;
vec4 s = texture(cubeMap, vec3(uv, float(faceIndex)));
return s;
}`)}let ta=class extends Et{constructor(e,t){super(e,"sampler2DArray",Mt.Bind,(r,i)=>r.bindTexture(e,t(i)))}};function kn(e){const t=e.fragment;t.constants.add("radiusCloudsSquared","float",ra).code.add(C`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),t.uniforms.add(new Pe("radiusCurvatureCorrection",({clouds:i})=>i.parallax.radiusCurvatureCorrection)).code.add(C`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),t.code.add(C`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),fs(t),vs(t);const r=Ie(.28,.175,.035);t.constants.add("RIM_COLOR","vec3",r),t.code.add(C`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${C.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${C.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${C.float(.2)} * pow(dirDotLight, ${C.float(10)}) * (1. - pow(sunsetTransition, ${C.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),e.include(ea),t.uniforms.add(new Bt("readChannelsRG",i=>i.clouds.readChannels===tt.RG),new ta("cubeMap",i=>{var s,a;return(a=(s=i.clouds.data)==null?void 0:s.cubeMap)==null?void 0:a.colorTexture})).code.add(C`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = lookupCloudsFromTextureArray(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),t.uniforms.add(new kt("anchorPoint",i=>i.clouds.parallax.anchorPoint),new kt("anchorPointNew",i=>i.clouds.parallaxNew.anchorPoint),new Yt("rotationClouds",i=>i.clouds.parallax.transform),new Yt("rotationCloudsNew",i=>i.clouds.parallaxNew.transform),new Pe("cloudsOpacity",i=>i.clouds.opacity),new Pe("fadeFactor",i=>i.clouds.fadeFactor),new Bt("crossFade",i=>i.clouds.fadeState===m.CROSS_FADE)).code.add(C`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const ra=(Ye.radius+Qs)**2;let ot=class extends Et{constructor(e,t){super(e,"usampler2D",Mt.Pass,(r,i,s)=>r.bindTexture(e,t(i,s)))}};var ye;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(ye||(ye={}));let $r=class extends Le{constructor(){super(...arguments),this.color=Ie(1,1,1)}};function ia(){const e=new ne;return e.include(It),e.fragment.uniforms.add(new Ze("tex",t=>t.texture),new Ai("uColor",t=>t.color)),e.fragment.main.add(C`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),e}const sa=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:$r,build:ia},Symbol.toStringTag,{value:"Module"})),aa={required:[]};O.Depth;let Gr=class extends ui{precompile(e){return!!this.acquireTechniques(e)}consumes(){return aa}get usedMemory(){return 0}get renderOccludedFlags(){return Se.Occlude}get isDecoration(){return!1}get running(){return!1}modify(e,t){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}},na=class extends Gr{},Yn=class extends Gr{},dr=class extends Et{constructor(e,t){super(e,"ivec2",Mt.Pass,(r,i,s)=>r.setUniform2iv(e,t(i,s)))}},jr=class extends Le{};function oa(){const e=new ne,{outputs:t,fragment:r}=e;return e.include(It),r.uniforms.add(new ot("highlightTexture",i=>i.highlightTexture)),r.constants.add("outlineWidth","int",Math.ceil(rt)),r.constants.add("cellSize","int",J),t.add("fragGrid","uvec2"),r.main.add(C`ivec2 inputTextureSize = textureSize(highlightTexture, 0);
ivec2 cellBottomLeftCornerInput = ivec2(ivec2(floor(gl_FragCoord.xy) * vec2(cellSize)));
ivec2 coordMid =  cellBottomLeftCornerInput + ivec2(cellSize >> 1);
uvec2 centreTexel = texelFetch(highlightTexture, coordMid, 0).rg & uvec2(0x55u);
float marginSquare = float(outlineWidth*outlineWidth);
uvec2 outputValue = centreTexel & uvec2(0x55u);
for(int y = -outlineWidth; y <= cellSize + outlineWidth; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : outlineWidth;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
ivec2 coord = cellBottomLeftCornerInput + ivec2(x, y);
uvec2[4] texels = uvec2[4] (
texelFetch(highlightTexture,coord+ivec2(0,0),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(1,0),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(0,1),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(1,1),0).rg & uvec2(0x55u)
);
if (texels[0] == texels[1] && texels[1] == texels[2] && texels[2] == texels[3] && texels[3] ==  centreTexel) {
continue;
}
for (int i=0; i<4; ++i){
outputValue |= ((texels[i] ^ centreTexel) << 1);
outputValue |= texels[i];
}
}
}
fragGrid = outputValue;`),e}const J=32,rt=9,Br=.4,la=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:jr,blurSize:Br,build:oa,gridCellPixelSize:J,outlineSize:rt},Symbol.toStringTag,{value:"Module"}));function Nt(e){const{vertex:t}=e;t.uniforms.add(new ot("coverageTexture",r=>r.coverageTexture),new dr("highlightRenderCellCount",r=>V(gr,r.horizontalCellCount,r.verticalCellCount)),new dr("highlightTextureResolution",({highlightTexture:r})=>V(gr,r.descriptor.width,r.descriptor.height)),new at("highlightLevel",r=>r.highlightLevel)).constants.add("cellSize","int",J),e.varyings.add("sUV","vec2"),e.varyings.add("vOutlinePossible","float"),t.code.add(C`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`),t.main.add(C`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
uvec2 covTexel = texelFetch(coverageTexture, cellPos, 0).rg;
int channelIndex = (highlightLevel >> 2) & 3;
uint channelValue = covTexel[channelIndex];
int highlightIndex = (highlightLevel & 3) << 1;
bool covered = ((channelValue >> highlightIndex) & 1u) == 1u;
if (!covered) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = (((channelValue >> highlightIndex) & 2u) == 2u) ? 1.0 : 0.0;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}const gr=y();function ha(){const e=new ne;e.include(Nt);const{fragment:t}=e;return t.uniforms.add(new Ze("blurInput",r=>r.highlightBlurTexture),new Mr("blurSize",r=>r.blurSize),new ot("highlightTexture",r=>r.highlightTexture),new Ze("highlightOptionsTexture",r=>r.highlightOptionsTexture),new at("highlightLevel",r=>r.highlightLevel),new Lr("occludedIntensityFactor",r=>r.occludedFactor)),t.constants.add("inner","float",1-(rt-Br)/rt),e.include(Nr),t.main.add(C`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
uvec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),e}const ca=Object.freeze(Object.defineProperty({__proto__:null,build:ha},Symbol.toStringTag,{value:"Module"}));let pr=class extends se{constructor(e,t){super(e,t,new ae(ca,()=>re(()=>import("./ImageMaterial.glsl-4GA395N2-xM94ZX-O.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146]),import.meta.url).then(r=>r.H)))}initializePipeline(){return Z({blending:Vr,colorWrite:ee})}},kr=class extends Le{constructor(){super(...arguments),this.blurSize=y()}};function ua(){const e=new ne;return e.include(Nt),e.outputs.add("fragHighlight","vec2",0),e.fragment.uniforms.add(new Mr("blurSize",t=>t.blurSize),new Fi("blurInput",t=>t.blurInput)).main.add(C`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 center = texture(blurInput, sUV).rg;
if (vOutlinePossible == 0.0) {
fragHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, sUV + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, sUV - blurSize * 3.294215).rg * 0.093913;
fragHighlight = sum;
}`),e}const da=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:kr,build:ua},Symbol.toStringTag,{value:"Module"}));let _r=class extends se{constructor(e,t){super(e,t,new ae(da,()=>re(()=>import("./ImageMaterial.glsl-4GA395N2-xM94ZX-O.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146]),import.meta.url).then(r=>r.a)))}initializePipeline(){return Z({colorWrite:ee})}},mr=class extends se{constructor(e,t){super(e,t,new ae(la,()=>re(()=>import("./ImageMaterial.glsl-4GA395N2-xM94ZX-O.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146]),import.meta.url).then(r=>r.b)))}initializePipeline(){return Z({colorWrite:ee})}},ga=class extends Le{constructor(){super(...arguments),this.occludedFactor=As,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}};function pa(){const e=new ne;e.include(Nt),e.include(Nr);const{fragment:t}=e;return e.outputs.add("fragSingleHighlight","vec2",0),t.uniforms.add(new ot("highlightTexture",r=>r.highlightTexture),new at("highlightLevel",r=>r.highlightLevel)),t.main.add(C`ivec2 iuv = ivec2(gl_FragCoord.xy);
uvec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),e}const _a=Object.freeze(Object.defineProperty({__proto__:null,build:pa},Symbol.toStringTag,{value:"Module"}));let fr=class extends se{constructor(e,t){super(e,t,new ae(_a,()=>re(()=>import("./ImageMaterial.glsl-4GA395N2-xM94ZX-O.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146]),import.meta.url).then(r=>r.c)))}initializePipeline(){return Z({colorWrite:ee})}};const ma=[];new oe(_.POSITION,3,X.FLOAT,0,12),new oe(_.POSITION,2,X.FLOAT,0,8),new oe(_.POSITION,2,X.FLOAT,0,12),new oe(_.UV0,2,X.HALF_FLOAT,8,12),new oe(_.POSITION,2,X.FLOAT,0,16),new oe(_.UV0,2,X.FLOAT,8,16);let je=class extends ji{constructor(){super(...arguments),this.produces=gt.HIGHLIGHTS,this.consumes={required:[gt.HIGHLIGHTS,"highlights"]},this._downsampleDrawParameters=new jr,this._passParameters=new ga,this._highlightBlurDrawParameters=new kr,this._grid=new fa}initialize(){this.addHandles([_e(()=>this._updateOptionsTexture(),()=>{},bt)])}destroy(){this._grid.coverage=Ee(this._grid.coverage),this._grid.vao=Je(this._grid.vao),this._passParameters.highlightOptionsTexture=Ee(this._passParameters.highlightOptionsTexture)}_updateOptionsTexture(){if(this._passParameters.highlightOptionsTexture==null){const e=new qr(16,2);e.internalFormat=Fs.RGBA,e.samplingMode=Wr.NEAREST,this._passParameters.highlightOptionsTexture=new Lt(this.renderingContext,e,null)}this._passParameters.highlightOptionsTexture.setData(va(this.view.state.highlights)),this.requestRender(Xe.UPDATE)}precompile(){this.techniques.precompile(mr),this.techniques.precompile(fr),this.techniques.precompile(_r),this.techniques.precompile(pr)}render(e){const t=e.find(({name:c})=>c===gt.HIGHLIGHTS),{techniques:r,bindParameters:i,_passParameters:s,renderingContext:a}=this;if(!i.decorations)return t;const n=r.get(mr);if(!n.compiled)return this.requestRender(Xe.UPDATE),t;const o=e.find(({name:c})=>c==="highlights").getTexture();s.highlightTexture=o;const l=()=>{var W;this._gridUpdateResources(o);const c=this._gridComputeCoverage(n,o,i),{horizontalCellCount:x,verticalCellCount:S}=c;return s.horizontalCellCount=x,s.verticalCellCount=S,s.coverageTexture=(W=c.coverage)==null?void 0:W.getTexture(),c},d=c=>{const x=c.verticalCellCount*c.horizontalCellCount;a.bindVAO(c.vao),a.drawElementsInstanced(Ms.TRIANGLES,6,X.UNSIGNED_BYTE,0,x)},{camera:p}=i,f=()=>{a.bindFramebuffer(t.fbo),a.setViewport4fv(p.fullViewport)};return this._renderHighlightPostprocess(o,l,d,f),s.highlightTexture=null,s.coverageTexture=null,t}_renderHighlightPostprocess(e,t,r,i){var Vt;const{fboCache:s,techniques:a,bindParameters:n,_passParameters:o,renderingContext:l}=this,d=a.get(fr),p=a.get(_r),f=a.get(pr);if(!f.compiled||!p.compiled||!d.compiled)return void this.requestRender(Xe.UPDATE);o.highlightTexture=e;const c=t(),{width:x,height:S}=e.descriptor;o.highlightTexture=e;const{camera:W}=n,{fullWidth:xe,fullHeight:lt,pixelRatio:Ne}=W,be=Math.ceil(xe/Ne),we=Math.ceil(lt/Ne),{_highlightBlurDrawParameters:v}=this,P=this.view.stage.renderView.renderer,{highlights:Ht}=n;for(let He=0;He<Ht.length;++He){const{name:Jr}=Ht[He];if(!P.hasHighlight(Jr))continue;o.highlightLevel=He,l.setClearColor(0,0,0,0);const ht=s.acquire(x,S,"single highlight",U.RG8UNORM);l.bindFramebuffer(ht.fbo),l.setViewport(0,0,x,S),l.clear(te.COLOR),l.bindTechnique(d,n,o),r(c),v.blurInput=ht.getTexture(),V(v.blurSize,1/be,0);const Ve=s.acquire(be,we,"single highlight blur h",U.RG8UNORM);l.unbindTexture((Vt=Ve.fbo)==null?void 0:Vt.colorTexture),l.bindFramebuffer(Ve.fbo),l.setViewport(0,0,be,we),l.clear(te.COLOR),l.bindTechnique(p,n,o,v),r(c),ht.release(),V(v.blurSize,0,1/we),o.highlightBlurTexture=Ve.getTexture(),i(),l.bindTechnique(f,n,o,v),r(c),Ve.release()}}_gridUpdateResources(e){const t=this._grid,{width:r,height:i}=e.descriptor;if(t.horizontalCellCount=Math.ceil(r/J),t.verticalCellCount=Math.ceil(i/J),t.vao)return;const s=this.renderingContext,a=tr.createIndex(s,er.STATIC_DRAW,ba);t.vao=new Gs(s,Bi,new Map([["geometry",ma]]),new Map([["geometry",tr.createVertex(s,er.STATIC_DRAW)]]),a)}_gridComputeCoverage(e,t,r){var p;const i=this.renderingContext,s=this._grid,a=t.descriptor,n=Math.ceil(a.width/J),o=Math.ceil(a.height/J);this._downsampleDrawParameters.input=t;const{highlights:l}=r;(p=s.coverage)==null||p.release();const d=this.fboCache.acquire(n,o,"highlight coverage",l.length>Yr?U.RG8UINT:U.R8UINT);return s.coverage=d,i.bindFramebuffer(d.fbo),i.bindTechnique(e,r,this._passParameters,this._downsampleDrawParameters),i.setViewport(0,0,n,o),i.screen.draw(),s}get test(){}};u([b()],je.prototype,"produces",void 0),u([b()],je.prototype,"consumes",void 0),je=u([B("esri.views.3d.webgl-engine.effects.highlight.Highlight")],je);let fa=class{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}};function va(e){const t=new Uint8Array(128);let r=0;for(const i of e){const s=4*r,a=4*r+64;++r;const{color:n}=i,o=i.haloColor??n;t[s+0]=n.r,t[s+1]=n.g,t[s+2]=n.b,t[s+3]=i.fillOpacity*n.a*255,t[a+0]=o.r,t[a+1]=o.g,t[a+2]=o.b,t[a+3]=i.haloOpacity*o.a*255}return t}let ya=0;function xa(e){let t=0;for(const i of e){const{name:s}=i;t+=s.length;const{color:a,fillOpacity:n,haloColor:o,haloOpacity:l}=i;t+=a.r+a.g+a.b+a.a+n,t+=o?o.r+o.g+o.b+o.a+l:0}const r=e.at(0);if(r){const{shadowOpacity:i,shadowDifference:s,shadowColor:a}=r;t+=i+s+a.r+a.g+a.b+a.a}return ya+++(t>=0?0:1)}const ba=new Uint8Array([0,1,2,2,1,3]);function wa(e,t,r,i,s,a=0){const{highlights:n}=i,o=n.length>1?t.acquire(r.width,r.height,"highlight mix",n.length>Yr?U.RG8UINT:U.R8UINT):null,{gl:l}=e;if(o){const p=e.getBoundFramebufferObject();e.bindFramebuffer(o.fbo),l.clearBufferuiv(l.COLOR,0,[0,0,0,0]),e.bindFramebuffer(p)}const d=o==null?void 0:o.getTexture();i.highlightMixTexture=d,V(i.highlightMixOrigin,a,0),n.forEach((p,f)=>{if(f>0){const c=Lt.TEXTURE_UNIT_FOR_UPDATES;e.bindTexture(d,c),e.setActiveTexture(c),l.copyTexSubImage2D(Ls.TEXTURE_2D,0,0,0,a,0,r.width,r.height),e.bindTexture(null,c)}e.clear(te.DEPTH),i.highlightLevel=f,s()}),i.highlightLevel=null,i.highlightMixTexture=null,o==null||o.release()}const Yr=4;let Ca=class{constructor(e,t,r,i){this.material=e,this.output=t,this.techniques=r,this.textures=i}},Ta=class{constructor(e,t,r,i){this._textures=e,this._techniques=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new Hs}dispose(){this._textures.destroy()}acquire(e,t,r){var s;if(this._ownMaterial(e),!((s=e.produces.get(t))!=null&&s(r)))return null;let i=this._id2glMaterialRef.get(r,e.id);if(i==null){const a=e.createGLMaterial(new Ca(e,r,this._techniques,this._textures));i=new Oa(a),this._id2glMaterialRef.set(r,e.id,i)}return i.ref(),i.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);r!=null&&(r.unref(),r.referenced||(Je(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&si.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Oa=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,ve(this._refCnt>=0)}get referenced(){return this._refCnt>0}};var it;(function(e){e[e.Immediate=0]="Immediate",e[e.FadeWithWeather=1]="FadeWithWeather"})(it||(it={}));let Ra=class{constructor(e){this.shadowMap=e,this.slot=M.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=At.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new nt,this._inverseViewport=y(),this._oldLighting=new _t,this._newLighting=new _t,this._fadedLighting=new _t,this._lighting=this._newLighting,this.ssr=new Da,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlights=new Array,this.highlightOrderMap=new Map,this.highlightMixOrigin=y(),this.highlightMixTexture=null,this.hudRenderStyle=zs.Occluded,this.hudOccludedFragmentOpacity=1,this.snowCover=!1,this.clouds=new Xs,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,t,r,i){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=t,this._newLighting.globalFactor=r,this._newLighting.set(e),i===it.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}get highlight(){return this.highlightLevel==null?null:this.highlights[this.highlightLevel]}},Da=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=H()}},Sa=class{constructor(e,t,r){this.rctx=e,this.techniques=r,this.lastFrameCamera=new nt,this.output=O.Color,this.renderOccludedMask=Ke,this.time=ai(0),this.bind=new Ra(t),this.bind.alignPixelEnabled=!0}};const Ke=Se.Occlude|Se.OccludeAndTransparent|Se.OccludeAndTransparentStencil;let De=class extends nt{constructor(){super(...arguments),this._projectionMatrix=H()}get projectionMatrix(){return this._projectionMatrix}};u([b()],De.prototype,"_projectionMatrix",void 0),u([b({readOnly:!0})],De.prototype,"projectionMatrix",null),De=u([B("esri.views.3d.webgl-engine.lib.CascadeCamera")],De);var st;(function(e){e[e.Highlight=0]="Highlight",e[e.ExcludeHighlight=1]="ExcludeHighlight"})(st||(st={}));let Be=class{constructor(){this.camera=new De,this.lightMat=H()}},Pa=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},Ia=class{constructor(e,t){this._fbos=e,this._viewingMode=t,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Pa,this._projectionView=H(),this._projectionViewInverse=H(),this._modelViewLight=H(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Pt(),this._cascades=[new Be,new Be,new Be,new Be],this._lastOrigin=null,this._enabled=!1,this._maxTextureWidth=Math.min(ni("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture(Ue)}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return rr(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeMainBuffer(){this._handle=Ee(this._handle)}disposeOffscreenBuffers(){this.disposeMainBuffer(),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=Pr(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)vt[e]=this._cascades[e];return vt.length=this._numCascades,vt}start(e,t,r,i,s){ve(this.enabled);const{near:a,far:n}=Na(r);this._computeCascadeDistances(a,n,i),this._textureHeight=this._computeTextureHeight(e,s,i),this._setupMatrices(e,t);const{viewMatrix:o,projectionMatrix:l}=e;for(let d=0;d<this._numCascades;++d)this._constructCascade(d,l,o,t);this._lastOrigin=null,this.clear()}finish(){ve(this.enabled)}getShadowMapMatrices(e){if(!this._lastOrigin||!vi(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||Me(),$(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){qt(Cr,this._cascades[t].lightMat,e);for(let r=0;r<16;++r)Tr[16*t+r]=Cr[r]}}return Tr}moveSnapshot(e){var t,r;ve(this.enabled),(t=this._snapshots[e])==null||t.release(),this._snapshots[e]=this._handle,(r=this._handle)==null||r.setName(e===st.Highlight?"shadow map highlight":"shadow map excluding highlight"),this._handle=null}copySnapshot(e){var a,n,o,l;if(!this.enabled||!((n=(a=this._handle)==null?void 0:a.getTexture(Ue))!=null&&n.descriptor))return;(o=this._snapshots[e])==null||o.release();const t=e===st.Highlight?"shadow map highlight":"shadow map excluding highlight",r=this._acquireFBO(t);this._snapshots[e]=r;const i=(l=this._handle)==null?void 0:l.fbo;if(!i||!(r!=null&&r.fbo))return void console.error("No FBO");const{rctx:s}=this._fbos;s.blitFramebuffer(i,r.fbo,te.DEPTH)}getSnapshot(e){var t;return this.enabled?(t=this._snapshots[e])==null?void 0:t.getTexture(Ue):null}clear(){this._ensureFbo(),this.bindFbo(),this._fbos.rctx.clear(te.DEPTH)}_computeTextureHeight({pixelRatio:e,fullWidth:t,fullHeight:r},i,s){const a=Math.min(window.devicePixelRatio,i)/e,n=s?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return Ki(Math.max(t,r)*a*n,this._maxTextureWidth/this._numCascades)}_ensureFbo(){var e,t,r,i;((t=(e=this._handle)==null?void 0:e.fbo)==null?void 0:t.width)===this._textureWidth&&((r=this._handle)==null?void 0:r.fbo.height)===this._textureHeight||((i=this._handle)==null||i.release(),this._handle=this._acquireFBO("shadow map"))}_acquireFBO(e){var r;const t=this._fbos.acquire(this._textureWidth,this._textureHeight,e,Ji.DEPTH16);return(r=t.getTexture(Ue))==null||r.setShadowFiltering(!0),t}_discardSnapshot(e){this._snapshots[e]=Ee(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}bindFbo(){var e;this._fbos.rctx.bindFramebuffer((e=this._handle)==null?void 0:e.fbo)}_constructCascade(e,t,r,i){const s=this._cascades[e],a=-this._cascadeDistances[e],n=-this._cascadeDistances[e+1],o=(t[10]*a+t[14])/Math.abs(t[11]*a+t[15]),l=(t[10]*n+t[14])/Math.abs(t[11]*n+t[15]);ve(o<l);for(let c=0;c<8;++c){rr(vr,c%4==0||c%4==3?-1:1,c%4==0||c%4==1?-1:1,c<4?o:l,1);const x=N[c];Ws(x,vr,this._projectionViewInverse),x[0]/=x[3],x[1]/=x[3],x[2]/=x[3]}yi(ft,N[0]),s.camera.viewMatrix=qt(Ea,this._modelViewLight,ft);for(let c=0;c<8;++c)Ar(N[c],N[c],s.camera.viewMatrix);let d=N[0][2],p=N[0][2];for(let c=1;c<8;++c)d=Math.min(d,N[c][2]),p=Math.max(p,N[c][2]);d-=200,p+=200,s.camera.near=-p,s.camera.far=-d,La(r,i,d,p,s.camera),wt(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const f=this._textureHeight;s.camera.viewport=[e*f,0,f,f]}_setupMatrices(e,t){wt(this._projectionView,e.projectionMatrix,e.viewMatrix),_i(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===zr.Global?e.eye:Er(ft,0,0,1);mi(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],r)}_computeCascadeDistances(e,t,r){const i=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(Vs(t/e,4)),i);const s=(t-e)/this._numCascades,a=(t/e)**(1/this._numCascades);let n=e,o=e;for(let l=0;l<this._numCascades+1;++l)this._cascadeDistances[l]=oi(n,o,this.settings.splitSchemeLambda),n*=a,o+=s}get test(){}};const Ea=H(),vr=Pt(),N=[];for(let e=0;e<8;++e)N.push(Pt());const yr=y(),xr=y(),Aa=y(),br=y(),wr=y(),ft=Me(),vt=[],Cr=H(),Tr=K.concat(K,K,K,K),L=y(),de=y(),Q=[y(),y(),y(),y()],T=y(),yt=y(),q=y(),Re=y(),ge=y(),pe=y(),ke=y();function Fa(e,t,r,i,s,a,n,o){V(L,0,0);for(let v=0;v<4;++v)Y(L,L,e[v]);me(L,L,.25),V(de,0,0);for(let v=4;v<8;++v)Y(de,de,e[v]);me(de,de,.25),Te(Q[0],e[4],e[5],.5),Te(Q[1],e[5],e[6],.5),Te(Q[2],e[6],e[7],.5),Te(Q[3],e[7],e[4],.5);let l=0,d=Qt(Q[0],L);for(let v=1;v<4;++v){const P=Qt(Q[v],L);P<d&&(d=P,l=v)}fe(T,Q[l],e[l+4]);const p=T[0];let f,c;T[0]=-T[1],T[1]=p,fe(yt,de,L),D(yt,T)<0&&bs(T,T),Te(T,T,yt,r),Xt(T,T),f=c=D(fe(q,e[0],L),T);for(let v=1;v<8;++v){const P=D(fe(q,e[v],L),T);P<f?f=P:P>c&&(c=P)}ws(i,L),me(q,T,f-t),Y(i,i,q);let x=-1,S=1,W=0,xe=0;for(let v=0;v<8;++v){fe(Re,e[v],i),Xt(Re,Re);const P=T[0]*Re[1]-T[1]*Re[0];P>0?P>x&&(x=P,W=v):P<S&&(S=P,xe=v)}le(x>0,"leftArea"),le(S<0,"rightArea"),me(ge,T,f),Y(ge,ge,L),me(pe,T,c),Y(pe,pe,L),ke[0]=-T[1],ke[1]=T[0];const lt=We(i,e[xe],pe,Y(q,pe,ke),1,s),Ne=We(i,e[W],pe,q,1,a),be=We(i,e[W],ge,Y(q,ge,ke),1,n),we=We(i,e[xe],ge,q,1,o);le(lt,"rayRay"),le(Ne,"rayRay"),le(be,"rayRay"),le(we,"rayRay")}function g(e,t){return 3*t+e}const Or=y();function E(e,t){return V(Or,e[t],e[t+3]),Or}const I=y(),h=Us();function Ma(e,t,r,i,s){fe(I,r,i),me(I,I,.5),h[0]=I[0],h[1]=I[1],h[2]=0,h[3]=I[1],h[4]=-I[0],h[5]=0,h[6]=I[0]*I[0]+I[1]*I[1],h[7]=I[0]*I[1]-I[1]*I[0],h[8]=1,h[g(0,2)]=-D(E(h,0),e),h[g(1,2)]=-D(E(h,1),e);let a=D(E(h,0),r)+h[g(0,2)],n=D(E(h,1),r)+h[g(1,2)],o=D(E(h,0),i)+h[g(0,2)],l=D(E(h,1),i)+h[g(1,2)];a=-(a+o)/(n+l),h[g(0,0)]+=h[g(1,0)]*a,h[g(0,1)]+=h[g(1,1)]*a,h[g(0,2)]+=h[g(1,2)]*a,a=1/(D(E(h,0),r)+h[g(0,2)]),n=1/(D(E(h,1),r)+h[g(1,2)]),h[g(0,0)]*=a,h[g(0,1)]*=a,h[g(0,2)]*=a,h[g(1,0)]*=n,h[g(1,1)]*=n,h[g(1,2)]*=n,h[g(2,0)]=h[g(1,0)],h[g(2,1)]=h[g(1,1)],h[g(2,2)]=h[g(1,2)],h[g(1,2)]+=1,a=D(E(h,1),t)+h[g(1,2)],n=D(E(h,2),t)+h[g(2,2)],o=D(E(h,1),r)+h[g(1,2)],l=D(E(h,2),r)+h[g(2,2)],a=-.5*(a/n+o/l),h[g(1,0)]+=h[g(2,0)]*a,h[g(1,1)]+=h[g(2,1)]*a,h[g(1,2)]+=h[g(2,2)]*a,a=D(E(h,1),t)+h[g(1,2)],n=D(E(h,2),t)+h[g(2,2)],o=-n/a,h[g(1,0)]*=o,h[g(1,1)]*=o,h[g(1,2)]*=o,s[0]=h[0],s[1]=h[1],s[2]=0,s[3]=h[2],s[4]=h[3],s[5]=h[4],s[6]=0,s[7]=h[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=h[6],s[13]=h[7],s[14]=0,s[15]=h[8]}function La(e,t,r,i,s){const a=1/N[0][3],n=1/N[4][3];ve(a<n);let o=a+Math.sqrt(a*n);const l=Math.sin(li(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));o/=l,Fa(N,o,l,yr,xr,Aa,br,wr),Ma(yr,xr,br,wr,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function Na(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}let Rr=class extends se{constructor(e,t){super(e,t,new ae(sa,()=>re(()=>import("./ImageMaterial.glsl-4GA395N2-xM94ZX-O.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146]),import.meta.url).then(r=>r.T)))}initializePipeline(e){return e.hasAlpha?Z({blending:Vr,colorWrite:ee}):Z({colorWrite:ee})}},Qr=class extends Mi{constructor(){super(...arguments),this.hasAlpha=!1}};u([A()],Qr.prototype,"hasAlpha",void 0);let Xr=class extends Le{constructor(){super(...arguments),this.overlayIndex=j.INNER,this.opacity=1}};function Ha(){const e=new ne;return e.include(It),e.fragment.uniforms.add(new Ze("tex",t=>t.texture)),e.fragment.uniforms.add(new at("overlayIdx",t=>t.overlayIndex)),e.fragment.uniforms.add(new Lr("opacity",t=>t.opacity)),e.fragment.main.add(C`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),e}const Va=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Xr,build:Ha},Symbol.toStringTag,{value:"Module"}));let Dr=class extends se{constructor(e,t){super(e,t,new ae(Va,()=>re(()=>import("./ImageMaterial.glsl-4GA395N2-xM94ZX-O.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146]),import.meta.url).then(r=>r.O)))}},z=class extends na{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Xr,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Zr,this._passParameters=new $r,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new nt,this.events=new ei,this.longitudeCyclical=null,this.produces=new Map([[M.DRAPED_MATERIAL,t=>t!==O.Highlight||this.hasHighlights],[M.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this._view,t=e.stage,r=t.renderer.fboCache,{waterTextures:i,techniques:s}=t.renderView;this._renderContext=new Sa(this._rctx,new Ia(r,e.state.viewingMode),s),this.addHandles([_e(()=>i.updating,()=>this.events.emit("content-changed"),zt),_e(()=>this.spatialReference,o=>this._localOriginFactory=new Rs(o),zt),ti(()=>e.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0),_e(()=>xa(e.state.highlights),()=>this._sortedDrapeSourceRenderersDirty=!0,bt),_e(()=>e.state.highlights,o=>{this._bindParameters.highlights=o,this._bindParameters.highlightOrderMap=e.state.highlightOrderMap},bt),e.resourceController.scheduler.registerTask(qs.OVERLAY_RENDERER,this)]);const{_bindParameters:a,_camera:n}=this;n.near=1,n.far=1e4,n.relativeElevation=null,a.slot=M.DRAPED_MATERIAL,a.mainDepth=null,a.camera=n,a.oitPass=At.NONE,a.updateLighting([new ki(ri())],0,0,it.Immediate)}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._passParameters.texture=Je(this._passParameters.texture),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this._stage.renderView.renderingContext}get _view(){return this.parent.view}get _stage(){return this.parent.view.stage}get spatialReference(){return this.parent.spatialReference}get _techniques(){return this._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._pluginContext.materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){const t=new Ta(this._view.stage.renderView.textures,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));this._pluginContext={...e,materials:t},this._techniques.precompile(Dr)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||Ce(this._renderers,e=>e.updating||e.canCompact)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const t of this._renderers.values()){const r=t.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}registerDrapeSource(e,t){var r;(r=this._renderers.get(e))==null||r.destroy(),this._renderers.set(e,t),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(_e(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e)}removeDrapeSourceRenderer(e){if(e==null)return;const t=this._renderers.get(e);t!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){var e;return((e=this._renderTargets)==null?void 0:e.computeValidity())??0}releaseRenderTargets(){var e;(e=this._renderTargets)==null||e.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&ct(e,t=>t.drapeTargetType===Ps.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=ct(e,t=>t.drapeSourceType===ze.Features),this._hasDrapedRasterSource=ct(e,t=>t.drapeSourceType===ze.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new ks(this._stage.renderer.fboCache),this._overlays=[new or,new or]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=Je(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var t,r;return e===w.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?(t=this._renderTargets)==null?void 0:t.getTexture(w.Color):(r=this._renderTargets)==null?void 0:r.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,t){let r=!1;for(const[i,s]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers(),e.madeProgress()),this.compact(e),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=Ce(this._renderers,i=>i.hasHighlights),this.notifyChange("rendersOccludedDraped"))}compact(e){let t=!1;for(const r of this._renderers.values()){if(e.done)break;t=r.compact(e)||t}return t&&this.notifyChange("updating"),t}hasHighlight(e){return Ce(this._renderers,t=>t.hasHighlight(e))}processSyncDrapeSources(){this._processDrapeSources($s,e=>e.updatePolicy===Ds.SYNC)}get isEmpty(){return!pt.OVERLAY_DRAW_DEBUG_TEXTURE&&!Ce(this._renderers,e=>!e.isEmpty)}get hasWater(){const e=Ce(this._renderers,({hasWater:t})=>t);return e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water")),this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=xt,++this._techniques.precompiling;const t=this._sortedRenderers.some(({renderer:r})=>r.precompile(this._renderContext));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=e,t}renders(e){var s,a;if(pt.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==w.Occluded&&e!==w.Highlight)return!0;if(!this._overlays)return!1;const t=this._overlays[j.INNER];for(const n of this._overlays)n.setupGeometryViews(this.longitudeCyclical);if(!t.hasSomeSizedView())return!1;const r=this._renderContext.output;this._renderContext.output=((a=(s=this._renderTargets)==null?void 0:s.targets.find(n=>n.content===e))==null?void 0:a.output)??O.Color,++this._techniques.precompiling;const i=this._sortedRenderers.some(({renderer:n})=>n.precompile(this._renderContext));return--this._techniques.precompiling,this._renderContext.output=r,i}get mode(){var e;return this.isEmpty?ye.Disabled:this.hasWater&&this.renders(w.WaterNormal)?ye.EnabledWithWater:(e=this._renderTargets)!=null&&e.getTexture(w.Color)?ye.Enabled:ye.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach(r=>t=r.updateAnimation(e)||t),t&&this.parent.requestRender(Xe.BACKGROUND),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(!this._overlays||!this._renderTargets)return;const t=this._bindParameters;t.alignPixelEnabled=e.alignPixelEnabled,++this._techniques.precompiling;for(const r of this._renderTargets.targets){if(r.content===w.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const i=r.output;this._renderContext.output=i,t.slot=i===O.Normal?M.DRAPED_WATER:M.DRAPED_MATERIAL,i===O.Highlight&&(t.highlightMixTexture=t.highlights.length>1?this._rctx.emptyTexture:null),r.content===w.Occluded&&(this._renderContext.renderOccludedMask=xt),this._sortedRenderers.forAll(({drapeSource:s,renderer:a})=>{r.content===w.ColorNoRasterImage&&s.drapeSourceType===ze.RasterImage||a.precompile(this._renderContext)}),this._renderContext.renderOccludedMask=Ke,t.highlightMixTexture=null}--this._techniques.precompiling}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const t of this._overlays)t.setupGeometryViews(this.longitudeCyclical);this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;for(const t of this._renderTargets.targets){if(t.content===w.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(j.INNER,t),i=this._drawTarget(j.OUTER,t);(r||i)&&t.fbo.generateMipMap()}}}_drawTarget(e,t){const r=this._overlays[e],i=r.canvasGeometries;if(i.numViews===0)return!1;const s=this._view.state.contentPixelRatio;this._screenToWorldRatio=s*r.mapUnitsPerPixel/this._bindParameters.overlayStretch;const{output:a}=t;if(this.isEmpty||a===O.Normal&&!this.hasWater||!r.hasSomeSizedView())return!1;const{_rctx:n,_camera:o,_renderContext:l,_bindParameters:d}=this;if(o.pixelRatio=r.pixelRatio*s,l.output=a,d.screenToWorldRatio=this._screenToWorldRatio,d.screenToPCSRatio=this._screenToWorldRatio*this.parent.worldToPCSRatio,d.slot=a===O.Normal?M.DRAPED_WATER:M.DRAPED_MATERIAL,t.content===w.Occluded&&(l.renderOccludedMask=xt),!this.renders(t.content))return l.renderOccludedMask=Ke,!1;const{resolution:p}=r,f=e===j.INNER,c=f?0:p;if(n.setViewport(c,0,p,p),this._bindTargetFBO(t),f)if(t.output!==O.Highlight)n.setClearColor(0,0,0,0),n.clear(te.COLOR);else{const{gl:x}=n;x.clearBufferuiv(x.COLOR,0,[0,0,0,0])}if(pt.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==w.Occluded&&t.content!==w.Highlight){this._techniques.precompile(Rr,St);const x=this._techniques.get(Rr,St);for(let S=0;S<i.numViews;S++)this._setViewParameters(i.extents[S],r),this._ensureDebugPatternResources(r.resolution,Ua[e]),n.bindTechnique(x,d,this._passParameters),n.screen.draw()}if(t.output===O.Highlight){const{fboCache:x}=this._stage.renderer,S=this._resolution;this._bindTargetFBO(t),wa(n,x,{width:S,height:S},d,()=>this._renderAllGeometry(e,t),c)}else this._renderAllGeometry(e,t);return n.bindFramebuffer(null),l.renderOccludedMask=Ke,!0}_renderAllGeometry(e,t){const r=this._overlays[e],i=r.canvasGeometries;this._sortedRenderers.forAll(({drapeSource:s,renderer:a})=>{if(t.content===w.ColorNoRasterImage&&s.drapeSourceType===ze.RasterImage)return;const{fullOpacity:n}=s,o=n!=null&&n<1&&t.output===O.Color&&this._bindTemporaryFBO();for(let l=0;l<i.numViews;l++)this._setViewParameters(i.extents[l],r),a.render(this._renderContext);if(o){this._bindTargetFBO(t),this._overlayParameters.texture=o.getTexture(),this._overlayParameters.opacity=n,this._overlayParameters.overlayIndex=e;const l=this._techniques.get(Dr);this._rctx.bindTechnique(l,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),o.release()}})}_bindTargetFBO(e){const t=this._resolution,r=2*t;e.fbo.bind(this._rctx,r,t)}_bindTemporaryFBO(){const e=this._resolution,t=2*e,r=this._stage.renderer.fboCache,i=r.acquire(t,e,"overlay tmp");return r.rctx.bindFramebuffer(i.fbo),r.rctx.clear(te.COLOR),i}get _resolution(){var e;return((e=this._overlays)==null?void 0:e[j.INNER].resolution)??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){var a;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let s=0;for(const{renderer:n}of this._sortedRenderers)s=((a=n.intersect)==null?void 0:a.call(n,e,t,r,i,s))??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this._view.map.allLayers,t=e.length;this._renderers.forEach((r,i)=>{const s=e.indexOf(i.layer),a=s>=0,n=i.renderGroup??(a?Kt.MapLayer:Kt.ViewLayer),o=i.drapeSourcePriorityOffset??0,l=t*n+(a?s:0)+o;this._sortedRenderers.push(new za(i,r,l))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],gi(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),pi(r.viewMatrix,[-e[0],-e[1],0])}_ensureDebugPatternResources(e,t){if(Er(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let i=0;for(let a=0;a<e;a++)for(let n=0;n<e;n++){const o=Math.floor(n/10),l=Math.floor(a/10);o<2||l<2||10*o>e-20||10*l>e-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&o&&1&l?1&n^1&a?0:255:1&o^1&l?0:128)}const s=new qr(e);s.samplingMode=Wr.NEAREST,this._passParameters.texture=new Lt(this._rctx,s,r)}get test(){}};u([b()],z.prototype,"hasHighlights",void 0),u([b()],z.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([b({constructOnly:!0})],z.prototype,"parent",void 0),u([b({readOnly:!0})],z.prototype,"_techniques",null),u([b({type:Boolean,readOnly:!0})],z.prototype,"updating",null),u([b()],z.prototype,"isEmpty",null),u([b({readOnly:!0})],z.prototype,"rendersOccludedDraped",null),z=u([B("esri.views.3d.terrain.OverlayRenderer")],z);class za{constructor(t,r,i){this.drapeSource=t,this.renderer=r,this.index=i}}const Ua=[[1,.5,.5],[.5,.5,1]],Wa=-2,xt=Se.OccludeAndTransparent,St=new Qr;St.hasAlpha=!0;let Qn=class{constructor(e,t={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=H(),this._shaderTransformation=null,this._boundingSphere=null,this.id=hi(),this.layerViewUid=t.layerViewUid,this.graphicUid=t.graphicUid,this.castShadow=t.castShadow??!1,t.objectShaderTransformation&&this.objectShaderTransformationChanged(t.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){fi(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=H()),wt(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=Oi()),Ar(Ri(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*Si(this.shaderTransformation)),this._boundingSphere):Di}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightOptions(e){this.geometry.foreachHighlightOptions(e)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}},qa=class extends os{constructor(){super(...arguments),this._pp0=Ie(0,0,1),this._pp1=Ie(0,0,0)}intersect(e,t,r,i,s,a){return jt(e,r,i,s,void 0,a)}intersectDraped(e,t,r,i){return this._pp0[0]=this._pp1[0]=r[0],this._pp0[1]=this._pp1[1]=r[1],jt(e,t,this._pp0,this._pp1,void 0,i)}};function $a(e){const t=new ne,{vertex:r,fragment:i,attributes:s,varyings:a}=t,{vvColor:n,hasVertexColors:o}=e;return Li(r,e),t.include(Ni,e),t.include(Hi,e),t.include(Vi,e),t.include(zi,e),i.include(Ui,e),t.include(Wi,e),t.include(qi,e),s.add(_.POSITION,"vec3"),n&&s.add(_.COLORFEATUREATTRIBUTE,"float"),o||a.add("vColor","vec4"),a.add("vpos","vec3",{invariant:!0}),r.uniforms.add(new $i("uColor",l=>l.color)),r.main.add(C`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${o?"vColor *= uColor;":n?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      gl_Position = transformPosition(proj, view, vpos);`),i.include(Gi),i.main.add(C`discardBySlice(vpos);
discardByTerrainDepth();
outputColorHighlightOID(vColor, vpos, vColor.rgb);`),t}const Ga=Object.freeze(Object.defineProperty({__proto__:null,build:$a},Symbol.toStringTag,{value:"Module"}));class ja extends se{constructor(t,r){super(t,r,new ae(Ga,()=>re(()=>import("./ImageMaterial.glsl-4GA395N2-xM94ZX-O.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146]),import.meta.url).then(i=>i.C)))}_createPipeline(t,r){const{oitPass:i,output:s,transparent:a,cullFace:n,draped:o,hasOccludees:l,polygonOffset:d}=t,p=i===At.NONE;return Z({blending:Fr(s)&&a?ls(i):null,culling:ys(n),depthTest:o?null:{func:hs(i)},depthWrite:cs(t),drawBuffers:us(s,ds(i,s)),colorWrite:ee,stencilWrite:l?gs:null,stencilTest:l?r?ps:_s:null,polygonOffset:p?d?Ba:null:ms(t)})}initializePipeline(t){return this._occludeePipelineState=this._createPipeline(t,!0),this._createPipeline(t,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}}const Ba={factor:1,units:1};let F=class extends Yi{constructor(){super(...arguments),this.cullFace=Ft.None,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=Qi.None,this.emissionSource=Xi.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1,this.snowCover=!1}};u([A({count:Ft.COUNT})],F.prototype,"cullFace",void 0),u([A()],F.prototype,"hasVertexColors",void 0),u([A()],F.prototype,"transparent",void 0),u([A()],F.prototype,"discardInvisibleFragments",void 0),u([A()],F.prototype,"polygonOffset",void 0),u([A()],F.prototype,"enableOffset",void 0),u([A()],F.prototype,"writeDepth",void 0),u([A()],F.prototype,"hasOccludees",void 0),u([A()],F.prototype,"terrainDepthTest",void 0),u([A()],F.prototype,"cullAboveTerrain",void 0),u([A()],F.prototype,"objectAndLayerIdColorInstanced",void 0),u([A()],F.prototype,"vvColor",void 0),u([A()],F.prototype,"draped",void 0);let Xn=class extends qa{constructor(e){super(e,Ya),this._configuration=new F,this.supportsEdges=!0,this.produces=new Map([[M.OPAQUE_MATERIAL,t=>this._isOpaqueMaterialPass(t)],[M.OPAQUE_MATERIAL_WITHOUT_NORMALS,t=>this._isOpaqueNoSSAODepthPass(t)],[M.TRANSPARENT_MATERIAL,t=>dt(t)&&this._transparent&&this.parameters.writeDepth],[M.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,t=>Gt(t)&&this._transparent&&this.parameters.writeDepth],[M.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,t=>dt(t)&&this._transparent&&!this.parameters.writeDepth],[M.DRAPED_MATERIAL,t=>Ei(t)]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<Zi,this._configuration.terrainDepthTest=t.terrainDepthTest&&Fr(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=es}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===O.Highlight||dt(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return Gt(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new ka(e)}createBufferWriter(){const e=ie().vec3f(_.POSITION);return Hr()&&e.vec4u8(_.OLIDCOLOR),this.parameters.vvColor?e.f32(_.COLORFEATUREATTRIBUTE):e.vec4u8(_.COLOR),new ts(e)}},ka=class extends rs{beginSlot(e){return this.getTechnique(ja,e)}};class Ya extends is{constructor(){super(...arguments),this.color=Pi,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Ft.None,this.draped=!1,this.discardInvisibleFragments=!1}}var Sr;(function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(Sr||(Sr={}));const R={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Qa={dash:R.dash,"dash-dot":[...R.dash,...R.dot],dot:R.dot,"long-dash":R["long-dash"],"long-dash-dot":[...R["long-dash"],...R.dot],"long-dash-dot-dot":[...R["long-dash"],...R.dot,...R.dot],none:null,"short-dash":R["short-dash"],"short-dash-dot":[...R["short-dash"],...R["short-dot"]],"short-dash-dot-dot":[...R["short-dash"],...R["short-dot"],...R["short-dot"]],"short-dot":R["short-dot"],solid:null},Xa=8;function Ka(e,t){return e==null?e:{pattern:e.slice(),pixelRatio:t}}function Kn(e){return{pattern:[e,e],pixelRatio:2}}function Jn(e){return(e==null?void 0:e.type)==="style"?Ja(e.style):null}function Ja(e){return e!=null?Ka(Qa[e],Xa):null}function Zn(e,t,r=null){const i=[],s=t.mapPositions;Za(t,i);const a=i[0][1].data,n=i[0][1].indices.length,o=Os(n);return en(t,i,o),sn(t,i,o),tn(t,i,o),rn(t,i,o),an(t,i,o),nn(t,i,o),on(t,i,a),new ss(e,i,s,as.Line,r)}function Za(e,t){const{attributeData:{position:r},removeDuplicateStartEnd:i}=e,s=ln(r)&&i,a=r.length/3-(s?1:0),n=new Array(2*(a-1)),o=s?r.slice(0,-3):r;let l=0;for(let d=0;d<a-1;d++)n[l++]=d,n[l++]=d+1;t.push([_.POSITION,new k(o,n,3,s)])}function en(e,t,r){if(e.attributeData.colorFeature!=null)return;const i=e.attributeData.color;t.push([_.COLOR,new k(i??Ii,r,4)])}function tn(e,t,r){e.attributeData.normal&&t.push([_.NORMAL,new k(e.attributeData.normal,r,3)])}function rn(e,t,r){e.attributeData.colorFeature!=null&&t.push([_.COLORFEATUREATTRIBUTE,new k([e.attributeData.colorFeature],r,1,!0)])}function sn(e,t,r){e.attributeData.sizeFeature==null&&t.push([_.SIZE,new k([e.attributeData.size??1],r,1,!0)])}function an(e,t,r){e.attributeData.sizeFeature!=null&&t.push([_.SIZEFEATUREATTRIBUTE,new k([e.attributeData.sizeFeature],r,1,!0)])}function nn(e,t,r){e.attributeData.opacityFeature!=null&&t.push([_.OPACITYFEATUREATTRIBUTE,new k([e.attributeData.opacityFeature],r,1,!0)])}function on(e,t,r){if(e.overlayInfo==null||e.overlayInfo.renderCoordsHelper.viewingMode!==zr.Global||!e.overlayInfo.spatialReference.isGeographic)return;const i=Ir(r.length),s=ci(e.overlayInfo.spatialReference);for(let f=0;f<i.length;f+=3)Cs(r,f,i,f,s);const a=r.length/3,n=ns(a+1);let o=hn,l=cn,d=0,p=0;V(o,i[p++],i[p++]),p++,n[0]=0;for(let f=1;f<a+1;++f)f===a&&(p=0),V(l,i[p++],i[p++]),p++,d+=xs(o,l),n[f]=d,[o,l]=[l,o];t.push([_.DISTANCETOSTART,new k(n,t[0][1].indices,1,!0)])}function ln(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}const hn=y(),cn=y();function eo(e,t,r,i){const s=e.type==="polygon"?et.CCW_IS_HOLE:et.NONE,a=e.type==="polygon"?e.rings:e.paths,{position:n,outlines:o}=Ur(a,!!e.hasZ,s,e.spatialReference),l=Ir(n.length),d=Is(n,e.spatialReference,0,l,0,n,0,n.length/3,t,r,i),p=d!=null;return{lines:p?Kr(o,n,l):[],projectionSuccess:p,sampledElevation:d}}function to(e,t){const r=e.type==="polygon"?et.CCW_IS_HOLE:et.NONE,i=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:a}=Ur(i,!1,r),n=Ts(s,e.spatialReference,0,s,t,0);for(let o=2;o<s.length;o+=3)s[o]=Wa;return{lines:n?Kr(a,s):[],projectionSuccess:n}}function Kr(e,t,r=null){const i=new Array;for(const{index:s,count:a}of e){if(a<=1)continue;const n=3*s,o=3*a;i.push({position:Wt(t,3*s,3*a),mapPositions:r!=null?Wt(r,n,o):void 0})}return i}const ro=ie().vec3f(_.POSITION),io=ie().vec3f(_.POSITION).vec2f16(_.UV0),so=ie().vec3f(_.POSITION).vec4u8(_.COLOR);ie().vec3f(_.POSITION).vec2f16(_.UV0).vec4u8(_.OLIDCOLOR);const ao=ie().vec3f(_.POSITION).vec2f(_.UV0),no=ie().vec3f(_.POSITION).vec2f(_.UV0).vec4u8(_.OLIDCOLOR);export{$r as A,Gs as C,ia as E,jr as F,Sr as G,Br as M,ha as N,sr as O,ir as T,ua as V,pa as W,Xn as Y,kr as a,oa as b,rt as c,Zn as d,Ha as e,to as f,Kn as g,no as h,qa as i,Qn as j,J as k,kn as l,eo as m,Yn as p,Wa as r,$a as s,Jn as t,ro as v,ao as w,io as x,so as y,Xr as z};
