import{bp as m,aP as g,aj as k,P as b,ah as T,e_ as w,e$ as S,f0 as v,f1 as M,x as C,av as H,eb as D,al as A,m as p,E as d,n as x}from"./index-BeTPrQ6f.js";import{r as y}from"./Queue-CK6TduSr-C-T211SM.js";import{o as R}from"./signal-DHxLvooI-Bin-tnuW.js";import{m as K}from"./Version-DSJSGSLA-Cg87msWM.js";const P=T("mac")?"Meta":"Control",G=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),L=e=>G.has(e);let q=class{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const t=e.modifiers;for(const i of this.keyModifiers)if(!t.has(i))return!1;return!0}},E=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const i of t)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(t=>this._handleEvent(t)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let n;typeof t=="function"?(i=t,n=[]):n=t||[];const s=typeof e=="string"?new q(e,n):e,r=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},o=h=>{const u=this._incoming[h.match.eventType];if(u){const I=u.indexOf(h);u.splice(I,1),r(),this._manager&&this._manager.updateDependencies()}},a=new z(s,i,{onPause:o,onRemove:o,onResume:h=>{const u=this._incoming[h.match.eventType];u&&!u.includes(h)&&(u.push(h),r(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(a),r(),this._manager&&this._manager.updateDependencies(),a}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new O(e,{onEmit:(i,n,s,r)=>{var o;(o=this._manager)==null||o.emit(i.eventType,n,s,r)},onRemove:i=>{var n;delete this._outgoing[i.eventType],(n=this._manager)==null||n.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){var t;(t=this._manager)==null||t.setPointerCapture(e,!0)}stopCapturingPointer(e){var t;(t=this._manager)==null||t.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){var i;const t=this._incoming[e.type];if(t){for(const n of t)if(n.match.matches(e)&&((i=n.callback)==null||i.call(n,e),e.shouldStopPropagation()))break}}},z=class{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},O=class{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},U=class extends E{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this._id=null,this.registerIncoming("pointer-move",t=>this._update(t.data))}_update(e){const t=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:n,native:{pointerId:s}}=e;t===this._value&&this._x===i&&this._y===n&&this._id===s||(this._value=t,this._x=i,this._y=n,this._id=s,this._onChange(s,t,i,n))}},N=class extends E{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=R(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},j=class{constructor(e,t){this._owner=t,this._properties={},this._afterDispatchHandle=null;for(const i in e){const n=e[i],s=new w(n,void 0,void 0,2,2);this._properties[i]={pool:s,acquired:[]}}this._afterDispatchHandle=S(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const t=this._properties[e];for(const i of t.acquired)v(i)||t.pool.release(i);t.pool.destroy(),t.pool=null,t.acquired=null}this._properties=null,this._owner=null}get(e){const t=this._owner._get(e),i=this._properties[e];let n=i.pool.acquire();for(i.acquired.push(n);n===t;)n=i.pool.acquire(),i.acquired.push(n);return M(),n}_release(){for(const e in this._properties){const t=this._properties[e];let i=0;for(const n of t.acquired)v(n)?t.acquired[i++]=n:t.pool.release(n);t.acquired.length=i}}},W=class{constructor(){this.id=0,this.type="mouse",this.location=g()}},l=class extends k{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=P,this._propertiesPool=new j({latestPointerInfo:()=>new W},this),this._latestPointerInfo=void 0,this._paused=!1,this._testTimestamp=void 0}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get latestPointerInfo(){return this._latestPointerInfo}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,t,i=_.INTERNAL){if(this._nameToGroup[e]||t.length===0)return;const n={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const r=n.handlers[s];this._handlers.push(r),r.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,c,h,u)=>{this._emitInputEvent(r.priorityIndex+1,o,a,c,u,h)},setPointerCapture:(o,a)=>{this._setPointerCapture(n,r,o,a)},setEventCallback:o=>{r.eventCallback=o},setUninstallCallback:o=>{r.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(i=>{var n;i.removed=!0,(n=i.uninstallCallback)==null||n.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):b.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const n=this._handlers[i];n.priorityIndex=i,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s){for(const r of n.handler.outgoingEventTypes)if(e.has(r)){s=!0;break}}if(s)for(const r of n.handler.incomingEventMatches){e.add(r.eventType);for(const o of r.keyModifiers)L(o)||t.add(o)}n.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,i,n){const s=this._latestPointerInfo;if(s==null||s.id!==e||s.type!==t||s.location.x!==i||s.location.y!==n){const r=this._propertiesPool.get("latestPointerInfo");r.id=e,r.type=t,r.location.x=i,r.location.y=n,this._latestPointerInfo=r}}_onEventReceived(e,t){var s,r;if(e==="pointer-capture-lost"){const o=t;this._pointerCaptures.delete(o.native.pointerId)}this._updateKeyModifiers(e,t);const i=this._testTimestamp??((s=t.native)==null?void 0:s.timestamp),n=(r=t.native)==null?void 0:r.cancelable;this._emitInputEventFromSource(e,t,i,n)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const n=()=>{i||(this._activeKeyModifiers=new Set(this._activeKeyModifiers),i=!0)},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(n(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(n(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const r=t.native;s("Alt",!!(r!=null&&r.altKey)),s("Control",!!(r!=null&&r.ctrlKey)),s("Ctrl",!!(r!=null&&r.ctrlKey)),s("Shift",!!(r!=null&&r.shiftKey)),s("Meta",!!(r!=null&&r.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new U((e,t,i,n)=>this._setLatestPointer(e,t,i,n)),this._multiTouchHandler=new N,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],_.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,_.INTERNAL)}_setPointerCapture(e,t,i,n){const s=e.name+"-"+t.priorityIndex,r=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,r),n?(r.add(s),r.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):r.has(s)&&(r.delete(s),r.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,i,n){this._emitInputEvent(0,e,t,i,n)}_emitInputEvent(e,t,i,n,s,r){var h;const o=n??((h=this._currentPropagation)==null?void 0:h.timestamp)??performance.now(),a=s??!1,c={event:new Y(t,i,o,r||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new y,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var t,i,n;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:s,priorityIndex:r}=e.events.pop(),o=(t=s.data)==null?void 0:t.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!s.shouldStopPropagation()&&((n=(i=e.currentHandler).eventCallback)==null||n.call(i,s)),s.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(s.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:s,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new y;t.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)t.push(i.events.pop());i.events=t,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const n of t.handler.incomingEventMatches){if(i.eventType!==n.eventType)continue;const s=i.keyModifiers.filter(r=>n.keyModifiers.includes(r));if(s.length===i.keyModifiers.length!=(s.length===n.keyModifiers.length))return i.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let n=0;for(;n<t.length&&this._compareHandlerPriority(i,t[n])>=0;)n++;t.splice(n,0,i)}return t}get test(){}};p([d({readOnly:!0})],l.prototype,"hasPendingInputs",null),p([d({constructOnly:!0})],l.prototype,"eventSource",void 0),p([d({constructOnly:!0})],l.prototype,"recognizers",void 0),p([d()],l.prototype,"multiTouchActive",null),p([d()],l.prototype,"_latestPointerInfo",void 0),p([d()],l.prototype,"latestPointerInfo",null),p([d()],l.prototype,"_paused",void 0),p([d({readOnly:!0})],l.prototype,"updating",null),l=p([x("esri.views.input.InputManager")],l);class Y{constructor(t,i,n,s,r){this.type=t,this.data=i,this.timestamp=n,this.modifiers=s,this.cancelable=r,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return!!(1&this._propagationState)}defer(t){this._propagationState|=2;const i=(n,s)=>{this._propagationState&=-3;const r=this._resumeCallback;if(this._resumeCallback=null,r&&r(),s)throw n;return n};return(typeof t=="function"?t():t).then(n=>i(n,!1),n=>i(n,!0))}shouldPausePropagation(t){return!!(2&this._propagationState)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}const _={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3},B="z",F="r",$={cancel:"Escape",complete:"Enter"},ie={...$,redo:F,undo:B,center:"Alt",constraint:"Shift",delete:["Backspace","Delete"],vertexAdd:"f",pan:" "},ne={toggle:"Control"},se={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},re={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:P,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0}},oe={invertType:["Control","Meta"]};class ae{constructor(){this._bindings=new Map}add(t,i){return this.addToggle(t,n=>{n.type==="key-down"&&i(n)})}addToggle(t,i){const n=f.fromDefinition(t,i),s=C(this._bindings,n.key,()=>[]);return s.push(n),H(()=>D(s,n))}register(t,i=_.WIDGET){return A([t.on("key-down",n=>this.dispatch(t.inputManager,n),i),t.on("key-up",n=>this.dispatch(t.inputManager,n),i)])}dispatch(t,i){const n=i.key,s=this._bindings.get(n);if(s)for(const r of s)r.process(t,i)}}class f{constructor(t,i,n,s,r){this.key=t,this.modifiers=i,this.repeats=n,this.continuePropagation=s,this.callback=r}process(t,i){if(!(i.key!==this.key||"repeat"in i&&i.repeat&&!this.repeats)){for(const n of this.modifiers)if(!t.isModifierKeyDown(n))return;this.continuePropagation||i.stopPropagation(),this.callback(i)}}static fromDefinition(t,i){if(typeof t=="string")return new f(t,[],!1,!1,i);const{key:n,modifier:s,repeats:r,continuePropagation:o}=t;return new f(n,s?Array.isArray(s)?s:[s]:[],!!r,!!o,i)}}function X(e){return g(e.x,e.y)}function Z(e,t){var n;const i=(n=e instanceof HTMLElement?e:e.surface)==null?void 0:n.getBoundingClientRect();return i?g(t.clientX-i.left,t.clientY-i.top):g(0,0)}function he(e,t){return t instanceof Event?Z(e,t):X(t)}function le(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}const ce=new m("cyan"),ue=1,pe=.25,de=new m("black"),_e=.4,ge=.2,fe=.25,me="default",ve="temporary",ye=new m("yellow"),Pe={button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",empty:"esri-widget__content--empty",heading:"esri-widget__heading",interactive:"esri-interactive",panel:"esri-widget--panel",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button"};class J extends K{constructor(t,i){super(t,i,"webmap")}}function Ee(e){return e!=null&&typeof e=="object"&&"declaredClass"in e&&e.declaredClass==="esri.WebMap"}new J(2,35);export{ne as $,X as I,Z as T,ie as V,se as Z,_,pe as a,$ as b,ge as c,me as d,l as e,ye as f,Pe as g,de as h,ae as i,re as j,j as k,_e as l,Ee as m,he as n,ue as o,fe as p,ce as r,le as s,oe as t,ve as u,E as v,P as y};
