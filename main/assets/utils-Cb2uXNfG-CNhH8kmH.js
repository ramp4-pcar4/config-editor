const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./symbolLayerUtils-Ccqq9A9S-BwGfMjU7.js","./index-JysQxb7m.js","./index-BQSptJp9.css","./LRUCache-DPWdPNTF-BhV6gJVw.js","./MemCache-qDGoejB7-Bz_y0gIH.js"])))=>i.map(i=>d[i]);
import{ad as f,N as _,bH as m,fi as p,f8 as u,bn as S,f7 as E,fj as N,fk as R,_ as A}from"./index-JysQxb7m.js";import{f as O}from"./asyncUtils-BPUlNCrX-BS2LVKAY.js";import{c as P}from"./jsonUtils-BwLwuQj7-Bu_6JrpW.js";import{g as w}from"./cimSymbolUtils-DCedSSCN-C5MSTcya.js";import{i as $}from"./LRUCache-DPWdPNTF-BhV6gJVw.js";const g="picture-fill",k="simple-fill",D="simple-line",x="simple-marker",H="text",I="cim",b=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),d=new $(1e3);function ot(t){const n=t.style;let r=null;if(t)switch(t.type){case x:n!=="cross"&&n!=="x"&&(r=t.color);break;case k:n&&n!=="solid"?n!=="none"&&(r={type:"pattern",x:0,y:0,src:S(`esri/symbols/patterns/${n}.png`),width:5,height:5}):r=t.color;break;case g:r={type:"pattern",src:t.url,width:u(t.width)*t.xscale,height:u(t.height)*t.yscale,x:u(t.xoffset),y:u(t.yoffset)};break;case H:r=t.color;break;case I:r=w(t)}return r}function lt(t,n){const r=t+"-"+n;return d.get(r)!==void 0?Promise.resolve(d.get(r)):_(t,{responseType:"image"}).then(e=>{const o=e.data,l=o.naturalWidth,i=o.naturalHeight,s=document.createElement("canvas");s.width=l,s.height=i;const a=s.getContext("2d");a.fillStyle=n,a.fillRect(0,0,l,i),a.globalCompositeOperation="destination-in",a.drawImage(o,0,0);const c=s.toDataURL();return d.put(r,c),c})}function L(t){if(!t)return null;let n=null;switch(t.type){case k:case g:case x:n=L(t.outline);break;case D:{const r=u(t.width);t.style!=null&&t.style!=="none"&&r!==0&&(n={color:t.color,style:V(t.style),width:r,cap:t.cap,join:t.join==="miter"?u(t.miterLimit):t.join},n.dashArray=U(n).join(",")||"none");break}default:n=null}return n}function U(t){if(!(t!=null&&t.style))return[];const{dashArray:n,style:r,width:e}=t;if(typeof n=="string"&&n!=="none")return n.split(",").map(i=>Number(i));const o=e??0,l=b.has(r)?b.get(r).map(i=>i*o):[];if(t.cap!=="butt")for(const[i,s]of l.entries())l[i]=i%2==1?s+o:Math.max(s-o,1);return l}const V=(()=>{const t={};return n=>{if(t[n])return t[n];const r=n.replaceAll("-","");return t[n]=r,r}})(),it=new f([128,128,128]),q=new f("white");function B(t){var r,e;const n=(r=t.symbolLayers)==null?void 0:r.at(-1);if(n&&"outline"in n)return(e=n==null?void 0:n.outline)==null?void 0:e.size}function at(t){var n;return t?m(t)?B(t)??0:E((n=L(t))==null?void 0:n.width):0}function st(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(n=>n.type==="object");case"line-3d":return t.symbolLayers.some(n=>n.type==="path");case"polygon-3d":return t.symbolLayers.some(n=>n.type==="object"||n.type==="extrude");default:return!1}}function ct(t){var n;return((n=t.resource)==null?void 0:n.href)??""}function ut(t,n){if(!t)return null;let r=null;return m(t)?r=C(t):p(t)&&(r=t.type==="cim"?w(t):t.color?new f(t.color):null),r?y(r,n):null}function C(t){const n=t.symbolLayers;if(!n)return null;let r=null;return n.forEach(e=>{var o;e.type==="object"&&((o=e.resource)!=null&&o.href)||(r=e.type==="water"?e.color:e.material?e.material.color:null)}),r?new f(r):null}function y(t,n){if(n==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*n,new f(r)}function J(t,n,r){const e=t.symbolLayers;if(!e)return;const o=l=>y(n??l??(r!=null?q:null),r);e.forEach(l=>{var i,s;if(l.type!=="object"||!((i=l.resource)!=null&&i.href)||n)if(l.type==="water")l.color=o(l.color);else{const a=l.material!=null?l.material.color:null,c=o(a);if(l.material==null?l.material=new N({color:c}):l.material.color=c,r!=null&&"outline"in l&&((s=l.outline)==null?void 0:s.color)!=null&&(l.outline.color=y(l.outline.color,r)),"marker"in l&&l.marker!=null){const v=o(l.marker.color);l.marker.color=v}}})}function M(t,n,r){var e;(n=n??t.color)&&(t.color=y(n,r)),r!=null&&"outline"in t&&((e=t.outline)!=null&&e.color)&&(t.outline.color=y(t.outline.color,r))}function ft(t,n,r){t&&(n||r!=null)&&(n&&(n=new f(n)),m(t)?J(t,n,r):p(t)&&M(t,n,r))}async function Q(t,n){const r=t.symbolLayers;r&&await O(r,async e=>T(e,n))}async function T(t,n){switch(t.type){case"extrude":F(t,n);break;case"icon":case"line":case"text":W(t,n);break;case"path":K(t,n);break;case"object":await G(t,n)}}function W(t,n){const r=j(n);r!=null&&(t.size=r)}function j(t){for(const n of t)if(typeof n=="number")return n;return null}function F(t,n){const r=n[2];typeof r=="number"&&(t.size=r)}async function G(t,n){const{resourceSize:r,symbolSize:e}=await X(t),o=z(n,r,e);o!=null&&(t.width=h(n[0],e[0],r[0],o),t.depth=h(n[1],e[1],r[1],o),t.height=h(n[2],e[2],r[2],o))}function K(t,n){const r=z(n,R,[t.width,void 0,t.height]);r!=null&&(t.width=h(n[0],t.width,1,r),t.height=h(n[2],t.height,1,r))}function z(t,n,r){for(let e=0;e<3;e++){const o=t[e];switch(o){case"symbol-value":{const l=r[e];return l!=null?l/n[e]:1}case"proportional":break;default:if(o&&n[e])return o/n[e]}}return null}async function X(t){const{computeObjectLayerResourceSize:n}=await A(()=>import("./symbolLayerUtils-Ccqq9A9S-BwGfMjU7.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),r=await n(t,10),{width:e,height:o,depth:l}=t,i=[e,l,o];let s=1;for(let a=0;a<3;a++){const c=i[a];if(c!=null){s=c/r[a];break}}for(let a=0;a<3;a++)i[a]==null&&(i[a]=r[a]*s);return{resourceSize:r,symbolSize:i}}function h(t,n,r,e){switch(t){case"proportional":return r*e;case"symbol-value":return n??r;default:return t}}function Y(t,n){const r=j(n);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const e=t.width/t.height;e>1?(t.width=r,t.height=r*e):(t.width=r*e,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function ht(t,n){if(t&&n)return m(t)?Q(t,n):void(p(t)&&Y(t,n))}function yt(t,n,r){if(t&&n!=null)if(m(t)){const e=t.symbolLayers;e&&e.forEach(o=>{if(o.type==="object")switch(r){case"tilt":o.tilt=(o.tilt??0)+n;break;case"roll":o.roll=(o.roll??0)+n;break;default:o.heading=(o.heading??0)+n}o.type==="icon"&&(o.angle+=n)})}else p(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=n))}function mt(t){if(!t)return null;const n=t.effects.filter(r=>r.type!=="bloom").map(r=>r.toJSON());return P(n)}function pt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(n=>n.type==="extrude")}export{st as $,ct as B,ut as F,ot as H,lt as I,it as J,at as W,ft as _,pt as a,L as b,mt as i,U as j,yt as l,ht as s,V as z};
