const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./geometryServiceUtils-DvEWJN_g-COD6bX2w.js","./index-12gn5LMs.js","./index-6GCfk1Ih.css","./project-TZjL1vJA-7nGAEaVv.js","./utils-BO8hgPs3-CSpNGQF8.js","./utils-DpLVEUvg-D1Ynm5FY.js"])))=>i.map(i=>d[i]);
import{h as c,bC as v,_ as M,u as b}from"./index-12gn5LMs.js";import{i as d}from"./HeightModelInfo-C4voFc4k-DOxXcHQ7.js";import{J as U,k,L as R,O as I,K as H}from"./projectionUtils-B-CplN3q-BJPnkKI4.js";function z(e,i,o){const t=C(e),n=i,g=T(t,n,o);if(t){const r=d.deriveUnitFromSR(t,e.spatialReference).heightUnit;if(!o&&r!==t.heightUnit){const s=new c("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${r})`,{horizontalUnit:r});return new c("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:t,error:s})}}if(!S(e)||g===a.Unsupported)return new c("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:t});switch(g){case a.Units:{const r=(t==null?void 0:t.heightUnit)||"unknown",s=(n==null?void 0:n.heightUnit)||"unknown",l=new c("layerview:incompatible-height-unit",`The vertical units of the layer (${r}) must match the vertical units of the scene (${s})`,{layerUnit:r,sceneUnit:s});return new c("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:t,sceneHeightModelInfo:n,error:l})}case a.HeightModel:{const r=(t==null?void 0:t.heightModel)||"unknown",s=(n==null?void 0:n.heightModel)||"unknown",l=new c("layerview:incompatible-height-model",`The height model of the layer (${r}) must match the height model of the scene (${s})`,{layerHeightModel:r,sceneHeightModel:s});return new c("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:t,sceneHeightModelInfo:n,error:l})}case a.CRS:{const r=(t==null?void 0:t.vertCRS)||"unknown",s=(n==null?void 0:n.vertCRS)||"unknown",l=new c("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${r}) must match the vertical datum of the scene (${s})`,{layerDatum:r,sceneDatum:s});return new c("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:t,sceneHeightModelInfo:n,error:l})}}return null}function T(e,i,o){if(!f(e)||!f(i))return a.Unsupported;if(e==null||i==null)return a.Ok;if(!o&&e.heightUnit!==i.heightUnit)return a.Units;if(e.heightModel!==i.heightModel)return a.HeightModel;switch(e.heightModel){case"gravity-related-height":return a.Ok;case"ellipsoidal":return e.vertCRS===i.vertCRS?a.Ok:a.CRS;default:return a.Unsupported}}var a;function f(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function S(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!y(e)}function C(e){var o;if(e.type==="integrated-mesh-3dtiles")return null;const i=e.url?v(e.url):void 0;return!(((o=e.spatialReference)==null?void 0:o.vcsWkid)==null&&i!=null&&i.serverType==="ImageServer")&&p(e)&&e.heightModelInfo?e.heightModelInfo:y(e)?d.deriveUnitFromSR($,e.spatialReference):null}function p(e){return"heightModelInfo"in e}function m(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function y(e){return m(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):w(e)}function P(e){return e.layers!=null||w(e)||m(e)||p(e)}function w(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(a||(a={}));const $=new d({heightModel:"gravity-related-height"});let u,h=null;async function O(e){h||(h=M(()=>import("./geometryServiceUtils-DvEWJN_g-COD6bX2w.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(i=>u=i)),await h,b(e)}async function _(e,i,o,t){if(!e)return null;const n=e.spatialReference;return k()||R(n,i)?I(e,i):u?u.projectGeometry(e,i,o,t):(await Promise.race([O(t),H(t)]),_(e,i,o,t))}async function q(e,i){try{return e!=null&&e.spatialReference?await U(e,i):null}catch{return null}}export{P as $,q as F,_ as M,z as T,C as p};
