var I=Object.defineProperty;var N=(y,a,n)=>a in y?I(y,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):y[a]=n;var $=(y,a,n)=>N(y,typeof a!="symbol"?a+"":a,n);import{gV as M,hf as T,gS as Y,hk as P,gW as W,hy as j,gX as L,gY as x,g$ as q,g_ as D,gT as A,h1 as G,h4 as J,h6 as U,h7 as X,hm as C,h5 as F,iz as Q,j4 as K,hj as Z}from"./index-BeTPrQ6f.js";const ee={class:"swipe-container"},ae=["id","aria-valuenow","aria-label","content"],te=["swipe-position","view"],ie=Y({__name:"swipe",props:{fixture:{type:M,required:!0},message:String},setup(y){const a=P("iApi"),n=W(),e=j("slider"),_=L(45),E=L(0),f=L(0),S=L(50),R=L(),t=L(),O=x(()=>{var h,w,r,u;const i=30+f.value-f.value,c=(h=e.value)!=null&&h.getBoundingClientRect()?((w=e.value)==null?void 0:w.getBoundingClientRect().right)-((r=e.value)==null?void 0:r.getBoundingClientRect().left):0,s=+_.value/90,o=(c-i)*s,d=(((u=e.value)==null?void 0:u.getBoundingClientRect().x)??0)+o+(i-5.25)/2;return S.value=d/a.$rootEl.clientWidth*100+.2,`${d}px`}),V=x(()=>`${E.value}px`),H=x(()=>`${-E.value/2-18}px`),B=y;q(()=>{var i;E.value=((i=a.$rootEl)==null?void 0:i.clientHeight)??1200});const k=()=>{var i;E.value=((i=a.$rootEl)==null?void 0:i.clientHeight)??E.value,f.value++,setTimeout(()=>{f.value++},50)},m=()=>{n.setOpacity(.1),e.value.style.background=""},p=()=>{n.setOpacity(1),e.value.style.background="inherit"};D(async()=>{var c,s,o,d,h,w;"ontouchstart"in document.documentElement||!window.matchMedia("(pointer:fine)").matches||(e.value.style.background="inherit"),window.addEventListener("resize",k),(c=e.value)==null||c.addEventListener("focus",m),(s=e.value)==null||s.addEventListener("blur",p),(o=e.value)==null||o.addEventListener("mouseover",m),(d=e.value)==null||d.addEventListener("mouseleave",p),(h=e.value)==null||h.addEventListener("touchstart",m),(w=e.value)==null||w.addEventListener("touchend",p),setTimeout(()=>{f.value++},50),await z();const i=()=>{var u;const r=(u=t.value)==null?void 0:u.querySelector(".arcgis-swipe__container");return r?(r.removeAttribute("tabindex"),!0):!1};if(!i()){const r=new MutationObserver((u,g)=>{i()&&g.disconnect()});r.observe(t.value,{childList:!0,subtree:!0,attributes:!1}),setTimeout(()=>r.disconnect(),5e3)}a.event.on(A.MAP_BASEMAPCHANGE,async r=>{var u,g;r.schemaChanged&&((u=t.value)==null||u.trailingLayers.forEach(v=>{var l;(l=t.value)==null||l.trailingLayers.remove(v)}),(g=t.value)==null||g.leadingLayers.forEach(v=>{var l;(l=t.value)==null||l.leadingLayers.remove(v)}),await z())}),a.event.on(A.LAYER_RELOAD_END,r=>{var u,g;(u=t.value)==null||u.trailingLayers.forEach(v=>{var l,b;v.id===r.id&&((l=t.value)==null||l.trailingLayers.remove(v),(b=t.value)==null||b.trailingLayers.add(r.esriLayer))}),(g=t.value)==null||g.leadingLayers.forEach(v=>{var l,b;v.id===r.id&&((l=t.value)==null||l.leadingLayers.remove(v),(b=t.value)==null||b.leadingLayers.add(r.esriLayer))})}),a.event.on(A.LAYER_REMOVE,r=>{var u,g;(u=t.value)==null||u.trailingLayers.forEach(v=>{var l;v.id===r.id&&((l=t.value)==null||l.trailingLayers.remove(v))}),(g=t.value)==null||g.leadingLayers.forEach(v=>{var l;v.id===r.id&&((l=t.value)==null||l.leadingLayers.remove(v))})})});const z=async()=>{await a.geo.map.viewPromise,R.value=a.geo.map.esriView;const i=B.fixture.trailing,c=B.fixture.leading;i.forEach(s=>{a.geo.layer.awaitLayer(s,!0).then(o=>{var d;o.esriLayer?(d=t.value)==null||d.trailingLayers.add(o.esriLayer):console.warn(`Invalid layer instance: ${s}`)})}),c.forEach(s=>{a.geo.layer.awaitLayer(s,!0).then(o=>{var d;o.esriLayer?(d=t.value)==null||d.leadingLayers.add(o.esriLayer):console.warn(`Invalid layer instance: ${s}`)})})};return G(()=>{var i,c,s,o,d,h;window.removeEventListener("resize",k),(i=e.value)==null||i.removeEventListener("focus",()=>m),(c=e.value)==null||c.removeEventListener("blur",()=>p),(s=e.value)==null||s.removeEventListener("mouseover",m),(o=e.value)==null||o.removeEventListener("mouseleave",p),(d=e.value)==null||d.removeEventListener("touchstart",m),(h=e.value)==null||h.removeEventListener("touchend",p)}),(i,c)=>{const s=J("tippy");return X(),U("div",ee,[C("div",{class:"verticalLine",style:Q({left:O.value,height:V.value,bottom:H.value})},null,4),F(C("input",{"onUpdate:modelValue":c[0]||(c[0]=o=>_.value=o),id:"layerSlider"+Z(a).$element._uid,class:"layerSliderElement",type:"range",ref_key:"slider",ref:e,min:"0","aria-valuemin":"0","aria-valuemax":"90","aria-valuenow":_.value,"aria-label":i.$t("map.layerSwipe.label"),max:"90",step:"0.5",content:i.$t("map.layerSwipe.drag"),style:{"z-index":10}},null,8,ae),[[K,_.value],[s,{followCursor:!0,trigger:"mouseenter"}]]),C("arcgis-swipe",{direction:"horizontal","swipe-position":S.value,view:R.value,"auto-destroy-disable":"",ref_key:"swipeComponent",ref:t},null,8,te)])}}}),re=T(ie,[["__scopeId","data-v-49cd9ac9"]]);class se extends M{constructor(){super(...arguments);$(this,"leading",[]);$(this,"trailing",[])}_parseConfig(n){this.leading=(n==null?void 0:n.leading)??[],this.trailing=(n==null?void 0:n.trailing)??[]}async added(){this._parseConfig(this.config);const{el:n,destroy:e}=this.mount(re,{app:this.$element,props:{fixture:this}});n.childNodes[0]&&this.$vApp.$el.appendChild(n.childNodes[0]),this.removed=()=>{e()}}}export{se as default};
