import{v as o,S as i,cY as H,F as S,w as E,n as y,x as I,X as T,ad as U,I as b,dN as C,aF as x,a6 as R,q as f}from"./index-DRDU_nTl.js";import{g as O}from"./imageUtils-D3tfFRL_-CBYTfd6H.js";import{i as _,c as $}from"./meshProperties-D3dLIiIV-CfHVFTP-.js";var m;const v=new WeakMap;let P=0;var d;let a=(d=class extends T{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,r,s,n){if(t instanceof HTMLImageElement){const c={type:"image-element",src:C(t.src,n),crossOrigin:t.crossOrigin};r[s]=c}else if(t instanceof HTMLCanvasElement){const c={type:"canvas-element",imageData:W(t.getContext("2d").getImageData(0,0,t.width,t.height))};r[s]=c}else if(t instanceof HTMLVideoElement){const c={type:"video-element",src:C(t.src,n),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};r[s]=c}else if(t instanceof ImageData){const c={type:"image-data",imageData:W(t)};r[s]=c}}readData(t){switch(t.type){case"image-element":{const r=new Image;return r.src=t.src,r.crossOrigin=t.crossOrigin,r}case"canvas-element":{const r=N(t.imageData),s=document.createElement("canvas");return s.width=r.width,s.height=r.height,s.getContext("2d").putImageData(r,0,0),s}case"image-data":return N(t.imageData);case"video-element":{const r=document.createElement("video");return r.src=t.src,r.crossOrigin=t.crossOrigin,r.autoplay=t.autoplay,r.loop=t.loop,r.muted=t.muted,r.preload=t.preload,r}default:return}}get transparent(){const{data:t,url:r}=this,s=n=>(n==null?void 0:n.toLowerCase().endsWith(".png"))||(n==null?void 0:n.toLocaleLowerCase().startsWith("data:image/png;"));return t instanceof HTMLCanvasElement?L(t.getContext("2d").getImageData(0,0,t.width,t.height)):t instanceof ImageData?L(t):!(!r||!s(r))||!!(t instanceof HTMLImageElement&&s(t.src))}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",r=(s="")=>`d:${s},t:${this.transparent},w:${t}`;return this.url!=null?r(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?r(this.data.src):(v.has(this.data)||v.set(this.data,++P),r(v.get(this.data))):r()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const r=this.data;"data"in r?t+=r.data.byteLength:r instanceof HTMLImageElement?t+=r.naturalWidth*r.naturalHeight*3:r instanceof HTMLCanvasElement&&(t+=r.width*r.height*3)}return t}clone(){const t={url:this.url,data:this.data,transparent:this.transparent,wrap:this._cloneWrap()};return new m(t)}cloneWithDeduplication(t){const r=t.get(this);if(r)return r;const s=this.clone();return t.set(this,s),s}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(t){return typeof t=="string"?new m({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new m({data:t}):x(m,t)}},m=d,d);function W(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}function N(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return O(r,e.width,e.height)}function L(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}o([i({type:String,json:{write:H}})],a.prototype,"url",null),o([i({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),i()],a.prototype,"data",null),o([S("data")],a.prototype,"writeData",null),o([E("data")],a.prototype,"readData",null),o([i({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],a.prototype,"transparent",null),o([i({json:{write:!0}})],a.prototype,"wrap",void 0),o([i({readOnly:!0})],a.prototype,"contentHash",null),a=m=o([y("esri.geometry.support.MeshTexture")],a);let h=class extends I.ClonableMixin(T){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};o([i({type:[Number],nonNullable:!0,json:{write:!0}})],h.prototype,"offset",void 0),o([i({type:Number,nonNullable:!0,json:{write:!0}})],h.prototype,"rotation",void 0),o([i({type:[Number],nonNullable:!0,json:{write:!0}})],h.prototype,"scale",void 0),h=o([y("esri.geometry.support.MeshTextureTransform")],h);var w;let l=w=class extends T{constructor(e){super(e),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=e!=null?e.get(this):null;if(r)return r;const s=new w(this.clonePropertiesWithDeduplication(t));return e==null||e.set(this,s),s}clonePropertiesWithDeduplication(e){var t,r,s,n;return{color:this.color!=null?this.color.clone():null,colorTexture:(t=this.colorTexture)==null?void 0:t.cloneWithDeduplication(e),normalTexture:(r=this.normalTexture)==null?void 0:r.cloneWithDeduplication(e),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(s=this.colorTextureTransform)==null?void 0:s.clone(),normalTextureTransform:(n=this.normalTextureTransform)==null?void 0:n.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let e=0;return e+=this.color!=null?16:0,this.colorTexture!=null&&(e+=this.colorTexture.memoryUsage),e+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(e+=this.normalTexture.memoryUsage),e+=this.normalTextureTransform!=null?20:0,e}};o([i({type:U,json:{write:!0}})],l.prototype,"color",void 0),o([i({type:a,json:{write:!0}})],l.prototype,"colorTexture",void 0),o([i({type:h,json:{write:!0}})],l.prototype,"colorTextureTransform",void 0),o([i({type:a,json:{write:!0}})],l.prototype,"normalTexture",void 0),o([i({type:h,json:{write:!0}})],l.prototype,"normalTextureTransform",void 0),o([i({nonNullable:!0,json:{write:!0}})],l.prototype,"alphaMode",void 0),o([i({nonNullable:!0,json:{write:!0}})],l.prototype,"alphaCutoff",void 0),o([i({nonNullable:!0,json:{write:!0}})],l.prototype,"doubleSided",void 0),l=w=o([y("esri.geometry.support.MeshMaterial")],l);var M;let u=M=class extends l{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=e!=null?e.get(this):null;if(r)return r;const s=new M(this.clonePropertiesWithDeduplication(t));return e==null||e.set(this,s),s}getMemoryUsage(){let e=super.getMemoryUsage();return e+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(e+=this.emissiveTexture.memoryUsage),e+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(e+=this.occlusionTexture.memoryUsage),e+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(e+=this.metallicRoughnessTexture.memoryUsage),e+=this.metallicRoughnessTextureTransform!=null?20:0,e}clonePropertiesWithDeduplication(e){var t,r,s,n,c,D,j;return{...super.clonePropertiesWithDeduplication(e),emissiveColor:(t=this.emissiveColor)==null?void 0:t.clone(),emissiveTexture:(r=this.emissiveTexture)==null?void 0:r.cloneWithDeduplication(e),emissiveTextureTransform:(s=this.emissiveTextureTransform)==null?void 0:s.clone(),occlusionTexture:(n=this.occlusionTexture)==null?void 0:n.cloneWithDeduplication(e),occlusionTextureTransform:(c=this.occlusionTextureTransform)==null?void 0:c.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(D=this.metallicRoughnessTexture)==null?void 0:D.cloneWithDeduplication(e),metallicRoughnessTextureTransform:(j=this.metallicRoughnessTextureTransform)==null?void 0:j.clone()}}};o([i({type:U,json:{write:!0}})],u.prototype,"emissiveColor",void 0),o([i({type:a,json:{write:!0}})],u.prototype,"emissiveTexture",void 0),o([i({type:h,json:{write:!0}})],u.prototype,"emissiveTextureTransform",void 0),o([i({type:a,json:{write:!0}})],u.prototype,"occlusionTexture",void 0),o([i({type:h,json:{write:!0}})],u.prototype,"occlusionTextureTransform",void 0),o([i({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],u.prototype,"metallic",void 0),o([i({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],u.prototype,"roughness",void 0),o([i({type:a,json:{write:!0}})],u.prototype,"metallicRoughnessTexture",void 0),o([i({type:h,json:{write:!0}})],u.prototype,"metallicRoughnessTextureTransform",void 0),u=M=o([y("esri.geometry.support.MeshMaterialMetallicRoughness")],u);var g;let p=g=class extends T{static from(e){return x(g,e)}constructor(e){super(e),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(e){return $(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},R.getLogger(this))}castMaterial(e){return x(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?u:l,e)}clone(){return new g({faces:f(this.faces),shading:this.shading,material:f(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(e,t){const r={faces:f(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new g(r)}get memoryUsage(){let e=0;return this.faces!=null&&(e+=this.faces.byteLength),this.material!=null&&(e+=this.material.memoryUsage),e}};o([i({json:{write:_}})],p.prototype,"faces",void 0),o([b("faces")],p.prototype,"castFaces",null),o([i({type:l,json:{write:!0}})],p.prototype,"material",void 0),o([b("material")],p.prototype,"castMaterial",null),o([i({json:{write:!0}})],p.prototype,"name",void 0),o([i({type:String,json:{write:!0}})],p.prototype,"shading",void 0),o([i({type:Boolean})],p.prototype,"trustSourceNormals",void 0),p=g=o([y("esri.geometry.support.MeshComponent")],p);export{a,p as c,u as l,h as u};
