const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./OverrideHelper-DgyARgwI-JQJB6wdi.js","./index-DRDU_nTl.js","./index-6GCfk1Ih.css","./colorUtils-Eg6lOlXm-CIpqqE7k.js","./vec42-D8CJyqHG-DnfLTeQH.js","./common-CYWrYyJl-E8-sukrT.js","./vec4f64-DD-nkcCV-CSNWKRqG.js","./FieldsIndex-Bt0Y8aWr-BXn84fF2.js","./UnknownTimeZone-DxjyzFvs-cjzeJI3F.js","./timeZoneUtils-d5p0Jda1-BUF1-4-D.js","./ArcadeExpression-XjY3x7KV-DNejdRYH.js","./TimeOnly-CGkId3bj-44ueVjBl.js","./enum-g1DWyQyu-BtAPMkcr.js","./utils-BfXZnjCE-SvVDBGfQ.js","./defaultCIMValues-BcSaJjm--58G-soMN.js","./enums-a_LDTPYU-CBIcy3mM.js","./callExpressionWithFeature-Bk8k1lJI-DP7jVp_Z.js","./quantizationUtils-D907S7Bm-CFnglEIz.js"])))=>i.map(i=>d[i]);
import{q as u,d9 as C,N as G,v as s,S as r,F as H,n as v,ad as m,I as te,eJ as k,eK as ie,bf as q,bh as se,x as $,X as _,es as X,eu as Y,a8 as re,bu as oe,eL as z,_ as ne,a6 as N,eM as le,ei as ae}from"./index-DRDU_nTl.js";import{n as K}from"./ClassBreaksRenderer-Bq2XGpfI-XPZkvr3K.js";import{e as A,n as ue,F as j,s as pe,h as ye,l as ce,m as de}from"./commonProperties-CJLeiNuA-CShbG08T.js";import{i as he}from"./LRUCache-DPWdPNTF-BhV6gJVw.js";import{d as me}from"./DictionaryScriptEvaluator-DW5hOK9A-31xRLS33.js";import{f as fe}from"./ArcadeExpression-XjY3x7KV-DNejdRYH.js";import{G as be}from"./utils-BfXZnjCE-SvVDBGfQ.js";import{g as ge,y as ve,c as we}from"./heatmapUtils-DRTN9U3a-14xziRoT.js";import{c as xe}from"./RendererLegendOptions-Bil_IDab-DmYL58TV.js";import{t as Q}from"./SimpleRenderer-C1YRhRzu-B3fJ4OCP.js";import{r as U}from"./UniqueValueRenderer-CLXHFtg9-DeGd1Q65.js";class P{static parse(t,i,o){const n=[],l=[],y=t.split(";");for(let h=0;h<y.length;h++){const p=y[h];if(p){if(p.includes("po:")){const b=p.slice(3).split("|");if(b.length===3){const[w,E,ee]=b,F=Ie(w,E,ee);F&&l.push(F)}}else if(p.includes("|")){for(const b of p.split("|"))if(i.has(b)){n.push(b);break}}else if(i.has(p))n.push(p);else if(h===0){n.length=0,n.push(je(o));break}}}return new P(n,l)}constructor(t,i){this.partNames=t,this.overrides=i}}function Se(e,t){if(e==="DashTemplate")return t.split(" ").map(i=>Number(i));if(e==="Color"){const i=new m(t).toRgba();return[i[0],i[1],i[2],255*i[3]]}return Number(t)}function Ie(e,t,i){return{primitiveName:e,propertyName:t,value:Se(t,i),defaultValue:null}}function je(e){switch(e){case"esriGeometryPolyline":return"Invalid_L";case"esriGeometryPolygon":return"Invalid_A";default:return"Invalid_P"}}const _e={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let W=class{constructor(e,t,i,o){this.url=e,this.fieldMap=i,this.dictionaryInfo=o,this._symbolPartCache=new he(100);const n=async()=>me.from(await o,t,i);this._evaluator=n()}async getSymbolAsync(e,t,i=!0){var w;const o=await this._evaluator,n=(t==null?void 0:t.fields)??fe(e.attributes),l=o.createDictionaryFieldsIndex(n),y=o.evaluate(e,(t==null?void 0:t.scale)??0,l,t==null?void 0:t.spatialReference);if(y==null)return null;const h=oe(e.geometry),p=P.parse(y,o.itemNames,h),b=h==="esriGeometryPoint"&&!((w=e.geometry)!=null&&w.hasZ);return await this._cimPartsToCIMSymbol(e,p.partNames,p.overrides,b,t,i,l)}async getSymbolForControlString(e,t,i){const o=await this._evaluator,n=P.parse(e,o.itemNames,t),l=t==="esriGeometryPoint"&&!i,y=B(await Promise.all(n.partNames.map(h=>this._getSymbolPart(h))),n.overrides,l);return new z({data:y})}async _cimPartsToCIMSymbol(e,t,i,o,n,l,y){const h=t.map(w=>this._getSymbolPart(w,n));let p=await Promise.all(h);if(l&&this.fieldMap&&p.length>0){const{OverrideHelper:w}=await ne(()=>import("./OverrideHelper-DgyARgwI-JQJB6wdi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url);p=u(p);for(const E of p)w.applyDictionaryTextOverrides(E,e,this.fieldMap,y,be(E))}const b=B(p,i,o);return new z({data:b})}async _fetchSymbolPart(e,t){const i=await this.dictionaryInfo,o=(this.url+"/"+i.cimRefTemplateUrl).replaceAll(/\{itemName\}/gi,e),{data:n}=await G(o,{responseType:"json",query:{f:"json"},...t});return n}async _getSymbolPart(e,t){let i=this._symbolPartCache.get(e);return i||(i=this._fetchSymbolPart(e,t),this._symbolPartCache.put(e,i)),i}};function B(e,t,i){if(!e||e.length===0)return null;const o={...e[0]};if(e.length>1){o.effects=null,o.symbolLayers=[];for(const n of e){const l=n;if(l.effects!=null)for(const y of l.symbolLayers)y.effects==null?y.effects=l.effects:y.effects.unshift(...l.effects);o.symbolLayers.unshift(...l.symbolLayers)}}return i&&(o.callout=_e),{type:"CIMSymbolReference",symbol:o,primitiveOverrides:t}}var V;let f=V=class extends A(j){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){const e=this.getDictionaryInfo();return new W(this.url,this.config,this.fieldMap??{},e)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,o){o!=null&&o.origin||super.writeVisualVariables(e,t,i,o)}clone(){return new V({config:u(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:u(this.fieldMap),url:u(this.url),visualVariables:u(this.visualVariables)})}async getSymbolAsync(e,t,i=!0){return this._loader.getSymbolAsync(e,t,i)}async getSymbolForControlString(e,t,i){return this._loader.getSymbolForControlString(e,t,i)}getDictionaryInfo(){return this._dictionaryInfoPromise||(this._dictionaryInfoPromise=this._fetchDictionaryInfo()),this._dictionaryInfoPromise}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await C(e,t,this.scaleExpression);for(const i in this.fieldMap){const o=this.fieldMap[i];t.has(o)&&e.add(o)}}get arcadeRequired(){return!0}getSymbol(){return null}get symbols(){return[]}getAttributeHash(){var e;return((e=this.visualVariables)==null?void 0:e.reduce((t,i)=>t+i.getAttributeHash(),""))??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}async _fetchDictionaryInfo(){const{data:e}=await G(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"}});return e}};s([r({type:W})],f.prototype,"_loader",null),s([r({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],f.prototype,"config",void 0),s([r({type:Object,json:{write:!0}})],f.prototype,"fieldMap",void 0),s([r({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],f.prototype,"scaleExpression",void 0),s([H("scaleExpression")],f.prototype,"writeData",null),s([r({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],f.prototype,"scaleExpressionTitle",void 0),s([r({type:String,json:{write:!0}})],f.prototype,"url",void 0),s([H("visualVariables")],f.prototype,"writeVisualVariables",null),f=V=s([v("esri.renderers.DictionaryRenderer")],f);var M;let g=M=class extends _{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(N.getLogger(this).error(".field: field must be a string value"),null):le(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){var e;return new M({color:(e=this.color)==null?void 0:e.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};s([r({type:m,json:{type:[Number],write:!0}})],g.prototype,"color",void 0),s([r({type:String,json:{write:!0}})],g.prototype,"field",void 0),s([te("field")],g.prototype,"castField",null),s([r({type:String,json:{write:!0}})],g.prototype,"label",void 0),s([r({type:String,json:{write:!0}})],g.prototype,"valueExpression",void 0),s([r({type:String,json:{write:!0}})],g.prototype,"valueExpressionTitle",void 0),g=M=s([v("esri.renderers.support.AttributeColorInfo")],g);const Z=g;var R;let D=R=class extends _{constructor(){super(...arguments),this.unit=null}clone(){return new R({unit:this.unit})}};s([r({type:String,json:{write:!0}})],D.prototype,"unit",void 0),D=R=s([v("esri.renderers.support.DotDensityLegendOptions")],D);const Ee=D;var T;let c=T=class extends A(j){constructor(e){super(e),this.attributes=null,this.backgroundColor=new m([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new k,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new ie({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}getAttributeHash(){var e;return((e=this.attributes)==null?void 0:e.reduce((t,i)=>t+i.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new T({attributes:u(this.attributes),backgroundColor:u(this.backgroundColor),dotBlendingEnabled:u(this.dotBlendingEnabled),dotShape:u(this.dotShape),dotSize:u(this.dotSize),dotValue:u(this.dotValue),legendOptions:u(this.legendOptions),outline:u(this.outline),referenceScale:u(this.referenceScale),seed:u(this.seed),visualVariables:u(this.visualVariables),authoringInfo:u(this.authoringInfo)})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(t=>t.field||t.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes??[])i.valueExpression&&await C(e,t,i.valueExpression),i.field&&e.add(i.field)}};s([r({type:[Z],json:{write:!0}})],c.prototype,"attributes",void 0),s([r({type:m,json:{write:!0}})],c.prototype,"backgroundColor",void 0),s([r({type:Boolean,json:{write:!0}})],c.prototype,"dotBlendingEnabled",void 0),s([r({type:String,json:{write:!1}})],c.prototype,"dotShape",void 0),s([r({type:Number,json:{write:!0}})],c.prototype,"dotSize",void 0),s([r({type:Ee,json:{write:!0}})],c.prototype,"legendOptions",void 0),s([r({type:k,json:{default:null,write:!0}})],c.prototype,"outline",void 0),s([r({type:Number,json:{write:!0}})],c.prototype,"dotValue",void 0),s([r({type:Number,json:{write:!0}})],c.prototype,"referenceScale",void 0),s([r({type:Number,json:{write:!0}})],c.prototype,"seed",void 0),s([q({dotDensity:"dot-density"})],c.prototype,"type",void 0),c=T=s([v("esri.renderers.DotDensityRenderer")],c);var O;let x=O=class extends _{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new O({color:this.color&&this.color.clone(),ratio:this.ratio})}};s([r({type:m,json:{type:[se],default:null,write:{isRequired:!0}}})],x.prototype,"color",void 0),s([r({type:Number,json:{write:{isRequired:!0}}})],x.prototype,"ratio",void 0),x=O=s([v("esri.renderers.support.HeatmapColorStop")],x);let I=class extends $.ClonableMixin(_){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};s([r({type:String,json:{write:!0}})],I.prototype,"minLabel",void 0),s([r({type:String,json:{write:!0}})],I.prototype,"maxLabel",void 0),s([r({type:String,json:{write:!0}})],I.prototype,"title",void 0),I=s([v("esri.renderers.support.HeatmapLegendOptions")],I);var L;function J(e){if(e!=null){const{maxDensity:t,minDensity:i,radius:o}=e;if(t!=null||i!=null||o!=null){const{blurRadius:n,maxPixelIntensity:l,minPixelIntensity:y,...h}=e;return h}}return e}let a=L=class extends j{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new x({ratio:0,color:new m("rgba(255, 140, 0, 0)")}),new x({ratio:.75,color:new m("rgba(255, 140, 0, 1)")}),new x({ratio:.9,color:new m("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(e){return J(e)}get blurRadius(){return ge(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",ve(e)),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(we**2*this.blurRadius**4)}read(e,t){e=J(e),super.read(e,t)}getSymbol(){return new Y}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const i=this.field,o=this.valueExpression;i&&typeof i=="string"&&ae(e,t,i),o&&typeof o=="string"&&await C(e,t,o)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new L({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:u(this.colorStops),field:this.field,legendOptions:u(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};s([r({type:ue,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],a.prototype,"authoringInfo",void 0),s([r({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],a.prototype,"blurRadius",null),s([r({type:[x],json:{write:{isRequired:!0}}})],a.prototype,"colorStops",void 0),s([r({type:String,json:{write:!0}})],a.prototype,"field",void 0),s([r({type:I,json:{write:!0}})],a.prototype,"legendOptions",void 0),s([r({type:Number,json:{write:!0}})],a.prototype,"maxDensity",void 0),s([r({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],a.prototype,"maxPixelIntensity",null),s([r({type:Number,json:{write:!0}})],a.prototype,"minDensity",void 0),s([r({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],a.prototype,"minPixelIntensity",null),s([r({type:Number,cast:X,json:{write:!0}})],a.prototype,"radius",void 0),s([r({type:Number,range:{min:0},json:{default:0,write:!0}})],a.prototype,"referenceScale",void 0),s([q({heatmap:"heatmap"})],a.prototype,"type",void 0),s([r({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],a.prototype,"valueExpression",void 0),s([r({type:String})],a.prototype,"valueExpressionTitle",void 0),s([r({readOnly:!0})],a.prototype,"_pixelIntensityToDensity",null),a=L=s([v("esri.renderers.HeatmapRenderer")],a);let S=class extends $.ClonableMixin(_){constructor(){super(...arguments),this.color=new m([0,0,0,0]),this.label=null,this.threshold=0}};s([r({type:m,json:{write:!0}})],S.prototype,"color",void 0),s([r({type:String,json:{write:!0}})],S.prototype,"label",void 0),s([r({type:Number,range:{min:0,max:1},json:{write:!0}})],S.prototype,"threshold",void 0),S=s([v("esri.renderers.support.OthersCategory")],S);const De={base:ye,key:"type",typeMap:{size:ce,opacity:de}};let d=class extends A($.ClonableMixin(j)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new m([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new S,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){var e;return new Y({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(re)}getAttributeHash(){var e;return((e=this.visualVariables)==null?void 0:e.reduce((t,i)=>t+i.getAttributeHash(),""))??""}getMeshHash(){return this.symbols.reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await C(e,t,i.valueExpression),i.field&&e.add(i.field)}};s([r({type:[Z],json:{write:!0}})],d.prototype,"attributes",void 0),s([r(pe)],d.prototype,"backgroundFillSymbol",void 0),s([r({type:m,json:{write:!0}})],d.prototype,"defaultColor",void 0),s([r({type:String,json:{write:!0}})],d.prototype,"defaultLabel",void 0),s([r({type:Number,range:{min:0,max:1},json:{write:!0}})],d.prototype,"holePercentage",void 0),s([r({type:S,json:{write:!0}})],d.prototype,"othersCategory",void 0),s([r({type:xe,json:{write:!0}})],d.prototype,"legendOptions",void 0),s([r({type:k,json:{default:null,write:!0}})],d.prototype,"outline",void 0),s([r({type:Number,cast:X,json:{write:!0}})],d.prototype,"size",void 0),s([q({pieChart:"pie-chart"})],d.prototype,"type",void 0),s([r({types:[De]})],d.prototype,"visualVariables",void 0),d=s([v("esri.renderers.PieChartRenderer")],d);const ze={key:"type",base:j,typeMap:{heatmap:a,simple:Q,"unique-value":U,"class-breaks":K,"dot-density":c,dictionary:f,"pie-chart":d},errorContext:"renderer"},Be={key:"type",base:j,typeMap:{simple:Q,"unique-value":U,"class-breaks":K,heatmap:a},errorContext:"renderer",validate:Pe};function Pe(e){switch(e.type){case"simple":return Ce(e);case"unique-value":return Ne(e);case"class-breaks":return Ve(e);case"heatmap":return e}}function Ce(e){if(e.symbol)return e;N.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function Ne(e){const t=e.uniqueValueInfos,i=t==null?void 0:t.filter(({symbol:o,label:n},l)=>(o||N.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${l}] ${n}) without a symbol from web scene.`),!!o));return(i==null?void 0:i.length)!==(t==null?void 0:t.length)&&(e.uniqueValueInfos=i),e}function Ve(e){const t=e.classBreakInfos,i=t==null?void 0:t.filter(({symbol:o,label:n},l)=>(o||N.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${l}] ${n}) without a symbol from web scene.`),!!o));return(i==null?void 0:i.length)!==(t==null?void 0:t.length)&&(e.classBreakInfos=i),e}export{Be as P,ze as _,x as w};
