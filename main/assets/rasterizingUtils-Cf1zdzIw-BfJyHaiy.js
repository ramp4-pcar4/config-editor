import{P as U,l3 as $,am as P}from"./index-BeTPrQ6f.js";import{o as p}from"./defaultCIMValues-BWu-APou-XI-Li77m.js";import{M as b}from"./definitions-DVO21zOC-BwakNu1s.js";const z=15.5,y=4,L=64,X=1024,Y={outlineWidth:.75,referenceWidth:.75,cap:p.CIMSolidStroke.capstyle,join:p.CIMSolidStroke.joinstyle,miterLimit:p.CIMSolidStroke.miterlimit};function R(o,s,n=0){const e=P(o,0,G);for(let a=0;a<4;a++)s[n+a]=Math.floor(256*V(e*q[a]))}function N(o,s=0){let n=0;for(let e=0;e<4;e++)n+=o[s+e]*E[e];return n}const q=[1,256,65536,16777216],E=[1/256,1/65536,1/16777216,1/4294967296],G=N(new Uint8ClampedArray([255,255,255,255]));N(new Uint8ClampedArray([255,255,255,0]));function V(o){return o-Math.floor(o)}const I=()=>U.getLogger("esri.symbols.cim.rasterizingUtils"),W=32,j=o=>o==="vertical"||o==="horizontal"||o==="cross"||o==="esriSFSCross"||o==="esriSFSVertical"||o==="esriSFSHorizontal";function Z(o,s,n){const e=s.style,a=$(Math.ceil(n)),t=j(e)?8*a:16*a,r=2*a;o.width=t,o.height=t;const i=o.getContext("2d");i.strokeStyle="#ffffff",i.lineWidth=a,i.beginPath(),e!=="vertical"&&e!=="cross"&&e!=="esriSFSCross"&&e!=="esriSFSVertical"||(i.moveTo(t/2,-r),i.lineTo(t/2,t+r)),e!=="horizontal"&&e!=="cross"&&e!=="esriSFSCross"&&e!=="esriSFSHorizontal"||(i.moveTo(-r,t/2),i.lineTo(t+r,t/2)),e!=="backward-diagonal"&&e!=="diagonal-cross"&&e!=="esriSFSDiagonalCross"&&e!=="esriSFSBackwardDiagonal"||(i.moveTo(-r,-r),i.lineTo(t+r,t+r),i.moveTo(t-r,-r),i.lineTo(t+r,r),i.moveTo(-r,t-r),i.lineTo(r,t+r)),e!=="forward-diagonal"&&e!=="diagonal-cross"&&e!=="esriSFSForwardDiagonal"&&e!=="esriSFSDiagonalCross"||(i.moveTo(t+r,-r),i.lineTo(-r,t+r),i.moveTo(r,-r),i.lineTo(-r,r),i.moveTo(t+r,t-r),i.lineTo(t-r,t+r)),i.stroke();const h=i.getImageData(0,0,o.width,o.height),l=new Uint8Array(h.data);let f;for(let c=0;c<l.length;c+=4)f=l[c+3]/255,l[c]=l[c]*f,l[c+1]=l[c+1]*f,l[c+2]=l[c+2]*f;return[l,o.width,o.height,a]}function _(o){o.length%2==1&&(o=[...o,...o]);const s=o.reduce((c,u)=>c+u,0),n=Math.round(s*y),e=1,a=new Float32Array(n*e);let t=0,r=0,i=.5,h=!0;for(const c of o){for(t=r,r+=c*y;i<=r;){const u=i-.5,m=Math.min(Math.abs(i-t),Math.abs(i-r));a[u]=h?-m:m,i++}h=!h}const l=a.length,f=new Uint8Array(4*l);for(let c=0;c<l;++c){const u=a[c]/y;R(u/L*.5+.5,f,4*c)}return[f,n,e]}function oo(o,s){o==null&&(o=[]);const n=s==="Butt",e=s==="Square",a=!n&&!e;o.length%2==1&&(o=[...o,...o]);const t=z,r=2*t;let i=0;for(const d of o)i+=d;const h=Math.round(i*t),l=new Float32Array(h*r),f=.5*t;let c=0,u=0,m=.5,S=!0;for(const d of o){for(c=u,u+=d*t;m<=u;){let C=.5;for(;C<r;){const D=(C-.5)*h+m-.5,g=a?(C-t)*(C-t):Math.abs(C-t);l[D]=S?n?Math.max(Math.max(c+f-m,g),Math.max(m-u+f,g)):g:a?Math.min((m-c)*(m-c)+g,(m-u)*(m-u)+g):e?Math.min(Math.max(m-c,g),Math.max(u-m,g)):Math.min(Math.max(m-c+f,g),Math.max(u+f-m,g)),C++}m++}S=!S}const T=l.length,v=new Uint8Array(4*T);for(let d=0;d<T;++d){const C=(a?Math.sqrt(l[d]):l[d])/t;R(C,v,4*d)}return[v,h,r]}function to(o,s){const{colorRamp:n,gradientType:e}=s,a=n.type==="CIMFixedColorRamp",t=s.interval||p.CIMGradientFill.interval;let r=w(n);return a&&(r=k(r,t)),e==="Discrete"||a?H(o,r,t):B(o,r)}let x;function eo(o,s){const{colorRamp:n,gradientType:e}=s,a=w(n),t=n.type==="CIMFixedColorRamp";if(e==="Continuous"&&!t)return M(o,a);const r=s.interval??p.CIMGradientFill.interval;if(t)return M(o,k(a,r));const i=[];x??(x=document.createElement("canvas")),F(x,a,r,1,0);const h=x.getContext("2d").getImageData(0,0,r,1).data;for(let l=0,f=0;l<r;l++,f=4*l){const c=[h[f+0],h[f+1],h[f+2],h[f+3]];i.push({offset:l/r,color:c}),i.push({offset:(l+1)/r,color:c})}return M(o,i)}function w(o){const s=[];switch(o.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{o.type==="CIMPolarContinuousColorRamp"&&I().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");const n=o;s.push({offset:0,color:[n.fromColor[0],n.fromColor[1],n.fromColor[2],n.fromColor[3]/255]}),s.push({offset:1,color:[n.toColor[0],n.toColor[1],n.toColor[2],n.toColor[3]/255]});break}case"CIMFixedColorRamp":{const n=o,e=1/(n.colors.length-1);let a=0;for(const t of n.colors)s.push({offset:a,color:[t[0],t[1],t[2],t[3]/255]}),a+=e;break}case"CIMMultipartColorRamp":{const n=o,e=n.weights.reduce((t,r)=>t+r,0);let a=0;for(let t=0;t<n.colorRamps.length;t++){const r=n.colorRamps[t],i=n.weights[t],h=w(r);for(const l of h)s.push({offset:(a+l.offset*i)/e,color:l.color});a+=i}break}default:I().error(`Color ramp "${o.type}" currently unsupported.`)}return s}function k(o,s){const n=[],e=(o.length-1)/(s-1);for(let a=0;a<s;a++){const t=o[Math.round(a*e)].color;n.push({offset:a/s,color:t}),n.push({offset:(a+1)/s,color:t})}return n}function B(o,s){return F(o,s,W,1,b),A(o)}function H(o,s,n){return F(o,s,n,1,b),A(o)}function M(o,s,n=0){for(const{offset:e,color:a}of s)o.addColorStop(Math.min(Math.max(e,n),1-n),`rgba(${a[0]}, ${a[1]}, ${a[2]}, ${a[3]})`)}function F(o,s,n,e,a){const t=n+2*a;o.width=t,o.height=e;const r=(a+1)/t,i=o.getContext("2d",{willReadFrequently:!0});if(s.length>0){const h=i.createLinearGradient(0,0,t,e);M(h,s,r),i.fillStyle=h}else i.fillStyle="rgba(128, 128, 128, 1)";i.fillRect(0,0,t,e)}function A(o){const{width:s,height:n}=o,e=o.getContext("2d").getImageData(0,0,s,n),a=new Uint8Array(e.data);for(let t=0;t<a.length;t+=4){const r=a[t+3]/255;a[t]*=r,a[t+1]*=r,a[t+2]*=r}return[a,s,n]}function O(o){var a,t,r,i;const s=((t=(a=o[0])==null?void 0:a[0])==null?void 0:t[0])??0,n=((i=(r=o[0])==null?void 0:r[0])==null?void 0:i[1])??0,e={ymin:n,xmin:s,ymax:n,xmax:s,width:0,height:0};for(let h=0;h<o.length;h++){const l=o[h];for(let f=0;f<l.length;f++){const c=l[f][0],u=l[f][1];c<e.xmin&&(e.xmin=c),c>e.xmax&&(e.xmax=c),u<e.ymin&&(e.ymin=u),u>e.ymax&&(e.ymax=u)}}return e.width=Math.abs(e.xmax-e.xmin),e.height=Math.abs(e.ymax-e.ymin),e}function ro(o,s){const n=O(o),e=n.width===0?1:n.width,a=n.height===0?1:n.height,t=[];for(let r=0;r<o.length;r++){const i=o[r],h=[];for(let l=0;l<i.length;l++){let f=Math.round(i[l][0]-n.xmin),c=Math.round(i[l][1]-n.ymin);if(f=s.xmin+f*s.width/e,c=s.ymin+c*s.height/a,isNaN(f)||isNaN(c))throw new Error("Scaled shape has NaN values");h.push([f,c])}t.push(h)}return t}function no(o,s,n){const e=[];for(let a=0;a<o.length;a++){const t=o[a],r=[];for(let i=0;i<t.length;i++){const h=t[i][0]+s,l=t[i][1]+n;if(isNaN(h)||isNaN(l))throw new Error("Scaled shape has NaN values");r.push([h,l])}e.push(r)}return e}export{Y as E,Z as J,y as M,_ as O,oo as X,to as Y,eo as Z,L as b,no as o,X as q,ro as t,R as x};
