import{gS as E,gZ as M,hk as B,iB as S,gY as x,hl as q,h4 as $,hb as G,h7 as t,hg as I,hm as s,h8 as A,hc as T,h6 as l,h5 as L,hf as Q,hr as y,hj as u,iA as R,h9 as V,ha as z,ja as U,jb as O,jc as Y,jd as K,je as Z,gW as D,iW as N,j8 as P,hd as F,j9 as W,gX as H,g$ as J,hn as ee,h1 as X,g_ as ae,gT as te,ho as re}from"./index-BeTPrQ6f.js";const le={class:"rv-geosearch-bar relative h-26 mx-8 mb-8"},se=["placeholder","value","aria-label"],oe={class:"absolute inset-y-0 right-8 grid w-10 place-content-center"},ne=["aria-label","content"],ce=E({__name:"search-bar",setup(j){const{t:o}=M(),c=S(),n=D(),f=x(()=>c.searchVal),b=x(()=>['"',"$","!","*","+","?","^","{","}","(",")","|","[","]"].filter(h=>c.searchVal.includes(h)).join("")),m=h=>{c.setSearchTerm(h),c.setSearchRegex(h)},v=N(500,h=>{m(h)});return(h,a)=>{const i=$("tippy");return t(),l("div",le,[s("input",{type:"text",class:F(["border-b w-full text-base py-8 outline-none focus:shadow-outline border-gray-600 h-full min-w-0",{"border-yellow-500":b.value}]),placeholder:u(o)("geosearch.searchText"),value:f.value,onInput:a[0]||(a[0]=r=>u(v)(r.target.value)),onKeyup:a[1]||(a[1]=P(r=>{u(n).mobileView&&r.target.blur()},["enter"])),"aria-label":u(o)("geosearch.searchText"),onKeypress:a[2]||(a[2]=P(W(()=>{},["prevent"]),["enter"])),enterkeyhint:"done"},null,42,se),s("span",oe,[b.value?L((t(),l("button",{key:0,class:"cursor-default","aria-label":u(o)("geosearch.badChars",{chars:b.value}),content:u(o)("geosearch.badChars",{chars:b.value})},a[3]||(a[3]=[R(" âš  ")]),8,ne)),[[i]]):T("",!0)])])}}}),ie={class:"rv-geosearch-top-filters sm:flex items-center w-full ml-8 mb-14"},ue={class:"w-fit inline-block sm:w-1/2 h-26 mb-8 sm:mb-0 pr-16 sm:pr-0"},pe=["value","aria-label"],be={value:"",disabled:"",hidden:""},ve={class:"sm:w-1/2 h-26 sm:mx-16 flex"},he=["value","aria-label"],de={value:"",disabled:"",hidden:""},ge=["disabled","content","aria-label"],fe=E({__name:"top-filters",setup(j){const{t:o}=M(),c=B("iApi"),n=S(),f=H([]),b=H([]),m=H([]),v=x(()=>n.queryParams),h=x(()=>c.language),a=p=>n.setProvince(p),i=p=>n.setType(p),r=()=>{a({}),i({})},w=()=>{var g,k;n.initService(c.language,c.fixture.get("geosearch").config);const p=(g=f.value.find(e=>v.value.province===e.name))==null?void 0:g.code,d=(k=b.value.find(e=>v.value.type===e.name))==null?void 0:k.code;n.getProvinces.then(e=>{var _;f.value=e,a({province:(_=e.find(C=>C.code===p))==null?void 0:_.name,forceReRun:!0})}),n.getTypes.then(e=>{var _;b.value=e,i({type:(_=e.find(C=>C.code===d))==null?void 0:_.name,forceReRun:!0})})};return J(()=>{w(),m.value.push(ee(h,w))}),X(()=>{m.value.forEach(p=>p())}),(p,d)=>{const g=$("truncate"),k=$("tippy");return t(),l("div",ie,[s("div",ue,[L((t(),l("select",{class:"border-b border-b-gray-600 w-full h-full py-0 cursor-pointer",value:v.value.province,"aria-label":u(o)("geosearch.filters.province"),onChange:d[0]||(d[0]=e=>a({province:e.target.value}))},[L((t(),l("option",be,[R(y(u(o)("geosearch.filters.province")),1)])),[[g]]),(t(!0),l(V,null,z(f.value,e=>L((t(),l("option",{key:e.code},[R(y(e.name),1)])),[[g]])),128))],40,pe)),[[g]])]),s("div",ve,[L((t(),l("select",{class:"border-b border-b-gray-600 w-full h-full py-0 cursor-pointer max-w-150",value:v.value.type,"aria-label":u(o)("geosearch.filters.type"),onChange:d[1]||(d[1]=e=>i({type:e.target.value}))},[s("option",de,y(u(o)("geosearch.filters.type")),1),(t(!0),l(V,null,z(b.value,e=>(t(),l("option",{key:e.code},y(e.name),1))),128))],40,he)),[[g]]),L((t(),l("button",{type:"button",class:"text-gray-500 w-1/8 h-24 pl-8 pr-16 sm:pr-8 hover:text-black disabled:cursor-default disabled:text-gray-400",disabled:!v.value.type&&!v.value.province,onClick:r,content:u(o)("geosearch.filters.clear"),"aria-label":u(o)("geosearch.filters.clear")},d[2]||(d[2]=[s("div",{class:"rv-geosearch-icon"},[s("svg",{class:"fill-current w-18 h-18",viewBox:"0 0 23 21"},[s("path",{d:"M 14.7574,20.8284L 17.6036,17.9822L 14.7574,15.1716L 16.1716,13.7574L 19.0178,16.568L 21.8284,13.7574L 23.2426,15.1716L 20.432,17.9822L 23.2426,20.8284L 21.8284,22.2426L 19.0178,19.3964L 16.1716,22.2426L 14.7574,20.8284 Z M 2,2L 19.9888,2.00001L 20,2.00001L 20,2.01122L 20,3.99999L 19.9207,3.99999L 13,10.9207L 13,22.909L 8.99999,18.909L 8.99999,10.906L 2.09405,3.99999L 2,3.99999L 2,2 Z "})])],-1)]),8,ge)),[[k,{placement:"bottom"}]])])])}}}),me={class:"rv-geosearch-bottom-filters"},ye={class:"bg-white"},xe={class:"ml-8 cursor-pointer font-normal"},we=["checked"],Le=E({__name:"bottom-filters",setup(j){const{t:o}=M(),c=B("iApi"),n=S(),f=x(()=>n.resultsVisible),b=N(300,a=>{v(a).then(i=>{m({extent:i,visible:f.value})})}),m=a=>{n.setMapExtent(a)},v=async a=>a.sr.wkid===4326?a:await c.geo.proj.projectGeometry(4326,a),h=a=>{v(c.geo.map.getExtent()).then(i=>{m({extent:i,visible:a})})};return ae(()=>{c.event.on(te.MAP_EXTENTCHANGE,b,"geosearch_map_extent")}),X(()=>{c.event.off("geosearch_map_extent")}),(a,i)=>(t(),l("div",me,[s("div",ye,[s("label",xe,[s("input",{type:"checkbox",class:"border-2 mx-8 border-gray-600 cursor-pointer",checked:f.value,onChange:i[0]||(i[0]=r=>h(r.target.checked)),onKeypress:i[1]||(i[1]=P(W(()=>{},["prevent"]),["enter"]))},null,40,we),R(y(u(o)("geosearch.visible")),1)])])]))}}),ke={},Te={class:"w-full h-6 relative overflow-hidden rounded-full indeterminate mb-14"},_e={class:"h-full progressbar bg-blue-800 rounded-full top-0","aria-valuemin":"0","aria-valuemax":"100"},Re={class:"flex items-center h-full"};function je(j,o){return t(),l("div",Te,[s("div",_e,[s("span",Re,[re(j.$slots,"default",{},void 0,!0)])])])}const $e=Q(ke,[["render",je],["__scopeId","data-v-0a8d1c36"]]),Ce={class:"flex flex-col h-full"},Ee={key:1,class:"text-red-900 text-xs px-8 mb-10"},Me={key:2,class:"px-8 mb-10 py-8 flex-grow text-wrap border-y border-gray-600 overflow-y-auto"},Se={class:"relative h-48"},Ae={class:"font-bold text-blue-600"},He={key:3,class:"rv-results-list flex-grow mb-5 border-t border-b border-gray-600 overflow-y-auto"},Ve=["onClick"],ze={class:"rv-result-description px-8"},Pe={class:"flex-1 text-left truncate font-bold leading-tight"},Be=["innerHTML"],Ge={key:0,class:"text-gray-600 text-sm"},Ie={key:1,class:"hidden"},Ke={key:2,class:"text-sm font-normal"},Ne=E({__name:"screen",props:{panel:{type:Object}},setup(j){const{t:o}=M(),c=B("iApi"),n=S(),f=x(()=>n.searchVal.replace(/["!*$+?^{}()|[\]\\]/g,"").trim()),b=x(()=>n.searchResults),m=x(()=>n.loadingResults),v=x(()=>n.failedServices),h=x(()=>n.GSservice.config.fsaUrl),a=async r=>{if(r.flav==="fsa"&&h.value){const p=h.value.replace(U,r.name),[d,g]=await O(Y(p));if(!d){const k=new K("fsazoom",g.features[0].geometry.rings,Z.fromConfig(g.spatialReference),!0);c.geo.map.zoomMapTo(k);return}}const w=new K("zoomies",[[[r.bbox[0],r.bbox[1]],[r.bbox[0],r.bbox[3]],[r.bbox[2],r.bbox[3]],[r.bbox[2],r.bbox[1]],[r.bbox[0],r.bbox[1]]]],Z.latLongSR(),!0);c.geo.map.zoomMapTo(w)},i=(r,w)=>{const p=r.replace(new RegExp(`${n.searchRegex}`,"gi"),d=>'<span class="font-bold text-blue-600">'+d+"</span>");return w?p+",":p};return(r,w)=>{const p=q("panel-screen"),d=$("truncate"),g=$("focus-item"),k=$("focus-list");return t(),G(p,{panel:j.panel},{header:I(()=>[R(y(u(o)("geosearch.title")),1)]),content:I(()=>[s("div",Ce,[A(ce),A(fe),m.value?(t(),G($e,{key:0,class:"flex-none"})):T("",!0),v.value.length>0&&!m.value?(t(),l("div",Ee,y(u(o)("geosearch.serviceError",{services:v.value.join(", ")})),1)):T("",!0),f.value&&b.value.length===0&&!m.value?(t(),l("div",Me,[s("span",Se,[R(y(u(o)("geosearch.noResults")),1),s("span",Ae,'"'+y(f.value)+'"',1)])])):T("",!0),b.value.length>0?L((t(),l("ul",He,[(t(!0),l(V,null,z(b.value,(e,_)=>(t(),l("li",{class:"relative h-56",key:_},[L((t(),l("button",{type:"button",class:"absolute inset-0 h-full w-full hover:bg-gray-300 default-focus-style",onClick:C=>a(e),style:{"border-bottom":"1px solid lightgray"},"truncate-trigger":""},[s("div",ze,[L((t(),l("div",Pe,[s("span",{innerHTML:i(e.name,e.location.province)},null,8,Be),e.location.province?(t(),l("span",Ge,y(e.location.city?" "+e.location.city+", "+e.location.province.abbr:" "+e.location.province.abbr),1)):T("",!0),e.type?(t(),l("span",Ie,"; ")):T("",!0),e.type?(t(),l("span",Ke,[w[0]||(w[0]=s("br",null,null,-1)),R(y(e.type),1)])):T("",!0)])),[[d,{externalTrigger:!0,options:{placement:"top-start"}}]])])],8,Ve)),[[g,"show-truncate"]])]))),128))])),[[k]]):T("",!0),A(Le,{class:"mt-auto"})])]),_:1},8,["panel"])}}});export{Ne as default};
