import{j0 as j}from"./index-DRDU_nTl.js";import{E as v,h as L}from"./Indices-BuIC5D20-BmppxcCO.js";function B(i,n,r){const l=Array.isArray(i),e=l?i.length/n:i.byteLength/(4*n),A=l?i:new Uint32Array(i,0,e*n),g=(r==null?void 0:r.minReduction)??0,c=(r==null?void 0:r.originalIndices)||null,q=c?c.length:0,u=(r==null?void 0:r.componentOffsets)||null;let b=0;if(u)for(let t=0;t<u.length-1;t++){const s=u[t+1]-u[t];s>b&&(b=s)}else b=e;const w=Math.floor(1.1*b)+1;(h==null||h.length<2*w)&&(h=new Uint32Array(j(2*w)));for(let t=0;t<2*w;t++)h[t]=0;let o=0;const U=!!u&&!!c,p=U?q:e;let y=v(e);const d=new Uint32Array(q),E=1.96;let x=g!==0?Math.ceil(4*E*E/(g*g)*g*(1-g)):p,M=1,C=u?u[1]:p;for(let t=0;t<p;t++){if(t===x){const f=1-o/t;if(f+E*Math.sqrt(f*(1-f)/t)<g)return null;x*=2}if(t===C){for(let f=0;f<2*w;f++)h[f]=0;if(c)for(let f=u[M-1];f<u[M];f++)d[f]=y[c[f]];C=u[++M]}const s=U?c[t]:t,I=s*n,$=N(A,I,n);let m=$%w,k=o;for(;h[2*m+1]!==0;){if(h[2*m]===$){const f=h[2*m+1]-1;if(z(A,I,f*n,n)){k=y[f];break}}m++,m>=w&&(m-=w)}k===o&&(h[2*m]=$,h[2*m+1]=s+1,o++),y[s]=k}if(g!==0&&1-o/e<g)return null;if(U){for(let t=u[M-1];t<d.length;t++)d[t]=y[c[t]];y=L(d)}const a=l?new Array(o):new Uint32Array(o*n);o=0;for(let t=0;t<p;t++)y[t]===o&&(G(A,(U?c[t]:t)*n,a,o*n,n),o++);if(c&&!U){const t=new Uint32Array(q);for(let s=0;s<t.length;s++)t[s]=y[c[s]];y=L(t)}return{buffer:Array.isArray(a)?a:a.buffer,indices:y,uniqueCount:o}}function z(i,n,r,l){for(let e=0;e<l;e++)if(i[n+e]!==i[r+e])return!1;return!0}function G(i,n,r,l,e){for(let A=0;A<e;A++)r[l+A]=i[n+A]}function N(i,n,r){let l=0;for(let e=0;e<r;e++)l=i[n+e]+l|0,l=l+(l<<11)+(l>>>2)|0;return l>>>0}let h=null;export{B as v};
