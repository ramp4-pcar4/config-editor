const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ElevationQuery-D2SLf79J-BwSSe2K4.js","./asyncUtils-Cu__bxqs-ecCTUaGV.js","./index-BeTPrQ6f.js","./index-BlWAJbpo.css","./projectionUtils-CsX1UTBu-DsZaU4xz.js","./projectBuffer-CMNsPBq1-CMpE7Jo3.js","./zscale-PLuFqpaL-BIEnWBsg.js","./TileKey-1TQKLvpf-ByD6Ad6n.js","./GeometryDescriptor-CGSMioST-BjTCNFpW.js","./layersCreator-DpzdZQia-DcCdwOC_.js","./loadUtils-DwBPBIZy-BQIH1t1r.js","./fetchService-CbI45rct-DlraP8Gs.js","./associatedFeatureServiceUtils-CYDBc3zT-CVYBBSKA.js","./PortalItem-BrQqKoE_-zs2bKsCH.js","./lazyLayerLoader-BJiXfIQc-BZp5YqgY.js","./portalLayers-CgoWRTMY-2drJoJ7R.js","./portalItemUtils-C12I5owR-Iiaf4oEu.js","./styleUtils-BQqoMgIA-U43o5V_5.js"])))=>i.map(i=>d[i]);
import{j as k,aT as z,ar as O,bI as E,bJ as M,a7 as v,bK as H,bD as K,P as w,br as W,bL as Y,l as Q,_ as I,N as S,q as N,bM as X,bN as B,m as o,bO as Z,E as a,n as y,bP as ee,bQ as re,bR as A,bS as te,bp as J,bo as se,Y as D,bT as oe,v as ae,R as ie,bl as P}from"./index-BeTPrQ6f.js";import{a as x,F as g}from"./Basemap-Dv-hYkd3-V8XC6wCN.js";import{e as C}from"./CollectionFlattener-DfZaIx8a-ADmwanro.js";import{y as ne}from"./loadAll-B16dgL0--5EDWWWLE.js";import{r as le}from"./uuid-CFz2qBzH-cIdlpVG-.js";import{C as pe}from"./persistable-vgejqKb5-CBqfEqX1.js";import{h as m}from"./PolygonCollection-BEPfGuUm-Bu1vpYsn.js";import{u as ue}from"./editableLayers-BTZOOiKD-ByJ-Oydo.js";import"./mat4f32-BdRMyjXW-CWt6U0BP.js";import"./mat4-R0VY9B_E-DoEP887i.js";import{w as de,x as ye,v as ce}from"./TablesMixin-Cv7gcoNw-OtczYJk-.js";import"./PortalItem-BrQqKoE_-zs2bKsCH.js";import"./messages-DQ10DjvF-6kk0dzjG.js";import"./intl-DRhjUnwt-Dihhq8dq.js";import"./isBasemap-CJN7v_Jq-Dgi2bMj-.js";import"./writeUtils-DKeM2R6Z-BUUAIn2U.js";import"./asyncUtils-Cu__bxqs-ecCTUaGV.js";import"./MD5-CXHDUqXT-CMrYdOi6.js";import"./multiOriginJSONSupportUtils-DGETddQl-BrWaY9_8.js";import"./resourceExtension-Boq2U56c-rXLaGMsr.js";import"./projectionUtils-CsX1UTBu-DsZaU4xz.js";import"./projectBuffer-CMNsPBq1-CMpE7Jo3.js";import"./zscale-PLuFqpaL-BIEnWBsg.js";var j;let f=j=class extends D{constructor(e){super(e),this.type="none"}clone(){return new j({type:this.type})}};o([Z({none:"none",stayAbove:"stay-above"}),a({json:{write:{isRequired:!0}}})],f.prototype,"type",void 0),f=j=o([y("esri.ground.NavigationConstraint")],f);const U=Symbol("GroundInstance");function Ve(e){return e!=null&&typeof e=="object"&&U in e}var R,$,q;let l=$=(q=class extends E(H){constructor(e){super(e),this[R]=!0,this.parent=null,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new v;const r=s=>{var n;const{parent:i}=s;i&&i!==this&&"remove"in i&&((n=i.remove)==null||n.call(i,s)),s.parent=this,s.type!=="elevation"&&s.type!=="base-elevation"&&w.getLogger(this).error(`Layer '${s.title}, id:${s.id}' of type '${s.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},t=s=>{s.parent=null};this.addHandles([this.layers.on("after-add",s=>r(s.item)),this.layers.on("after-remove",s=>t(s.item))]),this.allLayers=new C({getCollections:()=>{var s,i;return[this.layers,(i=(s=this.parent)==null?void 0:s.basemap)==null?void 0:i.groundLayers]}})}removeChildLayer(e){this.layers.remove(e)}initialize(){this.when().catch(e=>{K(e)||w.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}get integratedMeshGround(){var r,t;const e=(t=(r=this.parent)==null?void 0:r.basemap)==null?void 0:t.groundLayers.at(0);return e!=null&&e.replacesTerrain?e:null}destroy(){const e=this.layers.removeAll();for(const r of e)O(r);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}get loaded(){return super.loaded}get layers(){return this._get("layers")}set layers(e){this._set("layers",W(e,this._get("layers")))}writeLayers(e,r,t,s){const i=[];e&&(s={...s,layerContainerType:"ground"},e.forEach(n=>{if("write"in n){const d={};Y(n)().write(d,s)&&i.push(d)}else s!=null&&s.messages&&s.messages.push(new Q("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),r.layers=i}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return ne(this,e=>{e(this.layers)})}async queryElevation(e,r){await this.load({signal:r==null?void 0:r.signal});const{queryAll:t}=await I(()=>import("./ElevationQuery-D2SLf79J-BwSSe2K4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url);return S(r),t(this.layers.filter(F).toArray(),e,r)}async createElevationSampler(e,r){await this.load({signal:r==null?void 0:r.signal});const{createSampler:t}=await I(()=>import("./ElevationQuery-D2SLf79J-BwSSe2K4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url);return S(r),t(this.layers.filter(F).toArray(),e,r)}clone(){const e={opacity:this.opacity,surfaceColor:N(this.surfaceColor),navigationConstraint:N(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new $({resourceInfo:this.resourceInfo}).set(e)}read(e,r){this.resourceInfo||this._set("resourceInfo",{data:e,context:r}),super.read(e,r)}_loadFromSource(e){const r=this.resourceInfo;return r?this._loadLayersFromJSON(r.data,r.context,e):Promise.resolve()}async _loadLayersFromJSON(e,r,t){const s=(r==null?void 0:r.origin)||"web-scene",i=(r==null?void 0:r.portal)||null,n=(r==null?void 0:r.url)||null,{populateOperationalLayers:d}=await I(async()=>{const{populateOperationalLayers:L}=await import("./layersCreator-DpzdZQia-DcCdwOC_.js");return{populateOperationalLayers:L}},__vite__mapDeps([9,2,3,10,11,12,13,14,15,16,4,5,6,17,1]),import.meta.url);S(t);const c=[];if(e.layers&&Array.isArray(e.layers)){const L={context:{origin:s,url:n,portal:i,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};c.push(d(this.layers,e.layers,L))}await Promise.allSettled(c)}},R=U,q);function F(e){return e&&"createElevationSampler"in e}o([a()],l.prototype,"parent",void 0),o([a()],l.prototype,"integratedMeshGround",null),o([a({json:{read:!1,write:{isRequired:!0}}})],l.prototype,"layers",null),o([a()],l.prototype,"allLayers",void 0),o([ee("layers")],l.prototype,"writeLayers",null),o([a({readOnly:!0})],l.prototype,"resourceInfo",void 0),o([a({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:A,read:{reader:re,source:"transparency"},write:{writer:(e,r)=>{r.transparency=te(e)},target:"transparency"}}})],l.prototype,"opacity",void 0),o([a({type:J,json:{type:[A],write:(e,r)=>{r.surfaceColor=e.toJSON().slice(0,3)}}})],l.prototype,"surfaceColor",void 0),o([a({type:f,json:{write:!0}})],l.prototype,"navigationConstraint",void 0),l=$=o([y("esri.Ground")],l);const _=l;let b=class extends se(D){constructor(e){super(e),this.color=null}};o([a({type:J,json:{type:[A],write:!0}})],b.prototype,"color",void 0),b=o([y("esri.effects.FocusAreaOutline")],b);const he=b;let u=class extends E(M){constructor(e){super(e),this.id=`focusarea-${le()}`,this.title=null,this.enabled=!0,this.outline=null,this.geometries=new m}readGeometries(e,r,t){var s,i;Array.isArray(e)?this.geometries=m.fromJSON(e,t):t.origin!=="web-scene"&&t.origin!=="portal-item"||((i=(s=t.hooks)==null?void 0:s.onAfterLoad)==null||i.call(s,()=>this._loadGeometries(oe(e,t),t)))}async _loadGeometries(e,r){const t=await ae(e,{responseType:"json"});this.geometries=m.fromJSON(t.data,r)}};o([a({type:String,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),a()],u.prototype,"id",void 0),o([a({type:String,json:{write:!0}})],u.prototype,"title",void 0),o([a({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],u.prototype,"enabled",void 0),o([a({type:he,json:{write:!0}})],u.prototype,"outline",void 0),o([a({type:m,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new m(e.items.map(r=>r.clone()))}),pe({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],u.prototype,"geometries",void 0),o([ie(["web-scene","portal-item","service"],"geometries")],u.prototype,"readGeometries",null),u=o([y("esri.effects.FocusArea")],u);const me=u;let h=class extends E(M){constructor(e){super(e),this.areas=new v,this.style="bright"}};o([a({type:v.ofType(me),nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new v(e.items.map(r=>r.clone()))})],h.prototype,"areas",void 0),o([a({type:["bright","dark"],nonNullable:!0,json:{write:!0}})],h.prototype,"style",void 0),h=o([y("esri.effects.FocusAreas")],h);const V=h,T=()=>w.getLogger("esri.support.basemapUtils");function ge(){return{}}function fe(e){for(const r in e){const t=e[r];t&&!t.destroyed&&t.destroy(),delete e[r]}}function be(e,r){let t;if(typeof e=="string"){const s=e in x,i=!s&&e.includes("/");if(!s&&!i){if(X())T().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const n=Object.entries(x).filter(([d,c])=>c.classic||c.is3d).map(([d])=>`"${d}"`).sort().join(", ");T().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${n}`)}return null}r&&(t=r[e]),t||(t=s?g.fromId(e):new g({style:{id:e}}),r&&(r[e]=t))}else t=B(g,e);return t!=null&&t.destroyed&&(T().warn("The provided basemap is already destroyed",{basemap:t}),t=null),t}const G={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function ve(e){let r=null;if(typeof e=="string")if(e in G){const t=G[e];r=new _({resourceInfo:{data:{layers:[t]}}})}else w.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else r=B(_,e);return r}let p=class extends de(ye(k)){constructor(e){super(e),this.allLayers=new C({getCollections:()=>{var r,t,s,i;return[(r=this.basemap)==null?void 0:r.baseLayers,(t=this.basemap)==null?void 0:t.groundLayers,(s=this.ground)==null?void 0:s.layers,this.layers,(i=this.basemap)==null?void 0:i.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.focusAreas=new V,this.allTables=ce(this),this.basemap=null,this.editableLayers=new C({getCollections:()=>[this.allLayers],itemFilterFunction:ue}),this.ground=new _,this._basemapCache=ge(),this.addHandles(z(()=>this.ground,(r,t)=>{(t==null?void 0:t.parent)===this&&(t.parent=null),r.parent=this},{sync:!0}))}destroy(){fe(this._basemapCache),this._basemapCache=null,this.focusAreas.destroy(),this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=O(this.basemap),O(this.ground),this._set("ground",null)}castBasemap(e){return be(e,this._basemapCache)}castGround(e){return ve(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};o([a({readOnly:!0,dependsOn:[]})],p.prototype,"allLayers",void 0),o([a({type:V,nonNullable:!0,json:{write:{overridePolicy:e=>({enabled:e.areas.length>0,ignoreOrigin:!0})}}})],p.prototype,"focusAreas",void 0),o([a({readOnly:!0})],p.prototype,"allTables",void 0),o([a({type:g,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],p.prototype,"basemap",void 0),o([P("basemap")],p.prototype,"castBasemap",null),o([a({readOnly:!0})],p.prototype,"editableLayers",void 0),o([a({type:_,nonNullable:!0})],p.prototype,"ground",void 0),o([P("ground")],p.prototype,"castGround",null),o([a()],p.prototype,"undoRedo",void 0),p=o([y("esri.Map")],p);const we=p,ke=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"}));export{we as L,ke as M,Ve as o};
