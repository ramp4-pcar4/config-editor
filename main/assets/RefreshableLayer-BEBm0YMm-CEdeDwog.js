import{m as o,E as f,bl as d,n as m,bY as p,bh as v,P as g,a7 as y,eL as b,aG as I}from"./index-BeTPrQ6f.js";import{e as w}from"./layerContainerType-CJrPp4UB-BIF7XAYP.js";const n=new y,h=new WeakMap;function C(e){T(e)&&n.push(new WeakRef(e))}function D(e){const s=n.find(r=>r.deref()===e);s&&n.remove(s)}function T(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function c(e,s){return Number.isFinite(e)&&Number.isFinite(s)?s<=0?e:c(s,e%s):0}let l=0,i=0;function H(){const e=Date.now();let s=!1;for(const r of n){const t=r.deref();t?t.refreshInterval&&e-(h.get(t)??0)+5>=6e4*t.refreshInterval&&(h.set(t,e),t.refresh(e)):s=!0}if(s)for(let r=n.length-1;r>=0;r--)n.at(r).deref()||n.removeAt(r)}b(()=>{const e=Date.now();let s=0;for(const r of n){const t=r.deref();t&&(s=c(Math.round(6e4*t.refreshInterval),s),t.refreshInterval?h.get(t)||h.set(t,e):h.delete(t))}if(s!==i){if(i=s,clearInterval(l),i===0)return void(l=0);l=setInterval(H,i)}},I);const u=.1,P=e=>{const s=e;let r=class extends s{constructor(...t){super(...t),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=p(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||C(this)},()=>{})}destroy(){D(this)}castRefreshInterval(t){return t>=u?t:t<=0?0:u}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(t=Date.now()){v(this._debounceHasDataChanged()).then(a=>{a&&this._set("refreshTimestamp",t),this.emit("refresh",{dataChanged:a})},a=>{g.getLogger(this).error(a),this.emit("refresh",{dataChanged:!1,error:a})})}async hasDataChanged(){return!0}get test(){}};return o([f({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:w}}}}})],r.prototype,"refreshInterval",void 0),o([d("refreshInterval")],r.prototype,"castRefreshInterval",null),o([f({readOnly:!0})],r.prototype,"refreshTimestamp",void 0),o([f({readOnly:!0})],r.prototype,"refreshParameters",null),r=o([m("esri.layers.mixins.RefreshableLayer")],r),r};export{P as k};
