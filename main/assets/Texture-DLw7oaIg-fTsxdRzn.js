import{l as d,eX as G,P as H,ay as ie,N as j,bD as ae,ah as V,m as T,E as M,n as Y,bo as oe,Y as ne,B as W,c0 as w,bP as le,R as ce,bl as L,am as k,bJ as pe}from"./index-BeTPrQ6f.js";import{l as he}from"./Cyclical-Bzwh_QaL-CXh-hbnA.js";import{N as X,O as $,L as f,R as n,G as O,T as U,S as ue}from"./enums-DDJfd4_p-D3z9tmVA.js";let D=class extends pe{constructor(t){super(t),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(t){return t!=null&&this.row===t.row&&this.rows===t.rows&&this.column===t.column&&this.columns===t.columns}};T([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],D.prototype,"row",void 0),T([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],D.prototype,"column",void 0),T([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],D.prototype,"rows",void 0),T([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],D.prototype,"columns",void 0),D=T([Y("esri.CameraLayout")],D);const J=D;let R=class extends oe(ne){constructor(...t){super(...t),this.position=new W([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new J}normalizeCtorArgs(t,e,r,i){if(t&&typeof t=="object"&&("x"in t||Array.isArray(t))){const s={position:t};return e!=null&&(s.heading=e),r!=null&&(s.tilt=r),i!=null&&(s.fov=i),s}return t}writePosition(t,e,r,i){const s=t.clone();s.x=w(t.x||0),s.y=w(t.y||0),s.z=t.hasZ?w(t.z||0):t.z,e[r]=s.write({},i)}readPosition(t,e){const r=new W;return r.read(t,e),r.x=w(r.x||0),r.y=w(r.y||0),r.z=r.hasZ?w(r.z||0):r.z,r}equals(t){return t!=null&&this.tilt===t.tilt&&this.heading===t.heading&&this.fov===t.fov&&this.position.equals(t.position)&&this.layout.equals(t.layout)}};T([M({type:W,json:{write:{isRequired:!0}}})],R.prototype,"position",void 0),T([le("position")],R.prototype,"writePosition",null),T([ce("position")],R.prototype,"readPosition",null),T([M({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),L(t=>he.normalize(w(t)))],R.prototype,"heading",void 0),T([M({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),L(t=>k(w(t),-180,180))],R.prototype,"tilt",void 0),T([M({type:Number,nonNullable:!0,json:{default:55,write:!0}}),L(t=>k(w(t,55),1,170))],R.prototype,"fov",void 0),T([M({type:J,nonNullable:!0,json:{read:!1,write:!1}})],R.prototype,"layout",void 0),R=T([Y("esri.Camera")],R);const Ae=R,me=()=>H.getLogger("esri.views.webgl.checkWebGLError");function Z(t){switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const Q=!!V("enable-feature:webgl-debug");function ee(){return Q}function De(){return Q}function A(t,e=ee()){if(e){const r=Z(t);if(r){const i=new Error().stack;me().error(new d("webgl-error","WebGL error occurred",{message:r,stack:i}))}}}function Ie(t,e,r,i=0){const s=t.gl;t.bindBuffer(r);for(const a of r.layout){const l=e.get(a.name);if(l==null){console.warn(`There is no location for vertex attribute '${a.name}' defined.`);continue}const c=i*a.stride;if(a.count<=4)s.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),s.enableVertexAttribArray(l),a.divisor>0&&s.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let o=0;o<3;o++)s.vertexAttribPointer(l+o,3,a.type,a.normalized,a.stride,a.offset+12*o+c),s.enableVertexAttribArray(l+o),a.divisor>0&&s.vertexAttribDivisor(l+o,a.divisor);else if(a.count===16)for(let o=0;o<4;o++)s.vertexAttribPointer(l+o,4,a.type,a.normalized,a.stride,a.offset+16*o+c),s.enableVertexAttribArray(l+o),a.divisor>0&&s.vertexAttribDivisor(l+o,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count);if(ee()){const o=Z(t.gl);o&&console.error(`Unable to bind vertex attribute "${a.name}" with baseInstanceOffset ${c}:`,o,a)}}}function ye(t){switch(t){case 6406:case 6409:case 6403:case 36244:case 6402:case 34041:return 1;case 6410:case 33319:case 33320:return 2;case 6407:case 36248:return 3;case 6408:case 36249:return 4}return 0}function de(t){switch(t){case 6406:case 6409:case 6403:case 36244:case n.R8:case n.R8I:case n.R8UI:case n.R8_SNORM:case 36168:return 1;case 6410:case 33319:case 33320:case n.RGBA4:case n.R16F:case n.R16I:case n.R16UI:case n.RG8:case n.RG8I:case n.RG8UI:case n.RG8_SNORM:case n.RGB565:case n.RGB5_A1:case U.DEPTH_COMPONENT16:return 2;case 6407:case 36248:case n.RGB8:case n.RGB8I:case n.RGB8UI:case n.RGB8_SNORM:case n.SRGB8:case U.DEPTH_COMPONENT24:return 3;case 6408:case 36249:case n.RGBA8:case n.R32F:case n.R11F_G11F_B10F:case n.RG16F:case n.R32I:case n.R32UI:case n.RG16I:case n.RG16UI:case n.RGBA8I:case n.RGBA8UI:case n.RGBA8_SNORM:case n.SRGB8_ALPHA8:case n.RGB9_E5:case n.RGB10_A2UI:case n.RGB10_A2:case U.DEPTH_COMPONENT32F:case O.DEPTH24_STENCIL8:return 4;case O.DEPTH32F_STENCIL8:return 5;case n.RGB16F:case n.RGB16I:case n.RGB16UI:return 6;case n.RG32F:case n.RG32I:case n.RG32UI:case n.RGBA16F:case n.RGBA16I:case n.RGBA16UI:return 8;case n.RGB32F:case n.RGB32I:case n.RGB32UI:return 12;case n.RGBA32F:case n.RGBA32I:case n.RGBA32UI:return 16;case f.COMPRESSED_RGB_S3TC_DXT1_EXT:case f.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case f.COMPRESSED_RGBA_S3TC_DXT3_EXT:case f.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case f.COMPRESSED_R11_EAC:case f.COMPRESSED_SIGNED_R11_EAC:case f.COMPRESSED_RGB8_ETC2:case f.COMPRESSED_SRGB8_ETC2:case f.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case f.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case f.COMPRESSED_RG11_EAC:case f.COMPRESSED_SIGNED_RG11_EAC:case f.COMPRESSED_RGBA8_ETC2_EAC:case f.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}let _e=class{constructor(e=0,r=e){this.width=e,this.height=r,this.type=0,this.target=3553,this.pixelFormat=6408,this.dataType=X.UNSIGNED_BYTE,this.samplingMode=9729,this.wrapMode=10497,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.compareEnabled=!1,this.linearFilterDepth=!1,this.depth=1,this.isImmutable=!1}};function ge(t){return t.width<=0||t.height<=0||t.depth<=0?0:Math.round(t.width*t.height*t.depth*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:de(t.internalFormat))*(t.target===34067?6:1))}const F=()=>H.getLogger("esri/views/webgl/textureUtils");function P(t){const{width:e,height:r,depth:i}=t;(e!=null&&e<0||r!=null&&r<0||i!=null&&i<0)&&F().error("Negative dimension parameters are not allowed!");const{internalFormat:s}=t;if(s&&(te(s)||re(s))){const{linearFilterDepth:a,compareEnabled:l,samplingMode:c,hasMipmap:o}=t;o&&F().error("Depth textures cannot have mipmaps"),a?c!==9729&&c!==9728&&F().error("Depth textures cannot sample mipmaps"):(c!==9728&&F().error("Depth textures without filtering must use NEAREST filtering"),l&&F().error("Depth textures without filtering cannot use compare function"))}}function fe(t){return ue.includes(t)}function te(t){return G(U,t)}function re(t){return G(O,t)}function xe(t){return t!=null&&G(f,t)}function y(t){return t!=null&&"type"in t&&t.type==="compressed"}function Te(t){return t!=null&&"byteLength"in t}function K(t){return t!=null&&!y(t)&&!Te(t)}function I(t){return t===32879||t===35866}function q(t,e,r,i=1){let s=Math.max(e,r);return t===32879&&(s=Math.max(s,i)),Math.floor(Math.log2(s))+1}function C(t){if(t.internalFormat!=null)return t.internalFormat;switch(t.dataType){case X.FLOAT:switch(t.pixelFormat){case 6408:return n.RGBA32F;case 6407:return n.RGB32F;default:throw new d("texture:unknown-format","Unable to derive format")}case X.UNSIGNED_BYTE:switch(t.pixelFormat){case 6408:return n.RGBA8;case 6407:return n.RGB8}}const{pixelFormat:e}=t;return t.internalFormat=e===34041?O.DEPTH24_STENCIL8:e===6402?U.DEPTH_COMPONENT24:e,t.internalFormat}function Ee(t){let e="width"in t?t.width:t.codedWidth,r="height"in t?t.height:t.codedHeight;return t instanceof HTMLVideoElement&&(e=t.videoWidth,r=t.videoHeight),{width:e,height:r,depth:1}}class z extends _e{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case n.R16F:case n.R32F:case n.R8_SNORM:case n.R8:this.pixelFormat=6403;break;case n.R8I:case n.R8UI:case n.R16I:case n.R16UI:case n.R32I:case n.R32UI:this.pixelFormat=36244}}static validate(e,r){return new z(e,r)}}const Re=!!V("esri-tests-disable-gpu-memory-measurements"),b=()=>H.getLogger("esri/views/webgl/Texture");var h;let Fe=(h=class{constructor(e,r=null,i=null){if(this.type=1,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._shadowFilterDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const s=z.validate(e,r);if(!s)throw new d("texture:invalid-descriptor","Texture descriptor invalid");this._descriptor=s}this._descriptor.target===34067?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return Re?0:ge(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty||this._shadowFilterDirty}get hasWebGLTextureObject(){return!!this._glName}dispose(){var e;this.abortCompression(),this.hasWebGLTextureObject&&((e=this._descriptor.context)!=null&&e.gl)&&(this._descriptor.context.instanceCounter.decrement($.Texture,this),this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor=null)}release(){this.dispose()}[Symbol.dispose](){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new d("texture:immutable-resize","Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===34067?this._setDataCubeMap(null):this.setData(null)}}enableCompression(e){this._descriptor.compress=e}disableCompression(){this._descriptor.compress=void 0}setData(e){this.abortCompression(),!y(e)&&this._descriptor.internalFormat&&G(f,this._descriptor.internalFormat)&&(this._descriptor.internalFormat=void 0),this._setData(e),!y(e)&&this._descriptor.compress&&this._compressOnWorker(e)}updateData(e,r,i,s,a,l,c=0){l||b().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||b().error("An attempt to update uninitialized texture!");const o=this._descriptor;o.internalFormat=C(o);const{context:p,pixelFormat:u,dataType:m,target:_,isImmutable:g}=o;if(g&&!this._wasImmutablyAllocated)throw new d("texture:uninitialized","Cannot update immutable texture before allocation!");const E=p.bindTexture(this,h.TEXTURE_UNIT_FOR_UPDATES,!0);(r<0||i<0||r+s>o.width||i+a>o.height)&&b().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:x}=p;c&&(s&&a||b().warn("Must pass width and height if `UNPACK_SKIP_ROWS` is used"),x.pixelStorei(x.UNPACK_SKIP_ROWS,c)),K(l)?x.texSubImage2D(_,e,r,i,s,a,u,m,l):y(l)?x.compressedTexSubImage2D(_,e,r,i,s,a,o.internalFormat,l.levels[e]):x.texSubImage2D(_,e,r,i,s,a,u,m,l),c&&x.pixelStorei(x.UNPACK_SKIP_ROWS,0),p.bindTexture(E,h.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,s,a,l,c,o){o||b().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||b().error("An attempt to update an uninitialized texture!");const p=this._descriptor;p.internalFormat=C(p);const{context:u,pixelFormat:m,dataType:_,isImmutable:g,target:E}=p;if(g&&!this._wasImmutablyAllocated)throw new d("texture:uninitialized","Cannot update immutable texture before allocation!");I(E)||b().warn("Attempting to set 3D texture data on a non-3D texture");const x=u.bindTexture(this,h.TEXTURE_UNIT_FOR_UPDATES);u.setActiveTexture(h.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||r+a>p.width||i+l>p.height||s+c>p.depth)&&b().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:S}=u;if(y(o))o=o.levels[e],S.compressedTexSubImage3D(E,e,r,i,s,a,l,c,p.internalFormat,o);else{const N=o;S.texSubImage3D(E,e,r,i,s,a,l,c,m,_,N)}u.bindTexture(x,h.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(e.width===0||e.height===0)return;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new d("texture:immutable-change","Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,P(e)}e.samplingMode===9729?(this._samplingModeDirty=!0,e.samplingMode=9985):e.samplingMode===9728&&(this._samplingModeDirty=!0,e.samplingMode=9984);const r=this._descriptor.context.bindTexture(this,h.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(h.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,h.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new d("texture:immutable-change","Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,P(e)}e.samplingMode===9985?(this._samplingModeDirty=!0,e.samplingMode=9729):e.samplingMode===9984&&(this._samplingModeDirty=!0,e.samplingMode=9728)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,P(this._descriptor),this._wrapModeDirty=!0)}setShadowFiltering(e){e!==this._descriptor.linearFilterDepth&&(this._descriptor.linearFilterDepth=this._descriptor.compareEnabled=e,this.setSamplingMode(e?9729:9728),P(this._descriptor),this._shadowFilterDirty=!0)}applyChanges(){this._samplingModeDirty&&(this._applySamplingMode(),this._samplingModeDirty=!1),this._wrapModeDirty&&(this._applyWrapMode(),this._wrapModeDirty=!1),this._shadowFilterDirty&&(this._applyShadowMode(),this._shadowFilterDirty=!1)}abortCompression(){this._compressionAbortController=ie(this._compressionAbortController)}_setData(e,r){var o;const i=this._descriptor,s=(o=i.context)==null?void 0:o.gl;if(!s)return;A(s),this.hasWebGLTextureObject||(this._glName=s.createTexture(),i.context.instanceCounter.increment($.Texture,this)),P(i);const a=i.context.bindTexture(this,h.TEXTURE_UNIT_FOR_UPDATES);i.context.setActiveTexture(h.TEXTURE_UNIT_FOR_UPDATES),this._configurePixelStorage(),A(s);const l=r??i.target,c=I(l);if(K(e))this._setDataFromTexImageSource(e,l);else{const{width:p,height:u,depth:m}=i;if(p==null||u==null)throw new d("texture:missing-size","Width and height must be specified!");if(c&&m==null)throw new d("texture:missing-depth","Depth must be specified!");if(i.internalFormat=C(i),i.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,i.internalFormat,i.hasMipmap,p,u,m),y(e)){if(!xe(i.internalFormat))throw new d("texture:format-mismatch","Attempting to use compressed data with an uncompressed format!");this._setDataFromCompressedSource(e,i.internalFormat,l)}else this._texImage(l,0,i.internalFormat,p,u,m,e),A(s),i.hasMipmap&&this.generateMipmap()}this._applySamplingMode(),this._applyWrapMode(),this._applyAnisotropicFilteringParameters(),this._applyShadowMode(),A(s),i.context.bindTexture(a,h.TEXTURE_UNIT_FOR_UPDATES)}_setDataCubeMap(e=null){for(let r=34069;r<=34074;r++)this._setData(e,r)}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_setDataFromTexImageSource(e,r){const{gl:i}=this._descriptor.context,s=this._descriptor;s.internalFormat=C(s);const a=I(r),{width:l,height:c,depth:o}=Ee(e);s.width&&s.height,s.width||(s.width=l),s.height||(s.height=c),a&&s.depth,a&&(s.depth=o),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(r,s.internalFormat,s.hasMipmap,l,c,o),this._texImage(r,0,s.internalFormat,l,c,o,e),A(i),s.hasMipmap&&(this.generateMipmap(),A(i))}_setDataFromCompressedSource(e,r,i){const s=this._descriptor,{width:a,height:l,depth:c}=s,o=e.levels,p=q(i,a,l,c),u=Math.min(p,o.length)-1;this._descriptor.context.gl.texParameteri(s.target,33085,u),this._forEachMipmapLevel((m,_,g,E)=>{const x=o[Math.min(m,o.length-1)];this._compressedTexImage(i,m,r,_,g,E,x)},u)}_texStorage(e,r,i,s,a,l){const{gl:c}=this._descriptor.context;if(!fe(r)&&!te(r)&&!re(r))throw new d("texture:missing-format","Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const o=i?q(e,s,a,l):1;if(I(e)){if(l==null)throw new d("texture:missing-depth","Missing depth dimension for 3D texture upload");c.texStorage3D(e,o,r,s,a,l)}else c.texStorage2D(e,o,r,s,a);this._wasImmutablyAllocated=!0}_texImage(e,r,i,s,a,l,c){const o=this._descriptor.context.gl,p=I(e),{isImmutable:u,pixelFormat:m,dataType:_}=this._descriptor;if(u){if(c!=null){const g=c;if(p){if(l==null)throw new d("texture:missing-depth","Missing depth dimension for 3D texture upload");o.texSubImage3D(e,r,0,0,0,s,a,l,m,_,g)}else o.texSubImage2D(e,r,0,0,s,a,m,_,g)}}else{const g=c;if(p){if(l==null)throw new d("texture:missing-depth","Missing depth dimension for 3D texture upload");o.texImage3D(e,r,i,s,a,l,0,m,_,g)}else o.texImage2D(e,r,i,s,a,0,m,_,g)}}_compressedTexImage(e,r,i,s,a,l,c){const o=this._descriptor.context.gl,p=I(e);if(this._descriptor.isImmutable){if(c!=null)if(p){if(l==null)throw new d("texture:missing-depth","Missing depth dimension for 3D texture upload");o.compressedTexSubImage3D(e,r,0,0,0,s,a,l,i,c)}else o.compressedTexSubImage2D(e,r,0,0,s,a,i,c)}else if(p){if(l==null)throw new d("texture:missing-depth","Missing depth dimension for 3D texture upload");o.compressedTexImage3D(e,r,i,s,a,l,0,c)}else o.compressedTexImage2D(e,r,i,s,a,0,c)}async _compressOnWorker(e){var E,x,S,N;const{width:r,height:i,context:s,flipped:a,preMultiplyAlpha:l,hasMipmap:c}=this._descriptor,o=(E=this._descriptor.compress)==null?void 0:E.compressionTracker,p=(x=this._descriptor.compress)==null?void 0:x.compressionCallback,{compressedTextureETC:u,compressedTextureS3TC:m}=s.capabilities;if(!((S=h.compressionWorkerHandle)!=null&&S.isCompressible(e,this._descriptor))||!u&&!m)return;this.abortCompression();const _=new AbortController;let g;this._compressionAbortController=_,o==null||o.increment();try{e instanceof Uint8Array?g=e.buffer:(g=await createImageBitmap(e,{imageOrientation:a?"flipY":"none"}),j(_));const v={data:g,width:r,height:i,needsFlip:e instanceof Uint8Array&&this.descriptor.flipped,components:this._descriptor.pixelFormat===6408?4:3,preMultiplyAlpha:l,hasMipmap:c,hasETC:!!u,hasS3TC:!!m},B=await h.compressionWorkerHandle.invoke(v,_.signal,"low");if(j(_),B.compressedTexture&&this.hasWebGLTextureObject){const se=this.usedMemory;this._descriptor.internalFormat=B.internalFormat,this._setData(B.compressedTexture),p==null||p(se-this.usedMemory)}}catch(v){ae(v)||b().error("Texture compression failed!")}finally{o==null||o.decrement(),(N=this._compressionAbortController)!=null&&N.signal.aborted&&(this._compressionAbortController=null),g instanceof ImageBitmap&&g.close()}}_forEachMipmapLevel(e,r=1/0){let{width:i,height:s,depth:a,hasMipmap:l,target:c}=this._descriptor;const o=c===32879;if(i==null||s==null||o&&a==null)throw new d("texture:missing-size","Missing texture dimensions for mipmap calculation");for(let p=0;e(p,i,s,a),l&&(i!==1||s!==1||o&&a!==1)&&!(p>=r);++p)i=Math.max(1,i>>1),s=Math.max(1,s>>1),o&&(a=Math.max(1,a>>1))}_applySamplingMode(){var a;const e=this._descriptor,r=(a=e.context)==null?void 0:a.gl;let i=e.samplingMode,s=e.samplingMode;i===9985||i===9987?(i=9729,e.hasMipmap||(s=9729)):i!==9984&&i!==9986||(i=9728,e.hasMipmap||(s=9728)),r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,i),r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,s)}_applyWrapMode(){var i;const e=this._descriptor,r=(i=e.context)==null?void 0:i.gl;typeof e.wrapMode=="number"?(r.texParameteri(e.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,e.wrapMode)):(r.texParameteri(e.target,r.TEXTURE_WRAP_S,e.wrapMode.s),r.texParameteri(e.target,r.TEXTURE_WRAP_T,e.wrapMode.t))}_applyShadowMode(){var s;const e=this._descriptor,r=(s=e.context)==null?void 0:s.gl,i=e.compareEnabled?r.COMPARE_REF_TO_TEXTURE:r.NONE;r.texParameteri(e.target,r.TEXTURE_COMPARE_MODE,i),e.compareEnabled&&r.texParameteri(e.target,r.TEXTURE_COMPARE_FUNC,r.GREATER),A(r)}_applyAnisotropicFilteringParameters(){const e=this._descriptor,r=e.context.capabilities.textureFilterAnisotropic;r&&e.context.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}},h.TEXTURE_UNIT_FOR_UPDATES=0,h.compressionWorkerHandle=null,h);export{_e as $,A,z as G,ee as H,Z as W,de as Z,Ie as _,ye as g,De as m,Ae as u,Fe as w};
