import{y as F}from"./Field-Cj6Pz3TI-DKnhyIXm.js";import{v as S,I as $,fB as M,t as J,Y as Q,z as H,dK as K}from"./index-uAe2c5m-.js";var k;let x=k=class extends Q{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new k({variableName:this.variableName,dimensionName:this.dimensionName,values:H(this.values),isSlice:this.isSlice})}};S([$({type:String,json:{write:!0}})],x.prototype,"variableName",void 0),S([$({type:String,json:{write:!0}})],x.prototype,"dimensionName",void 0),S([$({type:M.array(M.oneOf([M.native(Number),M.array(M.native(Number))])),json:{write:!0}})],x.prototype,"values",void 0),S([$({type:Boolean,json:{write:!0}})],x.prototype,"isSlice",void 0),x=k=S([J("esri.layers.support.DimensionalDefinition")],x);const I=x,X="Raster.",y="Raster.Dim.",A=".Max",N={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},V=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function T(e,n){return new F({name:e,alias:n,domain:null,editable:!1,length:50,type:"string"})}function C(e,n){return new F({name:e,alias:n,domain:null,editable:!1,type:"double"})}function _(e,n){return new F({name:e,alias:n,domain:null,editable:!1,type:"date"})}function le(e){return T(N.servicePixelValue,e??"Service Pixel Value")}function ue(e){return T(N.rawServicePixelValue,e??"Raw Service Pixel Value")}function oe(){return T(N.itemPixelValue,"Item Pixel Value")}function me(e){return T(`${N.servicePixelValue}.${e}`,e)}function ce(e){return C(`${N.magnitude}`,"Magnitude"+(e?` (${e})`:""))}function fe(){return C(`${N.direction}`,"Direction (Â°)")}function de(e){return e.fields.filter(n=>n.type!=="oid"&&n.name.toLowerCase()!=="value").map(n=>{const a=n.clone();return a.name=`${X}${n.name}`,a})}function he(e){const n=new Set,a=new Set,s=new Map;return e.variables.forEach(({dimensions:t})=>{t.forEach(i=>{var r;if(i.recurring)s.set(i.name,i.unit);else{const o=((r=i.unit)==null?void 0:r.trim())==="ISO8601"?n:a;o.add(i.name),i.hasRanges&&o.add(`${i.name}${A}`)}})}),[T(N.variable,"Variable"),...[...n].map(t=>_(`${y}${t}`,Y(t))),...[...a].map(t=>C(`${y}${t}`,Y(t))),...[...s].map(([t,i])=>C(`${y}${t}`,G(t,i)))]}function G(e,n){return n=n==null?void 0:n.toLowerCase(),n&&V.has(n)?V.get(n):Y(e)}function Y(e){const n=e.endsWith(A),a=n?e.slice(0,-4):e,s=a==="StdTime"?"Standard Time":a==="StdZ"?"Standard Z":a;return n?`${s} Max`:s}function U(e,n){return n?new Date(e):e}function ve(e,n,a){a!=null&&a.length&&(n[N.variable]=a[0].variableName,a.forEach(({dimensionName:s,values:t})=>{if(s&&(t!=null&&t.length)){const i=`${y}${s}`,r=e.find(({name:l})=>l===i);if(!r)return;const o=r.type==="date",m=t[0];if(Array.isArray(m)){if(n[`${y}${s}`]=U(m[0],o),m[1]!=null){const l=`${y}${s}${A}`;if(e.some(({name:u})=>u===l)){const u=U(m[1],o);n[l]=u}}}else n[`${y}${s}`]=U(m,o)}}))}function ge(e,n){if(n.pixelType.startsWith("f")&&e.forEach(({format:a,fieldName:s})=>{a&&s&&/^raster\.(item|service)pixelvalue/i.test(s)&&(a.places=2)}),n.multidimensionalInfo){const a=n.multidimensionalInfo.variables.flatMap(({dimensions:s})=>s);e.forEach(({format:s,fieldName:t})=>{var i,r;if(s&&(t!=null&&t.startsWith(y))){const o=t.slice(y.length),m=`${o}${A}`;(r=(i=a.find(({name:l})=>l===o||l===m))==null?void 0:i.values)!=null&&r.every(l=>Number.isInteger(l))&&(s.places=0)}})}}function O(e,n,a){var i;const s=n.shift();if(a.length===0){const r=[];a.push({sliceId:-1,multidimensionalDefinition:r})}const t=a.length;for(let r=0;r<t;r++){const o=a.shift().multidimensionalDefinition;(i=s.values)==null||i.forEach(m=>{a.push({sliceId:-1,multidimensionalDefinition:[...o,{variableName:e,dimensionName:s.name,values:[m]}]})})}n.length&&O(e,n,a)}function be(e,n){const a=[];let s=0;return(n?e.variables.filter(t=>t.name.toLowerCase()===n.toLowerCase()):[...e.variables].sort((t,i)=>t.name>i.name?1:-1)).forEach(t=>{const i=[],r=[...t.dimensions].sort((o,m)=>o.name>m.name?-1:1);O(t.name,r,i),i.forEach(o=>{a.push({...o,sliceId:s++})})}),a}function ye(e,n,a){let s=e;if(n&&(n=[...n].sort((t,i)=>t.dimensionName<i.dimensionName?-1:1)).forEach(({dimensionName:t,values:i,isSlice:r})=>{i.length&&(s=s.filter(o=>{const m=o.multidimensionalDefinition.find(u=>u.dimensionName===t);if(m==null)return!1;const l=m.values[0];return typeof l=="number"?typeof i[0]=="number"?i.includes(l):i.some(u=>u[0]<=l&&u[1]>=l):typeof i[0]=="number"?i.some(u=>l[0]<=u&&l[1]>=u):r?i.some(u=>u[0]===l[0]&&u[0]===l[1]):i.some(u=>u[0]>=l[0]&&u[0]<=l[1]||u[1]>=l[0]&&u[1]<=l[1]||u[0]<l[0]&&u[1]>l[1])}))}),s.length&&(a==null?void 0:a.start)!=null&&a.end!=null){const t=a.start.getTime(),i=a.end.getTime(),r=s[0].multidimensionalDefinition.findIndex(o=>o.dimensionName==="StdTime");r>-1&&(s=s.filter(o=>{const m=o.multidimensionalDefinition[r].values[0];return t<=m&&i>=m}))}return s.map(t=>t.sliceId)}function L(e,n){return Array.isArray(e)?n[0]===n[1]?e[0]===n[0]||e[1]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]}function ee(e,n){return e[0]<=n[0]&&e[1]>=n[0]||e[0]<=n[1]&&e[1]>=n[1]||e[0]>=n[0]&&e[1]<=n[1]}function j(e){return e.length===1?[e[0],e[0]]:[e[0],e[e.length-1]]}function W(e,n,a){var r,o,m;if(!((r=n==null?void 0:n.subsetDefinitions)!=null&&r.length))return e;let s;if(a){const{variables:l}=n;if(l.length&&!l.includes(a))return null;const u=n.subsetDefinitions.find(c=>c.dimensionName===e.name&&c.variableName===a);if(!((o=u==null?void 0:u.values)!=null&&o.length))return e;s=j(u.values)}else s=(m=n.dimensions.find(({name:l})=>l===e.name))==null?void 0:m.extent;const t=s;if(!(t!=null&&t.length))return e;const i=e.values.filter(l=>L(l,t));return{...e,extent:[...t],values:i}}function R(e,n,a){var t;if(!((t=n==null?void 0:n.subsetDefinitions)!=null&&t.length))return!1;const{variables:s}=n;if(s.length&&e.some(({variableName:i})=>i&&!s.includes(i)))return!0;for(let i=0;i<e.length;i++){const r=e[i],o=n.subsetDefinitions.find(m=>(r.variableName===""||m.variableName===r.variableName)&&m.dimensionName===r.dimensionName);if(o!=null&&o.values.length){const m=j(o.values);if(!r.isSlice&&r.values.length===2&&!Array.isArray(r.values[0])&&r.values[0]!==r.values[1]&&a){if(!ee(r.values,m))return!0}else if(r.values.some(l=>!L(l,m)))return!0}}return!1}function we(e,n){if(e==null)return{isOutside:!1};const{geometry:a,timeExtent:s,multidimensionalDefinition:t}=n;let i=null;if(s!=null&&(i=ne(e,s),i==null))return{isOutside:!0};const{areaOfInterest:r}=e;if(r&&a){const o=a.type==="point"?a:a.type==="extent"?a.center:a.type==="polygon"?a.centroid:null;if(o&&!r.contains(o))return{isOutside:!0}}return t!=null&&t.length&&R(t,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:a,timeExtent:i,multidimensionalDefinition:t}}}function ne(e,n){const a=e.dimensions.find(({name:r})=>r==="StdTime");if(a==null||n.start==null&&n.end==null)return n;n=n.clone();const{start:s,end:t}=n.toJSON(),i=s===t?[s]:s!=null&&t!=null?[s,t]:[s??t];return i.length===2&&(a!=null&&a.extent.length)&&(i[0]=Math.max(i[0],a.extent[0]),i[1]=Math.min(i[1],a.extent[1]??a.extent[0]),i[1]<i[0])||R([new I({variableName:"",dimensionName:"StdTime",isSlice:i.length===1,values:i})],e,!0)?null:(n.start=new Date(i[0]),n.end=new Date(i[1]??i[0]),n)}function pe(e){var r,o,m;const{rasterInfo:n,multidimensionalSubset:a}=e,{multidimensionalInfo:s}=n;if(s==null)return null;let t=(r=e.multidimensionalDefinition)!=null&&r.length?e.multidimensionalDefinition:E(n,{multidimensionalSubset:a});if(!(t!=null&&t.length))return null;if(t.some(l=>!l.dimensionName)){const{variableName:l}=t[0],u=E(n,{multidimensionalSubset:a,variableName:l});u==null||u.forEach(c=>{var b;const d=t==null?void 0:t.find(({dimensionName:D})=>D===c.dimensionName);(b=d==null?void 0:d.values)!=null&&b.length&&(c.values=d.values,c.isSlice=d.isSlice)}),t=u}const{timeExtent:i}=e;if(t!=null&&i!=null&&(i.start!=null||i.end!=null)){t=t.map(g=>g.clone());const l=(m=(o=s.variables.find(({name:g})=>g===t[0].variableName))==null?void 0:o.dimensions)==null?void 0:m.find(({name:g})=>g==="StdTime"),u=t.find(({dimensionName:g})=>g==="StdTime");if(!l||!u)return null;const{start:c,end:d}=i,b=c==null?null:c.getTime(),D=d==null?null:d.getTime(),h=b??D,v=D??b;if(l.values!=null){const g=l.values.filter(f=>{if(Array.isArray(f)){if(h===v)return f[0]<=h&&f[1]>=h;const w=f[0]<=h&&f[1]>h||f[0]<v&&f[1]>=v,p=f[0]>=h&&f[1]<=v||f[0]<h&&f[1]>v;return w||p}return h===v?f===h:f>=h&&f<=v});if(g.length){const f=g.sort((w,p)=>{const Z=Array.isArray(w)?w[0]:w,z=Array.isArray(w)?w[1]:w,B=Array.isArray(p)?p[0]:p,q=Array.isArray(p)?p[1]:p;return h===v?Z-B:Math.abs(z-v)-Math.abs(q-v)})[0];u.values=[f]}else t=null}else if(l.hasRegularIntervals&&l.extent){const[g,f]=l.extent;h>f||v<g?t=null:u.values=h===v?[h]:[Math.max(g,h),Math.min(f,v)]}}return t!=null&&R(t,a)?null:t}function te(e,n={}){var u,c;const{multidimensionalInfo:a,keyProperties:s}=e;if(a==null)return null;const{variableName:t,multidimensionalSubset:i,multidimensionalDefinition:r}=n,o=r!=null?(u=r[0])==null?void 0:u.variableName:null,m=t||o||(s==null?void 0:s.DefaultVariable);let{variables:l}=a;return(c=i==null?void 0:i.variables)!=null&&c.length&&(l=l.filter(({name:d})=>i.variables.includes(d))),m?l.find(({name:d})=>d===m)??l[0]:l[0]}function E(e,n={}){const a=te(e,n);if(!a)return null;const s=[],{dimensions:t,name:i}=a;if(t.length===0)return[new I({variableName:i,dimensionName:"",values:[],isSlice:!0})];for(let r=0;r<t.length;r++){const o=W(t[r],n.multidimensionalSubset,i);if(!o)return null;const{values:m,extent:l}=o;let u=(m==null?void 0:m[0])??(l==null?void 0:l[0]);o.name.toLowerCase()==="stdz"&&!o.hasRanges&&l&&Math.abs(l[1])<=Math.abs(l[0])&&(u=m!=null&&m.length?m[m.length-1]:l[1]),s.push(new I({variableName:i,dimensionName:o.name,values:[u],isSlice:!n.useRangeForRangedDimensionInfo||!!o.hasRanges}))}return s}function Ne(e){return!!(e!=null&&e.length)&&e.some(n=>{if(n.values==null)return!0;const a=n.values.length;return a===0||a>1||!n.isSlice&&Array.isArray(n.values[0])})}function xe(e,n){var s;if(n==null||e==null)return null;let a=n.variables.map(t=>({...t}));return(s=e==null?void 0:e.variables)!=null&&s.length&&(a=a.filter(({name:t})=>e.variables.includes(t)),a.forEach(t=>{t.dimensions=t.dimensions.map(i=>W(i,e,t.name)).filter(K)})),a}function ae(e,n){var o;const{values:a}=n;if(a!=null&&a.length){const m=Array.isArray(a[0]),l=Array.isArray(e);return m!==l?-1:m&&l?a.findIndex(u=>u[0]===e[0]&&u[1]===e[1]):a.indexOf(e)}const{extent:s}=n;if(Array.isArray(e)||!s||e<s[0]||e>s[1])return-1;const t=n.interval||1;if(n.unit!=="ISO8601")return Math.round((e-s[0])/t);const i=s[0];let r=-1;switch(((o=n.intervalUnit)==null?void 0:o.toLowerCase())||"days"){case"seconds":r=Math.round((e-i)/1e3/t);break;case"minutes":r=Math.round((e-i)/6e4/t);break;case"hours":r=Math.round((e-i)/36e5/t);break;case"days":r=Math.round((e-i)/864e5/t);break;case"months":{const m=new Date(e).getUTCFullYear()-new Date(i).getUTCFullYear(),l=new Date(i).getUTCMonth(),u=new Date(e).getUTCMonth();r=m===0?u-l:u+11-l+12*(m-1)}break;case"years":r=Math.round((new Date(e).getUTCFullYear()-new Date(i).getUTCFullYear())/t);break;case"decades":r=Math.round((new Date(e).getUTCFullYear()-new Date(i).getUTCFullYear())/10/t)}return r}function P(e){var r,o;let n=(r=e.values)==null?void 0:r.length;if(n)return n;const{extent:a,unit:s}=e,t=e.interval||1,i=a?a[1]-a[0]:0;if(s!=="ISO8601")return Math.round(i/t);switch(((o=e.intervalUnit)==null?void 0:o.toLowerCase())??"seconds"){case"seconds":n=Math.round(i/1e3/t);break;case"minutes":n=Math.round(i/6e4/t);break;case"hours":n=Math.round(i/36e5/t);break;case"days":n=Math.round(i/864e5/t);break;case"months":if(a){const m=new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear(),l=new Date(a[0]).getUTCMonth(),u=new Date(a[1]).getUTCMonth();n=m===0?u-l+1:u+11-l+12*(m-1)+1}else n=0;break;case"years":n=a?Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/t):0;break;case"decades":n=a?Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/10/t):0;break;default:n=0}return n}function De(e){var i,r;if(((i=e.extent)==null?void 0:i.length)!==2||!e.interval)return[];const{extent:[n,a],interval:s}=e;if(e.unit==="ISO8601"){const o=((r=e.intervalUnit)==null?void 0:r.toLowerCase())??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(o)?ie(n,a,s,o):[]}const t=Math.round((a-n)/s);return Array.from({length:t},(o,m)=>m===t-1?a:n+m*s)}function ie(e,n,a,s){const t=[];let i=e;const r=new Date(e);for(;i<=n;)switch(t.push(i),s){case"decades":r.setUTCFullYear(r.getUTCFullYear()+10*a),i=r.getTime();break;case"years":r.setUTCFullYear(r.getUTCFullYear()+a),i=r.getTime();break;case"months":r.setUTCMonth(r.getUTCMonth()+a),i=r.getTime();break;case"days":i+=864e5*a;break;case"hours":i+=36e5*a;break;case"minutes":i+=6e4*a;break;case"seconds":i+=1e3*a}return t.length===1?t[1]=n:t[t.length-1]=n,t}function Se(e,n){let a=0;const s=e[0].variableName,t=[...n.variables].sort((i,r)=>i.name>r.name?1:-1);for(let i=0;i<t.length;i++){const r=t[i],o=[...r.dimensions].sort((u,c)=>u.name>c.name?-1:1);if(r.name!==s){a+=o.map(u=>P(u)).reduce((u,c)=>u*c);continue}const m=o.map(u=>P(u)),l=o.length;for(let u=0;u<l;u++){const c=e.find(b=>b.dimensionName===o[u].name);if(c==null)return null;const d=ae(c.values[0],o[u]);if(d===-1)return null;m.shift(),a+=u===l-1?d:d*m.reduce((b,D)=>b*D)}break}return a}function Me(e){return Math.round(24*(e-25569)*3600*1e3)}export{R as $,E as F,le as H,te as L,I as M,X as V,ue as X,oe as _,de as a,N as b,we as c,xe as d,me as e,pe as f,De as g,Ne as h,he as i,ge as l,ce as n,ye as o,Se as p,ve as r,fe as t,be as u,y as v,Me as w};
