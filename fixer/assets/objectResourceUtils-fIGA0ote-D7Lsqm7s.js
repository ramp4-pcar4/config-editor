const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./loader-hV6Mz7xG-BQNvh-k0.js","./index-DiOGazkl.js","./index-CpSsk29H.css","./mat4f64-BaJwL7tQ-k0uMm8LY.js","./enums-DBi1-Mm2-CUS1pvQe.js","./Version-BTMwSXf1-DEjuUdvI.js","./mat4-BFStKTjU-Bib9wxUy.js","./common-CYWrYyJl-E8-sukrT.js","./quat-D8L_R4I0-CMBQ_yU7.js","./mat3f64-Dh9_zhFu-BIT-k8Dm.js","./quatf64-C16JxGFv-BKWK1F8U.js","./vec32-BuqRmYBM-D6B9qCPB.js","./vec42-D8CJyqHG-DnfLTeQH.js","./BufferView-BBCzkcZS-3iq8whlT.js","./vec2-BnynUbeJ-CKtGJQAy.js","./devEnvironmentUtils-CxrVv3RG-ktR0Kqgv.js","./mat3-DOnW3DjW-C3hbW9XY.js","./vec2f64-CEUyUoff-BBc0aQ6D.js","./VerticalOffset.glsl-BtVaDxLq-j0XZn6Ek.js","./Indices-DkAzsiH--C10ftvlC.js","./InterleavedLayout-DcHoXu73-C2BcJT6D.js","./vec4f64-CjUMzAyX-DPYbdAom.js","./triangle-BePBrXJ8-DOAX6nhV.js","./sphere-Cj20syUS-BYHiUXdf.js","./plane-B_adY3_o-D_A32zKw.js","./lineSegment-BJNfNZM5-BhAF-tHw.js","./renderState-DlSSrLcZ-Du_EmLq6.js","./VertexAttribute-DFC3a3eR-BhmQtMsu.js","./ShaderOutput-C_OqLoo1-jp3zUBgm.js","./BindType-CKbZk6AG-Bqvzo9NX.js","./glsl-o28TenZV-B0eZUNn3.js","./lengthUtils-wU9RRIqK-CF8QejgG.js","./boundedPlane-B6TkXVHT-2W9NmjhG.js","./ViewingMode-CyR_b1T8-_s7_Gbsk.js","./requestImageUtils-rT_rMd2F-C-gGuXgP.js","./TextureFormat-Cl0ugX3E-DD0Aw8RG.js","./Texture-DXSFJsEu-DZV9f3XV.js","./signal-DxzURL18-B-SS2xji.js","./getDataTypeBytes-HSdrWtlL-ClHsCcSN.js","./orientedBoundingBox-CTsjUkMw--RMT9kfU.js","./spatialReferenceEllipsoidUtils-DlQOpWof-DMfdbodh.js","./computeTranslationToOriginAndRotation-DwwrTl3S-nRJadthZ.js","./projection-m8vi7Cxv-C38gXQRM.js","./vec3-CRJiMrND-gvaJYIo9.js","./vec4-DcTMp5mq-DNgnZM33.js","./vec2f32-CVhmN3Me-DxoqVD7C.js","./memoryEstimations-iHVpvWPf-ScSPMRuy.js","./NestedMap-Ddo7BfvO-C19CMXI3.js","./DefaultMaterial-DGGIMylx-B4PMdSK0.js","./NormalAttribute.glsl-C9zbIKka-CzIkXlO0.js","./doublePrecisionUtils-BJbYwoii-kIP-tL_t.js","./ShaderBuilder-BkQM64Qp-DPuZGbmx.js"])))=>i.map(i=>d[i]);
import{cc as Ae,mf as Me,mg as Be,mh as Se,_ as Ie,j7 as ue,jQ as G,iR as Z,ce as Ee,H as Oe,me as _e,b as ce,cn as Q,G as J,c as me,gi as ee,jV as $e,iX as fe,df as D,a8 as Pe,a5 as Le}from"./index-DiOGazkl.js";import{m as Ue}from"./devEnvironmentUtils-CxrVv3RG-ktR0Kqgv.js";import{X as je,P as Ce,E as te}from"./mat3-DOnW3DjW-C3hbW9XY.js";import{n as de,o as z}from"./mat3f64-Dh9_zhFu-BIT-k8Dm.js";import{z as ke}from"./mat4-BFStKTjU-Bib9wxUy.js";import{n as Ne}from"./mat4f64-BaJwL7tQ-k0uMm8LY.js";import{_ as Fe}from"./vec2f64-CEUyUoff-BBc0aQ6D.js";import{Z as re,r as qe,x as ne,b as Ge,l as Ve,Y as De}from"./vec32-BuqRmYBM-D6B9qCPB.js";import{aR as q,aQ as pe,q as he}from"./VerticalOffset.glsl-BtVaDxLq-j0XZn6Ek.js";import{X as ye,L as ze,C as Xe,l as ge,g as Ke,M as He}from"./BufferView-BBCzkcZS-3iq8whlT.js";import{_ as Qe,z as Je,T as oe,R as se}from"./vec3-CRJiMrND-gvaJYIo9.js";import{R as We,q as ae}from"./vec4-DcTMp5mq-DNgnZM33.js";import{A as xe,c as Ye}from"./Indices-DkAzsiH--C10ftvlC.js";import{G as ie,T as X}from"./enums-DBi1-Mm2-CUS1pvQe.js";import{I as B,c as Ze,a as H,v as Te}from"./renderState-DlSSrLcZ-Du_EmLq6.js";import{f as et,l as tt}from"./vec2f32-CVhmN3Me-DxoqVD7C.js";import{f as rt}from"./memoryEstimations-iHVpvWPf-ScSPMRuy.js";import{s as nt}from"./NestedMap-Ddo7BfvO-C19CMXI3.js";import{m as we}from"./Version-BTMwSXf1-DEjuUdvI.js";import{r as ot}from"./requestImageUtils-rT_rMd2F-C-gGuXgP.js";import{M as j}from"./orientedBoundingBox-CTsjUkMw--RMT9kfU.js";import{T as L}from"./VertexAttribute-DFC3a3eR-BhmQtMsu.js";import{e as st,p as at,E as V,K as it,Q as lt}from"./DefaultMaterial-DGGIMylx-B4PMdSK0.js";import{a as le}from"./NormalAttribute.glsl-C9zbIKka-CzIkXlO0.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./InterleavedLayout-DcHoXu73-C2BcJT6D.js";import"./vec42-D8CJyqHG-DnfLTeQH.js";import"./vec4f64-CjUMzAyX-DPYbdAom.js";import"./triangle-BePBrXJ8-DOAX6nhV.js";import"./sphere-Cj20syUS-BYHiUXdf.js";import"./plane-B_adY3_o-D_A32zKw.js";import"./quatf64-C16JxGFv-BKWK1F8U.js";import"./lineSegment-BJNfNZM5-BhAF-tHw.js";import"./ShaderOutput-C_OqLoo1-jp3zUBgm.js";import"./BindType-CKbZk6AG-Bqvzo9NX.js";import"./glsl-o28TenZV-B0eZUNn3.js";import"./lengthUtils-wU9RRIqK-CF8QejgG.js";import"./boundedPlane-B6TkXVHT-2W9NmjhG.js";import"./ViewingMode-CyR_b1T8-_s7_Gbsk.js";import"./TextureFormat-Cl0ugX3E-DD0Aw8RG.js";import"./Texture-DXSFJsEu-DZV9f3XV.js";import"./signal-DxzURL18-B-SS2xji.js";import"./getDataTypeBytes-HSdrWtlL-ClHsCcSN.js";import"./vec2-BnynUbeJ-CKtGJQAy.js";import"./projection-m8vi7Cxv-C38gXQRM.js";import"./quat-D8L_R4I0-CMBQ_yU7.js";import"./spatialReferenceEllipsoidUtils-DlQOpWof-DMfdbodh.js";import"./computeTranslationToOriginAndRotation-DwwrTl3S-nRJadthZ.js";import"./doublePrecisionUtils-BJbYwoii-kIP-tL_t.js";import"./ShaderBuilder-BkQM64Qp-DPuZGbmx.js";let ut=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,t){return this._load("json",e,t)}async loadBinary(e,t){return Ee(e)?(Oe(t),_e(e)):this._load("binary",e,t)}async loadImage(e,t){return this._load("image",e,t)}async _load(e,t,o){if(this._streamDataRequester==null)return(await ce(t,{responseType:ct[e]})).data;const r=await Q(this._streamDataRequester.request(t,e,o));if(r.ok===!0)return r.value;throw J(r.error),new me("glt-loader-request-error",`Request for resource failed: ${r.error}`)}};const ct={image:"image",binary:"array-buffer",json:"json","image+type":void 0},S=()=>Pe.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");class mt{constructor(t,o,r){this.resource=t,this.textures=o,this.cachedMemory=r}}async function ft(e,t){const o=await dt(e,t),r=await xt(o.textureDefinitions??{},t);let a=0;for(const s in r)if(r.hasOwnProperty(s)){const i=r[s];a+=i!=null&&i.image?i.image.width*i.image.height*4:0}return new mt(o,r,a+rt(o))}async function dt(e,t){const o=t==null?void 0:t.streamDataRequester;if(o)return pt(e,o,t);const r=await Q(ce(e,t));if(r.ok===!0)return r.value.data;J(r.error),be(r.error)}async function pt(e,t,o){const r=await Q(t.request(e,"json",o));if(r.ok===!0)return r.value;J(r.error),be(r.error.details.url)}function be(e){throw new me("",`Request for object resource failed: ${e}`)}function ht(e){const t=e.params,o=t.topology;let r=!0;switch(t.vertexAttributes||(S().warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=t.faces;if(s){if(t.vertexAttributes)for(const i in t.vertexAttributes){const l=s[i];l!=null&&l.values?(l.valueType!=null&&l.valueType!=="UInt32"&&(S().warn(`Unsupported indexed geometry indices type '${l.valueType}', only UInt32 is currently supported`),r=!1),l.valuesPerElement!=null&&l.valuesPerElement!==1&&(S().warn(`Unsupported indexed geometry values per element '${l.valuesPerElement}', only 1 is currently supported`),r=!1)):(S().warn(`Indexed geometry does not specify face indices for '${i}' attribute`),r=!1)}}else S().warn("Indexed geometries must specify faces"),r=!1;break}default:S().warn(`Unsupported topology '${o}'`),r=!1}e.params.material||(S().warn("Geometry requires material"),r=!1);const a=e.params.vertexAttributes;for(const s in a)a[s].values||(S().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function yt(e,t){var f,w;const o=new Array,r=new Array,a=new Array,s=new nt,i=e.resource,l=we.parse(i.version||"1.0","wosr");wt.validate(l);const n=i.model.name,u=i.model.geometries,c=i.materialDefinitions??{},m=e.textures;let p=0;const h=new Map;for(let g=0;g<u.length;g++){const x=u[g];if(!ht(x))continue;const A=Tt(x),T=x.params.vertexAttributes,y=[],O=d=>{if(x.params.topology==="PerAttributeArray")return null;const v=x.params.faces;for(const b in v)if(b===d)return v[b].values;return null},C=T[L.POSITION],N=C.values.length/C.valuesPerElement;for(const d in T){const v=T[d],b=v.values,M=O(d)??xe(N);y.push([d,new j(b,M,v.valuesPerElement,!0)])}const I=A.texture,R=m&&m[I];if(R&&!h.has(I)){const{image:d,parameters:v}=R,b=new he(d,v);r.push(b),h.set(I,b)}const F=h.get(I),_=F?F.id:void 0,$=A.material;let E=s.get($,I);if(E==null){const d=c[$.slice($.lastIndexOf("/")+1)].params;d.transparency===1&&(d.transparency=0);const v=R&&R.alphaChannelUsage,b=d.transparency>0||v==="transparency"||v==="maskAndTransparency",M=R?ve(R.alphaChannelUsage):void 0,Y={ambient:ee(d.diffuse),diffuse:ee(d.diffuse),opacity:1-(d.transparency||0),transparent:b,textureAlphaMode:M,textureAlphaCutoff:.33,textureId:_,doubleSided:!0,cullFace:H.None,colorMixMode:d.externalColorMixMode||"tint",textureAlphaPremultiplied:(R==null?void 0:R.parameters.preMultiplyAlpha)??!1};t!=null&&t.materialParameters&&Object.assign(Y,t.materialParameters),E=new V(Y,t),s.set($,I,E)}a.push(E);const P=new pe(E,y);p+=((w=(f=y.find(d=>d[0]===L.POSITION))==null?void 0:f[1])==null?void 0:w.indices.length)??0,o.push(P)}return{engineResources:[{name:n,stageResources:{textures:r,materials:a,geometries:o},pivotOffset:i.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:gt(o)}}function gt(e){const t=ue();return e.forEach(o=>{const r=o.boundingInfo;r!=null&&(G(t,r.bbMin),G(t,r.bbMax))}),t}async function xt(e,t){const o=new Array;for(const s in e){const i=e[s],l=i.images[0].data;if(!l){S().warn("Externally referenced texture data is not yet supported");continue}const n=i.encoding+";base64,"+l,u="/textureDefinitions/"+s,c=i.channels==="rgba"?i.alphaChannelUsage||"transparency":"none",m={noUnpackFlip:!0,wrap:{s:ie.REPEAT,t:ie.REPEAT},preMultiplyAlpha:ve(c)!==B.Opaque},p=t!=null&&t.disableTextures?Promise.resolve(null):ot(n,t);o.push(p.then(h=>({refId:u,image:h,parameters:m,alphaChannelUsage:c})))}const r=await Promise.all(o),a={};for(const s of r)a[s.refId]=s;return a}function ve(e){switch(e){case"mask":return B.Mask;case"maskAndTransparency":return B.MaskBlend;case"none":return B.Opaque;default:return B.Blend}}function Tt(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const wt=new we(1,2,"wosr");function bt(e,t){W(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function W(e,t,o=2,r=o){const a=t.length/2;let s=0,i=0;if(!Ae(t)||Me(t)){for(let n=0;n<a;++n)e[s]=t[i],e[s+1]=t[i+1],s+=o,i+=r;return}const l=Be(t);if(Se(t))for(let n=0;n<a;++n)e[s]=Math.max(t[i]/l,-1),e[s+1]=Math.max(t[i+1]/l,-1),s+=o,i+=r;else for(let n=0;n<a;++n)e[s]=t[i]/l,e[s+1]=t[i+1]/l,s+=o,i+=r}function vt(e,t,o,r){const a=e.typedBuffer,s=e.typedBufferStride,i=(r==null?void 0:r.count)??e.count;let l=((r==null?void 0:r.dstIndex)??0)*s;for(let n=0;n<i;++n)a[l]=t,a[l+1]=o,l+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:vt,normalizeIntegerBuffer:W,normalizeIntegerBufferView:bt},Symbol.toStringTag,{value:"Module"}));let Rt=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=Te.KTX2_ENCODING}};function K(e){return(e==null?void 0:e.type)==="encoded-mesh-texture"}async function $r(e){const t=new Blob([e]),o=await t.text();return JSON.parse(o)}async function Pr(e,t){if(t===Te.KTX2_ENCODING)return new Rt(e);const o=new Blob([e],{type:t});let r=URL.createObjectURL(o);switch(t){case"image/jpeg":r+="#.jpg";break;case"image/png":r+="#.png"}const a=new Image;if(Le("esri-iPhone"))return new Promise((s,i)=>{const l=()=>{u(),s(a)},n=c=>{u(),i(c)},u=()=>{URL.revokeObjectURL(r),a.removeEventListener("load",l),a.removeEventListener("error",n)};a.addEventListener("load",l),a.addEventListener("error",n),a.src=r});try{a.src=r,await a.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(r),a}function At(e,t){switch(t){case X.TRIANGLES:return Mt(e);case X.TRIANGLE_STRIP:return Bt(e);case X.TRIANGLE_FAN:return St(e)}}function Mt(e){return typeof e=="number"?xe(e):$e(e)?new Uint16Array(e):e}function Bt(e){const t=typeof e=="number"?e:e.length;if(t<3)return[];const o=t-2,r=Ye(3*o);if(typeof e=="number"){let a=0;for(let s=0;s<o;s+=1)s%2==0?(r[a++]=s,r[a++]=s+1,r[a++]=s+2):(r[a++]=s+1,r[a++]=s,r[a++]=s+2)}else{let a=0;for(let s=0;s<o;s+=1)s%2==0?(r[a++]=e[s],r[a++]=e[s+1],r[a++]=e[s+2]):(r[a++]=e[s+1],r[a++]=e[s],r[a++]=e[s+2])}return r}function St(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const o=t-2,r=o<=65536?new Uint16Array(3*o):new Uint32Array(3*o);if(typeof e=="number"){let l=0;for(let n=0;n<o;++n)r[l++]=0,r[l++]=n+1,r[l++]=n+2;return r}const a=e[0];let s=e[1],i=0;for(let l=0;l<o;++l){const n=e[l+2];r[i++]=a,r[i++]=s,r[i++]=n,s=n}return r}function k(e){if(e==null)return null;const t=e.offset!=null?e.offset:et,o=e.rotation!=null?e.rotation:0,r=e.scale!=null?e.scale:tt,a=z(1,0,0,0,1,0,t[0],t[1],1),s=z(Math.cos(o),-Math.sin(o),0,Math.sin(o),Math.cos(o),0,0,0,1),i=z(r[0],0,0,0,r[1],0,0,0,1),l=de();return te(l,s,i),te(l,a,l),l}class It{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class Et{constructor(t,o,r){this.name=t,this.lodThreshold=o,this.pivotOffset=r,this.stageResources=new It,this.numberOfVertices=0}}async function Ot(e,t){var m;const o=Re(Ue(e));if(o.fileType==="wosr"){const p=await(t.cache?t.cache.loadWOSR(o.url,t):ft(o.url,t)),{engineResources:h,referenceBoundingBox:f}=yt(p,t);return{lods:h,referenceBoundingBox:f,isEsriSymbolResource:!1,isWosr:!0}}let r;if(t.cache)r=await t.cache.loadGLTF(o.url,t,!!t.usePBR);else{const{loadGLTF:p}=await Ie(()=>import("./loader-hV6Mz7xG-BQNvh-k0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]),import.meta.url);r=await p(new ut(t.streamDataRequester),o.url,t,t.usePBR)}const a=(m=r.model.meta)==null?void 0:m.ESRI_proxyEllipsoid,s=r.meta.isEsriSymbolResource&&a!=null&&r.meta.ESRI_webstyle==="EsriRealisticTreesStyle";s&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,Ut(r,a));const i=!!t.usePBR,l=r.meta.isEsriSymbolResource?{usePBR:i,isSchematic:!1,treeRendering:s,mrrFactors:st}:{usePBR:i,isSchematic:!1,treeRendering:!1,mrrFactors:at},n={...t.materialParameters,treeRendering:s},{engineResources:u,referenceBoundingBox:c}=_t(r,l,n,t,o.specifiedLodIndex);return{lods:u,referenceBoundingBox:c,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function Re(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function _t(e,t,o,r,a){const s=e.model,i=new Array,l=new Map,n=new Map,u=s.lods.length,c=ue();return s.lods.forEach((m,p)=>{const h=r.skipHighLods===!0&&(u>1&&p===0||u>3&&p===1)||r.skipHighLods===!1&&a!=null&&p!==a;if(h&&p!==0)return;const f=new Et(m.name,m.lodThreshold,[0,0,0]);m.parts.forEach(w=>{const g=h?new V({},r):$t(s,w,f,t,o,l,n,r),{geometry:x,vertexCount:A}=Pt(w,g??new V({},r)),T=x.boundingInfo;T!=null&&p===0&&(G(c,T.bbMin),G(c,T.bbMax)),g!=null&&(f.stageResources.geometries.push(x),f.numberOfVertices+=A)}),h||i.push(f)}),{engineResources:i,referenceBoundingBox:c}}function $t(e,t,o,r,a,s,i,l){var A,T;const n=e.materials.get(t.material);if(n==null)return null;const{normal:u,color:c,texCoord0:m,tangent:p}=t.attributes,h=t.material+(u?"_normal":"")+(c?"_color":"")+(m?"_texCoord0":"")+(p?"_tangent":""),f=t.attributes.texCoord0!=null,w=t.attributes.normal!=null,g=Lt(n.alphaMode);if(!s.has(h)){if(f){const P=(d,v=!1)=>{if(d!=null&&!i.has(d)){const b=e.textures.get(d);if(b){const M=b.data;i.set(d,new he(K(M)?M.data:M,{...b.parameters,preMultiplyAlpha:!K(M)&&v,encoding:K(M)?M.encoding:void 0}))}}};P(n.colorTexture,g!==B.Opaque),P(n.normalTexture),P(n.occlusionTexture),P(n.emissiveTexture),P(n.metallicRoughnessTexture)}const y=1/fe,O=n.color[0]**y,C=n.color[1]**y,N=n.color[2]**y,I=n.emissiveFactor[0]**y,R=n.emissiveFactor[1]**y,F=n.emissiveFactor[2]**y,_=n.colorTexture!=null&&f?i.get(n.colorTexture):null,$=it(n),E=((A=n.normalTextureTransform)==null?void 0:A.scale)!=null?(T=n.normalTextureTransform)==null?void 0:T.scale:Fe;s.set(h,new V({...r,transparent:g===B.Blend,customDepthTest:Ze.Lequal,textureAlphaMode:g,textureAlphaCutoff:n.alphaCutoff,diffuse:[O,C,N],ambient:[O,C,N],opacity:n.opacity,doubleSided:n.doubleSided,doubleSidedType:"winding-order",cullFace:n.doubleSided?H.None:H.Back,hasVertexColors:!!t.attributes.color,hasVertexTangents:!!t.attributes.tangent,normalType:w?le.Attribute:le.ScreenDerivative,castShadows:!0,receiveShadows:n.receiveShadows,receiveAmbientOcclusion:n.receiveAmbientOcclustion,textureId:_==null?void 0:_.id,colorMixMode:n.colorMixMode,normalTextureId:n.normalTexture!=null&&f?i.get(n.normalTexture).id:void 0,textureAlphaPremultiplied:_!=null&&!!_.parameters.preMultiplyAlpha,occlusionTextureId:n.occlusionTexture!=null&&f?i.get(n.occlusionTexture).id:void 0,emissiveTextureId:n.emissiveTexture!=null&&f?i.get(n.emissiveTexture).id:void 0,metallicRoughnessTextureId:n.metallicRoughnessTexture!=null&&f?i.get(n.metallicRoughnessTexture).id:void 0,emissiveFactor:[I,R,F],mrrFactors:$?lt:[n.metallicFactor,n.roughnessFactor,r.mrrFactors[2]],isSchematic:$,colorTextureTransformMatrix:k(n.colorTextureTransform),normalTextureTransformMatrix:k(n.normalTextureTransform),scale:[E[0],E[1]],occlusionTextureTransformMatrix:k(n.occlusionTextureTransform),emissiveTextureTransformMatrix:k(n.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:k(n.metallicRoughnessTextureTransform),...a},l))}const x=s.get(h);if(o.stageResources.materials.push(x),f){const y=O=>{O!=null&&o.stageResources.textures.push(i.get(O))};y(n.colorTexture),y(n.normalTexture),y(n.occlusionTexture),y(n.emissiveTexture),y(n.metallicRoughnessTexture)}return x}function Pt(e,t){const o=e.attributes.position.count,r=At(e.indices||o,e.primitiveType),a=q(3*o),{typedBuffer:s,typedBufferStride:i}=e.attributes.position;Qe(a,s,e.transform,3,i);const l=[[L.POSITION,new j(a,r,3,!0)]];if(e.attributes.normal!=null){const u=q(3*o),{typedBuffer:c,typedBufferStride:m}=e.attributes.normal;je(U,e.transform),Je(u,c,U,3,m),Z(U)&&oe(u,u),l.push([L.NORMAL,new j(u,r,3,!0)])}if(e.attributes.tangent!=null){const u=q(4*o),{typedBuffer:c,typedBufferStride:m}=e.attributes.tangent;Ce(U,e.transform),We(u,c,U,4,m),Z(U)&&oe(u,u,4),l.push([L.TANGENT,new j(u,r,4,!0)])}if(e.attributes.texCoord0!=null){const u=q(2*o),{typedBuffer:c,typedBufferStride:m}=e.attributes.texCoord0;W(u,c,2,m),l.push([L.UV0,new j(u,r,2,!0)])}const n=e.attributes.color;if(n!=null){const u=new Uint8Array(4*o);n.elementCount===4?n instanceof ye?ae(u,n,1,255):(n instanceof ze||n instanceof Xe)&&ae(u,n,1/255,255):(u.fill(255),n instanceof ge?se(u,n.typedBuffer,1,255,4,n.typedBufferStride):(e.attributes.color instanceof Ke||e.attributes.color instanceof He)&&se(u,n.typedBuffer,1/255,255,4,e.attributes.color.typedBufferStride)),l.push([L.COLOR,new j(u,r,4,!0)])}return{geometry:new pe(t,l),vertexCount:o}}const U=de();function Lt(e){switch(e){case"BLEND":return B.Blend;case"MASK":return B.Mask;case"OPAQUE":case null:case void 0:return B.Opaque}}function Ut(e,t){for(let o=0;o<e.model.lods.length;++o){const r=e.model.lods[o];for(const a of r.parts){const s=a.attributes.normal;if(s==null)return;const i=a.attributes.position,l=i.count,n=D(),u=D(),c=D(),m=new Float32Array(4*l),p=new Float32Array(3*l),h=ke(Ne(),a.transform);let f=0,w=0;for(let g=0;g<l;g++){i.getVec(g,u),s.getVec(g,n),re(u,u,a.transform),qe(c,u,t.center),ne(c,c,t.radius);const x=c[2],A=Ge(c),T=Math.min(.45+.55*A*A,1)**fe;ne(c,c,t.radius),h!==null&&re(c,c,h),Ve(c,c),o+1!==e.model.lods.length&&e.model.lods.length>1&&De(c,c,n,x>-1?.2:Math.min(-4*x-3.8,1)),p[f]=c[0],p[f+1]=c[1],p[f+2]=c[2],f+=3,m[w]=T,m[w+1]=T,m[w+2]=T,m[w+3]=1,w+=4}a.attributes.normal=new ge(p),a.attributes.color=new ye(m)}}}const Lr=Object.freeze(Object.defineProperty({__proto__:null,fetch:Ot,parseUrl:Re},Symbol.toStringTag,{value:"Module"}));export{Ot as Y,ut as a,At as b,bt as c,Lr as d,vt as l,K as n,Pr as o,$r as r,k as s,Rt as t};
