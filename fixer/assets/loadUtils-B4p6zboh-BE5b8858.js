import{o as m,g as p}from"./fetchService-IPSkq0MP-CzyO_vSu.js";import{q as b}from"./associatedFeatureServiceUtils-5tlRvHRs-DnC_9ZJy.js";import{it as h}from"./index-aQr1pzMk.js";class w{constructor(){this._serviceMetadatas=new Map,this._itemDatas=new Map}async fetchServiceMetadata(t,r){const a=this._serviceMetadatas.get(t);if(a)return a;const s=await m(t,r);return this._serviceMetadatas.set(t,s),s}async fetchItemData(t){const{id:r}=t;if(!r)return null;const{_itemDatas:a}=this;if(a.has(r))return a.get(r);const s=await t.fetchData();return a.set(r,s),s}async fetchCustomParameters(t,r){const a=await this.fetchItemData(t);return a&&typeof a=="object"&&(r?r(a):a.customParameters)||null}}function i(e){const t={id:e.id,name:e.name},r=p(e.type);return r!=="FeatureLayer"&&(t.layerType=r),t}async function S(e,t,r){var s,u,c;let a;if((e==null?void 0:e.layers)==null||(e==null?void 0:e.tables)==null){const l=await r.fetchServiceMetadata(t,{customParameters:(s=y(e))==null?void 0:s.customParameters});a=h(),(e=e||{}).layers=e.layers||((u=l==null?void 0:l.layers)==null?void 0:u.map(i)),e.tables=e.tables||((c=l==null?void 0:l.tables)==null?void 0:c.map(i))}return{data:e,preferredHost:a}}function y(e){if(!e)return null;const{layers:t,tables:r}=e;return t!=null&&t.length?t[0]:r!=null&&r.length?r[0]:null}function I(e,t){return t==null?null:[...e.layers||[],...e.tables||[]].find(r=>r.id===t)}function v(e,t){return[...e.layers||[],...e.tables||[]].filter(({layerType:r})=>r?t.includes(r):t.includes("ArcGISFeatureLayer"))}function M(e){var t,r;return(((t=e==null?void 0:e.layers)==null?void 0:t.length)??0)+(((r=e==null?void 0:e.tables)==null?void 0:r.length)??0)}function P(e){switch(e){case"catalog":return["CatalogLayer"];case"feature":return["ArcGISFeatureLayer"];case"oriented-imagery":return["OrientedImageryLayer"];case"subtype-group":return["SubtypeGroupLayer","SubtypeGroupTable"]}return null}function G(e){switch(e){case"CatalogLayer":return"CatalogLayer";case"OrientedImageryLayer":return"OrientedImageryLayer";case"SubtypeGroupLayer":case"SubtypeGroupTable":return"SubtypeGroupLayer"}return"FeatureLayer"}async function D(e,t,r){var u,c,l,f;if(!(e!=null&&e.url))return t??{};if(t??(t={}),!t.layers){const n=await r.fetchServiceMetadata(e.url);t.layers=(u=n.layers)==null?void 0:u.map(i)}const{serverUrl:a,portalItem:s}=await b(e.url,{sceneLayerItem:e,customParameters:(c=y(t))==null?void 0:c.customParameters}).catch(()=>({serverUrl:null,portalItem:null}));if(a==null)return t.tables=[],t;if(!t.tables&&s){const n=await s.fetchData().catch(()=>null);if(n!=null&&n.tables)t.tables=n.tables.map(i);else{const o=await r.fetchServiceMetadata(a,{customParameters:(l=y(n))==null?void 0:l.customParameters}).catch(()=>null);t.tables=(f=o==null?void 0:o.tables)==null?void 0:f.map(i)}}if(t.tables)for(const n of t.tables)n.url=`${a}/${n.id}`;return t}export{G as L,I as b,M as d,w as f,P as g,v as h,i as l,S as p,y as u,D as w};
