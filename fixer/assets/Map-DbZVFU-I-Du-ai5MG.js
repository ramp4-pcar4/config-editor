const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ElevationQuery-DuUlMAmS-DK6PeerD.js","./index-V75RkAZg.js","./index-CpSsk29H.css","./projection-m8vi7Cxv-MPQBAE9_.js","./TileKey-B_6qmYK--BtZdR-Xy.js","./layersCreator-Vp21VWYz-CxynMFZ1.js","./loadUtils-qPQbuxA4-CJZGaqLy.js","./fetchService-Bp_4TwIU-C72-_JVk.js","./associatedFeatureServiceUtils-DCapzd9d-LKA4pr89.js","./PortalItem-CJetnHeq-BmR4deil.js","./lazyLayerLoader-CEoVkyTx-BXdquhyH.js","./portalLayers-DhiK9wgY-BX_IGZpD.js","./portalItemUtils-DsrxEt4W-BFvAGkvd.js","./styleUtils-DbPBpaXg-CfSpwBjY.js"])))=>i.map(i=>d[i]);
import{v as i,ca as D,I as l,t as c,Y as j,a3 as G,aa as E,R as q,a8 as p,bd as g,ci as x,dx as z,c as H,_ as w,H as L,z as $,U as J,S as O,co as V,dy as Q,dz as W,a as k,bM as Y,a1 as R,br as K,dA as Z,dB as X,A as ee,a9 as F,ai as te,bh as re,b3 as ae}from"./index-V75RkAZg.js";import{F as f,a as M}from"./Basemap-DxWxjcEH-rQTh1mLu.js";import{y as se}from"./loadAll-BIhJ1RSe-B99U4CNe.js";import{f as I}from"./CollectionFlattener-9hYRBLDX-Bw0jowzo.js";import"./mat4f32-CiZjBg9k-CUm34GoR.js";import"./mat4-BFStKTjU-DR_gzsZK.js";import{U as oe}from"./Layer-B8q-l4yV-D3Rc0sPb.js";import"./PortalItem-CJetnHeq-BmR4deil.js";import"./intl-DLmy-Li5-CbupOHia.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./TimeExtent-gZaEUVeW-B3MjAsHp.js";var T;let m=T=class extends j{constructor(e){super(e),this.type="none"}clone(){return new T({type:this.type})}};i([D({none:"none",stayAbove:"stay-above"}),l({json:{write:{isRequired:!0}}})],m.prototype,"type",void 0),m=T=i([c("esri.ground.NavigationConstraint")],m);const ne=Symbol("GroundInstance");var N,S;let y=S=class extends j.JSONSupportMixin(G){constructor(e){super(e),this[N]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new E;const t=a=>{a.parent&&a.parent!==this&&"remove"in a.parent&&a.parent.remove(a),a.parent=this,a.type!=="elevation"&&a.type!=="base-elevation"&&p.getLogger(this).error(`Layer '${a.title}, id:${a.id}' of type '${a.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=a=>{a.parent=null};this.addHandles([this.layers.on("after-add",a=>t(a.item)),this.layers.on("after-remove",a=>r(a.item))])}initialize(){this.when().catch(e=>{q(e)||p.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)g(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}get layers(){return this._get("layers")}set layers(e){this._set("layers",x(e,this._get("layers")))}writeLayers(e,t,r,a){const o=[];e&&(a={...a,layerContainerType:"ground"},e.forEach(n=>{if("write"in n){const s={};z(n)().write(s,a)&&o.push(s)}else a!=null&&a.messages&&a.messages.push(new H("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=o}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return se(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:r}=await w(()=>import("./ElevationQuery-DuUlMAmS-DK6PeerD.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url);L(t);const a=new r,o=this.layers.filter(B).toArray();return a.queryAll(o,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:r}=await w(()=>import("./ElevationQuery-DuUlMAmS-DK6PeerD.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url);L(t);const a=new r,o=this.layers.filter(B).toArray();return a.createSamplerAll(o,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:$(this.surfaceColor),navigationConstraint:$(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new S({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,r){const a=(t==null?void 0:t.origin)||"web-scene",o=(t==null?void 0:t.portal)||null,n=(t==null?void 0:t.url)||null,{populateOperationalLayers:s}=await w(async()=>{const{populateOperationalLayers:v}=await import("./layersCreator-Vp21VWYz-CxynMFZ1.js");return{populateOperationalLayers:v}},__vite__mapDeps([5,1,2,6,7,8,9,10,11,12,3,13]),import.meta.url);L(r);const u=[];if(e.layers&&Array.isArray(e.layers)){const v={context:{origin:a,url:n,portal:o,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};u.push(s(this.layers,e.layers,v))}await Promise.allSettled(u)}};function ie(e){return e&&"createElevationSampler"in e}function B(e){return e.type==="elevation"||ie(e)}N=ne,i([l({json:{read:!1,write:{isRequired:!0}}})],y.prototype,"layers",null),i([J("layers")],y.prototype,"writeLayers",null),i([l({readOnly:!0})],y.prototype,"resourceInfo",void 0),i([l({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:O,read:{reader:V,source:"transparency"},write:{writer:(e,t)=>{t.transparency=Q(e)},target:"transparency"}}})],y.prototype,"opacity",void 0),i([l({type:W,json:{type:[O],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],y.prototype,"surfaceColor",void 0),i([l({type:m,json:{write:!0}})],y.prototype,"navigationConstraint",void 0),y=S=i([c("esri.Ground")],y);const b=y;function le(e){return new I({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const r=[];return"tables"in t&&r.push(t.tables),"layers"in t&&r.push(t.layers),r},itemFilterFunction:t=>{const r=t.parent;return!!r&&"tables"in r&&r.tables.includes(t)}})}function $e(e){for(const t of e.values())t==null||t.destroy();e.clear()}function A(e,t,r){let a,o;if(e)for(let n=0,s=e.length;n<s;n++){if(a=e.at(n),(a==null?void 0:a[t])===r)return a;if((a==null?void 0:a.type)==="group"&&(o=A(a.layers,t,r),o))return o}}const de=e=>{let t=class extends e{constructor(...r){super(...r),this.layers=new E;const a=s=>{s.parent&&"remove"in s.parent&&s.parent.remove(s)},o=s=>{s.parent=this,this.layerAdded(s),s.type!=="elevation"&&s.type!=="base-elevation"||p.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as an operational layer and will therefore be ignored.`)},n=s=>{s.parent=null,this.layerRemoved(s)};this.addHandles([this.layers.on("before-add",s=>{if(s.item===this)return s.preventDefault(),void p.getLogger(this).error("#add()","Cannot add layer to itself.");a(s.item)}),this.layers.on("after-add",s=>o(s.item)),this.layers.on("after-remove",s=>n(s.item))])}destroy(){const r=this.layers.toArray();for(const a of r)a.destroy();this.layers.destroy()}set layers(r){this._set("layers",x(r,this._get("layers")))}add(r,a){const o=this.layers;if(a=o.getNextIndex(a),r instanceof oe){const n=r;n.parent===this?this.reorder(n,a):o.add(n,a)}else K(r)?r.then(n=>{this.destroyed||this.add(n,a)}):p.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,a){const o=this.layers;let n=o.getNextIndex(a);r.slice().forEach(s=>{s.parent!==this?(o.add(s,n),n+=1):this.reorder(s,n)})}findLayerById(r){return A(this.layers,"id",r)}findLayerByUid(r){return A(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,a){return this.layers.reorder(r,a)}layerAdded(r){}layerRemoved(r){}};return i([l()],t.prototype,"layers",null),t=i([c("esri.support.LayersMixin")],t),t},ye=new Set(["feature","subtype-group"]);function C(e,t,r){if(e)for(let a=0,o=e.length;a<o;a++){const n=e.at(a);if(n[t]===r)return n;if((n==null?void 0:n.type)==="group"){const s=C(n.tables,t,r);if(s)return s}}}const pe=e=>{let t=class extends e{constructor(...r){super(...r),this.tables=new E,this.addHandles([this.tables.on("after-add",a=>{const o=a.item;o.parent&&o.parent!==this&&"tables"in o.parent&&o.parent.tables.remove(o),o.parent=this,ye.has(o.type)||p.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",a=>{a.item.parent=null})])}destroy(){const r=this.tables.toArray();for(const a of r)a.destroy();this.tables.destroy()}set tables(r){this._set("tables",x(r,this._get("tables")))}findTableById(r){return C(this.tables,"id",r)}findTableByUid(r){return C(this.tables,"uid",r)}};return i([l()],t.prototype,"tables",null),t=i([c("esri.support.TablesMixin")],t),t},h=new WeakMap;function P(e){return!e.destroyed&&(h.has(e)||e.addHandles([te(()=>{const t=e.parent;return!(!t||!("type"in t))&&(t.type==="catalog-dynamic-group"||P(t))},t=>h.set(e,t),re),ae(()=>h.delete(e))]),h.get(e))}function ue(e){return typeof e=="object"&&e!=null&&"loaded"in e&&e.loaded===!0&&"type"in e}function ce(e){var t,r;return!(!ue(e)||!((r=(t=Z(e))==null?void 0:t.operations)!=null&&r.supportsEditing)||"editingEnabled"in e&&!X(e)||P(e))}const _=()=>p.getLogger("esri.support.basemapUtils");function he(){return{}}function fe(e){for(const t in e){const r=e[t];g(r),delete e[t]}}function me(e,t){let r;if(typeof e=="string"){const a=e in M,o=!a&&e.includes("/");if(!a&&!o){if(ee.apiKey)_().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const n=Object.entries(M).filter(([s,u])=>u.classic||u.is3d).map(([s])=>`"${s}"`).sort().join(", ");_().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${n}`)}return null}t&&(r=t[e]),r||(r=a?f.fromId(e):new f({style:{id:e}}),t&&(t[e]=r))}else r=F(f,e);return r!=null&&r.destroyed&&(_().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}const U={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function ge(e){let t=null;if(typeof e=="string")if(e in U){const r=U[e];t=new b({resourceInfo:{data:{layers:[r]}}})}else p.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=F(b,e);return t}let d=class extends pe(de(k.EventedMixin(Y))){constructor(e){super(e),this.allLayers=new I({getCollections:()=>{var t,r,a;return[(t=this.basemap)==null?void 0:t.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(a=this.basemap)==null?void 0:a.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=le(this),this.basemap=null,this.editableLayers=new I({getCollections:()=>[this.allLayers],itemFilterFunction:ce}),this.ground=new b,this._basemapCache=he()}destroy(){fe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=g(this.basemap),g(this.ground),this._set("ground",null)}castBasemap(e){return me(e,this._basemapCache)}castGround(e){return ge(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};i([l({readOnly:!0,dependsOn:[]})],d.prototype,"allLayers",void 0),i([l({readOnly:!0})],d.prototype,"allTables",void 0),i([l({type:f,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],d.prototype,"basemap",void 0),i([R("basemap")],d.prototype,"castBasemap",null),i([l({readOnly:!0})],d.prototype,"editableLayers",void 0),i([l({type:b,nonNullable:!0})],d.prototype,"ground",void 0),i([R("ground")],d.prototype,"castGround",null),i([l()],d.prototype,"undoRedo",void 0),d=i([c("esri.Map")],d);const be=d,Oe=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{be as L,Oe as M,de as a,pe as l,$e as n,le as t};
