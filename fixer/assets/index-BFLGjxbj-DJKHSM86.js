import{fv as R,hl as M,g2 as W,ha as q,fA as z,fK as i,fB as b,gn as G,fM as S,fx as T,hm as Y,fN as B,g$ as O,hn as X,gv as D,ho as K,hp as j,fD as Q,fP as U,fG as V,h3 as J}from"./index-aQr1pzMk.js";class Z extends W{_parseConfig(t){const a=M(this.$vApp.$pinia);t&&(a.arrowIcon=t.arrowIcon,a.poleIcon=t.poleIcon)}get config(){return super.config}}const F="path",ee=12,te="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z",ae="#ff0000ff",se=5,ie=6,oe={style:F,size:ee,path:te,colour:ae,xOffset:se,yOffset:ie},re=["innerHTML"],le=R({__name:"northarrow",setup($){const t=q(),a=M(),e=z("iApi"),p=i(),c=b(()=>a.arrowIcon),k=b(()=>a.poleIcon),d=i(0),n=i(0),f=i(!1),A=i(`<svg xmlns="http://www.w3.org/2000/svg" fit=""  width="25" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" focusable="false">
                <g id="northarrow" transform="translate(-285.24 -142.234)">
                    <path id="path3770-7" d="M305.91 156.648a8.652 8.652 0 0 1-8.654 8.653 8.652 8.652 0 0 1-8.653-8.653 8.653 8.653 0 0 1 8.653-8.653 8.653 8.653 0 0 1 8.653 8.653z" fill="#fff" stroke="#fff" stroke-width=".895"/>
                    <path id="path3770" d="M304.982 156.648a7.725 7.725 0 0 1-7.726 7.726 7.725 7.725 0 0 1-7.726-7.726 7.725 7.725 0 0 1 7.726-7.726 7.725 7.725 0 0 1 7.726 7.726z" fill="none" stroke="#6d6d6d" stroke-width=".799"/>
                    <path id="path3774" d="M297.256 156.648v-8.525" fill="none" stroke="#000" stroke-width=".067"/>
                    <path d="M297.258 143.48l8.793 22.432-8.811-8.812-8.812 8.812z" id="path3778" fill="#fff" stroke="#fff" stroke-width=".912"/>
                    <path d="M297.256 144.805l7.726 19.568-7.726-7.726-7.726 7.726z" id="path3780" fill="#d6d6d6" stroke="#000" stroke-width=".266" stroke-linecap="square"/>
                    <path id="path6038" d="M297.256 144.666l-7.726 19.568 7.726-7.726" fill="#6d6d6d" stroke-width=".296" stroke-linecap="square"/>
                </g>
            </svg>`),x=i(!1),I=G([]),C=i([]);let v;S(()=>{var s;const o=t.config.map;C.value=o.tileSchemas,c!=null&&c.value&&(A.value=`<img width='25' src='${c.value}'>`),(s=e.geo.map.esriView)!=null&&s.ready&&_(e.geo.map.getExtent()),I.push(e.event.on(T.MAP_EXTENTCHANGE,Y(300,_)))}),B(()=>{I.forEach(o=>e.event.off(o))});const _=async o=>{var E;v=t.activeBasemapConfig;let s;for(const r of C.value)if((v==null?void 0:v.tileSchemaId)===r.id){s=r==null?void 0:r.hasNorthPole;break}const h=e.$vApp.$el.querySelector(".inner-shell"),u=p.value.querySelector(".northarrow").getBoundingClientRect().width,g=((E=e.$vApp.$el.querySelector(".appbar"))==null?void 0:E.clientWidth)||0,P=o.sr;if(s||typeof s>"u"&&!P.isWebMercator()){const r=new O("pole",{x:-96,y:90}),L=await e.geo.proj.projectGeometry(P,r),m=e.geo.map.mapPointToScreenPoint(L);if(m.screenY<0){f.value=!0;const l={screenX:h.clientWidth/2,screenY:h.clientHeight};d.value=Math.atan((m.screenX-l.screenX)/(l.screenY-m.screenY))*180/Math.PI,n.value=h.clientWidth/2+h.clientHeight*Math.tan(d.value*Math.PI/180)-u/2,n.value=Math.max(g-u/2,Math.min(e.geo.map.getPixelWidth()-u/2,n.value))}else if(f.value=!1,!x.value){x.value=!0;let l;k.value?l={style:X.ICON,icon:k.value,height:16.5,width:16.5}:l=oe;const w=e.geo.layer.createLayer({id:y,layerType:D.GRAPHIC,url:"",cosmetic:!0,system:!0});e.geo.map.addLayer(w),w.loadPromise().then(()=>{const N=new K(L,"northpole"),H=new j(l);N.style=H,w.addGraphic(N)})}}else f.value=!0,d.value=0,n.value=g+(h.clientWidth-g-u)/2};return(o,s)=>(Q(),U("div",{class:"absolute transition-all duration-300 ease-out",style:J({"transform-origin":"top center",transform:`rotate(${d.value}deg)`,left:`${n.value}px`,visibility:f.value?"visible":"hidden"}),ref_key:"el",ref:p},[V("span",{class:"northarrow",innerHTML:A.value},null,8,re)],4))}}),y="RampPoleMarker";class he extends Z{async added(){this._parseConfig(this.config);const t=this.$vApp.$watch(()=>this.config,p=>this._parseConfig(p)),{destroy:a,el:e}=this.mount(le,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(e.childNodes[0]),this.removed=()=>{t(),this.$iApi.geo.layer.getLayer(y)&&this.$iApi.geo.map.removeLayer(y),M(this.$vApp.$pinia).$reset(),a()}}}export{y as POLE_MARKER_LAYER_ID,he as default};
