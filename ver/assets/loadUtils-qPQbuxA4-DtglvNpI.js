import{o as f,g as p}from"./fetchService-Bp_4TwIU-D3l242Cg.js";import{D as b}from"./associatedFeatureServiceUtils-DCapzd9d-D9qI6xdR.js";class g{constructor(){this._serviceMetadatas=new Map,this._itemDatas=new Map}async fetchServiceMetadata(t,r){const a=this._serviceMetadatas.get(t);if(a)return a;const s=await f(t,r);return this._serviceMetadatas.set(t,s),s}async fetchItemData(t){const{id:r}=t;if(!r)return null;const{_itemDatas:a}=this;if(a.has(r))return a.get(r);const s=await t.fetchData();return a.set(r,s),s}async fetchCustomParameters(t,r){const a=await this.fetchItemData(t);return a&&typeof a=="object"&&(r?r(a):a.customParameters)||null}}function c(e){const t={id:e.id,name:e.name},r=p(e.type);return r!=="FeatureLayer"&&(t.layerType=r),t}async function L(e,t,r){var a,s,u;if((e==null?void 0:e.layers)==null||(e==null?void 0:e.tables)==null){const l=await r.fetchServiceMetadata(t,{customParameters:(a=o(e))==null?void 0:a.customParameters});(e=e||{}).layers=e.layers||((s=l==null?void 0:l.layers)==null?void 0:s.map(c)),e.tables=e.tables||((u=l==null?void 0:l.tables)==null?void 0:u.map(c))}return e}function o(e){if(!e)return null;const{layers:t,tables:r}=e;return t!=null&&t.length?t[0]:r!=null&&r.length?r[0]:null}function w(e,t){return t==null?null:[...e.layers||[],...e.tables||[]].find(r=>r.id===t)}function S(e,t){return[...e.layers||[],...e.tables||[]].filter(({layerType:r})=>r?t.includes(r):t.includes("ArcGISFeatureLayer"))}function I(e){var t,r;return(((t=e==null?void 0:e.layers)==null?void 0:t.length)??0)+(((r=e==null?void 0:e.tables)==null?void 0:r.length)??0)}function v(e){switch(e){case"catalog":return["CatalogLayer"];case"feature":return["ArcGISFeatureLayer"];case"oriented-imagery":return["OrientedImageryLayer"];case"subtype-group":return["SubtypeGroupLayer","SubtypeGroupTable"]}return null}function M(e){switch(e){case"CatalogLayer":return"CatalogLayer";case"OrientedImageryLayer":return"OrientedImageryLayer";case"SubtypeGroupLayer":case"SubtypeGroupTable":return"SubtypeGroupLayer"}return"FeatureLayer"}async function P(e,t,r){var u,l,y,m;if(!(e!=null&&e.url))return t??{};if(t??(t={}),!t.layers){const n=await r.fetchServiceMetadata(e.url);t.layers=(u=n.layers)==null?void 0:u.map(c)}const{serverUrl:a,portalItem:s}=await b(e.url,{sceneLayerItem:e,customParameters:(l=o(t))==null?void 0:l.customParameters}).catch(()=>({serverUrl:null,portalItem:null}));if(a==null)return t.tables=[],t;if(!t.tables&&s){const n=await s.fetchData().catch(()=>null);if(n!=null&&n.tables)t.tables=n.tables.map(c);else{const i=await r.fetchServiceMetadata(a,{customParameters:(y=o(n))==null?void 0:y.customParameters}).catch(()=>null);t.tables=(m=i==null?void 0:i.tables)==null?void 0:m.map(c)}}if(t.tables)for(const n of t.tables)n.url=`${a}/${n.id}`;return t}export{P as L,S as b,v as d,L as f,M as g,I as h,c as l,g as m,w as p,o as u};
