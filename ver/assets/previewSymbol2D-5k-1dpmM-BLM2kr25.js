import{fr as x,c as H,dz as A,jp as B}from"./index-C8m3jhgc.js";import{R as D}from"./colorUtils-DxUhbS7D-B-Muh5Ny.js";import{y as K}from"./fontUtils-Ce-zEYaT-BJIub1Xl.js";import{O as Q,Q as X}from"./quantizationUtils-Cndke4AR-g6lLwree.js";import{F as V,b as I,j as Y,G as _}from"./utils-C_9ghOVk-BbgXpKGq.js";import{g as P,p as J,r as Z,D as U}from"./utils-C1HQJ6Ct-BXAJfl6b.js";import"./vec42-D8CJyqHG-DnfLTeQH.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./vec4f64-CjUMzAyX-DPYbdAom.js";import"./jsonUtils-DzmXEA9_-_npj7tsJ.js";import"./parser-hXQyB-Qx-vNllFoQp.js";import"./mat4f32-CiZjBg9k-CUm34GoR.js";import"./mat4-BFStKTjU-eFKmoA7r.js";import"./cimSymbolUtils-BuFg2oLA-9FX-P__3.js";import"./utils-BYqzY6_X-x0QsB8bB.js";import"./defaultCIMValues-gWpu7WSC-cjxb95kj.js";import"./enums-f9UUstHQ-hLTu4V1l.js";import"./LRUCache-BLmkvs7b-C7sAHc2V.js";import"./MemCache-BCippCv6-B4i-p-yc.js";import"./globalCss-CFN4F315-D4Tn2bn1.js";import"./Queue-B8H6jIv7-CGxuMpyH.js";import"./signal-DxzURL18-wfRwoo2f.js";import"./Version-BTMwSXf1-BhPPVtmW.js";import"./jsxFactory-C5LxVioS-HM4dZcpE.js";import"./intl-DLmy-Li5-CBPkUqcW.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";import"./mat2df32-BCnkwMW8-BLRY8i4P.js";import"./mat2d-BQA-1WB--Pnyy0dhf.js";import"./webStyleSymbolUtils-BLJ6xjmu-Dx-7GphH.js";import"./devEnvironmentUtils-CxrVv3RG-ktR0Kqgv.js";import"./styleUtils-DxAOZq5S-BN2g5w8P.js";import"./webStyleAcceptedFormats-DsfCZOwz-CG7ZQ6BV.js";import"./ColorStop-DoHCvOqO-DH82WTuy.js";import"./TimeExtent-gZaEUVeW-BJxSd7M2.js";import"./utils-BG7WTOnW-D4tzhVMt.js";import"./timeZoneUtils-z3WjfjXQ-NGm-Oxyv.js";import"./typeUtils-I5iG5ZKA-Bj-ytWfY.js";import"./ClassBreaksRenderer-D97YzbWp-BNKlZRw7.js";import"./commonProperties-BLIn8DYU-te3BK1cG.js";import"./colorRamps-KMmVdCPJ-IldyGzzl.js";import"./visualVariableUtils-BO-_wo28-CKo3AW1i.js";import"./lengthUtils-wU9RRIqK-Cfmv-SV3.js";import"./RendererLegendOptions-f5mIImtQ-DjUg407A.js";import"./FieldsIndex-Y7EBAYp0-w6K0n6zu.js";import"./heatmapUtils--OU2Fakh-BfIIxpey.js";import"./SimpleRenderer-ADQlYl8U-BozHxNBQ.js";import"./UniqueValueRenderer-BmoLL_Ee-WAX_-d_L.js";import"./diffUtils-BSe9IE26-BODWUFPE.js";const W="picture-fill",tt="picture-marker",et="simple-fill",it="simple-line",ot="simple-marker",at="text",nt="Aa",lt=P.size,z=P.maxSize,rt=P.maxOutlineSize,E=P.lineWidth,T=225,st=document.createElement("canvas");function q(e,t,r){if(e.type==="polygon"){const o=e.extent,p=o.width===0?1:o.width,m=o.height===0?1:o.height;e=Q({originPosition:"upperLeft",scale:[p/t,m/r],translate:[o.xmin,o.ymax]},{},e);let s="";for(let n=0;n<e.rings.length;n++){const l=e.rings[n];for(let h=0;h<l.length;h++){const u=l[h][0],d=l[h][1];let i="";h===0?(i=`M${u.toString()} ${d.toString()}`,s!==""&&(i=` ${i}`),s+=i):h===l.length-1?(i=`l${u.toString()} ${d.toString()} Z`,s!==""&&(i=` ${i}`),s+=i):(i=`l${u.toString()} ${d.toString()}`,s!==""&&(i=` ${i}`),s+=i)}}return s}if(e.type==="polyline"){const o=e.extent,p=o.width===0?1:o.width,m=o.height===0?1:o.height;e=X({originPosition:"upperLeft",scale:[p/t,m/r],translate:[o.xmin,o.ymax]},{},e);let s="";for(let n=0;n<e.paths.length;n++){const l=e.paths[n];for(let h=0;h<l.length;h++){const u=l[h][0],d=l[h][1];let i="";h===0?(i=`M${u.toString()} ${d.toString()}`,s!==""&&(i=` ${i}`),s+=i):(i=`l${u.toString()} ${d.toString()}`,s!==""&&(i=` ${i}`),s+=i)}}return s}return""}function G(e,t){const r=st.getContext("2d"),o=[];t&&(t.weight&&o.push(t.weight),t.size&&o.push(t.size+"px"),t.family&&o.push(t.family)),r.font=o.join(" ");const{width:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:s,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l}=r.measureText(e);return{width:Math.ceil(Math.max(p,m+s)),height:Math.ceil(n+l),x:Math.floor(m),y:Math.floor((n-l)/2)}}function k(e){const t=e==null?void 0:e.size;return{width:t!=null&&typeof t=="object"&&"width"in t?x(t.width):null,height:t!=null&&typeof t=="object"&&"height"in t?x(t.height):null}}async function ht(e,t){const r=t.fill,o=e.color;if((r==null?void 0:r.type)==="pattern"&&o&&e.type!==W){const p=await _(r.src,o.toCss(!0));r.src=p,t.fill=r}}async function mt(e,t,r,o){var s,n,l;if(!("font"in e)||!e.font||t.shape.type!=="text")return;try{await K(e.font)}catch{}const{width:p,height:m}=k(o);if(!/[\uE600-\uE6FF]/.test(t.shape.text)){const{width:h,height:u,x:d,y:i}=G(t.shape.text,{weight:(s=t.font)==null?void 0:s.weight,size:(n=t.font)==null?void 0:n.size,family:(l=t.font)==null?void 0:l.family});r[0]=p??h,r[1]=m??u,t.shape.x=d,t.shape.y=i;let a="angle"in e?e.angle:null;if((o==null?void 0:o.rotation)!=null&&(a=(a??0)+o.rotation),a){const M=a*(Math.PI/180),L=Math.abs(Math.sin(M)),$=Math.abs(Math.cos(M));r[1]=r[0]*L+r[1]*$}}}function pt(e,t,r,o,p){var m;if(e.haloColor!=null&&e.haloSize!=null){p.masking??(p.masking=r.map(()=>[]));const s=x(e.haloSize);o[0]+=s,o[1]+=s,r.unshift([{...t,fill:null,stroke:{color:e.haloColor,width:2*s,join:"round",cap:"round"}}]),p.masking.unshift([{shape:{type:"rect",x:0,y:0,width:o[0]+2*B,height:o[1]+2*B},fill:[255,255,255],stroke:null},{...t,fill:[0,0,0,0],stroke:null}])}e.backgroundColor==null&&e.borderLineColor==null||(o[0]+=2*B,o[1]+=2*B,r.unshift([{shape:{type:"rect",x:0,y:0,width:o[0],height:o[1]},fill:e.backgroundColor,stroke:{color:e.borderLineColor,width:x(e.borderLineSize)}}]),(m=p.masking)==null||m.unshift([]))}function N(e,t){return e>t?"dark":"light"}function ct(e,t){var L,$,j,F,O;const r=typeof(t==null?void 0:t.size)=="number"?t==null?void 0:t.size:null,o=r!=null?x(r):null,p=(t==null?void 0:t.maxSize)!=null?x(t.maxSize):null;let m="angle"in e?e.angle:null;(t==null?void 0:t.rotation)!=null&&(m=(m??0)+t.rotation);const s=V(e);let n=I(e);ut(e,245)!=="dark"||t!=null&&t.ignoreWhiteSymbols||(n={width:.75,...n,color:"#bdc3c7"});let l=null;const h={shape:null,fill:s,stroke:n,offset:[0,0]};n!=null&&n.width&&(n.width=Math.min(n.width,rt));const u=(n==null?void 0:n.width)||0;let d=(t==null?void 0:t.size)!=null&&((t==null?void 0:t.scale)==null||(t==null?void 0:t.scale)),i=0,a=0,M=!1;switch(e.type){case ot:{const f=e.style,{width:g,height:c}=k(t);let b=g===c&&g!=null?g:o??Math.min(x(e.size),p||z);if((t==null?void 0:t.useMarkerSymbolSize)===!0&&g!==null&&c!==null){const y=Math.min(x(e.size),p||z);b=y>g&&y>c?Math.min(g,c):y}switch(i=b,a=b,f){case"circle":h.shape={type:"circle",cx:0,cy:0,r:.5*b},d||(i+=u,a+=u);break;case"cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[i,.5*a]},{command:"M",values:[.5*i,0]},{command:"L",values:[.5*i,a]}]};break;case"diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[.5*i,0]},{command:"L",values:[i,.5*a]},{command:"L",values:[.5*i,a]},{command:"Z",values:[]}]},d||(i+=u,a+=u);break;case"square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[i,0]},{command:"L",values:[i,a]},{command:"L",values:[0,a]},{command:"Z",values:[]}]},d||(i+=u,a+=u),m&&(M=!0);break;case"triangle":h.shape={type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,a]},{command:"L",values:[0,a]},{command:"Z",values:[]}]},d||(i+=u,a+=u),m&&(M=!0);break;case"x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[i,a]},{command:"M",values:[i,0]},{command:"L",values:[0,a]}]},m&&(M=!0);break;case"path":h.shape={type:"path",path:e.path||""},d||(i+=u,a+=u),m&&(M=!0),d=!0}break}case it:{const{width:f,height:g}=k(t),c=Y(n).reduce((v,S)=>v+S,0),b=c&&Math.ceil(E/c),y=g??o??u,w=f??(c*b||E);if(d=!0,((L=t==null?void 0:t.geometry)==null?void 0:L.type)==="polyline"&&(($=t==null?void 0:t.geometry)==null?void 0:$.extent)){i=w,a=g??i;const v=1e3,S=.15*v;l=[i,a],a=l[0]>l[1]?v*l[1]/l[0]:v,i=l[0]>l[1]?v:v*l[0]/l[1],n!=null&&n.width&&(n.width=n.width*v/(l[1]>l[0]?l[1]:l[0]),n.width>S&&(n.width=S)),h.shape={type:"path",path:q(t.geometry,i,a)}}else i=(t==null?void 0:t.maxSize)!=null?Math.min(w,t.maxSize):w,a=y,n&&(n.width=y),h.shape={type:"path",path:[{command:"M",values:[y/2,a/2]},{command:"L",values:[i-y/2,a/2]}]};break}case W:case et:{const f=typeof(t==null?void 0:t.symbolConfig)=="object"&&!!((j=t==null?void 0:t.symbolConfig)!=null&&j.isSquareFill),{width:g,height:c}=k(t);i=!f&&g!==c||g==null?o??lt:g,a=!f&&g!==c||c==null?i:c,d||(i+=u,a+=u),d=!0,(F=t==null?void 0:t.geometry)!=null&&F.extent&&((O=t==null?void 0:t.geometry)==null?void 0:O.type)==="polygon"?(l=[i,a],a=l[0]>l[1]?1e3*l[1]/l[0]:1e3,i=l[0]>l[1]?1e3:1e3*l[0]/l[1],h.shape={type:"path",path:q(t.geometry,i,a)}):h.shape=f?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[i,0]},{command:"L",values:[i,a]},{command:"L",values:[0,a]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:J.fill[0];break}case tt:{const f=Math.min(x(e.width),p||z),g=Math.min(x(e.height),p||z),{width:c,height:b}=k(t),y=c===b&&c!=null?c:o??Math.max(f,g),w=e.width/e.height;i=w<=1?Math.ceil(y*w):y,a=w<=1?y:Math.ceil(y/w),h.shape={type:"image",x:-Math.round(i/2),y:-Math.round(a/2),width:i,height:a,src:e.url||""},m&&(M=!0);break}case at:{const f=e,g=(t==null?void 0:t.overrideText)||f.text||nt,c=f.font,{width:b,height:y}=k(t),w=y??o??Math.min(x(c.size),p||z),{width:v,height:S}=G(g,{weight:c.weight,size:w,family:c.family}),C=/[\uE600-\uE6FF]/.test(g);i=b??(C?w:v),a=C?w:S;let R=.5*(C?w:S);C&&(R+=5),h.shape={type:"text",text:g,x:f.xoffset||0,y:f.yoffset||R,align:"middle",alignBaseline:f.verticalAlignment,decoration:c&&c.decoration,rotated:f.rotated,kerning:f.kerning},h.font=c&&{size:w,style:c.style,decoration:c.decoration,weight:c.weight,family:c.family};break}}return{shapeDescriptor:h,size:[i,a],outputSize:l,renderOptions:{node:t==null?void 0:t.node,scale:d,opacity:t==null?void 0:t.opacity,rotations:[m],useRotationSize:M,effectView:t==null?void 0:t.effectView,ariaLabel:t==null?void 0:t.ariaLabel}}}async function se(e,t){var l,h,u,d,i;const{shapeDescriptor:r,size:o,renderOptions:p,outputSize:m}=ct(e,t);if(!r.shape)throw new H("symbolPreview: renderPreviewHTML2D","symbol not supported.");await ht(e,r),await mt(e,r,o,t);const s=[[r]];if(typeof(t==null?void 0:t.symbolConfig)=="object"&&((l=t==null?void 0:t.symbolConfig)!=null&&l.applyColorModulation)){const a=.6*o[0];s.unshift([{...r,offset:[-a,0],fill:Z(r.fill,-.3)}]),s.push([{...r,offset:[a,0],fill:Z(r.fill,.3)}]),o[0]+=2*a,p.scale=!1}e.type==="text"&&pt(e,r,s,o,p);const n=U(s,o,p);if(m&&n){const a=n.nodeName.toLowerCase()==="img"?n:n.firstChild;a.nodeName.toLowerCase()==="svg"&&a.setAttribute("viewBox",`0 0 ${o[0].toString()} ${o[1].toString()}`),a.setAttribute("width",m[0].toString()),a.setAttribute("height",m[1].toString()),m.length>2&&(a.style.setProperty("padding-left",((h=m[2])==null?void 0:h.toString())+"px"),a.style.setProperty("padding-right",((u=m[2])==null?void 0:u.toString())+"px"),a.style.setProperty("padding-top",((d=m[3])==null?void 0:d.toString())+"px"),a.style.setProperty("padding-bottom",((i=m[3])==null?void 0:i.toString())+"px"),a.style.setProperty("box-sizing","border-box"))}return n}function ut(e,t=T){const r=V(e),o=I(e),p=!r||"type"in r?null:new A(r),m=o!=null&&o.color?new A(o==null?void 0:o.color):null,s=p?N(D(p),t):null,n=m?N(D(m),t):null;return n?s?s===n?s:t>=T?"light":"dark":n:s}export{ut as getContrastingBackgroundTheme,ct as getRenderSymbolParameters,se as previewSymbol2D};
