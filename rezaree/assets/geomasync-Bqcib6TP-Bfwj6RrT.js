const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./unitConversion-BXECx7w3-DLx7FHs9.js","./index-Bq7Udiuc.js","./index-CpSsk29H.css"])))=>i.map(i=>d[i]);
import{bH as w,bI as y,n as v,s as R,L as T,_ as K,E as b,Q as L,r as Y,an as M,l as G,b as W}from"./index-Bq7Udiuc.js";import{F as f,ac as g,o as h,X,ad as z,ae as H,j as _,h as J,A as U,w as D,af as Z,ag as q,ah as $,ai as k,d as P,aj as nn,J as x,ak as en,al as an,am as rn,an as Q,c as j,K as C}from"./arcade-Dg73dEoh-DI8aou7F.js";import{a as i,r as s}from"./unitConversion-BXECx7w3-DLx7FHs9.js";import{C as O}from"./TimeOnly-C3SOkmg2-iu07ax4y.js";import{n as V}from"./portalUtils-SFTmSBN_-B1wnDlCo.js";import{n as c}from"./operatorsWorkerConnection-DkxyJ5dM-bf3WQBrq.js";import"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import"./shared-Y9GMqi1u-8p4JawUl.js";import"./Field-Cj6Pz3TI-eyhQxCek.js";import"./fieldType-VTpxE-EM-CQBTaE1u.js";import"./number-ZeBaww6r-D3JXd3ky.js";import"./featureConversionUtils-DRaHTjrY-CX36bpup.js";import"./OptimizedFeatureSet-D6mgsKNr-DjQ8QZl2.js";import"./memoryEstimations-iHVpvWPf-0mmuGaCe.js";import"./OptimizedGeometry-1qDYm3YK-HgaplYA1.js";import"./FieldsIndex-Y7EBAYp0-Per2Bp66.js";import"./timeZoneUtils-z3WjfjXQ-D8ButgDy.js";import"./WhereClause-nZnXFKnG-sY4j6Vn-.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";import"./workers-0oosFQiO-DL4UeXRh.js";import"./Queue-B8H6jIv7-qe6xwAvV.js";import"./intl-DLmy-Li5-BJ0oorh2.js";async function B(t,e,a){var n,r;if(!((n=G)!=null&&n.findCredential(t.restUrl)))return null;if(t.loadStatus==="loaded"&&e===""&&((r=t.user)!=null&&r.sourceJSON)&&a===!1)return t.user.sourceJSON;const u={responseType:"json",query:{f:"json"}};if(a&&(u.query.returnUserLicenseTypeExtensions=!0),e===""){const o=await W(t.restUrl+"/community/self",u);if(o.data){const d=o.data;if(d!=null&&d.username)return d}return null}const l=await W(t.restUrl+"/community/users/"+e,u);if(l.data){const o=l.data;return o.error?null:o}return null}function N(t){if(t==null)return t;switch(typeof t){case"string":case"number":return t;default:throw new i(null,s.InvalidParameter,null)}}function Fn(t){t.mode==="async"&&(t.functions.disjoint=function(e,a){return t.standardFunctionAsync(e,a,(u,l,n)=>(n=f(n),g(n,e,a),n[0]===null||n[1]===null||c("disjoint",[n[0].toJSON(),n[1].toJSON()])))},t.functions.intersects=function(e,a){return t.standardFunctionAsync(e,a,(u,l,n)=>(n=f(n),g(n,e,a),n[0]!==null&&n[1]!==null&&c("intersects",[n[0].toJSON(),n[1].toJSON()])))},t.functions.touches=function(e,a){return t.standardFunctionAsync(e,a,(u,l,n)=>(n=f(n),g(n,e,a),n[0]!==null&&n[1]!==null&&c("touches",[n[0].toJSON(),n[1].toJSON()])))},t.functions.crosses=function(e,a){return t.standardFunctionAsync(e,a,(u,l,n)=>(n=f(n),g(n,e,a),n[0]!==null&&n[1]!==null&&c("crosses",[n[0].toJSON(),n[1].toJSON()])))},t.functions.within=function(e,a){return t.standardFunctionAsync(e,a,(u,l,n)=>(n=f(n),g(n,e,a),n[0]!==null&&n[1]!==null&&c("within",[n[0].toJSON(),n[1].toJSON()])))},t.functions.contains=function(e,a){return t.standardFunctionAsync(e,a,(u,l,n)=>(n=f(n),g(n,e,a),n[0]!==null&&n[1]!==null&&c("contains",[n[0].toJSON(),n[1].toJSON()])))},t.functions.overlaps=function(e,a){return t.standardFunctionAsync(e,a,(u,l,n)=>(n=f(n),g(n,e,a),n[0]!==null&&n[1]!==null&&c("overlaps",[n[0].toJSON(),n[1].toJSON()])))},t.functions.equals=function(e,a){return t.standardFunctionAsync(e,a,(u,l,n)=>(h(n,2,2,e,a),n[0]===n[1]||(n[0]instanceof w&&n[1]instanceof w?c("equals",[n[0].toJSON(),n[1].toJSON()]):(X(n[0])&&X(n[1])||!!(z(n[0])&&z(n[1])||H(n[0])&&H(n[1])))&&n[0].equals(n[1]))))},t.functions.relate=function(e,a){return t.standardFunctionAsync(e,a,(u,l,n)=>{if(n=f(n),h(n,3,3,e,a),n[0]instanceof w&&n[1]instanceof w)return c("relate",[n[0].toJSON(),n[1].toJSON(),_(n[2])]);if(n[0]instanceof w&&n[1]===null||n[1]instanceof w&&n[0]===null||n[0]===null&&n[1]===null)return!1;throw new i(e,s.InvalidParameter,a)})},t.functions.intersection=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>(n=f(n),g(n,e,a),n[0]===null||n[1]===null?null:y(await c("intersection",[n[0].toJSON(),n[1].toJSON()]))))},t.functions.union=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if((n=f(n)).length===0)throw new i(e,s.WrongNumberOfParameters,a);const r=[];if(n.length===1)if(v(n[0])){for(const o of f(n[0]))if(o!==null){if(!(o instanceof w))throw new i(e,s.InvalidParameter,a);r.push(o.toJSON())}}else{if(!J(n[0])){if(n[0]instanceof w)return U(O(n[0]),e.spatialReference);if(n[0]===null)return null;throw new i(e,s.InvalidParameter,a)}for(const o of f(n[0].toArray()))if(o!==null){if(!(o instanceof w))throw new i(e,s.InvalidParameter,a);r.push(o.toJSON())}}else for(const o of n)if(o!==null){if(!(o instanceof w))throw new i(e,s.InvalidParameter,a);r.push(o.toJSON())}return r.length===0?null:y(await c("union",[r]))})},t.functions.difference=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>(n=f(n),g(n,e,a),n[0]===null?null:n[1]===null?O(n[0]):y(await c("difference",[n[0].toJSON(),n[1].toJSON()]))))},t.functions.symmetricdifference=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>(n=f(n),g(n,e,a),n[0]===null&&n[1]===null?null:n[0]===null?O(n[1]):n[1]===null?O(n[0]):y(await c("symmetricDifference",[n[0].toJSON(),n[1].toJSON()]))))},t.functions.clip=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,2,2,e,a),!(n[1]instanceof R)&&n[1]!==null)throw new i(e,s.InvalidParameter,a);if(n[0]===null)return null;if(!(n[0]instanceof w))throw new i(e,s.InvalidParameter,a);return n[1]===null?null:y(await c("clip",[n[0].toJSON(),n[1].toJSON()]))})},t.functions.cut=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,2,2,e,a),!(n[1]instanceof T)&&n[1]!==null)throw new i(e,s.InvalidParameter,a);if(n[0]===null)return[];if(!(n[0]instanceof w))throw new i(e,s.InvalidParameter,a);return n[1]===null?[O(n[0])]:(await c("cut",[n[0].toJSON(),n[1].toJSON()])).map(r=>y(r))})},t.functions.area=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(h(n,1,2,e,a),n=f(n),D(n[0])){const o=await n[0].sumArea(N(n[1]),!1,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,a);return o}let r=n[0];if((v(r)||J(r))&&(r=Z(n[0],e.spatialReference)),r===null)return 0;if(!(r instanceof w))throw new i(e,s.InvalidParameter,a);return c("area",[r.toJSON(),N(n[1])])})},t.functions.areageodetic=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(h(n,1,2,e,a),n=f(n),D(n[0])){const o=await n[0].sumArea(N(n[1]),!0,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,a);return o}let r=n[0];if((v(n[0])||J(n[0]))&&(r=Z(n[0],e.spatialReference)),r===null)return 0;if(!(r instanceof w))throw new i(e,s.InvalidParameter,a);return c("geodeticArea",[r.toJSON(),N(n[1])])})},t.functions.length=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(h(n,1,2,e,a),n=f(n),D(n[0])){const o=await n[0].sumLength(N(n[1]),!1,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,a);return o}let r=n[0];if((v(n[0])||J(n[0]))&&(r=q(n[0],e.spatialReference)),r===null)return 0;if(!(r instanceof w))throw new i(e,s.InvalidParameter,a);return c("length",[r.toJSON(),N(n[1])])})},t.functions.length3d=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(h(n,1,2,e,a),(n=f(n))[0]===null)return 0;let r=n[0];if((v(n[0])||J(n[0]))&&(r=q(n[0],e.spatialReference)),r===null)return 0;if(!(r instanceof w))throw new i(e,s.InvalidParameter,a);if(r.hasZ===!0){const{convertFromSpatialReferenceUnit:o,toLengthUnit:d}=await K(()=>import("./unitConversion-BXECx7w3-DLx7FHs9.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(p=>p.e),m=$(r);return o(r.spatialReference,d(n[1]),m)}return c("length",[r.toJSON(),N(n[1])])})},t.functions.lengthgeodetic=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(h(n,1,2,e,a),n=f(n),D(n[0])){const o=await n[0].sumLength(N(n[1]),!0,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,a);return o}let r=n[0];if((v(n[0])||J(n[0]))&&(r=q(n[0],e.spatialReference)),r===null)return 0;if(!(r instanceof w))throw new i(e,s.InvalidParameter,a);return c("geodeticLength",[r.toJSON(),N(n[1])])})},t.functions.distance=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{n=f(n),h(n,2,3,e,a);let r=n[0];if((v(n[0])||J(n[0]))&&(r=k(n[0],e.spatialReference)),!(r instanceof w))throw new i(e,s.InvalidParameter,a);let o=n[1];if((v(n[1])||J(n[1]))&&(o=k(n[1],e.spatialReference)),!(o instanceof w))throw new i(e,s.InvalidParameter,a);return c("distance",[r.toJSON(),o.toJSON(),N(n[2])])})},t.functions.distancegeodetic=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{n=f(n),h(n,2,3,e,a);const r=n[0];if(!(r instanceof b))throw new i(e,s.InvalidParameter,a);const o=n[1];if(!(o instanceof b))throw new i(e,s.InvalidParameter,a);const d=new T({paths:[],spatialReference:r.spatialReference});return d.addPath([r,o]),c("geodeticLength",[d.toJSON(),N(n[2])])})},t.functions.densify=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,2,3,e,a),n[0]===null)return null;if(!(n[0]instanceof w))throw new i(e,s.InvalidParameter,a);const r=P(n[1]);if(isNaN(r))throw new i(e,s.InvalidParameter,a);if(r<=0)throw new i(e,s.InvalidParameter,a);switch(n[0].type){case"polygon":case"polyline":case"extent":return y(await c("densify",[n[0].toJSON(),r,N(n[2])]));default:return n[0]}})},t.functions.densifygeodetic=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,2,3,e,a),n[0]===null)return null;if(!(n[0]instanceof w))throw new i(e,s.InvalidParameter,a);const r=P(n[1]);if(isNaN(r))throw new i(e,s.InvalidParameter,a);if(r<=0)throw new i(e,s.InvalidParameter,a);switch(n[0].type){case"polygon":case"polyline":case"extent":return y(await c("geodeticDensify",[n[0].toJSON(),r,N(n[2])]));default:return n[0]}})},t.functions.generalize=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,2,4,e,a),n[0]===null)return null;if(!(n[0]instanceof w))throw new i(e,s.InvalidParameter,a);const r=P(n[1]);if(isNaN(r))throw new i(e,s.InvalidParameter,a);const o=nn(x(n[2],!0));return y(await c("generalize",[n[0].toJSON(),r,N(n[3]),{removeDegenerateParts:o}]))})},t.functions.buffer=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,2,3,e,a),n[0]===null)return null;if(!(n[0]instanceof w))throw new i(e,s.InvalidParameter,a);const r=P(n[1]);if(isNaN(r))throw new i(e,s.InvalidParameter,a);return r===0?O(n[0]):y(await c("buffer",[n[0].toJSON(),r,N(n[2])]))})},t.functions.buffergeodetic=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,2,3,e,a),n[0]===null)return null;if(!(n[0]instanceof w))throw new i(e,s.InvalidParameter,a);const r=P(n[1]);if(isNaN(r))throw new i(e,s.InvalidParameter,a);return r===0?O(n[0]):y(await c("geodesicBuffer",[n[0].toJSON(),r,N(n[2])]))})},t.functions.offset=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,2,6,e,a),n[0]===null)return null;if(!(n[0]instanceof L||n[0]instanceof T))throw new i(e,s.InvalidParameter,a);const r=P(n[1]);if(isNaN(r))throw new i(e,s.InvalidParameter,a);const o=_(n[3]??"round").toLowerCase();let d;switch(o){case"round":case"bevel":case"miter":case"square":d=o;break;default:d="round"}const m=P(x(n[4],10));if(isNaN(m))throw new i(e,s.InvalidParameter,a);const p=P(x(n[5],0));if(isNaN(p))throw new i(e,s.InvalidParameter,a);return y(await c("offset",[n[0].toJSON(),r,N(n[2]),{joins:d,miterLimit:m,flattenError:p}]))})},t.functions.rotate=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{var m;if(n=f(n),h(n,2,3,e,a),n[0]===null)return null;if(!(n[0]instanceof w))throw new i(e,s.InvalidParameter,a);const r=n[0]instanceof R?L.fromExtent(n[0]):n[0],o=P(n[1]);if(isNaN(o))throw new i(e,s.InvalidParameter,a);const d=x(n[2],null);if(d===null){const p=r.type==="point"?r:(m=r.extent)==null?void 0:m.center;return y(await c("rotate",[r.toJSON(),o,p==null?void 0:p.x,p==null?void 0:p.y]))}if(d instanceof b)return y(await c("rotate",[r.toJSON(),o,d.x,d.y]));throw new i(e,s.InvalidParameter,a)})},t.functions.centroid=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,1,2,e,a),n[0]===null)return null;const r=_(n[1]??"geometric").toLowerCase();if(r!=="geometric"&&r!=="labelpoint")throw new i(e,s.InvalidParameter,a);let o=n[0];if((v(n[0])||J(n[0]))&&(o=r==="geometric"?k(n[0],e.spatialReference):Z(n[0],e.spatialReference),o===null))return null;if(!(o instanceof w))throw new i(e,s.InvalidParameter,a);return y(r==="geometric"?await c("centroid",[o.toJSON()]):await c("labelPoint",[o.toJSON()]))})},t.functions.measuretocoordinate=function(e,a){return t.standardFunctionAsync(e,a,en)},t.functions.pointtocoordinate=function(e,a){return t.standardFunctionAsync(e,a,an)},t.functions.distancetocoordinate=function(e,a){return t.standardFunctionAsync(e,a,rn)},t.functions.multiparttosinglepart=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,1,1,e,a),n[0]===null)return null;if(!(n[0]instanceof w))throw new i(e,s.InvalidParameter,a);if(n[0]instanceof b)return[U(O(n[0]),e.spatialReference)];if(n[0]instanceof R)return[U(O(n[0]),e.spatialReference)];const r=y(await c("simplify",[n[0].toJSON()]));if(r instanceof L){const o=[],d=[];for(let m=0;m<r.rings.length;m++)if(r.isClockwise(r.rings[m])){const p=y({rings:[r.rings[m]],hasZ:r.hasZ===!0,hasM:r.hasM===!0,spatialReference:r.spatialReference.toJSON()});o.push(p)}else d.push({ring:r.rings[m],pt:r.getPoint(m,0)});for(let m=0;m<d.length;m++)for(let p=0;p<o.length;p++)if(o[p].contains(d[m].pt)){o[p].addRing(d[m].ring);break}return o}if(r instanceof T){const o=[];for(let d=0;d<r.paths.length;d++){const m=y({paths:[r.paths[d]],hasZ:r.hasZ===!0,hasM:r.hasM===!0,spatialReference:r.spatialReference.toJSON()});o.push(m)}return o}if(n[0]instanceof Y){const o=[],d=U(O(n[0]),e.spatialReference);for(let m=0;m<d.points.length;m++)o.push(d.getPoint(m));return o}return null})},t.functions.issimple=function(e,a){return t.standardFunctionAsync(e,a,(u,l,n)=>{if(n=f(n),h(n,1,1,e,a),n[0]===null)return!0;if(!(n[0]instanceof w))throw new i(e,s.InvalidParameter,a);return c("isSimple",[n[0].toJSON()])})},t.functions.simplify=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,1,1,e,a),n[0]===null)return null;if(!(n[0]instanceof w))throw new i(e,s.InvalidParameter,a);return y(await c("simplify",[n[0].toJSON()]))})},t.functions.convexhull=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,1,1,e,a),n[0]===null)return null;if(!(n[0]instanceof w))throw new i(e,s.InvalidParameter,a);return y(await c("convexHull",[n[0].toJSON()]))})},t.functions.getuser=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{var m,p;h(n,0,2,e,a);let r=x(n[1],""),o=r===!0;if(r=r===!0||r===!1?"":_(r),n.length===0||n[0]instanceof Q){let I;I=(m=e.services)!=null&&m.portal?e.services.portal:M.getDefault(),n.length>0&&(I=V(n[0],I));const F=await B(I,r,o);if(F){const A=JSON.parse(JSON.stringify(F));for(const S of["lastLogin","created","modified"])A[S]!==void 0&&A[S]!==null&&(A[S]=new Date(A[S]));return j.convertObjectToArcadeDictionary(A,C(e))}return null}let d=null;if(D(n[0])&&(d=n[0]),d){if(o=!1,r)return null;await d.load();const I=await d.getOwningSystemUrl();if(!I){if(!r){const S=await d.getIdentityUser();return S?j.convertObjectToArcadeDictionary({username:S},C(e)):null}return null}let F;F=(p=e.services)!=null&&p.portal?e.services.portal:M.getDefault(),F=V(new Q(I),F);const A=await B(F,r,o);if(A){const S=JSON.parse(JSON.stringify(A));for(const E of["lastLogin","created","modified"])S[E]!==void 0&&S[E]!==null&&(S[E]=new Date(S[E]));return j.convertObjectToArcadeDictionary(S,C(e))}return null}throw new i(e,s.InvalidParameter,a)})},t.functions.nearestcoordinate=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,2,2,e,a),!(n[0]instanceof w||n[0]===null))throw new i(e,s.InvalidParameter,a);if(!(n[1]instanceof b||n[1]===null))throw new i(e,s.InvalidParameter,a);if(n[0]===null||n[1]===null)return null;const r=n[0]instanceof R?L.fromExtent(n[0]):n[0],o=await c("getNearestCoordinate",[r.toJSON(),n[1].toJSON(),{calculateLeftRightSide:!0}]);return o===null?null:j.convertObjectToArcadeDictionary({coordinate:y(o.coordinate),distance:o.distance,sideOfLine:o.distance===0?"straddle":o.rightSide?"right":"left"},C(e),!1,!0)})},t.functions.nearestvertex=function(e,a){return t.standardFunctionAsync(e,a,async(u,l,n)=>{if(n=f(n),h(n,2,2,e,a),!(n[0]instanceof w||n[0]===null))throw new i(e,s.InvalidParameter,a);if(!(n[1]instanceof b||n[1]===null))throw new i(e,s.InvalidParameter,a);if(n[0]===null||n[1]===null)return null;const r=n[0]instanceof R?L.fromExtent(n[0]):n[0],o=await c("getNearestVertex",[r.toJSON(),n[1].toJSON()]);return o===null?null:j.convertObjectToArcadeDictionary({coordinate:y(o.coordinate),distance:o.distance,sideOfLine:o.distance===0?"straddle":o.rightSide?"right":"left"},C(e),!1,!0)})})}export{Fn as registerFunctions};
