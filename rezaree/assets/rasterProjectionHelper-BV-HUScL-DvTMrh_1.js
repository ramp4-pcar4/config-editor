const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CVKk0WAC-BXNlGu8r.js","./index-DT_2vTqg.js","./index-CpSsk29H.css","./draw-store-C1_quxsr-BWA26-W3.js","./GraphicsLayer-GkJJfSu5-ChkOihuu.js","./GraphicsCollection-rAFZo1AJ-DaZCacJZ.js","./Layer-B8q-l4yV-vl9jWDTa.js","./TimeExtent-gZaEUVeW-CjhClSAm.js","./ScaleRangeLayer-DIxukUBC-BiHY8U94.js","./layerContainerType-ChWdCT09-G5sdAsSy.js","./jsonUtils-DzmXEA9_-CrA2znfx.js","./parser-hXQyB-Qx-CKYTh4L4.js","./mat4f32-CiZjBg9k-CUm34GoR.js","./mat4-BFStKTjU-BOPNBj93.js","./common-CYWrYyJl-E8-sukrT.js","./ElevationInfo-DkWlof50-BssGWIKN.js","./lengthUtils-wU9RRIqK-Ck-67-Py.js","./intl-DLmy-Li5-DnUfHfMm.js","./SketchViewModel-T2dNp9Tt-D-FnDu-I.js","./UpdatingHandles-DBzjq66S-B93Tiora.js","./projection-m8vi7Cxv-C_JltvOn.js","./globalCss-CFN4F315-BP1UVbnN.js","./Queue-B8H6jIv7-Di67S5Qa.js","./signal-DxzURL18-CNLg-02N.js","./Version-BTMwSXf1-Cws5FYod.js","./quantityUtils-RaoZoCNH-D7603gQR.js","./vec2-BnynUbeJ-CKtGJQAy.js","./vec2f64-CEUyUoff-BBc0aQ6D.js","./vec32-BuqRmYBM-BM3KqM8m.js","./projectVectorToVector-D0K_S4MR-UmKLR1Il.js","./projectPointToVector-CG1hALQu-BjXPz5sw.js","./geodesicUtils-DV-lFWtb-Dn4jmTsX.js","./Query-CxQYWcUQ-8fAvXq-1.js","./Field-Cj6Pz3TI-MOMvkSrj.js","./fieldType-VTpxE-EM-CWsgg3NV.js","./vec42-D8CJyqHG-DnfLTeQH.js","./vec4f64-CjUMzAyX-DPYbdAom.js","./plane-B_adY3_o-GWG2FVRB.js","./mat3f64-Dh9_zhFu-BIT-k8Dm.js","./mat4f64-BaJwL7tQ-k0uMm8LY.js","./quatf64-C16JxGFv-BKWK1F8U.js","./sphere-Cj20syUS-DflIFGDB.js","./mat3-DOnW3DjW-C3hbW9XY.js","./jsxFactory-C5LxVioS-D52OxJOv.js","./uuid-Dj9mdEVg-BaKSCiyT.js","./layerViewUtils-Bk5QNiAa-BDm7c-BY.js","./widget-BgluoE6k-CtMr1HTT.js","./diffUtils-BSe9IE26-BzWFgoq_.js","./ViewingMode-CyR_b1T8-_s7_Gbsk.js","./meshVertexSpaceUtils-BwEbYR8F-BiGNgXWy.js","./MeshLocalVertexSpace-DFCiKNRA-CKbNLXSo.js","./hydratedFeatures-BDT5zTGB-CBPDnVQN.js","./Scheduler-Br-2v2ys-CKbCLMdl.js","./geometryEngineBase-DueYg7ux-B6e4gAE3.js","./_commonjsHelpers-BITg13Vk-KnjfkSck.js","./hydrated-Bae3cp-4-BalolLw_.js","./mat2d-BQA-1WB--Pnyy0dhf.js","./quat-D8L_R4I0-DVj2Ljg2.js","./drapedUtils-7RfmdK5D-B02L8yZj.js","./utils-C0LvbFCo-RMQaTNpt.js","./substitute-TfjvVaWd-0Phni5Uo.js"])))=>i.map(i=>d[i]);
import{_ as En,s as B,bP as I,E as N,c as dn,jz as v,jA as _,jB as un,jC as Tn,jD as _n,dK as vn,Q as sn,T as wn,cT as Cn}from"./index-DT_2vTqg.js";import{L as Ln,k as q,K as zn,O as L,q as fn}from"./projection-m8vi7Cxv-C_JltvOn.js";var nn;function Mn(n,t,i){return!Ln(n,t,i)}function z(n,t,i){const o=Mn(n,t,i);if(o&&!q())throw new dn("rasterprojectionhelper-project","projection engine is not loaded");return o}(function(n){n[n.None=0]="None",n[n.North=1]="North",n[n.South=2]="South",n[n.Both=3]="Both"})(nn||(nn={}));const xn=(n,t,i,o=0)=>{if(i[0]===1)return[0,0];let a=1,e=-1,s=1,u=-1;for(let c=0;c<n.length;c+=2)isNaN(n[c])||(a=a>n[c]?n[c]:a,e=e>n[c]?e:n[c],s=s>n[c+1]?n[c+1]:s,u=u>n[c+1]?u:n[c+1]);const{cols:l,rows:r}=t,f=(e-a)/l/i[0],d=(u-s)/r/i[1],p=2*o;let x=0,m=!1,h=[0,0];for(let c=0;c<l-3;c++){for(let R=0;R<r-3;R++){const g=c*r*2+2*R,y=(n[g]+n[g+4]+n[g+4*r]+n[g+4*r+4])/4,w=(n[g+1]+n[g+5]+n[g+4*r+1]+n[g+4*r+5])/4,M=Math.abs((y-n[g+2*r+2])/f),S=Math.abs((w-n[g+2*r+3])/d);if(M+S>x&&(x=M+S,h=[M,S]),p&&x>p){m=!0;break}}if(m)break}return h},jn={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},Y=32,K=4,$=K,H=new Map,Q=new Map,D=500,In=39.37,An=96;let J=null;async function Zn(){J&&q()||(q()||await zn(),J=await En(()=>import("./index-CVKk0WAC-BXNlGu8r.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60]),import.meta.url).then(n=>n.V))}function On(n,t,i){return z(n.spatialReference,t),i?fn(t,n.spatialReference,n):fn(n.spatialReference,t,n)}function $n(n,t,i,o=null){const a=n.spatialReference;if(!a||!t||a.equals(t))return n;z(a,t,o);const e=i.center,s=new B({xmin:e.x-n.x/2,xmax:e.x+n.x/2,ymin:e.y-n.y/2,ymax:e.y+n.y/2,spatialReference:a}),u=L(s,t,o),l=E(t);return u==null||l!=null&&u.width>=l?F(n,a,t):{x:u.width,y:u.height}}function F(n,t,i){const o=I(t)/I(i);return{x:n.x*o,y:n.y*o}}function tn(n,t,i){const{spatialReference:o}=i;if(!o||!t||o.equals(t))return n;if(o.isGeographic&&t.isGeographic)return F(n,o,t);if(z(o,t),!J)throw new dn("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:a,y:e}=n;const s=(a+e)/2*I(o);let u=1;s>30&&(u=30/s,a*=u,e*=u);const l=256,r=a*l/2,f=e*l/2,{x:d,y:p}=i.center,x=[];for(let b=0;b<=l;b++)x.push([d-r,p-f+b*e]);for(let b=1;b<=l;b++)x.push([d-r+b*a,p+f]);for(let b=1;b<=l;b++)x.push([d+r,p+f-b*e]);for(let b=1;b<l;b++)x.push([d+r-b*a,p-f]);x.push(x[0]);const m=new sn({rings:[x],spatialReference:o}),h=L(m,t);if(!h)return F(n,o,t);const c=h.extent,R=E(t);if(c==null||R!=null&&c.width>=R)return F(n,o,t);const g=J.planarArea(h),y=a*e*l*l,w=Math.sqrt(g/y)/u,M={x:c.width/u/l,y:c.height/u/l},S={x:a*w,y:e*w},G=M.x*M.y;return Math.abs(G-S.x*S.y)/G<.1?M:S}function en(n,t){return(typeof n=="number"?n:(n.x+n.y)/2)*I(t)*An*In}function Hn(n,t){const{pixelSize:i,extent:o}=n;return en(tn(i,t,o),t)}function k(n,t=.01){return I(n)?t/I(n):0}function hn(n,t,i=null,o=!0){const a=n.spatialReference;if(a.equals(t))return n;z(a,t,i);const e=L(n,t,i);return o&&e&&Rn([n],[e],a,t),e}function Rn(n,t,i,o){const a=V(i,!0),e=V(o,!0),s=k(i,D),u=k(o,D);if(s&&a!=null&&e!=null)for(let l=0;l<n.length;l++){const r=t[l];if(!r)continue;const{x:f}=n[l],{x:d}=r;d>=e[1]-u&&Math.abs(f-a[0])<s?r.x-=e[1]-e[0]:d<=e[0]+u&&Math.abs(f-a[1])<s&&(r.x+=e[1]-e[0])}}function Wn(n){const{inSR:t,outSR:i,datumTransformation:o,preferPE:a}=n;if(t.equals(i)){const{points:e}=an(n,null);return e}return t.isWebMercator&&i.isWGS84||t.isWGS84&&i.isWebMercator?qn(n):z(t,i,o)&&a&&(t.isGeographic||A(t)!=null)?Fn(n):Bn(n)}function Bn(n){const{points:t}=an(n,null),{inSR:i,outSR:o,datumTransformation:a}=n,e=t.map(u=>new N(u[0],u[1],i)),s=L(e,o,a);return a&&Rn(e,s,i,o),s.map(u=>u?[u.x,u.y]:[NaN,NaN])}function Fn(n){const{inSR:t,outSR:i,datumTransformation:o}=n,a=A(t),{points:e,mask:s}=an(n,a);if(!t.isGeographic){const l=t.wkid?v.coordsys(t.wkid):v.fromString(t.isGeographic?_.PE_TYPE_GEOGCS:_.PE_TYPE_PROJCS,t.wkt2||t.wkt);un.projToGeog(l,e.length,e)}if(o!=null&&o.steps.length){let l;if(i.isGeographic&&(l=e.map(([r])=>r>179.9955?1:r<-179.9955?-1:0)),o.steps.forEach(r=>{const f=r.wkid?v.geogtran(r.wkid):v.fromString(_.PE_TYPE_GEOGTRAN,r.wkt);Tn.geogToGeog(f,e.length,e,null,r.isInverse?_.PE_TRANSFORM_2_TO_1:_.PE_TRANSFORM_1_TO_2)}),l)for(let r=0;r<e.length;r++){const f=l[r],d=e[r][0],p=d>179.9955?1:d<-179.9955?-1:0;f&&p&&f!==p&&(e[r][0]=f>0?d+360:d-360)}}if(!i.isGeographic){const l=A(i,!0),r=l!=null&&l.isEnvelope?[l.bbox[1],l.bbox[3]]:[-90,90];Yn(e,r);const f=i.wkid?v.coordsys(i.wkid):v.fromString(i.isGeographic?_.PE_TYPE_GEOGCS:_.PE_TYPE_PROJCS,i.wkt2||i.wkt);un.geogToProj(f,e.length,e)}let u=e;if(s&&e.length!==s.length){u=[];for(let l=0,r=0;l<s.length;l++)s[l]?u.push(e[r++]):u.push([NaN,NaN])}return u}function qn(n){const{cols:t,rows:i,xres:o,yres:a,usePixelCenter:e,inSR:s,outSR:u}=n;let{xmin:l,ymax:r}=n;e&&(l+=o/2,r-=a/2);const f=[],d=[],p=Math.max(t,i);for(let m=0;m<p;m++){const h=l+o*Math.min(t,m),c=r-a*Math.min(i,m),R=L(new N({x:h,y:c,spatialReference:s}),u);m<=t&&f.push(R.x),m<=i&&d.push(R.y)}const x=[];for(let m=0;m<t;m++)for(let h=0;h<i;h++)x.push([f[m],d[h]]);return x}function A(n,t=!1){let i=n.wkid||n.wkt2||n.wkt;if(!i||n.isGeographic)return null;if(i=String(i),H.has(i)){const s=H.get(i);return t?s==null?void 0:s.gcs:s==null?void 0:s.pcs}const o=n.wkid?v.coordsys(n.wkid):v.fromString(n.isGeographic?_.PE_TYPE_GEOGCS:_.PE_TYPE_PROJCS,n.wkt2||n.wkt),a=mn(o,k(n,1e-4)),e=mn(o,0,!0);return H.set(i,{pcs:a,gcs:e}),t?e:a}function mn(n,t=0,i=!1){const o=_n.generate(n),a=i?n.horizonGcsGenerate():n.horizonPcsGenerate();if(!o||!(a!=null&&a.length))return null;let e=!1,s=a.find(c=>c.getInclusive()===1&&c.getKind()===1);if(!s){if(s=a.find(c=>c.getInclusive()===1&&c.getKind()===0),!s)return null;e=!0}const u=i?0:(o.getNorthPoleLocation()===2?1:0)|(o.getSouthPoleLocation()===2?2:0),l=o.isPannableRectangle(),r=s.getCoord();if(e)return{isEnvelope:e,isPannable:l,vertices:r,coef:null,bbox:[r[0][0]-t,r[0][1]-t,r[1][0]+t,r[1][1]+t],poleLocation:u};let f=0;const d=[];let[p,x]=r[0],[m,h]=r[0];for(let c=0,R=r.length;c<R;c++){f++,f===R&&(f=0);const[g,y]=r[c],[w,M]=r[f];if(M===y)d.push([g,w,y,M,2]);else{const S=(w-g)/(M-y||1e-4),G=g-S*y;y<M?d.push([S,G,y,M,0]):d.push([S,G,M,y,1])}p=p<g?p:g,x=x<y?x:y,m=m>g?m:g,h=h>y?h:y}return{isEnvelope:!1,isPannable:l,vertices:r,coef:d,bbox:[p,x,m,h],poleLocation:u}}function an(n,t){const i=[],{cols:o,rows:a,xres:e,yres:s,usePixelCenter:u}=n;let{xmin:l,ymax:r}=n;if(u&&(l+=e/2,r-=s/2),t==null){for(let x=0;x<o;x++)for(let m=0;m<a;m++)i.push([l+e*x,r-s*m]);return{points:i}}const f=new Uint8Array(o*a);if(t.isEnvelope){const{bbox:[x,m,h,c]}=t;for(let R=0,g=0;R<o;R++){const y=l+e*R,w=t.isPannable||y>=x&&y<=h;for(let M=0;M<a;M++,g++){const S=r-s*M;w&&S>=m&&S<=c&&(i.push([y,S]),f[g]=1)}}return{points:i,mask:f}}const d=t.coef,p=[];for(let x=0;x<a;x++){const m=r-s*x,h=[],c=[];for(let g=0;g<d.length;g++){const[y,w,M,S,G]=d[g];if(m===M&&M===S)h.push(y),h.push(w),c.push(2),c.push(2);else if(m>=M&&m<=S){const b=y*m+w;h.push(b),c.push(G)}}let R=h;if(h.length>2){let g=c[0]===2?0:c[0],y=h[0];R=[];for(let w=1;w<c.length;w++)c[w]===2&&w!==c.length-1||(c[w]!==g&&(R.push(g===0?Math.min(y,h[w-1]):Math.max(y,h[w-1])),g=c[w],y=h[w]),w===c.length-1&&R.push(c[w]===0?Math.min(y,h[w]):Math.max(y,h[w])));R.sort((w,M)=>w-M)}else h[0]>h[1]&&(R=[h[1],h[0]]);p.push(R)}for(let x=0,m=0;x<o;x++){const h=l+e*x;for(let c=0;c<a;c++,m++){const R=r-s*c,g=p[c];if(g.length===2)h>=g[0]&&h<=g[1]&&(i.push([h,R]),f[m]=1);else if(g.length>2){let y=!1;for(let w=0;w<g.length;w+=2)if(h>=g[w]&&h<=g[w+1]){y=!0;break}y&&(i.push([h,R]),f[m]=1)}}}return{points:i,mask:f}}function Yn(n,t){const[i,o]=t;for(let a=0;a<n.length;a++){const e=n[a][1];(e<i||e>o)&&(n[a]=[NaN,NaN])}}function bn(n,t){const i=E(n[0].spatialReference);if(n.length<2||i==null||(t=t??k(n[0].spatialReference),(n=n.filter(u=>u.width>t)).length===1))return n[0];let{xmin:o,xmax:a,ymin:e,ymax:s}=n[0];for(let u=1;u<n.length;u++){const l=n[u];a=l.xmax+i*u,e=Math.min(e,l.ymin),s=Math.max(s,l.ymax)}return new B({xmin:o,xmax:a,ymin:e,ymax:s,spatialReference:n[0].spatialReference})}function Sn(n,t,i=null,o=!0){const a=n.spatialReference;if(a.equals(t))return n;const e=rn(n),s=E(a,!0),u=E(t);if(e===0||s==null||u==null){const r=on(n,t,i,o);if(s==null&&u!=null&&Math.abs(r.width-u)<k(t)&&q()){const f=A(a);if(f!=null&&f.poleLocation===nn.None&&n.width<(f.bbox[2]-f.bbox[0])/2)return Kn(n,t)||r}return r}const l=n.clone().normalize();if(l.length===1&&n.xmax<s&&n.xmax-s/2>k(a)){const{xmin:r,xmax:f}=n;for(let d=0;d<=e;d++){const p=d===0?r:-s/2,x=d===e?f-s*d:s/2;l[d]=new B({xmin:p,xmax:x,ymin:n.ymin,ymax:n.ymax,spatialReference:a})}}return bn(l.map(r=>on(r,t,i,o)).filter(vn))}function Qn(n,t,i){if(n.type==="extent"){const{xmin:o,ymin:a,xmax:e,ymax:s,spatialReference:u}=n;n=new sn({rings:[[[o,s],[e,s],[e,a],[o,a],[o,s]]],spatialReference:u})}return n.spatialReference.equals(t)?n:(z(n.spatialReference,t,i),L(n,t,i))}function Kn(n,t){const i=E(t);if(i==null)return null;let{xmin:o,ymin:a,xmax:e,ymax:s}=n;const u=n.spatialReference,l=new sn({spatialReference:u,rings:[[[o,a],[e,a],[e,s],[o,s],[o,a]]]}),r=L(l,t);if(r.rings.length!==2||!r.rings[0].length||!r.rings[1].length)return null;const{rings:f}=r,d=k(u),p=new B({spatialReference:t});for(let x=0;x<2;x++){o=e=f[x][0][0],a=s=f[x][0][1];for(let m=0;m<f[x].length;m++)o=o>f[x][m][0]?f[x][m][0]:o,e=e<f[x][m][0]?f[x][m][0]:e,a=a>f[x][m][1]?f[x][m][1]:a,s=s<f[x][m][1]?f[x][m][1]:s;if(x===0)p.ymin=a,p.ymax=s,p.xmin=o,p.xmax=e;else if(p.ymin=Math.min(p.ymin,a),p.ymax=Math.max(p.ymax,s),Math.abs(e-i/2)<d)p.xmin=o,p.xmax=p.xmax+i;else{if(!(Math.abs(o+i/2)<d))return null;p.xmax=e+i}}return p}function on(n,t,i=null,o=!0,a=!0){const e=n.spatialReference;if(e.equals(t)||!t)return n;z(e,t,i);const s=L(n,t,i);if(a&&t.isWebMercator&&s&&(s.ymax=Math.min(20037508342787e-6,s.ymax),s.ymin=Math.max(-20037508342787e-6,s.ymin),s.ymin>=s.ymax))return null;if(!o||!s)return s;const u=V(e,!0),l=V(t,!0);if(u==null||l==null)return s;const r=k(e,.001),f=k(e,D),d=k(t,.001);if(Math.abs(s.xmin-l[0])<d&&Math.abs(s.xmax-l[1])<d){const p=Math.abs(n.xmin-u[0]),x=Math.abs(u[1]-n.xmax);if(p<r&&x>f){s.xmin=l[0];const m=[];m.push(new N(n.xmax,n.ymin,e)),m.push(new N(n.xmax,(n.ymin+n.ymax)/2,e)),m.push(new N(n.xmax,n.ymax,e));const h=m.map(c=>hn(c,t,i)).filter(c=>!isNaN(c==null?void 0:c.x)).map(c=>c.x);s.xmax=Math.max.apply(null,h)}if(x<r&&p>f){s.xmax=l[1];const m=[];m.push(new N(n.xmin,n.ymin,e)),m.push(new N(n.xmin,(n.ymin+n.ymax)/2,e)),m.push(new N(n.xmin,n.ymax,e));const h=m.map(c=>hn(c,t,i)).filter(c=>!isNaN(c==null?void 0:c.x)).map(c=>c.x);s.xmin=Math.min.apply(null,h)}}else{const p=k(t,.001);Math.abs(s.xmin-l[0])<p&&(s.xmin=l[0]),Math.abs(s.xmax-l[1])<p&&(s.xmax=l[1])}return s}function E(n,t=!1){if(!n)return null;const i=t?20037508342787e-6:20037508342788905e-9;return n.isWebMercator?2*i:n.wkid&&n.isGeographic?360:2*jn[n.wkid]||null}function V(n,t=!1){if(n.isGeographic)return[-180,180];const i=E(n,t);return i!=null?[-i/2,i/2]:null}function pn(n,t,i,o){let a=(n-t)/i;return a-Math.floor(a)!=0?a=Math.floor(a):o&&(a-=1),a}function rn(n,t=!1){const i=E(n.spatialReference);if(i==null)return 0;const o=t?0:-(i/2),a=k(n.spatialReference),e=!t&&Math.abs(n.xmax-i/2)<a?i/2:n.xmax,s=!t&&Math.abs(n.xmin+i/2)<a?-i/2:n.xmin;return pn(e,o,i,!0)-pn(s,o,i,!1)}function Un(n){const t=n.storageInfo.origin.x,i=E(n.spatialReference,!0);if(i==null)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const o=i/2,{nativePixelSize:a,storageInfo:e,extent:s}=n,{maximumPyramidLevel:u,blockWidth:l,pyramidScalingFactor:r}=e;let f=a.x;const d=[],p=n.transform!=null&&n.transform.type==="gcs-shift",x=t+(p?0:o),m=p?i-t:o-t;for(let h=0;h<=u;h++){const c=(s.xmax-t)/f/l,R=c-Math.floor(c)==0?c:Math.ceil(c),g=m/f/l,y=g-Math.floor(g)==0?g:Math.ceil(g),w=Math.floor(x/f/l),M=Math.round(x/f)%l,S=(l-Math.round(m/f)%l)%l;d.push({resolutionX:f,blockWidth:l,datasetColumnCount:R,worldColumnCountFromOrigin:y,leftMargin:M,rightPadding:S,originColumnOffset:w}),f*=r}return{originX:t,halfWorldWidth:o,pyramidsInfo:d,hasGCSSShiftTransform:p}}function Dn(n){if(!n||n.isGeographic)return n;const t=String(n.wkid||n.wkt2||n.wkt);let i;return Q.has(t)?i=Q.get(t):(i=(n.wkid?v.coordsys(n.wkid):v.fromString(_.PE_TYPE_PROJCS,n.wkt2||n.wkt)).getGeogcs().getCode(),Q.set(t,i)),new wn({wkid:i})}function nt(n){const t=n.isAdaptive&&n.spacing==null;let i=n.spacing||[Y,Y],o=U(n),a={cols:o.size[0]+1,rows:o.size[1]+1};const e=o.outofBoundPointCount>0&&o.outofBoundPointCount<o.offsets.length/2;let s=o.outofBoundPointCount===o.offsets.length/2||t&&e?[0,0]:xn(o.offsets,a,i,$);const u=(s[0]+s[1])/2,l=n.projectedExtent.spatialReference,r=n.srcBufferExtent.spatialReference;if(t&&(e||u>$)&&(Mn(l,r,n.datumTransformation)&&(l.isGeographic||A(l)),i=[K,K],o=U({...n,spacing:i}),a={cols:o.size[0]+1,rows:o.size[1]+1},s=xn(o.offsets,a,i,$)),o.error=s,i[0]>1&&(o.coefficients=gn(o.offsets,a,e)),n.includeGCSGrid&&!l.isGeographic&&!l.isWebMercator)if(r.isGeographic)o.gcsGrid={offsets:o.offsets,coefficients:o.coefficients,spacing:i};else{const f=A(l);if(f!=null&&!f.isEnvelope){const d=Dn(l),p=Sn(n.projectedExtent,d),{offsets:x}=U({...n,srcBufferExtent:p,spacing:i}),m=gn(x,a,e);o.gcsGrid={offsets:x,coefficients:m,spacing:i}}}return o}function U(n){const{projectedExtent:t,srcBufferExtent:i,pixelSize:o,datumTransformation:a,rasterTransform:e}=n,s=t.spatialReference,u=i.spatialReference,l=z(s,u),{xmin:r,ymin:f,xmax:d,ymax:p}=t,x=E(u),m=x!=null&&(n.hasWrapAround||(e==null?void 0:e.type)==="gcs-shift"),h=n.spacing||[Y,Y],c=h[0]*o.x,R=h[1]*o.y,g=h[0]===1,y=Math.ceil((d-r)/c-.1/h[0])+(g?0:1),w=Math.ceil((p-f)/R-.1/h[1])+(g?0:1),M=Wn({cols:y,rows:w,xmin:r,ymax:p,xres:c,yres:R,inSR:s,outSR:u,datumTransformation:a,preferPE:h[0]<=K,usePixelCenter:g}),S=[];let G,b=0;const T=g?-1:NaN,{xmin:j,xmax:O,ymax:X,width:Pn,height:Gn}=i,kn=k(u,D),Nn=x!=null&&j>0&&O>x/2;let ln=!1;if(l){const C=A(s);ln=C!=null&&C.poleLocation>0}for(let C=0;C<y;C++){const Z=[];for(let W=0;W<w;W++){let P=M[C*w+W];if(m&&P[0]>O&&P[0]>x/2-kn?P[0]-=x:m&&C===0&&P[0]<0&&Nn&&!e&&(P[0]+=x),!P||isNaN(P[0])||isNaN(P[1]))S.push(T),S.push(T),Z.push(null),b++;else{if(e){const cn=e.inverseTransform(new N({x:P[0],y:P[1],spatialReference:u}));P=[cn.x,cn.y]}Z.push(P),C>0&&m&&G[W]&&P[0]<G[W][0]&&(P[0]+=x,ln&&P[0]>O&&P[0]>x&&(P[0]-=x)),S.push((P[0]-j)/Pn),S.push((X-P[1])/Gn)}}G=Z}return{offsets:S,error:null,coefficients:null,outofBoundPointCount:b,spacing:h,size:g?[y,w]:[y-1,w-1]}}function gn(n,t,i){const{cols:o,rows:a}=t,e=new Float32Array((o-1)*(a-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),u=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<o-1;l++){for(let r=0;r<a-1;r++){let f=l*a*2+2*r;const d=n[f],p=n[f+1],x=n[f+2],m=n[f+3];f+=2*a;const h=n[f],c=n[f+1],R=n[f+2],g=n[f+3];let y=0,w=12*(r*(o-1)+l);for(let M=0;M<3;M++)e[w++]=s[y++]*d+s[y++]*x+s[y++]*R;y=0;for(let M=0;M<3;M++)e[w++]=s[y++]*p+s[y++]*m+s[y++]*g;y=0;for(let M=0;M<3;M++)e[w++]=u[y++]*d+u[y++]*h+u[y++]*R;y=0;for(let M=0;M<3;M++)e[w++]=u[y++]*p+u[y++]*c+u[y++]*g}if(i)for(let r=0;r<e.length;r++)isNaN(e[r])&&(e[r]=-1)}return e}function Jn(n,t){const i=n.clone().normalize();return i.length===1?i[0]:bn(i,t)}function tt(n){const{spatialReference:t}=n,i=Cn(t);if(!i)return n;const[o,a]=i.valid,e=a-o;let s=0;if(n.xmin<o){const u=o-n.xmin;s=Math.ceil(u/e)}else if(n.xmin>a){const u=n.xmin-a;s=-Math.ceil(u/e)}return new B({spatialReference:n.spatialReference,xmin:n.xmin+s*e,ymin:n.ymin,xmax:n.xmax+s*e,ymax:n.ymax})}function et(n,t,i){var m;const{storageInfo:o,pixelSize:a}=t;let e=0,s=!1;const{pyramidResolutions:u}=o,l=((m=o.tileInfo.format)==null?void 0:m.toLowerCase())==="mixed"?Math.max(1,Math.min(3,o.tileInfo.dpi/96)):1,r=(n.x+n.y)/2/l;if(u!=null&&u.length){const h=u[u.length-1],c=(h.x+h.y)/2,R=(a.x+a.y)/2;if(r<=R)e=0;else if(r>=c)e=u.length,s=r/c>8;else{let y,w=R;for(let M=1;M<=u.length;M++){if(y=(u[M-1].x+u[M-1].y)/2,r<=y){r===y?e=M:i==="down"?(e=M-1,s=r/w>8):e=i==="up"||r-w>y-r||r/w>2?M:M-1;break}w=y}}const g=e===0?a:u[e-1];return s&&Math.min(g.x,g.y)*I(t.spatialReference)>19567&&(s=!1),{pyramidLevel:e,pyramidResolution:new N({x:g.x,y:g.y,spatialReference:t.spatialReference}),excessiveReading:s}}const f=Math.log(n.x/a.x)/Math.LN2,d=Math.log(n.y/a.y)/Math.LN2,p=t.storageInfo.maximumPyramidLevel||0;e=i==="down"?Math.floor(Math.min(f,d)):i==="up"?Math.ceil(Math.max(f,d)):Math.round((f+d)/2),e<0?e=0:e>p&&(s=e>p+3,e=p);const x=2**e;return{pyramidLevel:e,pyramidResolution:new N({x:x*t.nativePixelSize.x,y:x*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:s}}function yn(n,t,i=!1){const{pixelSize:o,extent:a}=n,e=On(a,t,!1),s=Sn(Jn(a,(o.x+o.y)/16),t,e);return i||rn(s)===0?s:on(a,t,e)}function it(n,t,i){var G;const o=i==null?void 0:i.tileSize,a=i==null?void 0:i.alignGlobalDatasetWithAGOL,{extent:e,spatialReference:s,pixelSize:u}=n,l=tn(u,t,e);if(l==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const r=(l.x+l.y)/2,f=en(r,t),d=t.isGeographic?256/o*2958287637958547e-7:256/o*591657527591555e-6;let p=n.dataType==="vector-magdir"||n.dataType==="vector-uv";const x=yn(n,t,!0),m=Math.min(Math.ceil(Math.log(Math.min(n.width,n.height)/32)/Math.LN2),Math.ceil(Math.log(d/2/f)/Math.LN2));if(!p&&a&&(t.isGeographic||t.isWebMercator)){const b=E(t);if(p=rn(x)>0||b!=null&&x.width>b/4,!p&&b!=null){let T=-1;if(m<3)T=2**m*r*o;else if(n.storageInfo){const{maximumPyramidLevel:O=0,pyramidScalingFactor:X=2}=n.storageInfo;T=X**O*r*o}const j=Math.ceil(b/T);p=j===1||j===2&&b/2-x.xmax<T}}let h,c=f;const R=1.001,g=Math.min(2,Math.max(1.414,((G=n.storageInfo)==null?void 0:G.pyramidScalingFactor)||2));if(p){c=d;const b=t.isGeographic?1341104507446289e-21:.29858214164761665,T=en(b,t),j=t.isGeographic?4326:3857;h=tn({x:b,y:b},s,yn(n,new wn({wkid:j}),!0)),h.x*=c/T,h.y*=c/T}else{h={x:u.x,y:u.y};let b=0;for(;c<d*(R/2)&&b<m;)b++,c*=g,h.x*=g,h.y*=g;Math.max(c,d)/Math.min(c,d)<=R&&(c=d)}const y=[c],w=[{x:h.x,y:h.y}],M=70.5310735,S=Math.min(M,f)/R;for(;c>=S;)c/=g,h.x/=g,h.y/=g,y.push(c),w.push({x:h.x,y:h.y});return{projectedPixelSize:l,scales:y,srcResolutions:w,isCustomTilingScheme:!p}}export{Mn as $,nt as D,it as H,Zn as I,Un as K,E as N,rn as U,Qn as V,tt as Z,Sn as a,et as b,yn as c,$n as j,hn as o,Hn as q,On as y};
