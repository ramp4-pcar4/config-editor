import{ar as P,as as ne,aG as T,aI as ue,az as t,aL as n,aC as k,aV as X,aW as Q,aD as J,gV as pe,aF as A,aQ as I,fW as ee,ax as M,aK as F,aM as D,aY as se,hq as me,av as W,hA as re,aS as te,aH as Z,aJ as ae,aA as R,aE as E,aw as le,aX as Te,at as K,gW as ie,ay as Le,aB as ce,hH as ye,gw as Ee,hG as je}from"./index-DT_2vTqg.js";import{Y as Me}from"./toggle-switch-control-C5FvI50A-DOiKwJXr.js";const He={key:0,class:"relative"},ze={key:0,class:"relative"},Ce=["innerHTML"],qe=["src"],Ie={key:1,class:"w-32 h-32"},$e={class:"symbologyIcon"},Ae=["innerHTML"],Ne=["src"],Oe={class:"badge z-50 rounded-full text-white absolute h-10 w-10 p-8 inline-flex items-center justify-center"},Be={key:0,class:"px-5"},De={key:1,class:"inline-flex justify-center items-center relative"},Fe=P({__name:"symbology-stack",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0}},setup(c){const x=c,u=T([]);return ue(()=>{u.value=x.layer.legend}),(d,p)=>c.result.loaded?(t(),n("div",He,[k("div",{class:J(c.result.items.length===0?"opacity-50":"")},[u.value.length>1?(t(),n("div",ze,[(t(!0),n(X,null,Q(u.value.slice(0,3).reverse(),(w,h)=>(t(),n("div",{class:J(["absolute",[h==0?"symbol-0":h==1?"left-3":"left-6"]]),style:pe({"z-index":3-h}),key:h},[u.value[h].svgcode?(t(),n("span",{key:0,class:"symbologyIcon w-28 h-28",innerHTML:u.value[h].svgcode},null,8,Ce)):u.value[h].imgUrl?(t(),n("img",{key:1,class:"symbologyIcon w-28 h-28",src:u.value[h].imgUrl},null,8,qe)):A("",!0)],6))),128))])):u.value.length>0?(t(),n("div",Ie,[k("div",$e,[u.value[0].svgcode?(t(),n("span",{key:0,innerHTML:u.value[0].svgcode},null,8,Ae)):u.value[0].imgUrl?(t(),n("img",{key:1,class:"symbologyIcon w-full h-full",src:u.value[0].imgUrl},null,8,Ne)):A("",!0)])])):A("",!0)],2),k("div",Oe,[c.result.loaded?(t(),n("div",Be,I(c.result.items.length),1)):A("",!0)])])):(t(),n("div",De,p[0]||(p[0]=[k("div",{class:"symbologyIcon h-32 w-32"},[k("div",{class:"relative animate-spin spinner h-24 w-24"})],-1)])))}}),Se=ne(Fe,[["__scopeId","data-v-496d788d"]]),Ge=["content"],Pe={class:"symbologyLayerName truncate"},Ue=P({__name:"symbology-item",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0},selected:{type:Boolean,required:!0}},setup(c){const x=ee(),u=M(()=>x.properties),d=c,p=()=>{const w=d.layer;return w&&u.value[w.id]&&u.value[w.id].name?u.value[w.id].name:(w==null?void 0:w.name)??""};return(w,h)=>{const _=F("tippy");return D((t(),n("button",{class:J(["flex flex-grow justify-start items-center px-7 py-10 default-focus-style symbologyStackButton truncate",c.selected?"detailsButtonSelected":"px-11"]),onClick:h[0]||(h[0]=me(()=>{},["stop"])),content:p()},[se(Se,{class:"symbStack w-32 h-32 mr-10",layer:c.layer,result:c.result},null,8,["layer","result"]),k("div",Pe,I(p()),1)],10,Ge)),[[_,{placement:"right",sticky:!0}]])}}}),Ze=["content"],Je=P({__name:"symbology-list",props:{results:{type:Object,required:!0},selected:{type:String,required:!0}},emits:["selection-changed"],setup(c,{emit:x}){const{t:u}=W(),d=re(),p=T(),w=()=>{p.value._tippy.hide()},h=v=>{var C;v.key==="Tab"&&((C=p.value)!=null&&C.matches(":focus"))&&p.value._tippy.show()},_=x,y=c,s=T(""),g=T([]),r=T(!1),e=T(!1),i=v=>d.getLayerByUid(v),L=v=>{s.value=v,_("selection-changed",v),r.value=!1},$=()=>{e.value||setTimeout(()=>{r.value=e.value},500),e.value=!0},q=()=>{r.value=e.value=!1},m=()=>{e.value||(r.value=!0),e.value=!0},H=()=>{r.value=e.value=!1};return te(()=>{g.value.push(Z(y,()=>{s.value=y.selected}))}),ue(()=>{var v,C;(v=p.value)==null||v.addEventListener("blur",w),(C=p.value)==null||C.addEventListener("keyup",h)}),ae(()=>{var v,C;g.value.forEach(N=>N()),(v=p.value)==null||v.removeEventListener("blur",w),(C=p.value)==null||C.removeEventListener("keyup",h)}),(v,C)=>{const N=F("focus-item"),G=F("focus-list"),j=F("tippy");return D((t(),n("div",{class:J(["symbology-list absolute overflow-hidden z-50 p-0 w-48 bg-white text-sm inline-flex flex-col",{"symbology-list-expanded":r.value}]),onMouseover:$,onMouseleave:q,onFocus:m,onBlur:me(H,["self"]),content:E(u)("details.layers.results.list.tooltip"),ref_key:"el",ref:p},[(t(!0),n(X,null,Q(y.results,(O,a)=>(t(),n("div",{class:"flex justify-start relative",key:a},[D((t(),R(Ue,{key:O.uid,layer:i(O.uid),result:O,selected:O.uid===s.value,onClick:o=>L(O.uid)},null,8,["layer","result","selected","onClick"])),[[N]])]))),128))],42,Ze)),[[G],[j,{trigger:"manual",placement:"top-start",touch:!1}]])}}}),Ve={class:"inline font-bold"},Re=["innerHTML"],We=P({__name:"esri-default",props:{fixtureFields:{type:Object,required:!1},fields:{type:Object,required:!0},identifyData:{type:Object,required:!0}},setup(c){const{t:x}=W(),u=le("iApi"),d=c,p=(s,g,r,e)=>{const i=s.find(L=>L[g].toLowerCase()===r.toLowerCase());i&&delete e[i.name]},w=()=>{const s=Object.assign({},d.identifyData.data);p(d.fields,"type","geometry",s),u.ui.exposeOids||p(d.fields,"type","oid",s),u.ui.exposeMeasurements||(p(d.fields,"name","shape_length",s),p(d.fields,"name","shape_area",s));const g={};d.fields.forEach(e=>{var L;const i=(L=d.fixtureFields)==null?void 0:L.find($=>e.name===$.field);g[e.name]={name:(i==null?void 0:i.alias)||e.alias||e.name,type:e.type,visible:(i==null?void 0:i.visible)??!0}});const r={};Object.keys(s).forEach(e=>{const i=g[e];if(i&&i.visible){const L=s[e];r[e]={value:typeof L=="number"?u.ui.formatNumber(L):L,alias:i.name,type:i.type}}});for(const[e]of Object.entries(r))u.ui.isPlainText(r[e].value)&&(r[e].value=u.ui.escapeHtml(r[e].value));return r},h=(s,g,r)=>{switch(r){case"date":return y(s);default:return _(s,g)}},_=(s,g)=>{var i;if(!s)return s;if(s.trim().match(/\.(jpeg|jpg|gif|png)$/)||s.trim().match(/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i))return`<img src="${s}" alt="${x("details.item.alert.defaultAltText",{alias:g})}" />`;const r="underline text-blue-700 break-all",e=document.createElement("div");return e.innerHTML=s.trim(),((i=e.firstElementChild)==null?void 0:i.tagName)=="A"?(e.firstElementChild.className=r,e.innerHTML):ye(s,{className:r,target:"_blank",validate:{url:L=>/^https?:\/\//.test(L)}})},y=s=>{const g=parseInt(s);return isNaN(g)?s:new Date(g).toISOString().split("T")[0]};return(s,g)=>(t(),n("div",null,[(t(!0),n(X,null,Q(w(),(r,e,i)=>(t(),n("div",{class:"p-5 pl-3 flex justify-end flex-wrap even:bg-gray-300",key:i},[k("span",Ve,I(r.alias),1),g[0]||(g[0]=k("span",{class:"flex-auto"},null,-1)),k("span",{class:"inline",innerHTML:h(r.value,r.alias,r.type)},null,8,Re)]))),128))]))}}),Xe=["innerHTML"],Ye={key:1},Ke=P({__name:"html-default",props:{identifyData:{type:Object,required:!0}},setup(c){const{t:x}=W();return(u,d)=>c.identifyData?(t(),n("div",{key:0,class:"whitespace-pre-wrap break-words h-full overflow-auto",innerHTML:c.identifyData.data.data??c.identifyData.data},null,8,Xe)):(t(),n("div",Ye,I(E(x)("details.layers.results.empty")),1))}}),Qe={class:"relative flex flex-grow truncate"},et={key:0,class:"flex flex-grow items-center truncate"},tt={class:"flex p-8 items-center"},at=["innerHTML"],lt={key:1,class:"symbologyIcon p-6"},st=["content","innerHTML","tabindex"],it={key:1,class:"flex p-6 flex-grow"},nt={key:2,class:"zoomButton text-center p-3"},ut=["content","aria-label"],rt={key:0,class:"m-auto animate-spin spinner h-20 w-20"},ot={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"green",class:"m-auto w-20 h-20"},dt={key:2,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"red",class:"m-auto w-20 h-20"},ct=["innerHTML"],ve=P({__name:"result-item",props:{uid:{type:String,required:!0},data:{type:Object,required:!0},open:{type:Boolean,required:!1},inList:{type:Boolean,required:!1}},setup(c){const x=re(),u=c,d=le("iApi"),p=T([]),w=ee(),{t:h}=W(),_=T(!1),y=T(""),s=T("none"),g=T(),r=()=>x.getLayerByUid(u.uid),e=M(()=>w.properties),i=M(()=>w.defaultTemplates),L=M(()=>{var a;return((a=r())==null?void 0:a.supportsFeatures)??!1}),$=M(()=>{var a;return((a=r())==null?void 0:a.mapLayer)??!1}),q=M(()=>{const a=r();let o=a&&u.data.loaded?a.nameValue(u.data.data):d.$i18n.t("details.items.title");return d.ui.isPlainText(o)&&(o=d.ui.escapeHtml(o)),o}),m=a=>{var o;if(typeof a=="string"){const f="underline text-blue-700 break-all",z=document.createElement("div");return z.innerHTML=a.trim(),((o=z.firstElementChild)==null?void 0:o.tagName)=="A"?(z.firstElementChild.className=f,z.innerHTML):ye(a,{className:f,target:"_blank",validate:{url:B=>/^https?:\/\//.test(B)}})}return a},H=()=>{j("none"),u.data.loaded?v():u.data.load().then(()=>{v()})},v=()=>{if(y.value="",!(u.data&&u.data.loaded))return;const a=r();if(a===void 0){console.warn(`could not find layer for uid ${u.uid} during icon lookup`);return}if(a.supportsFeatures){const o=a.oidField;a.getIcon(u.data.data[o]).then(f=>{y.value=f})}},C=M(()=>{const a=r();return a&&e.value[a.id]&&e.value[a.id].template?e.value[a.id].template:i.value&&i.value[u.data.format]?i.value[u.data.format]:L.value?We:Ke}),N=M(()=>{var a;return L.value?((a=r())==null?void 0:a.fields)||[]:[]}),G=M(()=>{const a=r();if(a&&e.value[a.id]&&e.value[a.id].fields)return e.value[a.id].fields}),j=a=>{a==="zoomed"||a==="error"?setTimeout(()=>{var o;s.value=a,(o=g.value)==null||o._tippy.show(),setTimeout(()=>{var f;(f=g.value)==null||f._tippy.hide(),s.value="none"},3e3)},300):s.value=a},O=()=>{if(s.value!=="none")return;j("zooming");const a=r();if(a===void 0||!a.isLoaded){console.warn(`Could not find layer for uid ${u.uid} during zoom geometry lookup`),j("error");return}if(!u.data.loaded){console.warn("Details zoomToFeature call on item that is still loading. Should be impossible, alert the devs."),j("error");return}const o=u.data.data[a.oidField],f=()=>{const z={getGeom:!0};a.getGraphic(o,z).then(B=>{B.geometry.invalid()?(console.error(`Could not find graphic for objectid ${o}`),j("error")):(d.geo.map.zoomMapTo(B.geometry),j("zoomed"),d.updateAlert(d.$i18n.t("details.item.alert.zoom")))}).catch(()=>{j("error")})};a.layerType===Ee.FEATURE&&a.geomType!==je.POINT?a.getGraphicExtent(o).then(z=>{d.geo.map.zoomMapTo(z),j("zoomed"),d.updateAlert(d.$i18n.t("details.item.alert.zoom"))}).catch(()=>{f()}):f()};return te(()=>{p.value.push(Z(u,()=>{H()},{deep:!1,immediate:!0}))}),ae(()=>{p.value.forEach(a=>a())}),(a,o)=>{const f=F("truncate"),z=F("tippy");return t(),n(X,null,[k("div",Qe,[L.value?(t(),n("div",et,[k("div",tt,[c.data.loaded&&y.value?(t(),n("span",{key:0,class:"flex-none symbologyIcon",innerHTML:y.value},null,8,at)):(t(),n("div",lt,o[3]||(o[3]=[k("div",{class:"animate-spin spinner h-20 w-20"},null,-1)])))]),c.data.loaded?D((t(),n("span",{key:0,class:"pl-3 text-left flex-grow itemName",content:q.value,innerHTML:m(q.value),onTouchstart:o[0]||(o[0]=B=>_.value=!0),onTouchend:o[1]||(o[1]=B=>_.value=!1),tabindex:c.inList?-1:0},null,40,st)),[[f,{options:{placement:"top-start",offset:()=>_.value?[0,25]:[0,0]}}]]):(t(),n("div",it,I(E(h)("details.loading")),1)),c.data.loaded?(t(),n("span",nt,[$.value?D((t(),n("button",{key:0,type:"button",content:E(h)(`details.item.zoom${s.value==="none"?"":`.${s.value}`}`),"aria-label":E(h)(`grid.cells.zoom${s.value==="none"?"":`.${s.value}`}`),ref_key:"zoomButton",ref:g,onClick:o[2]||(o[2]=B=>{B.stopPropagation(),O()}),class:"text-gray-600 w-24 h-24 p-2 flex justify-center items-center"},[s.value==="zooming"?(t(),n("div",rt)):s.value==="zoomed"?(t(),n("svg",ot,o[4]||(o[4]=[k("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1)]))):s.value==="error"?(t(),n("svg",dt,o[5]||(o[5]=[k("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1)]))):(t(),n("span",{key:3,innerHTML:E(d).ui.getZoomIcon()},null,8,ct))],8,ut)),[[z,{placement:"bottom"}]]):A("",!0)])):A("",!0)])):A("",!0)]),c.open?(t(),R(Te(C.value),{key:0,identifyData:c.data,fields:N.value,fixtureFields:G.value,class:"p-8"},null,8,["identifyData","fields","fixtureFields"])):A("",!0)],64)}}}),vt={key:0,class:"layerName w-full flex-grow p-5 pb-8 font-bold truncate",tabIndex:"0"},pt={key:1,class:"p-8 mb-8 bg-gray-100 flex justify-between"},mt={for:"toggle"},yt={key:2,class:"flex flex-col justify-between p-8 mb-8 bg-gray-100"},gt={class:"flex"},ft=["aria-label"],ht=["content","aria-label","disabled"],bt={class:"px-3 text-center flex-grow"},kt=["content","aria-label","disabled"],xt={key:3},wt={key:0},_t=["content"],Tt=["onClick"],Lt={key:1,class:"text-center"},Et={key:4,class:"p-5"},jt=P({__name:"result-list",props:{uid:{type:String,required:!0},results:{type:Object,required:!0}},setup(c){const x=T(),u=()=>{x.value._tippy.hide()},d=l=>{var b;l.key==="Tab"&&((b=x.value)!=null&&b.matches(":focus"))&&x.value._tippy.show()},p=le("iApi"),w=ee(),h=re(),_=c,{t:y}=W(),s=T(!1),g=T(p.fixture.get("details")),r=T(!0),e=T(!1),i=T(0),L=T(20),$=T([]),q=T([]),m=M(()=>w.activeGreedy),H=M(()=>w.properties),v=M(()=>i.value+L.value),C=()=>h.getLayerByUid(_.uid),N=()=>_.results.find(l=>l.uid===_.uid),G=M(()=>{var l;return((l=N())==null?void 0:l.loaded)??!1}),j=M(()=>{var l;return(l=N())==null?void 0:l.requestTime}),O=M(()=>s.value&&(!e.value&&f().length>1||e.value&&f().length>L.value)),a=M(()=>{const l=C();return l&&H.value[l.id]&&H.value[l.id].name?H.value[l.id].name:(l==null?void 0:l.name)??""}),o=M(()=>_.uid),f=()=>{const l=N();return l?l.items:[]},z=M(()=>f()[i.value]),B=M(()=>{if(g.value.hasHilighter()){const l=C();if(l)return l.mapLayer&&l.supportsFeatures}return!1}),ge=l=>{r.value=l,w.hilightToggle=l,U()},fe=()=>{const l=C();i.value=i.value??0,r.value=w.hilightToggle??r.value,e.value=!1,s.value=!!l,U()},oe=l=>{e.value?(i.value+=l*L.value,U()):i.value+=l},U=()=>{const l=f();if(r.value&&G.value&&l.length>0&&B.value)if(e.value)g.value.hilightDetailsItems(l.slice(i.value,v.value),_.uid);else{const b=l[i.value];b&&g.value.hilightDetailsItems([b],_.uid)}else g.value.removeDetailsHilight()},he=()=>{e.value=!0,i.value=Math.floor(i.value/L.value)*L.value,U()},be=()=>{g.value.removeDetailsHilight(),q.value.forEach(l=>l()),$.value.forEach(l=>p.event.off(l))},ke=()=>{g.value.removeDetailsHilight()},xe=l=>{const b=i.value;i.value=l,e.value=!1,b===l&&U()};return ue(()=>{var l,b;$.value.push(p.event.on(K.LAYER_REMOVE,S=>{const V=p.panel.get("details");_.uid===S.uid&&V&&V.close()})),$.value.push(p.event.on(K.PANEL_CLOSED,S=>{S.id==="details"&&be()})),$.value.push(p.event.on(K.PANEL_MINIMIZED,S=>{S.id==="details"&&ke()})),$.value.push(p.event.on(K.MAP_BASEMAPCHANGE,S=>{r.value&&S.schemaChanged&&U()})),(l=x.value)==null||l.addEventListener("blur",u),(b=x.value)==null||b.addEventListener("keyup",d)}),te(()=>{q.value.push(Z(z,()=>{e.value||(fe(),z.value===void 0&&g.value.removeDetailsHilight())},{deep:!1,immediate:!0})),q.value.push(Z(o,()=>{const l=_.uid;if(e.value&&l){const b=N();b&&b.loading.then(()=>{_.uid===l&&e.value&&U()})}},{deep:!1,immediate:!0})),q.value.push(Z(j,()=>{i.value=0})),q.value.push(Z(()=>_.uid,()=>{i.value=0}))}),ae(()=>{var l,b;(l=x.value)==null||l.removeEventListener("blur",u),(b=x.value)==null||b.removeEventListener("keyup",d)}),(l,b)=>{const S=F("truncate"),V=F("tippy"),we=F("focus-item"),_e=F("focus-list");return G.value&&m.value===0?(t(),n("div",{key:0,class:"detailsContent relative flex flex-col flex-grow pl-5",style:pe(c.results.length>1?{"margin-left":"42px"}:"")},[s.value?D((t(),n("h1",vt,[ie(I(a.value),1)])),[[S,{options:{placement:"top-start"}}]]):A("",!0),B.value?(t(),n("div",pt,[k("label",mt,I(E(y)("details.togglehilight.title")),1),se(Me,{config:{value:r.value,disabled:!1},onToggled:ge},null,8,["config"])])):A("",!0),O.value?(t(),n("div",yt,[k("div",gt,[e.value?A("",!0):(t(),n("button",{key:0,type:"button",class:"px-8 font-bold hover:bg-gray-200 focus:bg-gray-200","aria-label":E(y)("details.item.see.list"),onClick:b[0]||(b[0]=Y=>he())},I(E(y)("details.item.see.list")),9,ft)),k("div",{class:J(["flex ml-auto bg-gray-200 py-8 items-center",{"w-full":e.value}])},[D((t(),n("button",{type:"button",content:E(y)(e.value?"details.items.previous":"details.item.previous.item"),onClick:b[1]||(b[1]=Y=>oe(-1)),class:"mx-2 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":E(y)(e.value?"details.items.previous":"details.item.previous.item"),disabled:i.value===0},b[3]||(b[3]=[k("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[k("g",null,[k("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,ht)),[[V,{placement:"top"}]]),k("span",bt,I(e.value?E(y)("details.items.range",[i.value+1,Math.min(v.value,f().length),f().length]):E(y)("details.item.count",[i.value+1,f().length])),1),D((t(),n("button",{type:"button",content:E(y)(e.value?"details.items.next":"details.item.next.item"),onClick:b[2]||(b[2]=Y=>oe(1)),class:"mx-2 rotate-180 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":E(y)(e.value?"details.items.next":"details.item.next.item"),disabled:!e.value&&i.value===f().length-1||e.value&&v.value>=f().length},b[4]||(b[4]=[k("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[k("g",null,[k("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,kt)),[[V,{placement:"top"}]])],2)])])):A("",!0),s.value?(t(),n("div",xt,[f().length>0?(t(),n("div",wt,[e.value?D((t(),n("div",{key:0,class:"flex flex-col",content:E(y)("details.layers.results.list.tooltip"),ref_key:"el",ref:x},[(t(!0),n(X,null,Q(f().slice(i.value,v.value),(Y,de)=>D((t(),n("button",{class:"flex flex-grow truncate default-focus-style hover:bg-gray-200",key:de,onClick:qt=>xe(i.value+de)},[se(ve,{data:Y,uid:c.uid,open:!1,"in-list":!0},null,8,["data","uid"])],8,Tt)),[[we,"show-truncate"]])),128))],8,_t)),[[_e],[V,{trigger:"manual",placement:"top-start",touch:!1}]]):(t(),R(ve,{key:1,data:z.value,uid:c.uid,open:!0,"in-list":!1},null,8,["data","uid"]))])):(t(),n("div",Lt,I(E(y)("details.layers.results.empty.currentLayer")),1))])):(t(),n("div",Et,I(E(y)("details.item.no.data")),1))],4)):(t(),n("div",{key:1,class:J(["flex justify-center py-10 items-center",c.results.length>1?"ml-42":""])},[b[5]||(b[5]=k("span",{class:"animate-spin spinner h-20 w-20 px-5 mr-8"},null,-1)),ie(" "+I(E(y)("details.item.loading")),1)],2))}}}),Mt=ne(jt,[["__scopeId","data-v-b02a05d4"]]),Ht={class:"relative h-full"},zt={class:"detailsContentSection overflow-y-auto h-full"},Ct=P({__name:"details-screen",props:{panel:{type:Object}},setup(c){const{t:x}=W(),u=le("iApi"),d=ee(),p=T([]),w=T([]),h=T([]),_=T(!1),y=T(""),s=M(()=>d.activeGreedy),g=M(()=>d.payload),r=M(()=>d.properties),e=m=>{y.value=m},i=m=>h.value.find(H=>H.uid===m),L=m=>{m!==void 0&&(d.activeGreedy=m.length===0?0:m[0].requestTime,h.value=m,$(m))},$=m=>{if(y.value){const H=i(y.value);H?H.loading.then(()=>{H.requestTime===s.value&&(H.items.length>0?(d.activeGreedy=0,_.value=!1):q(m))}):q(m)}else q(m)},q=(m,H)=>{let v;if(H)v=H;else{const j=d.properties,O=m.map(o=>{var f;return[((f=j[o.layerId])==null?void 0:f.priority)??50,o.layerId]}),a=new Set(O.map(o=>o[0]));v=[],a.forEach(o=>{const f=O.filter(z=>z[0]===o).map(z=>z[1]);v.push([o,f])}),v.sort((o,f)=>f[0]-o[0])}if(v.length===0){d.activeGreedy=0,_.value=!0;return}const C=v[v.length-1][1],N=m.filter(j=>C.includes(j.layerId)).map(j=>j.loading.then(()=>j.items.length>0?Promise.resolve(j):Promise.reject())),G=m.length===0?0:m[0].requestTime;Promise.any(N).then(j=>{j.requestTime===s.value&&(d.activeGreedy=0,y.value=j.uid,_.value=!1)}).catch(()=>{G===s.value&&(v.pop(),q(m,v))})};return te(()=>{w.value.push(Z(g,m=>{L(m)},{deep:!1,immediate:!0}))}),ae(()=>{p.value.forEach(m=>u.event.off(m)),w.value.forEach(m=>m())}),(m,H)=>{const v=Le("panel-screen");return t(),R(v,{panel:c.panel},{header:ce(()=>[ie(I(E(d).origin==="toggleEvent"?E(x)("details.layers.title.gridOrigin"):E(x)("details.layers.title.identifyOrigin")),1)]),content:ce(()=>[k("div",Ht,[h.value.length>1?(t(),R(Je,{key:0,results:h.value,detailsProperties:r.value,selected:y.value,onSelectionChanged:e},null,8,["results","detailsProperties","selected"])):A("",!0),k("div",zt,[_.value?(t(),n("div",{key:1,class:J(["text-center",{"ml-42":h.value.length>1}])},I(h.value.length>=1?E(x)("details.layers.results.empty"):E(x)("details.layers.results.empty.noLayers")),3)):(t(),R(Mt,{key:0,uid:y.value,results:h.value},null,8,["uid","results"]))])])]),_:1},8,["panel"])}}}),At=ne(Ct,[["__scopeId","data-v-60c889f3"]]);export{At as default};
