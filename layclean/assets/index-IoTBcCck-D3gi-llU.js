const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./screen-1GBY_pRY-BiahWfQx.js","./index-CBMEoBe1.js","./index-CpSsk29H.css"])))=>i.map(i=>d[i]);
import{ar as y,fT as u,_ as m,au as v,fV as L,h3 as o,a_ as x,h4 as b,h5 as s,h6 as f,h7 as h,gw as I,av as E,aw as A,ay as _,az as $,aA as w,aB as C,aC as p,aE as S}from"./index-CBMEoBe1.js";class T extends x{_parseConfig(e){var i,r,d,n;const l=((i=e==null?void 0:e.headerControls)==null?void 0:i.slice())??["wizard","layerReorder","groupToggle","visibilityToggle"];if(o(this.$vApp.$pinia).headerControls=l,!e||!e.root.children)return;o(this.$vApp.$pinia).multilineItems=((r=e.multilineItems)==null?void 0:r.enabled)??!0;const t=[1,2,3,4,5,6];!((d=e.multilineItems)!=null&&d.maxLines)||!t.includes((n=e.multilineItems)==null?void 0:n.maxLines)?o(this.$vApp.$pinia).maxLines=3:o(this.$vApp.$pinia).maxLines=e.multilineItems.maxLines,this.handlePanelWidths(["legend"]),this.handlePanelTeleports(["legend"]);const a=this.getLayerFixtureConfigs();e.root.children.forEach(g=>{g.layerLegendConfigs=a,this.addItem(g)}),this.$iApi.geo.layer.allLayers().forEach(g=>{this.updateLegend(g)})}createItem(e,l){let t;e.layerId===void 0?t=new b(this.$iApi,e,l):(e.sublayerIndex!==void 0&&(e.layerId=this.$iApi.geo.layer.sublayerId(e.layerId,e.sublayerIndex)),t=new s(this.$iApi,e,l));const a=e.children;return a&&a.forEach(i=>{e.layerLegendConfigs!==void 0&&(i.layerLegendConfigs=e.layerLegendConfigs),t.children.push(this.createItem(i,t))}),t}addItem(e,l){const t=e instanceof f?e:this.createItem(e,l);return this._insertItem(t,l),t}async addLayerItem(e,l){const t=new s(this.$iApi,{layerId:e.id,sublayerIndex:e.isSublayer?e.layerIdx:void 0,name:e.name},l);return this._insertItem(t,l),this.updateLegend(e),t}get config(){return super.config}getLegend(){return o(this.$vApp.$pinia).children||[]}getLegendConfig(){return{root:{children:this.getLegend().map(e=>e.getConfig())}}}getItem(e){const l=this.getLegend();let t;return l.some(a=>(t=this.searchTreeFirst(a,i=>i.uid===e),t!==void 0)),t}getLayerItem(e){let l,t,a;return typeof e=="string"?(t=e,l=e):(t=e.id,l=e.uid),this.getLegend().some(i=>(a=this.searchTreeFirst(i,r=>r instanceof s&&(r.layerId===t||r.uid===l)),a!==void 0)),a}getAllExpanded(e){const l=e??!0;return this.searchLegend(t=>t.children.length>0&&t.expanded===l)}getAllVisible(e){const l=e??!0;return this.searchLegend(t=>t.visibility===l)}getLayerBoundItems(e){var a;let l="";const t=e instanceof h?e:this.$iApi.geo.layer.getLayer(e);if(t)l=t.isSublayer?((a=t.parentLayer)==null?void 0:a.id)||"":t.id;else return[];return this.searchLegend(i=>i instanceof s&&(i.layerId===l||i.parentLayerId===l))}updateLegend(e){const l=(t,a)=>{const i=this.getLayerItem(t);a?(i&&t instanceof h&&(i.layer=t),i==null||i.error()):i==null||i.load(t instanceof h?t:void 0)};e.loadPromise().then(()=>{let t=this.getLayerItem(e);if(e.layerType===I.MAPIMAGE){const a=i=>{if(i.isLayerRoot&&!i.isLogicalLayer)t=this.getLayerItem(e),l(e,!1),t&&!t.treeGrown&&(i.children.map(r=>this._treeWalker(e,r)).map(r=>this.addItem(r,t)),t.treeGrown=!0),i.children.forEach(r=>a(r));else if(!i.isLayerRoot&&!i.isLogicalLayer){if(t=this.getLayerItem(this.$iApi.geo.layer.sublayerId(e.id,i.layerIdx)),t){const r=t.getConfig();delete r.layerId,delete r.sublayerIndex,delete r.children,r.name||delete r.name;const d={...this._treeWalker(e,i),...r},n=this.createItem(d);this._replaceItem(t,n)}i.children.forEach(r=>a(r))}else i.isLogicalLayer&&l(this._treeWalker(e,i).layer,!1)};a(e.getLayerTree())}else l(e,!1)}).catch(()=>{l(e,!0),e.supportsSublayers&&e.config.sublayers.forEach(t=>{l(this.$iApi.geo.layer.sublayerId(e.id,t.index),!0)})})}expandItems(e,l){const t=this.getLegend(),a=l===void 0?t:l.children;l!==void 0&&this._toggleState(l,{expanded:e}),a.forEach(i=>{this._toggleState(i,{expanded:e})})}showItems(e,l){const t=this.getLegend(),a=l===void 0?t:l.children;l!==void 0&&this._toggleState(l,{visibility:e}),a.forEach(i=>{this._toggleState(i,{visibility:e})})}reloadLayerItem(e){const l=this.getLayerBoundItems(e);return l.forEach(t=>t.reload()),l.length>0}removeItem(e){const l=typeof e=="string"?this.getItem(e):e;return l!==void 0?this._deleteItem(l):!1}removeLayerItem(e){const l=this.getLayerItem(e);return l!==void 0?this._deleteItem(l):!1}searchTreeFirst(e,l){if(l(e))return e;{let t;return e.children.some(a=>(t=this.searchTreeFirst(a,l),t!==void 0)),t}}searchTreeAll(e,l){const t=[],a=[e];for(;a.length>0;){const i=a.shift();i&&l(i)&&t.push(i),i&&a.push(...i.children)}return t}searchLegend(e){return this.getLegend().map(l=>this.searchTreeAll(l,e)).flat()}_toggleState(e,l){const t=l.visibility,a=l.expanded;t!==void 0&&e.toggleVisibility(t),a!==void 0&&e.children.length>0&&e.toggleExpanded(a),e.children&&e.children.length>0&&e.children.forEach(i=>{this._toggleState(i,l)})}_insertItem(e,l){o(this.$vApp.$pinia).addItem({item:e,parent:l})}_deleteItem(e){const l=o(this.$vApp.$pinia),t=a=>{a.children.length>0&&a.children.forEach(i=>{t(i)}),a instanceof s&&a.handlers.forEach(i=>this.$iApi.event.off(i)),l.removeItem(a)};return t(e),!0}_replaceItem(e,l){o(this.$vApp.$pinia).replaceItem({oldItem:e,newItem:l})}_treeWalker(e,l,t){const a=(r=>{const d=[e];for(;d.length>0;){const n=d.shift();if(n&&n.uid===r)return n;n&&d.push(...n.sublayers)}})(l.uid),i={};return l.isLayerRoot&&!l.isLogicalLayer?(i.layer=a,i.name=a.name,i.children=l.children.map(r=>this._treeWalker(e,r,t))):!l.isLayerRoot&&!l.isLogicalLayer?(i.name=l.name,i.children=l.children.map(r=>this._treeWalker(e,r,t))):l.isLogicalLayer&&(i.layer=a,i.name=a.name,i.layerId=a.id,i.sublayerIndex=e.isSublayer?e.layerIdx:void 0),{...i,...t}}}const M=y({__name:"nav-button",setup(c){const{t:e}=E(),l=A("iApi"),t=()=>{l.panel.toggle("legend")};return(a,i)=>{const r=_("mapnav-button");return $(),w(r,{onClickFunction:t,tooltip:S(e)("legend.title")},{default:C(()=>i[0]||(i[0]=[p("svg",{class:"fill-current w-32 h-20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[p("path",{d:"M0 0h24v24H0z",fill:"none"}),p("path",{d:"M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z"})],-1)])),_:1},8,["tooltip"])}}}),R={en:{"legend.title":"Legend","legend.header.addlayer":"Add Layer","legend.header.reorderlayers":"Reorder Layers","legend.header.groups":"Toggle Groups","legend.header.groups.expand":"Expand All","legend.header.groups.collapse":"Collapse All","legend.header.visible":"Toggle Visibility","legend.header.visible.show":"Show All","legend.header.visible.hide":"Hide All","legend.group.expand":"Expand Group","legend.group.collapse":"Collapse Group","legend.visibility.showLayer":"Show layer","legend.visibility.hideLayer":"Hide layer","legend.visibility.showSymbol":"Show symbol","legend.visibility.hideSymbol":"Hide symbol","legend.visibility.showGroup":"Show group","legend.visibility.hideGroup":"Hide group","legend.symbology.expand":"Expand legend","legend.symbology.hide":"Hide legend","legend.symbology.loading":"Loading...","legend.layer.data":"Show more data","legend.layer.data.only":"Layer not on map","legend.layer.offscale":"Layer out of scale","legend.layer.zoomToVisible":"Zoom to visible scale","legend.layer.options":"More options","legend.layer.controls.metadata":"Metadata","legend.layer.controls.settings":"Settings","legend.layer.controls.datatable":"Datatable","legend.layer.controls.symbology":"Legend","legend.layer.controls.boundaryzoom":"Zoom to Layer Boundary","legend.layer.controls.cancel":"Cancel","legend.layer.controls.remove":"Remove","legend.layer.controls.reload":"Reload","legend.layer.controls.reloadDisabled":"Layer cannot be reloaded","legend.alert.symbologyExpanded":"Layer legend expanded","legend.alert.symbologyCollapsed":"Layer legend collapsed","legend.alert.groupExpanded":"Legend group expanded","legend.alert.groupCollapsed":"Legend group collapsed","legend.alert.layerAdded":"{name} layer added to legend","legend.alert.layerRemoved":"{name} layer removed from legend"},fr:{"legend.title":"Légende","legend.header.addlayer":"Ajouter une couche","legend.header.reorderlayers":"Réorganiser les couches","legend.header.groups":"Basculer les Groupes","legend.header.groups.expand":"Élargir les groupes","legend.header.groups.collapse":"Réduire les groupes","legend.header.visible":"Basculer la Visibilité","legend.header.visible.show":"Montrer tout","legend.header.visible.hide":"Cacher tout","legend.group.expand":"Développer un groupe","legend.group.collapse":"Réduire un groupe","legend.visibility.showLayer":"Afficher la couche","legend.visibility.hideLayer":"Masquer la couche","legend.visibility.showSymbol":"Afficher le symbole","legend.visibility.hideSymbol":"Masquer le symbole","legend.visibility.showGroup":"Afficher le groupe","legend.visibility.hideGroup":"Masquer le groupe","legend.symbology.expand":"Développer la légende","legend.symbology.hide":"Masquer la légende","legend.symbology.loading":"Chargement en cours...","legend.layer.data":"Afficher plus de données","legend.layer.data.only":"Couche non visualisable","legend.layer.offscale":"Couche hors de portée","legend.layer.zoomToVisible":"Zoom sur l'échelle visible","legend.layer.options":"Plus d'options","legend.layer.controls.metadata":"Métadonnées","legend.layer.controls.settings":"Paramètres","legend.layer.controls.datatable":"Tableau de données","legend.layer.controls.symbology":"Légende","legend.layer.controls.boundaryzoom":"Zoomer à la limite","legend.layer.controls.cancel":"Annuler","legend.layer.controls.remove":"Retirer","legend.layer.controls.reload":"Recharger","legend.layer.controls.reloadDisabled":"Le calque ne peut pas être rechargé","legend.alert.symbologyExpanded":"Légende de la couche développée","legend.alert.symbologyCollapsed":"Légende de la couche réduite","legend.alert.groupExpanded":"Groupe de légende développé","legend.alert.groupCollapsed":"Groupe de légende réduit","legend.alert.layerAdded":"{name} couche ajoutée à la légende","legend.alert.layerRemoved":"Couche {name} retiré de la légende"}};class z extends T{added(){this.$iApi.component("legend-nav-button",M),this.$iApi.panel.register({legend:{screens:{"legend-screen":()=>u(m(()=>import("./screen-1GBY_pRY-BiahWfQx.js"),__vite__mapDeps([0,1,2]),import.meta.url))},style:{width:"350px"},alertName:"legend.title",button:{tooltip:"legend.title",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none" /><path d="M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z" /></svg>'}}},{i18n:{messages:R}}),this._parseConfig(this.config!==void 0?JSON.parse(JSON.stringify(this.config)):void 0);const e=this.$vApp.$watch(()=>this.config,l=>this._parseConfig(l!==void 0?JSON.parse(JSON.stringify(l)):void 0));this.removed=()=>{e(),this.$iApi.fixture.exists("appbar")&&v(this.$vApp.$pinia).removeButton("legend"),this.$iApi.fixture.exists("mapnav")&&L(this.$vApp.$pinia).removeItem("legend"),o().$reset(),this.$iApi.panel.remove("legend")}}}export{z as default};
