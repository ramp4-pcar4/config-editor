import{v as n,bm as Lt,K as $t,a1 as zt,dJ as st,ak as Q,ba as Ht,aD as B,S as r,n as x,ac as xt,a0 as at,ah as lt,l as Ft,dD as et,aj as Dt,ag as Nt,az as ct,du as Zt,gL as Bt,jM as pt}from"./index-DRDU_nTl.js";import{i as jt}from"./UpdatingHandles-Bd2FQ26N-CvefNm7m.js";import{g as Yt}from"./asyncUtils-BPUlNCrX-B0y5b9rY.js";import{b as qt,e as Jt,y as Kt,n as Qt,k as T,f as Wt}from"./SketchTooltipInfo-CkyYTifq-CaVRsRf8.js";import Xt from"./GraphicsLayer-BiEC2-gS-CmDrjRCP.js";import{b as te,T as ee,O as dt,I as ie,E as ut,R as oe,j as ne,a as ht,N as re,P as se,V as ae}from"./drawSurfaces-DQUGW1oK-n1I1T0sj.js";import{i as le,m as D,y as P,d as ce,o as pe}from"./quantityUtils-B1Ov7DZK-BZZNLW5X.js";import{d as de,b as ue,m as he,E as ye}from"./elevationInfoUtils-Ccn2Wfoe-BOQP6U4t.js";import{A as bt,P as X,B as yt,L as gt}from"./vec32-Cj8pVsU0-DklfJOsw.js";import{r as N,G as ge,e as me,j as Ut,J as Vt,i as fe,E as ve}from"./TooltipInfoWithCoordinates-Xxefy9Or-BI4lLg8F.js";import{w as It,o as we,q as Oe,A as _e}from"./SketchViewModel-B0qFHK0t-CV5B7V3w.js";import{m as G,P as mt,x as ke,g as xe,i as be,b as Ue,v as ft,T as vt}from"./vec2-BnynUbeJ-CKtGJQAy.js";import{h as Ve,N as q}from"./boundedPlane-QDtjx5eO-Mr5fSDMD.js";import{k as L}from"./vectorStacks-5ZZtmT9E-sM-Ke9dk.js";import{d as Ie,e as Pe,f as Te,L as Ae}from"./SnappingContext-OY7xJ98b-BhdCChq3.js";var m;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(m||(m={}));var k;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(k||(k={}));const J={[k.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[k.UndoInvalidError]:"There are no items to Undo",[k.RedoInvalidError]:"There are no items to Redo",[k.ApplyInvalidError]:"Cannot apply an item that is already applied"};let $=class extends Error{constructor(){super(J[k.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},tt=class extends Error{constructor(){super(J[k.UndoInvalidError]),this.type="undo-redo-undo-error"}},wt=class extends Error{constructor(){super(J[k.RedoInvalidError]),this.type="undo-redo-redo-error"}},Me=class extends Error{constructor(){super(J[k.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var U;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(U||(U={}));let j=class extends xt{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=m.NeverApplied}get canUndo(){return this.status===m.Applied}get canRedo(){return this.status===m.Undone}async executeUndoRedoOperation(t){switch(t){case U.Apply:if(this.status!==m.NeverApplied)throw new Me;return await this.apply(),void(this.status=m.Applied);case U.Undo:if(this.status!==m.Applied)throw new tt;return await this.undo(),void(this.status=m.Undone);case U.Redo:if(this.status!==m.Undone)throw new tt;return await this.redo(),void(this.status=m.Applied)}}};n([r()],j.prototype,"name",void 0),n([r()],j.prototype,"tag",void 0),j=n([x("esri.undoredo.UndoableOperation")],j);let O=class extends xt{constructor(){super(...arguments),this._stack=new at,this._stackPosition=-1,this._updatingHandles=new jt}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new tt;if(this.updating)throw new $;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(U.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new wt;if(this.updating)throw new $;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new wt;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(U.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new $;await this._updatingHandles.addPromise((async()=>{t.status===m.NeverApplied&&await t.executeUndoRedoOperation(U.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new $;await this._updatingHandles.addPromise((async()=>{t.status===m.NeverApplied&&await t.executeUndoRedoOperation(U.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await lt(()=>!this.updating);const i=new at;for(let o=0;o<this._stack.length;o++){const s=this._stack.getItemAt(o);s&&(s.tag===t?(s.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(s))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new $;await lt(()=>!this.updating),this._drainStack()}};n([r()],O.prototype,"_stack",void 0),n([r()],O.prototype,"_stackPosition",void 0),n([r()],O.prototype,"updating",null),n([r({readOnly:!0})],O.prototype,"canUndo",null),n([r({readOnly:!0})],O.prototype,"hasUndo",null),n([r({readOnly:!0})],O.prototype,"canRedo",null),n([r({readOnly:!0})],O.prototype,"hasRedo",null),O=n([x("esri.UndoRedo")],O);let Ee=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function E(t,e,i){if(t==null)return"noTool";switch(t){case"point":return Re();case"multipoint":return"multipoint";case"polyline":return Se(e,i);case"polygon":return Ce(e,i);case"rectangle":case"circle":return Ge(e,i);default:return}}function Re(t){return"point"}function Se(t,e){const i=t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0;return e==="freehand"?i<2?"freehandStart":"freehandEnd":i<2?"polylineZeroVertices":"polylineOneVertex"}function Ce(t,e){const i=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;if(i<3)switch(e){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(i<4)return e==="freehand"?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}function Ge(t,e){if((t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0)<3)switch(e){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(e){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}function Le(t,e){const i=t==null?void 0:t.geometry;if(!t||(i==null?void 0:i.type)!=="mesh"||!e)return;const{renderCoordsHelper:o,elevationProvider:s}=e,{camera:d}=e.state,{extent:l}=i,{center:c,spatialReference:a}=l,h=ct(a),y=et(a),g=ct(o.spatialReference),w=l.width*h,p=l.height*y,V=(l.zmax??0)*y,S=V-(l.zmin??0)*y,Z=Math.max(w,p,S)/g,{x:v,y:I}=c,C=c.z??0;bt(Y,v,I,C),o.toRenderCoords(Y,a,Y);const rt=Z/d.computeScreenPixelSizeAt(Y);if(rt>d.width*ze)return"meshTooClose";if(rt<$e)return"meshTooFar";const Ct=he(t),{absoluteZ:Gt}=ye(v,I,V,a,e,Ct);return Gt<(s.getElevation(v,I,C,a,"ground")??0)*y+S*He?"meshUnderground":"mesh"}const $e=20,ze=1,He=.1,Y=Zt();let _=class extends T{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=D}get allFields(){return[]}};n([r()],_.prototype,"type",void 0),n([r()],_.prototype,"radius",void 0),n([r()],_.prototype,"xSize",void 0),n([r()],_.prototype,"ySize",void 0),n([r()],_.prototype,"area",void 0),n([r()],_.prototype,"helpMessage",void 0),n([r()],_.prototype,"allFields",null),_=n([x("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],_);let z=class extends N(T){constructor(t){super(t),this.type="draw-mesh",this.orientation=ge({lockable:!1}),this.scale=me({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};n([r()],z.prototype,"helpMessage",void 0),n([r()],z.prototype,"allFields",null),z=n([x("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],z);let H=class extends N(T){constructor(t){super(t),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([r()],H.prototype,"helpMessage",void 0),n([r()],H.prototype,"allFields",null),H=n([x("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],H);let F=class extends N(T){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([r()],F.prototype,"helpMessage",void 0),n([r()],F.prototype,"allFields",null),F=n([x("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],F);let A=class extends N(T){constructor(t){super(t),this.type="draw-polygon",this.direction=Ut(),this.distance=Vt(),this.area=fe(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};n([r()],A.prototype,"xyMode",void 0),n([r()],A.prototype,"helpMessage",void 0),n([r()],A.prototype,"allFields",null),A=n([x("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],A);let M=class extends N(T){constructor(t){super(t),this.type="draw-polyline",this.direction=Ut(),this.distance=Vt(),this.totalLength=ve(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};n([r()],M.prototype,"helpMessage",void 0),n([r()],M.prototype,"xyMode",void 0),n([r()],M.prototype,"allFields",null),M=n([x("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],M);let b=class extends T{constructor(t){super(t),this.type="draw-rectangle",this.xSize=P,this.ySize=P,this.area=D}get allFields(){return[]}};n([r()],b.prototype,"type",void 0),n([r()],b.prototype,"xSize",void 0),n([r()],b.prototype,"ySize",void 0),n([r()],b.prototype,"area",void 0),n([r()],b.prototype,"helpMessage",void 0),n([r()],b.prototype,"allFields",null),b=n([x("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],b);function Fe(t,e){return{point:new F({sketchOptions:e,viewType:t}),multipoint:new H({sketchOptions:e,viewType:t}),polyline:new M({sketchOptions:e,viewType:t}),polygon:new A({sketchOptions:e,viewType:t}),mesh:new z({sketchOptions:e,viewType:t}),rectangle:new b({sketchOptions:e}),circle:new _({sketchOptions:e})}}function Ot(t){const{directionOptions:e,geometryType:i,sketchOptions:o,tooltipInfos:s}=t,d=c=>{const a=K(t).mode,h=s[c].elevation;a==="relative-to-ground"||a==="relative-to-scene"||a==="on-the-ground"?h.lock(nt(t)):h.unlock()},l=c=>{if(e){const a=s[c].direction;a.committed=e.angle,a.unlockOnVertexPlacement=!1,o.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":d(i),l(i);break;case"point":case"mesh":d(i)}}function De(t,e){const{drawOperation:i,view:o}=e,s=it(e),d=K(e);if(o.type==="2d"||!t||d.mode!=="absolute-height"||(i==null?void 0:i.numCommittedVertices)!==1||!s||s.type!=="draw-polyline"&&s.type!=="draw-polygon"||s.elevation.locked)return;const[l,c,a]=t,h=ei(l,c,a,d,e);h!=null&&s.elevation.lock(h)}function _t(t){var e;(e=it(t))==null||e.allFields.forEach(i=>{i.unlockOnVertexPlacement&&i.unlock()})}function it({geometryType:t,graphic:e,tooltipInfos:i}){var o;return((o=e==null?void 0:e.geometry)==null?void 0:o.type)!==Ne[t]?t==="circle"||t==="rectangle"?i[t]:null:i[t]}const Ne={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function Ze(t,e){switch(t==null?void 0:t.type){case"draw-point":Be(t,e);break;case"draw-multipoint":je(t,e);break;case"draw-polyline":qe(t,e);break;case"draw-polygon":Je(t,e);break;case"draw-rectangle":Qe(t,e);break;case"draw-circle":We(t,e);break;case"draw-mesh":Ye(t,e)}}function Be(t,e){var o;const i=(o=e.graphic)==null?void 0:o.geometry;(i==null?void 0:i.type)==="point"&&(ot(t,i,e),t.helpMessage=E("point",i,e.drawOperation.drawingMode))}function je(t,e){var o;const i=(o=e.graphic)==null?void 0:o.geometry;(i==null?void 0:i.type)==="multipoint"&&(ot(t,i,e),t.helpMessage=E("multipoint",i,e.drawOperation.drawingMode))}function Ye(t,e){const{graphic:i,view:o}=e,s=i==null?void 0:i.geometry;o.type!=="3d"||s&&s.type!=="mesh"||(ot(t,s==null?void 0:s.origin,e),s&&Wt(t,s),t.helpMessage=Le(i,o))}function ot(t,e,i){const{drawOperation:o,view:s,sketchOptions:d}=i,{cursorVertex:l}=o;t.sketchOptions=d,t.viewType=s.type;const c=(e==null?void 0:e.type)==="multipoint"?e.getPoint(e.points.length-1):e;if(t.setLocationFromPoint(c,R(i)),Tt(t.elevation,i),!l)return void(o.constraints=void 0);const a=l;o.constraints={context:Rt(a,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function qe(t,e){const{createOperationGeometry:i,drawOperation:o,automaticLengthMeasurementUtils:s}=e,d=i!=null?i.full:null;d&&d.type!=="polyline"||(Pt(t,e),t.totalLength.actual=o.lastVertex?(d?s.autoLength2D(d):null)??P:null,t.helpMessage=E("polyline",d,e.drawOperation.drawingMode))}function Je(t,e){const{createOperationGeometry:i,drawOperation:o}=e,s=i!=null?i.full:null;s&&s.type!=="polygon"||(Pt(t,e),t.area.actual=o.lastVertex?(s?e.automaticAreaMeasurementUtils.autoArea2D(s):null)??D:null,t.helpMessage=E("polygon",s,e.drawOperation.drawingMode))}const kt=Lt(Ft);function Pt(t,e){const{drawOperation:i,sketchOptions:o,view:s,automaticLengthMeasurementUtils:d}=e,{cursorVertex:l,lastVertex:c,secondToLastVertex:a}=i,h=o.values.effectiveDirectionMode;t.sketchOptions=o,t.viewType=s.type;const y=c&&l?d.autoDistanceBetweenPoints2D(kt(c),kt(l))??P:null;if(t.distance.actual=y,t.distance.readOnly=c==null,t.direction.actual=null,t.direction.readOnly=!0,c&&l&&(h==="absolute"||a)){const p=Oe(a,c,l,h);t.direction.actual=p??ce,t.direction.readOnly=!1}t.setLocationFromPoint(l,R(e)),Tt(t.elevation,e);const g=Ke(c,e);t.xyMode=g,t.direction.visible=g==="direction-distance",t.distance.visible=g==="direction-distance",t.effectiveX.visible=g==="coordinates",t.effectiveY.visible=g==="coordinates";const w=l??c;i.constraints=w?{context:Rt(w,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Ke(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function Qe(t,e){var i;t.sketchOptions=e.sketchOptions,t.xSize=Mt(e),t.ySize=Et(e),t.area=At(e),t.helpMessage=E("rectangle",(i=e.graphic)==null?void 0:i.geometry,e.drawOperation.drawingMode)}function We(t,e){var s;const{forceUniformSize:i,sketchOptions:o}=e;t.sketchOptions=o,t.radius=i?Xe(e):null,t.xSize=i?null:Mt(e),t.ySize=i?null:Et(e),t.area=At(e),t.helpMessage=E("circle",(s=e.graphic)==null?void 0:s.geometry,e.drawOperation.drawingMode)}function Tt(t,e){const{drawOperation:i}=e,o=(i==null?void 0:i.cursorVertex)??(i==null?void 0:i.lastVertex);t.actual=_e(o)??nt(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function At(t){var i;const e=(i=t.createOperationGeometry)==null?void 0:i.full;return(e==null?void 0:e.type)!=="polygon"?D:t.automaticAreaMeasurementUtils.autoArea2D(e)??D}function Mt({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){var o;const i=(o=t==null?void 0:t.rectangle)==null?void 0:o.midpoints;return(i!=null?e.autoDistanceBetweenPoints2D(i.left,i.right):null)??P}function Et({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){var o;const i=(o=t==null?void 0:t.rectangle)==null?void 0:o.midpoints;return(i!=null?e.autoDistanceBetweenPoints2D(i.top,i.bottom):null)??P}function Xe({createOperationGeometry:t,automaticLengthMeasurementUtils:e}){var i;return(((i=t==null?void 0:t.circle)==null?void 0:i.center)!=null&&t.circle.edge!=null?e.autoDistanceBetweenPoints2D(t.circle.center,t.circle.edge):null)??P}function ti(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const o=i[e].elevation.committed;return o?pe(o,"meters")/et(R(t)):void 0}default:return}}function ei(t,e,i,o,s){const{view:d,drawOperation:l}=s;if(d.type!=="3d"||!l)return;i??(i=0);const c=R(s),a=K(s),h=de(d,t,e,i,c,a,o);return we(h,c)??nt(s)}function K(t){return t.drawOperation.elevationInfo??ue}function R(t){return t.drawOperation.coordinateHelper.spatialReference}function nt(t){const e=et(R(t));return le(t.defaultZ*e,"meters")}function Rt(t,e){return ae(t,e.view,R(e),K(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}let u=class extends $t.EventedMixin(te){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new It}initialize(){const{view:t}=this;this.internalGraphicsLayer=new Xt({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Fe(t.type,this.sketchOptions);const i=qt(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=i,Ot(this._tooltipsContext),this._coordinateFormatterLoadTask=Yt(()=>Qt()),this.addHandles([e.on("vertex-add",o=>this.onVertexAdd(o)),e.on("vertex-remove",o=>this.onVertexRemove(o)),e.on("vertex-update",o=>this.onVertexUpdate(o)),e.on("cursor-update",o=>this.onCursorUpdate(o)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",o=>this.onComplete(o)),this._coordinateFormatterLoadTask,i.on("paste",o=>Jt(o,this.activeTooltipInfo)),zt(()=>this.cursor,o=>{e.cursor=o},Dt),st(()=>{const{activeTooltipInfo:o,sketchOptions:s}=this;Ze(o,this._tooltipsContext),i.info=s.tooltips.effectiveEnabled?o:null}),st(()=>{e.constraintZ=ti(this._tooltipsContext)},Nt)]),this.finishToolCreation()}destroy(){this.drawOperation=Q(this.drawOperation),this.tooltip=Q(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=Q(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){const{defaultZ:t,directionOptions:e,drawOperation:i,forceUniformSize:o,geometryType:s,graphic:d,sketchOptions:l,tooltipInfos:c,view:a,automaticAreaMeasurementUtils:h,automaticLengthMeasurementUtils:y}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:t,directionOptions:e,drawOperation:i,forceUniformSize:o,geometryType:s,graphic:d,sketchOptions:l,tooltipInfos:c,view:a,automaticAreaMeasurementUtils:h,automaticLengthMeasurementUtils:y}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){var t;return((t=this.drawOperation)==null?void 0:t.updating)??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof O?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||Kt(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&Ot(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(f.outline),this.removeHandles(f.regularVertices),this.removeHandles(f.activeVertex),this.removeHandles(f.activeEdge),this.removeHandles(W)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const e=new Ht({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(B(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),W),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){var S,Z;if(this.drawOperation==null)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:o,lastVertex:s,committedVertices:d,geometryIncludingUncommittedVertices:l,numCommittedVertices:c}=this.drawOperation;if(!(c>0||o!=null))return;const a=t.operationComplete?d:l,h=a.length,y=o!=null?e.pointToArray(o):null,g=this._drawSpatialReference,w=i.type==="3d"&&i.viewingMode==="global",p=new Ee;p.committedVertices=d,p.cursorVertex=y;const{geometryType:V}=this;switch(V){case"point":case"mesh":p.full=e.arrayToPoint(a[0]);break;case"multipoint":p.full=h>0?se(a,g):null;break;case"polyline":case"polygon":h>0&&(p.full=V==="polygon"?ne([a],g,w,!0):ht([a],g,w),p.cursorEdge=y!=null&&s&&!re(o,s)?ht([[y,e.pointToArray(s)]],g,w):null,p.outline=h>1?p.full:null);break;case"circle":case"rectangle":{if(p.committedVertices=p.cursorVertex=null,!h)break;const v=ee(i,a[0]),I=a[0],C=v.makeMapPoint(I[0]+ii*i.resolution,I[1]);V==="circle"?h===1&&t.operationComplete?p.circle=dt([I,C],v,!0):h===2&&(this.forceUniformSize?p.circle=dt(a,v,this.centered):p.rectangle=ie(a,v,this.centered)):h===1&&t.operationComplete?p.rectangle=ut([I,C],v,!0):h===2&&(p.rectangle=this.forceUniformSize?ut(a,v,this.centered):oe(a,v,this.centered)),p.full=p.circle!=null?p.circle.geometry:(S=p.rectangle)==null?void 0:S.geometry,p.outline=((Z=p.full)==null?void 0:Z.type)==="polygon"?p.full:null;break}default:return null}return p}initializeGraphic(t){return B()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(e=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return B()}onCursorEdgeChanged(t){return B()}onVertexAdd(t){var e;_t(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||De((e=t.vertices.at(0))==null?void 0:e.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){_t(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),f.activeEdge):this.removeHandles(f.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),f.outline):this.removeHandles(f.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),f.regularVertices):this.removeHandles(f.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),f.activeVertex):this.removeHandles(f.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(W)):this._destroyAllVisualizations()}get activeTooltipInfo(){var t;return(t=this._coordinateFormatterLoadTask)!=null&&t.finished?it(this._tooltipsContext):null}};n([r()],u.prototype,"_coordinateFormatterLoadTask",void 0),n([r()],u.prototype,"_createOperationGeometry",void 0),n([r()],u.prototype,"_tooltipsContext",null),n([r({value:!0})],u.prototype,"centered",null),n([r()],u.prototype,"cursor",null),n([r({nonNullable:!0})],u.prototype,"defaultZ",void 0),n([r({constructOnly:!0})],u.prototype,"directionOptions",void 0),n([r()],u.prototype,"drawOperation",void 0),n([r()],u.prototype,"elevationLockOnVertexAddDisabled",void 0),n([r({value:!0})],u.prototype,"enabled",null),n([r({value:!0})],u.prototype,"forceUniformSize",null),n([r({constructOnly:!0})],u.prototype,"geometryType",void 0),n([r()],u.prototype,"graphic",null),n([r({constructOnly:!0})],u.prototype,"graphicProperties",void 0),n([r()],u.prototype,"graphicSymbol",null),n([r({constructOnly:!0})],u.prototype,"hasZ",void 0),n([r({constructOnly:!0})],u.prototype,"geometryToPlace",void 0),n([r()],u.prototype,"mode",null),n([r()],u.prototype,"snappingManager",void 0),n([r()],u.prototype,"snapToScene",void 0),n([r()],u.prototype,"tooltip",void 0),n([r()],u.prototype,"tooltipInfos",void 0),n([r({constructOnly:!0,type:It})],u.prototype,"sketchOptions",void 0),n([r()],u.prototype,"updating",null),n([r({constructOnly:!0,nonNullable:!0})],u.prototype,"view",void 0),n([r({constructOnly:!0})],u.prototype,"automaticAreaMeasurementUtils",void 0),n([r({constructOnly:!0})],u.prototype,"automaticLengthMeasurementUtils",void 0),n([r({constructOnly:!0})],u.prototype,"undoRedo",null),n([r()],u.prototype,"activeTooltipInfo",null),u=n([x("esri.views.draw.DrawGraphicTool")],u);const W=Symbol("create-operation-graphic"),f={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function _i(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const ii=48;function ki(t,e){return St(t,e,!1)}function xi(t,e){return St(t,e,!0)}function St(t,e,i){if(t instanceof Ie){if(t.operation instanceof Pe)return oi(t.operation,e,i),!0;if(t.operation instanceof Te)return ni(t.operation,e,i),!0;if(t.operation instanceof Ae)return ri(t.operation,e,i),!0}return!1}function oi(t,e,i=!1){const o=i?-1:1,s=Bt(o*t.dx,o*t.dy,o*t.dz);X(e.origin,e.origin,s),q(e)}function ni(t,e,i=!1){const o=i?-t.angle:t.angle;yt(e.basis1,e.basis1,pt,o),yt(e.basis2,e.basis2,pt,o),q(e)}function ri(t,e,i=!1){const o=i?1/t.factor1:t.factor1,s=i?1/t.factor2:t.factor2;gt(e.basis1,e.basis1,o),gt(e.basis2,e.basis2,s),vt(e.origin,e.origin,t.origin,t.axis1,o),vt(e.origin,e.origin,t.origin,t.axis2,s),q(e)}function bi(t,e,i,o,s=!1){o||(o=Ve());const d=G(L.get(),t[1],-t[0]),l=G(L.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=G(L.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),a=L.get(),h=e.allVertices;h.forEach(({pos:p})=>{G(a,mt(t,p),mt(d,p)),ke(l,l,a),xe(c,c,a)});const y=1e-6,g=G(L.get(),c[0]-l[0]<y?i/2:0,c[1]-l[1]<y?i/2:0);be(l,l,g),Ue(c,c,g);const w=s?h.reduce((p,V)=>p+(V.pos[2]??0),0)/h.length:0;return ft(o.basis1,t,(c[0]-l[0])/2),ft(o.basis2,d,(c[1]-l[1])/2),bt(o.origin,l[0]*t[0]+l[1]*d[0],l[0]*t[1]+l[1]*d[1],w),X(o.origin,o.origin,o.basis1),X(o.origin,o.origin,o.basis2),q(o),o}export{bi as c,u as d,_i as i,ki as n,xi as r};
