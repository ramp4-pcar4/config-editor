import{ag as b,l as d,be as f,bo as F,Y as P,m as n,E as l,n as m}from"./index-BeTPrQ6f.js";import{m as h}from"./Field-Dn1Bgq7n-CJCGLoNR.js";import{u as k}from"./locationUtils-sOTPEtiz-Bwo0TKFc.js";import{E as q,V as v,X as x}from"./parquet-BKuoy8EM-tvadAp3d.js";let p=class extends F(P){constructor(e){super(e),this.type=null}};n([l({type:["wkb","location"],nonNullable:!0,readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],p.prototype,"type",void 0),p=n([m("esri.layers.support.ParquetEncodingBase")],p);let a=class extends p{constructor(e){super(e),this.type="location",this.latitudeFieldName=null,this.longitudeFieldName=null}};n([l({type:["location"]})],a.prototype,"type",void 0),n([l({type:String,json:{name:"yField",write:{isRequired:!0}}})],a.prototype,"latitudeFieldName",void 0),n([l({type:String,json:{name:"xField",write:{isRequired:!0}}})],a.prototype,"longitudeFieldName",void 0),a=n([m("esri.layers.support.ParquetEncodingLocation")],a);let u=class extends p{constructor(e){super(e),this.type="wkb",this.primaryFieldName=null}};n([l({type:["wkb"]})],u.prototype,"type",void 0),n([l({type:["counter-clockwise"],json:{write:!0}})],u.prototype,"orientation",void 0),n([l({type:String,json:{name:"field",write:{isRequired:!0}}})],u.prototype,"primaryFieldName",void 0),u=n([m("esri.layers.support.ParquetEncodingWkb")],u);const g=new b({esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint"});function J(e){return g.toJSON(e)}function M(e){return g.fromJSON(e)}async function X(e,r={}){if(e.urls.length<1)throw new d("parquet:bad-input","At least one url must be specified",e);if(e.geometryType&&e.spatialReference&&e.encoding&&e.fields)return e;const i=await q(e.urls.getItemAt(0),{getCustomParameters:()=>r.customParameters}),o=v(i),t={...e,file:i};t.fields==null&&(t.fields=i.fields().map(s=>h.fromJSON({name:s.name,alias:s.name,type:s.type}))),t.encoding==null&&(t.encoding=R(o,t.fields));const c=x(i);if(c)switch(c.mode){case"z":t.displayOptimization={mode:"z"};break;case"xz":{const s=c.multiscale;if(!s)throw new d("parquet:bad-format","XZ display optimization requires multiscale geometries");t.displayOptimization={mode:"xz",multiscale:s};break}}if(!t.encoding)return t;switch(t.encoding.type){case"location":t.spatialReference==null&&(t.spatialReference=f.WGS84),t.geometryType==null&&(t.geometryType="point");break;case"wkb":{if(!o)return t;const s=o.primary_column,y=o.columns[s];if(t.geometryType||(t.geometryType=z(y)),t.spatialReference||(t.spatialReference=O(y)),t.fields)for(const w of Object.keys(o.columns))t.fields=t.fields.filter(N=>N.name!==w)}}return t}function R(e,r){if(e!=null){const o=e.primary_column,t=e.columns[o];return new u({primaryFieldName:o,orientation:t.orientation==="counterclockwise"?"counter-clockwise":null})}const i=k(r.map(o=>o.name));return i.latitudeFieldName&&i.longitudeFieldName?new a({latitudeFieldName:i.latitudeFieldName,longitudeFieldName:i.longitudeFieldName}):null}function S(e){switch(e){case"Point":return"point";case"Polygon":case"MultiPolygon":return"polygon";case"LineString":return"polyline";case"MultiPoint":return"multipoint";default:return null}}function z(e){const{geometry_types:r}=e,i=new Set;for(const o of r){const t=S(o);t&&i.add(t)}if(i.size>1)throw new d("parquet:unsupported","Parquet mixed geometry types are not supported",{geometryTypes:i});return i.size===1?i.values().next().value:void 0}function O(e){var i,o;const r=(o=(i=e.crs)==null?void 0:i.id)==null?void 0:o.code;return r&&typeof r=="number"?new f({wkid:r}):void 0}export{M as R,X as S,a as l,p,u,J as x,g as y};
