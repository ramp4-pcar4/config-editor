import{bL as d,h as m,dS as b,N as v}from"./index-DRDU_nTl.js";async function P(e,t={},s){await e.load(s);const r=d(e.itemUrl,"resources"),{start:c=1,num:f=10,sortOrder:l="asc",sortField:u="resource"}=t,i={query:{start:c,num:f,sortOrder:l,sortField:u,token:e.apiKey},signal:s==null?void 0:s.signal},o=await e.portal.request(r,i);return{total:o.total,nextStart:o.nextStart,resources:o.resources.map(({created:n,size:p,resource:a})=>({created:new Date(n),size:p,resource:e.resourceFromPath(a)}))}}async function q(e,t,s,r){const c=new Map;for(const{resource:l,content:u,compress:i,access:o}of t){if(!l.hasPath())throw new m(`portal-item-resource-${s}:invalid-path`,"Resource does not have a valid path");const[n,p]=h(l.path),a=`${n}/${i??""}/${o??""}`;c.has(a)||c.set(a,{prefix:n,compress:i,access:o,files:[]}),c.get(a).files.push({fileName:p,content:u})}await e.load(r);const f=d(e.userItemUrl,s==="add"?"addResources":"updateResources");for(const{prefix:l,compress:u,access:i,files:o}of c.values())for(let n=0;n<o.length;n+=25){const p=o.slice(n,n+25),a=new FormData;l&&l!=="."&&a.append("resourcesPrefix",l),u&&a.append("compress","true"),i&&a.append("access",i);let w=0;for(const{fileName:g,content:y}of p)a.append("file"+ ++w,y,g);a.append("f","json"),await e.portal.request(f,{method:"post",body:a,signal:r==null?void 0:r.signal})}}async function F(e,t,s){if(!t.hasPath())throw new m("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(s);const r=d(e.userItemUrl,"removeResources");await e.portal.request(r,{method:"post",query:{resource:t.path},signal:s==null?void 0:s.signal}),t.portalItem=null}async function S(e,t){await e.load(t);const s=d(e.userItemUrl,"removeResources");return e.portal.request(s,{method:"post",query:{deleteAll:!0},signal:t==null?void 0:t.signal})}function h(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function x(e){const[t,s]=R(e),[r,c]=h(t);return[r,c,s]}function R(e){const t=b(e);return t==null?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function O(e){return e.type==="blob"?e.blob:e.type==="json"?new Blob([e.jsonString],{type:"application/json"}):(await v(e.url,{responseType:"blob"})).data}function N(e,t){if(!e.hasPath())return null;const[s,,r]=x(e.path);return e.portalItem.resourceFromPath(d(s,t+r))}export{q as addOrUpdateResources,O as contentToBlob,P as fetchResources,N as getSiblingOfSameTypeI,S as removeAllResources,F as removeResource,x as splitPrefixFileNameAndExtension};
