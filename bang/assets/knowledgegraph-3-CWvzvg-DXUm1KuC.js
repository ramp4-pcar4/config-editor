const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-CuOTexj3-DwZahOQ0.js","./index-BeTPrQ6f.js","./index-BlWAJbpo.css","./normalizeUtils-DK5542Ty-DtqBcgc2.js","./Cyclical-Bzwh_QaL-CXh-hbnA.js","./normalizeUtilsCommon-5DjefBp7-CQyUDMQp.js","./utils-CRANtbnc-C6zyufvL.js","./utils-t279O251-BBk6rV0U.js","./Field-Dn1Bgq7n-CJCGLoNR.js","./fieldType-DvW5hpfa-DYUbIy_X.js","./networkEnums-pU3LwrHA-Cj_1j_s1.js","./FeatureSet-BIUKCqNW-D9YRl-VE.js","./GPMessage-C73bJGrE-bx2Yrd3_.js","./Relationship-CxaLXN7a-hGAJ5x7P.js"])))=>i.map(i=>d[i]);
import{bW as x,s as w,_ as k,r as S,z as N,b5 as I,eg as E,b as L,be as W,K as j,bj as M}from"./index-BeTPrQ6f.js";import{t as O}from"./arcade-WEshytE2-CynglP9_.js";import{v as $,_ as D,ae as V,D as P,A as T,X as z,l as A,m as B,j as J,$ as K,L as F}from"./Dictionary-B0UU8VOj-BnHchtFP.js";import{c as u}from"./enum-D3e-PyKo-Bl5V5br5.js";import{n as U}from"./portalUtils-BQqUZtd_-DC5noOca.js";import{G as X,L as C,W as H}from"./projectionUtils-CsX1UTBu-DsZaU4xz.js";import Y from"./PortalItem-BrQqKoE_-zs2bKsCH.js";import{o as Z,v as tt}from"./project-DVSYTwmh-D1oJHtjg.js";import{s as rt,n as nt,d as et,a as it,u as ot}from"./Relationship-CxaLXN7a-hGAJ5x7P.js";import"./arcadeEnvironment-CGtXgdl9-Db3WjmFu.js";import"./Feature-DEFbFbhW-MI6BQTTC.js";import"./TimeOnly-BFfVS_ja-C4MPGwCM.js";import"./UnknownTimeZone-DzO8gKMe-d6rtFXqm.js";import"./featureConversionUtils-CZmIxyv5-DHwRSztU.js";import"./OptimizedFeature-C33SioFK-sn7DeAq-.js";import"./memoryEstimations-C_GUL8g_-JniNFd5l.js";import"./OptimizedGeometry-BYxlP_oK-DvAqrgO1.js";import"./OptimizedFeatureSet-Dz5hF8Qm-CgsRgxJh.js";import"./FieldsIndex-Ds4D9xP7-BiTuE5Z3.js";import"./timeZoneUtils-CdK7eU4Y-fyhJ3EFx.js";import"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import"./shared-DXZ65waB-BM-XH3jC.js";import"./Field-Dn1Bgq7n-CJCGLoNR.js";import"./fieldType-DvW5hpfa-DYUbIy_X.js";import"./number-BsNxu9Ry-D0lLRJTw.js";import"./aiServices-BhAKf1Iw-D6L8gru6.js";import"./commonProperties-D1Pjvz5u-DHiB1uzW.js";import"./utils-CRANtbnc-C6zyufvL.js";import"./WhereClause-DrmAQ3eI-CwdMrUuP.js";import"./streamLayerUtils-CcwO9-27-DFlbJ4P1.js";import"./unitConversion-Dsm_H0Dm-eZfwiAJA.js";import"./uuid-CFz2qBzH-cIdlpVG-.js";import"./projectBuffer-CMNsPBq1-CMpE7Jo3.js";import"./zscale-PLuFqpaL-BIEnWBsg.js";import"./utils-t279O251-BBk6rV0U.js";let c=null;async function at(t){const r=L.geometryServiceUrl??"";if(!r){X()||await C();for(const n of t)n.container[n.indexer]=H(n.container[n.indexer],W.WGS84);return}const e=t.map(n=>n.container[n.indexer]),o=new Z({geometries:e,outSpatialReference:W.WGS84}),s=await tt(r,o);for(let n=0;n<s.length;n++){const i=t[n];i.container[i.indexer]=s[n]}}async function G(t,r){const e=new Y({portal:t,id:r});return await e.load(),c===null&&(c=await k(()=>import("./knowledgeGraphService-CuOTexj3-DwZahOQ0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url).then(o=>o.k)),await c.fetchKnowledgeGraph(e.url)}function R(t,r,e,o,s){if(t===null)return null;if(w(t)||N(t))return t;if(A(t)||A(t))return t.toJSDate();if(B(t))return t.toStorageFormat();if(J(t))return t.toStorageString();if(K(t)){const n={};for(const i of t.keys())n[i]=R(t.field(i),r,e,o,s),n[i]instanceof I&&s.push({container:n,indexer:i});return n}if(S(t)){const n=t.map(i=>R(i,r,e,o,s));for(let i=0;i<n.length;i++)n[i]instanceof I&&s.push({container:n,indexer:i});return n}return F(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&r?E(t):t:void 0}function st(t,r){if(!t)return t;if(t.spatialReference.isWGS84&&r.spatialReference.isWebMercator)return M(t);if(t.spatialReference.equals(r.spatialReference))return t;throw new u(r,"WrongSpatialReference",null)}function v(t,r){if(!t)return null;const e={};for(const o in t)e[o]=d(t[o],r);return e}function d(t,r){return t===null?null:S(t)?t.map(e=>d(e,r)):t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:v(t.properties,r)}:t instanceof et?{graphType:"object",properties:v(t.properties,r)}:t instanceof it?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:v(t.properties,r)}:t instanceof ot?{graphType:"path",path:t.path?t.path.map(e=>d(e,r)):null}:F(t)?st(t,r):w(t)||N(t)||j(t)?t:null}function Vt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(r,e){return t.standardFunctionAsync(r,e,(o,s,n)=>{var f,m;if($(n,2,2,r,e),n[0]===null)throw new u(r,"PortalRequired",e);if(n[0]instanceof O){const l=D(n[1]);let h;return h=(f=r.services)!=null&&f.portal?r.services.portal:x.getDefault(),G(U(n[0],h),l)}if(w(n[0])===!1)throw new u(r,"InvalidParameter",e);const i=D(n[0]);return G(((m=r.services)==null?void 0:m.portal)??x.getDefault(),i)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(r,e){return t.standardFunctionAsync(r,e,async(o,s,n)=>{var b;$(n,2,4,r,e);const i=n[0];if(!V(i))throw new u(r,"InvalidParameter",e);const f=n[1];if(!w(f))throw new u(r,"InvalidParameter",e);c===null&&(c=await k(()=>import("./knowledgeGraphService-CuOTexj3-DwZahOQ0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url).then(a=>a.k));let m=null;const l=P(n[2],null);if(!(l instanceof T||l===null))throw new u(r,"InvalidParameter",e);if(l){let a=[];m=R(l,!0,!1,r,a),a=a.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),a.length>0&&await at(a)}const h=P(n[3],!1),_=new rt({openCypherQuery:f,bindParameters:m,provenanceBehavior:h?"include":"exclude"});(((b=i==null?void 0:i.serviceDefinition)==null?void 0:b.currentVersion)??11.3)>11.2&&(_.outputSpatialReference=r.spatialReference);const Q=(await c.executeQueryStreaming(i,_)).resultRowsStream.getReader(),y=[];try{for(;;){const{done:a,value:p}=await Q.read();if(a)break;if(S(p))for(const g of p)y.push(d(g,r));else{const g=[];for(const q of p)g.push(d(p[q],r));y.push(g)}}}catch(a){throw a}return T.convertJsonToArcade(y,z(r),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{Vt as registerFunctions};
