const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ElevationQuery-BY0HtgLp-Ci4Eid_r.js","./asyncUtils-BPUlNCrX-BS2LVKAY.js","./index-JysQxb7m.js","./index-BQSptJp9.css","./projectionUtils-B-CplN3q-DYZZu_-u.js","./TileKey-B_6qmYK--BtZdR-Xy.js","./layersCreator-BUP_XUvO-DCrrncFB.js","./loadUtils-B4p6zboh-DUvFKnin.js","./fetchService-IPSkq0MP-DH3vOeo6.js","./associatedFeatureServiceUtils-5tlRvHRs-BucD56Fh.js","./PortalItem-BP-IQXnZ-q--yZGhn.js","./lazyLayerLoader-zoCpoQZ8-Inv2lqrg.js","./portalLayers-CI9PJ-2j-DoKAgNK-.js","./portalItemUtils-BfWDJg-S-Da4taYqM.js","./styleUtils-BnJpZ0Gl-BFeelRje.js"])))=>i.map(i=>d[i]);
import{v as s,bf as k,S as a,n as c,X as f,al as U,a0 as w,aM as z,a6 as _,ak as L,a5 as W,bg as H,h as V,_ as O,u as A,q as $,F as K,bh as x,bi as Q,bj as X,ad as P,x as N,bk as Y,N as Z,w as ee,K as te,ac as re,I as E,bl as oe,bm as B}from"./index-JysQxb7m.js";import{O as g,a as G}from"./Basemap-C_NhFN5u-DWhoo9Ja.js";import{d as se}from"./loadAll-DQWsVoX1-c-a3zMTV.js";import{e as F}from"./CollectionFlattener-DyEG1Q6J-Bta-Vg1j.js";import{r as ae}from"./uuid-Dj9mdEVg-BaKSCiyT.js";import{k as ie}from"./persistable-DgPk2hdg-CoT2ojhC.js";import{h as m}from"./PolygonCollection-Btw6sA7T-C5-etvgL.js";import{c as ne}from"./editableLayers-DFUBlMJy-CghCkhUG.js";import"./mat4f32-BdRMyjXW-CWt6U0BP.js";import"./mat4-OOmHNWi7-d4wDSfI3.js";import{w as le,x as pe,g as de}from"./TablesMixin-BORwbVPt-zJEn_uQN.js";import"./PortalItem-BP-IQXnZ-q--yZGhn.js";import"./intl-BAA1onnp-C2vVW-wX.js";import"./writeUtils-DAOvycBP-CY3M4MTP.js";import"./asyncUtils-BPUlNCrX-BS2LVKAY.js";import"./MD5-CXHDUqXT-CMrYdOi6.js";import"./multiOriginJSONSupportUtils-DGETddQl-BrWaY9_8.js";import"./resourceExtension-DCCj0Izs-IQKkVN6H.js";import"./projectionUtils-B-CplN3q-DYZZu_-u.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./Layer-DvVVmz9x-CQh7OSfC.js";import"./TimeExtent-Cf2Pienb-DstDmVgA.js";var C;let b=C=class extends f{constructor(e){super(e),this.type="none"}clone(){return new C({type:this.type})}};s([k({none:"none",stayAbove:"stay-above"}),a({json:{write:{isRequired:!0}}})],b.prototype,"type",void 0),b=C=s([c("esri.ground.NavigationConstraint")],b);const ye=Symbol("GroundInstance");var R,j,J;let p=j=(J=class extends f.JSONSupportMixin(U){constructor(e){super(e),this[R]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new w;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&_.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},o=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>o(r.item))])}initialize(){this.when().catch(e=>{z(e)||_.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)L(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}get layers(){return this._get("layers")}set layers(e){this._set("layers",W(e,this._get("layers")))}writeLayers(e,t,o,r){const i=[];e&&(r={...r,layerContainerType:"ground"},e.forEach(l=>{if("write"in l){const y={};H(l)().write(y,r)&&i.push(y)}else r!=null&&r.messages&&r.messages.push(new V("layer:unsupported",`Layers (${l.title}, ${l.id}) of type '${l.declaredClass}' cannot be persisted in the ground`,{layer:l}))})),t.layers=i}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return se(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:o}=await O(()=>import("./ElevationQuery-BY0HtgLp-Ci4Eid_r.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);A(t);const r=new o,i=this.layers.filter(q).toArray();return r.queryAll(i,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:o}=await O(()=>import("./ElevationQuery-BY0HtgLp-Ci4Eid_r.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);A(t);const r=new o,i=this.layers.filter(q).toArray();return r.createSamplerAll(i,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:$(this.surfaceColor),navigationConstraint:$(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new j({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,o){const r=(t==null?void 0:t.origin)||"web-scene",i=(t==null?void 0:t.portal)||null,l=(t==null?void 0:t.url)||null,{populateOperationalLayers:y}=await O(async()=>{const{populateOperationalLayers:I}=await import("./layersCreator-BUP_XUvO-DCrrncFB.js");return{populateOperationalLayers:I}},__vite__mapDeps([6,2,3,7,8,9,10,11,12,13,4,14,1]),import.meta.url);A(o);const u=[];if(e.layers&&Array.isArray(e.layers)){const I={context:{origin:r,url:l,portal:i,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};u.push(y(this.layers,e.layers,I))}await Promise.allSettled(u)}},R=ye,J);function ce(e){return e&&"createElevationSampler"in e}function q(e){return e.type==="elevation"||ce(e)}s([a({json:{read:!1,write:{isRequired:!0}}})],p.prototype,"layers",null),s([K("layers")],p.prototype,"writeLayers",null),s([a({readOnly:!0})],p.prototype,"resourceInfo",void 0),s([a({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:x,read:{reader:Q,source:"transparency"},write:{writer:(e,t)=>{t.transparency=X(e)},target:"transparency"}}})],p.prototype,"opacity",void 0),s([a({type:P,json:{type:[x],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],p.prototype,"surfaceColor",void 0),s([a({type:b,json:{write:!0}})],p.prototype,"navigationConstraint",void 0),p=j=s([c("esri.Ground")],p);const S=p;let v=class extends N.ClonableMixin(f){constructor(e){super(e),this.color=null}};s([a({type:P,json:{type:[x],write:!0}})],v.prototype,"color",void 0),v=s([c("esri.effects.FocusAreaOutline")],v);const ue=v;let d=class extends f.JSONSupportMixin(N){constructor(e){super(e),this.id=`focusarea-${ae()}`,this.title=null,this.enabled=!0,this.outline=null,this.geometries=new m}readGeometries(e,t,o){var r,i;Array.isArray(e)?this.geometries=m.fromJSON(e,o):(i=(r=o.hooks)==null?void 0:r.onAfterLoad)==null||i.call(r,()=>this._loadGeometries(Y(e,o),o))}async _loadGeometries(e,t){const o=await Z(e,{responseType:"json"});this.geometries=m.fromJSON(o.data,t)}};s([a({type:String,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),a()],d.prototype,"id",void 0),s([a({type:String,json:{write:!0}})],d.prototype,"title",void 0),s([a({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],d.prototype,"enabled",void 0),s([a({type:ue,json:{write:!0}})],d.prototype,"outline",void 0),s([a({type:m,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new m(e.items.map(t=>t.clone()))}),ie({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],d.prototype,"geometries",void 0),s([ee(["web-scene","portal-item"],"geometries")],d.prototype,"readGeometries",null),d=s([c("esri.effects.FocusArea")],d);const he=d;let h=class extends f.JSONSupportMixin(N){constructor(e){super(e),this.areas=new w,this.style="bright"}};s([a({type:w.ofType(he),nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new w(e.items.map(t=>t.clone()))})],h.prototype,"areas",void 0),s([a({type:["bright","dark"],nonNullable:!0,json:{write:!0}})],h.prototype,"style",void 0),h=s([c("esri.effects.FocusAreas")],h);const D=h,T=()=>_.getLogger("esri.support.basemapUtils");function me(){return{}}function fe(e){for(const t in e){const o=e[t];L(o),delete e[t]}}function ge(e,t){let o;if(typeof e=="string"){const r=e in G,i=!r&&e.includes("/");if(!r&&!i){if(oe())T().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const l=Object.entries(G).filter(([y,u])=>u.classic||u.is3d).map(([y])=>`"${y}"`).sort().join(", ");T().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${l}`)}return null}t&&(o=t[e]),o||(o=r?g.fromId(e):new g({style:{id:e}}),t&&(t[e]=o))}else o=B(g,e);return o!=null&&o.destroyed&&(T().warn("The provided basemap is already destroyed",{basemap:o}),o=null),o}const M={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function be(e){let t=null;if(typeof e=="string")if(e in M){const o=M[e];t=new S({resourceInfo:{data:{layers:[o]}}})}else _.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=B(S,e);return t}let n=class extends le(pe(te.EventedMixin(re))){constructor(e){super(e),this.allLayers=new F({getCollections:()=>{var t,o,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(o=this.ground)==null?void 0:o.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.focusAreas=new D,this.allTables=de(this),this.basemap=null,this.editableLayers=new F({getCollections:()=>[this.allLayers],itemFilterFunction:ne}),this.ground=new S,this._basemapCache=me()}destroy(){fe(this._basemapCache),this._basemapCache=null,this.focusAreas.destroy(),this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=L(this.basemap),L(this.ground),this._set("ground",null)}castBasemap(e){return ge(e,this._basemapCache)}castGround(e){return be(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};s([a({readOnly:!0,dependsOn:[]})],n.prototype,"allLayers",void 0),s([a({type:D,nonNullable:!0,json:{write:{overridePolicy:e=>({enabled:e.areas.length>0,ignoreOrigin:!0})}}})],n.prototype,"focusAreas",void 0),s([a({readOnly:!0})],n.prototype,"allTables",void 0),s([a({type:g,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],n.prototype,"basemap",void 0),s([E("basemap")],n.prototype,"castBasemap",null),s([a({readOnly:!0})],n.prototype,"editableLayers",void 0),s([a({type:S,nonNullable:!0})],n.prototype,"ground",void 0),s([E("ground")],n.prototype,"castGround",null),s([a()],n.prototype,"undoRedo",void 0),n=s([c("esri.Map")],n);const Be=n;export{Be as default};
