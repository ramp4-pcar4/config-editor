import{gj as g,gk as p}from"./index-BeTPrQ6f.js";import{B as S}from"./CIMSymbolHelper-C-M9oL19-BYnF76mM.js";import{CIMSymbolRasterizer as R}from"./CIMSymbolRasterizer-BqBQ5vb8-uiaE78vH.js";import{OverrideHelper as q}from"./OverrideHelper-RCCoK8tw-ysetE5jH.js";import{j as F}from"./utils-CIm5uQvO-CtKf129F.js";import{o as D}from"./symbolUtils-BWODOwTq-BEtrWlLF.js";import"./BidiEngine-DXDmu_WZ-DxL95DSc.js";import"./labelPoint-DTWBMY-Z-DoXEvKTt.js";import"./OptimizedGeometry-BYxlP_oK-DvAqrgO1.js";import"./memoryEstimations-C_GUL8g_-JniNFd5l.js";import"./GeometryUtils-C8-DjR3I-DcNL1Jc6.js";import"./fontUtils-bOFLFKCC-gLU2ItK2.js";import"./defaultCIMValues-BWu-APou-XI-Li77m.js";import"./rasterizingUtils-Cf1zdzIw-BfJyHaiy.js";import"./definitions-DVO21zOC-BwakNu1s.js";import"./mat2d-Cf4xHr3Z-u09Kv-lR.js";import"./mat2df32-fg3OHsAI-BF2V2zqo.js";import"./vec2f32-hTAvipMV-C0AQcwEv.js";import"./Rect-DD6XS68q-D_hsV3ag.js";import"./BoundingBox-DlCd_wcU-DBB4UfPl.js";import"./CIMResourceManager-CcSrCojH-Bt2v7OJu.js";import"./imageUtils-DITyjHV4-jEv5aA2D.js";import"./colorUtils-DlmOacVt-BnN0T6wa.js";import"./vec42-DHp-FUwt-Br7hmYJs.js";import"./vec4f64-DD-nkcCV-CSNWKRqG.js";import"./FieldsIndex-Ds4D9xP7-BiTuE5Z3.js";import"./UnknownTimeZone-DzO8gKMe-d6rtFXqm.js";import"./timeZoneUtils-CdK7eU4Y-fyhJ3EFx.js";import"./ArcadeExpression-BGPPS6z--7N6gsB31.js";import"./TimeOnly-BFfVS_ja-C4MPGwCM.js";import"./enum-D3e-PyKo-Bl5V5br5.js";import"./callExpressionWithFeature-C8T2jtcK-BKO8mxzd.js";import"./quantizationUtils-Ba9rpy9D-8ijlY328.js";import"./utils-DvP1Tc7W-CK5sH9q2.js";import"./asyncUtils-Cu__bxqs-ecCTUaGV.js";import"./jsonUtils-Bl9MVnOR-Be8hf0yA.js";import"./parser-CXoJuqeV-C7irlk5U.js";import"./mat4f32-BdRMyjXW-CWt6U0BP.js";import"./mat4-R0VY9B_E-DoEP887i.js";import"./cimSymbolUtils-BJ01Nooc-BfOR3Irv.js";import"./LRUCache-CvGiiws0-B3io5Jp4.js";import"./MemCache-TG-MhOJy-BkjKRNR7.js";import"./jsxFactory-DN-m49_5-CUFCpKPo.js";import"./intl-DRhjUnwt-Dihhq8dq.js";import"./messages-DQ10DjvF-6kk0dzjG.js";import"./uuid-CFz2qBzH-cIdlpVG-.js";import"./sanitizerUtils-CrdmaILo-DztC6Qnx.js";const d=new R(null),u=p(22),I=p(120),v=p(50),E=1;async function H(o,t,l){const r=t==null?void 0:t.size;let i=r!=null&&typeof r=="object"&&"width"in r?r.width:r,m=r!=null&&typeof r=="object"&&"height"in r?r.height:r;if(!i||!m)if(l==="esriGeometryPolygon")i=m=t.maxSize?Math.min(t.maxSize,u):u;else{const n=await k(o,t,l);n&&(i=n.width,m=n.height),l==="esriGeometryPolyline"&&(i=t.maxSize?Math.min(t.maxSize,v):v),i=i!=null&&isFinite(i)?Math.min(i,I):u,m=m!=null&&isFinite(m)?Math.max(Math.min(m,I),E):u}return t.style==="legend"&&l==="esriGeometryPolyline"&&(i=v),{width:i,height:m}}async function k(o,t={},l){var h;const r=t.cimOptions||t;l??(l=r.geometryType||F((h=o==null?void 0:o.data)==null?void 0:h.symbol));const{feature:i,fieldMap:m,viewParams:n}=r,a=await q.resolveSymbolOverrides(o.data,i,null,m,l,null,n);if(!a)return null;(o=o.clone()).data={type:"CIMSymbolReference",symbol:a},o.data.primitiveOverrides=void 0;const e=[];return S.fetchResources(a,d.resourceManager,e),S.fetchFonts(a,d.resourceManager,e),e.length>0&&await Promise.all(e),S.getEnvelope(a,null,d.resourceManager)}async function Lt(o,t={}){var C,x;const{node:l,opacity:r,symbolConfig:i}=t,m=i!=null&&typeof i=="object"&&"isSquareFill"in i&&i.isSquareFill,n=t.cimOptions||t,a=n.geometryType||F((C=o==null?void 0:o.data)==null?void 0:C.symbol),e=await H(o,t,a),{feature:h,fieldMap:G}=n,O=t!=null&&t.geometry||m||a!=="esriGeometryPolygon"?"preview":"legend";let P=e;const z=e;if(t!=null&&t.geometry&&(a==="esriGeometryPolygon"||a==="esriGeometryPolyline")&&(g(e.width)<200||g(e.height)<200)){const M=e.width>e.height?p(200)*e.height/e.width:p(200);P={width:e.width>e.height?p(200):p(200)*e.width/e.height,height:M}}const f=await d.rasterizeCIMSymbolAsync(o,h,P,O,G,a,null,n.viewParams,n.allowScalingUp,(x=t==null?void 0:t.geometry)==null?void 0:x.toJSON());if(!f)return null;const{width:j,height:L}=f,c=document.createElement("canvas");c.width=j,c.height=L,c.getContext("2d").putImageData(f,0,0);const w=g(z.width),b=g(z.height),s=new Image(w,b);s.src=c.toDataURL(),s.ariaLabel=t.ariaLabel??null,s.alt=t.ariaLabel??"",r!=null&&(s.style.opacity=`${r}`);let y=s;if(t.cssEffectFilter){const M={shape:{type:"image",x:0,y:0,width:w,height:b,src:s.src},fill:null,stroke:null,offset:[0,0]};y=D([[M]],[w,b],t)}return l&&y&&l.appendChild(y),y}export{k as getCIMSymbolPreviewSize,Lt as previewCIMSymbol};
