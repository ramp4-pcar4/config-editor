const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./GroupLayer-CroYvxEb-tQelvnh7.js","./index-DRDU_nTl.js","./index-6GCfk1Ih.css","./CollectionFlattener-DyEG1Q6J-CX4KYnzI.js","./loadAll-DQWsVoX1-B6Kwb4K3.js","./asyncUtils-BPUlNCrX-B0y5b9rY.js","./MultiOriginJSONSupport-BqiFJbbt-DHUs1Le_.js","./Layer-DvVVmz9x-KWeeum0v.js","./TimeExtent-Cf2Pienb-B-fbcJgZ.js","./BlendLayer-DjW_5k0v-B-iv8FvS.js","./layerContainerType-ChWdCT09-G5sdAsSy.js","./jsonUtils-BwLwuQj7-Bs5cxcDn.js","./parser-CWccHtwJ-8TX6iggd.js","./mat4f32-BdRMyjXW-CWt6U0BP.js","./mat4-OOmHNWi7-DudBwkox.js","./common-CYWrYyJl-E8-sukrT.js","./OperationalLayer-CbXUnTH0-DDbWRrTr.js","./ElevationInfo-DE5to86a-BmmpBl1B.js","./lengthUtils-C61nRlXw-ttxBda7R.js","./PortalLayer-B34ZUA2x-BPfkadbV.js","./PortalItem-BP-IQXnZ-BpV17zma.js","./portalItemUtils-BfWDJg-S-B_p9oXKP.js","./projectionUtils-B-CplN3q-B7QPK1Xx.js","./ScaleRangeLayer-x42fwED3-_jUPFtou.js","./layersCreator-BUP_XUvO-D-4S9FIW.js","./loadUtils-B4p6zboh-B_L1ncXe.js","./fetchService-IPSkq0MP-BrJkQx9U.js","./associatedFeatureServiceUtils-5tlRvHRs-BvGVvkLr.js","./lazyLayerLoader-zoCpoQZ8-BXdOXrhY.js","./portalLayers-CI9PJ-2j-C7nIN5cj.js","./styleUtils-BnJpZ0Gl-CWN099EX.js","./TablesMixin-BORwbVPt-BTmIdbrD.js","./interfaces-Cwm0pihk-Ptzy6gTd.js","./saveUtils-W0sSii7v-3Bw9btmg.js","./writeUtils-DAOvycBP-TEGxhpVZ.js"])))=>i.map(i=>d[i]);
import{_ as F,bC as _,h as v,iy as C,iz as N,iA as V,M as k,iu as g}from"./index-DRDU_nTl.js";import{q as J}from"./associatedFeatureServiceUtils-5tlRvHRs-BvGVvkLr.js";import{o as f,g as S,b as M}from"./fetchService-IPSkq0MP-BrJkQx9U.js";import{t as x}from"./lazyLayerLoader-zoCpoQZ8-BXdOXrhY.js";import"./PortalItem-BP-IQXnZ-BpV17zma.js";const E={FeatureLayer:!0,SceneLayer:!0,VideoLayer:!0};async function B(e){const{properties:l,url:r}=e,a={...l,url:r},n=await D(r,l==null?void 0:l.customParameters),{Constructor:t,layerId:c,sourceJSON:u,parsedUrl:y,layers:o,tables:m}=n;if(o.length+m.length===0)return c!=null&&(a.layerId=c),u!=null&&(a.sourceJSON=u),new t(a);const d=new(await F(async()=>{const{default:w}=await import("./GroupLayer-CroYvxEb-tQelvnh7.js");return{default:w}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34]),import.meta.url)).default({title:y.title});return await G(d,n,a),d}function O(e,l){return e?e.find(({id:r})=>r===l):null}function U(e,l,r,a,n){const t={...n,layerId:l};return e!=null&&(t.url=e),r!=null&&(t.sourceJSON=r),"sublayerTitleMode"in a.prototype&&(t.sublayerTitleMode="service-name"),new a(t)}async function G(e,l,r){const a=l.sublayerConstructorProvider;for(const{id:n,serverUrl:t}of l.layers){const c=O(l.sublayerInfos,n),u=U(t,n,c,(c&&(a==null?void 0:a(c)))??l.Constructor,r);e.add(u)}if(l.tables.length){const n=await b("FeatureLayer");l.tables.forEach(({id:t,serverUrl:c})=>{const u=U(c,t,O(l.tableInfos,t),n,r);e.tables.add(u)})}}async function D(e,l){var m,d,w,h,I,L,P;let r=_(e);if(r==null&&(r=await $(e,l)),r==null)throw new v("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:e});const{serverType:a,sublayer:n}=r;let t;const c={FeatureServer:"FeatureLayer",KnowledgeGraphServer:"KnowledgeGraphLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer",VideoServer:"VideoLayer"},u=a==="FeatureServer",y=a==="SceneServer",o={parsedUrl:r,Constructor:null,layerId:u||y?n??void 0:void 0,layers:[],tables:[]};switch(a){case"MapServer":if(n!=null){const{type:s}=await f(e,{customParameters:l});switch(t="FeatureLayer",s){case"Catalog Layer":t="CatalogLayer";break;case"Catalog Dynamic Group Layer":throw new v("arcgis-layers:unsupported",`fromUrl() not supported for "${s}" layers`)}}else t=await z(e,l)?"TileLayer":"MapImageLayer";break;case"ImageServer":{const s=await f(e,{customParameters:l}),{tileInfo:i,cacheType:p}=s;t=i?((m=i==null?void 0:i.format)==null?void 0:m.toUpperCase())!=="LERC"||p&&p.toLowerCase()!=="elevation"?"ImageryTileLayer":"ElevationLayer":"ImageryLayer";break}case"SceneServer":{const s=await f(r.url.path,{customParameters:l});if(t="SceneLayer",s){const i=s==null?void 0:s.layers;if((s==null?void 0:s.layerType)==="Voxel")t="VoxelLayer";else if(i!=null&&i.length){const p=(d=i[0])==null?void 0:d.layerType;p!=null&&g[p]!=null&&(t=g[p])}}break}case"3DTilesServer":throw new v("arcgis-layers:unsupported","fromUrl() not supported for 3DTiles layers");case"FeatureServer":if(t="FeatureLayer",n!=null){const s=await f(e,{customParameters:l});o.sourceJSON=s,o.preferredUrl=C(),t=S(s.type)}break;default:t=c[a]}if(E[t]&&n==null){const s=await A(e,a,l);if(u&&(o.preferredUrl=s.preferredUrl,o.sublayerInfos=s.layerInfos,o.tableInfos=s.tableInfos),s.layers.length+s.tables.length!==1)o.layers=s.layers,o.tables=s.tables,u&&((w=s.layerInfos)!=null&&w.length)&&(o.sublayerConstructorProvider=await H(s.layerInfos));else if(u||y){const i=((h=s.layerInfos)==null?void 0:h[0])??((I=s.tableInfos)==null?void 0:I[0]);if(o.layerId=((L=s.layers[0])==null?void 0:L.id)??((P=s.tables[0])==null?void 0:P.id),o.sourceJSON=i,u){const p=i==null?void 0:i.type;t=S(p)}}}return o.Constructor=await b(t),o}async function $(e,l){var u;const r=await f(e,{customParameters:l});let a=null,n=null;const t=r.type;if(t==="Feature Layer"||t==="Table"?(a="FeatureServer",n=r.id??null):t==="indexedVector"?a="VectorTileServer":r.hasOwnProperty("mapName")?a="MapServer":r.hasOwnProperty("bandCount")&&r.hasOwnProperty("pixelSizeX")?a="ImageServer":r.hasOwnProperty("maxRecordCount")&&r.hasOwnProperty("allowGeometryUpdates")?a="FeatureServer":r.hasOwnProperty("streamUrls")?a="StreamServer":T(r)?(a="SceneServer",n=r.id):r.hasOwnProperty("layers")&&T((u=r.layers)==null?void 0:u[0])&&(a="SceneServer"),!a)return null;const c=n!=null?N(e):null;return{title:c!=null&&r.name||V(e),serverType:a,sublayer:n,url:{path:c!=null?c.serviceUrl:k(e).path}}}function T(e){return e!=null&&e.hasOwnProperty("store")&&e.hasOwnProperty("id")&&typeof e.id=="number"}async function A(e,l,r){let a,n,t,c=!1;switch(l){case"FeatureServer":{const o=await M(e,{customParameters:r});t=C(e,{preferredHost:o.preferredHost}),c=!!o.layersJSON,a=o.layersJSON||o.serviceJSON;break}case"SceneServer":{const o=await R(e,r);a=o.serviceInfo,n=o.tableServerUrl;break}default:a=await f(e,{customParameters:r})}const u=a==null?void 0:a.layers,y=a==null?void 0:a.tables;return{preferredUrl:t,layers:(u==null?void 0:u.map(o=>({id:o.id})).reverse())||[],tables:(y==null?void 0:y.map(o=>({serverUrl:n,id:o.id})).reverse())||[],layerInfos:c?u:[],tableInfos:c?y:[]}}async function R(e,l){var a;const r=await f(e,{customParameters:l});if(!((a=r.layers)!=null&&a[0]))return{serviceInfo:r};try{const{serverUrl:n}=await J(e),t=await f(n,{customParameters:l}).catch(()=>null);return t&&(r.tables=t.tables),{serviceInfo:r,tableServerUrl:n}}catch{return{serviceInfo:r}}}async function b(e){return(0,x[e])()}async function z(e,l){return(await f(e,{customParameters:l})).tileInfo}async function H(e){if(!e.length)return;const l=new Set,r=[];for(const{type:t}of e)l.has(t)||(l.add(t),r.push(b(S(t))));const a=await Promise.all(r),n=new Map;return Array.from(l).forEach((t,c)=>{n.set(t,a[c])}),t=>n.get(t.type)}export{B as fromUrl};
