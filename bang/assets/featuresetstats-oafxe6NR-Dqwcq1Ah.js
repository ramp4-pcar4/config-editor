import{i as d}from"./TimeOnly-BFfVS_ja-C4MPGwCM.js";import{x as A,l as u}from"./arcade-WEshytE2-CynglP9_.js";import{c as l}from"./enum-D3e-PyKo-Bl5V5br5.js";import{v as p,U as c,w as m,$ as w,J as h,D as s,X as v}from"./Dictionary-B0UU8VOj-BnHchtFP.js";import{L as y,i as S}from"./WhereClause-DrmAQ3eI-CwdMrUuP.js";import{r as f,s as x,w as I}from"./index-BeTPrQ6f.js";import"./UnknownTimeZone-DzO8gKMe-d6rtFXqm.js";import"./arcadeEnvironment-CGtXgdl9-Db3WjmFu.js";import"./Feature-DEFbFbhW-MI6BQTTC.js";import"./featureConversionUtils-CZmIxyv5-DHwRSztU.js";import"./OptimizedFeature-C33SioFK-sn7DeAq-.js";import"./memoryEstimations-C_GUL8g_-JniNFd5l.js";import"./OptimizedGeometry-BYxlP_oK-DvAqrgO1.js";import"./OptimizedFeatureSet-Dz5hF8Qm-CgsRgxJh.js";import"./FieldsIndex-Ds4D9xP7-BiTuE5Z3.js";import"./timeZoneUtils-CdK7eU4Y-fyhJ3EFx.js";import"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import"./shared-DXZ65waB-BM-XH3jC.js";import"./Field-Dn1Bgq7n-CJCGLoNR.js";import"./fieldType-DvW5hpfa-DYUbIy_X.js";import"./number-BsNxu9Ry-D0lLRJTw.js";import"./aiServices-BhAKf1Iw-D6L8gru6.js";import"./commonProperties-D1Pjvz5u-DHiB1uzW.js";import"./utils-CRANtbnc-C6zyufvL.js";import"./streamLayerUtils-CcwO9-27-DFlbJ4P1.js";import"./unitConversion-Dsm_H0Dm-eZfwiAJA.js";import"./uuid-CFz2qBzH-cIdlpVG-.js";async function i(a,r,t,e){if(t.length===1){if(f(t[0]))return u(a,t[0],s(t[1],-1));if(m(t[0]))return u(a,t[0].toArray(),s(t[1],-1))}else if(t.length===2){if(f(t[0]))return u(a,t[0],s(t[1],-1));if(m(t[0]))return u(a,t[0].toArray(),s(t[1],-1));if(c(t[0])){const o=await t[0].load(),n=await F(y.create(t[1],{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}),e,r);return g(r,await t[0].calculateStatistic(a,n,s(t[2],1e3),r.abortSignal))}}else if(t.length===3&&c(t[0])){const o=await t[0].load(),n=await F(y.create(t[1],{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}),e,r);return g(r,await t[0].calculateStatistic(a,n,s(t[2],1e3),r.abortSignal))}return u(a,t,-1)}function g(a,r){return r instanceof S?d.fromReaderAsTimeStampOffset(r.toStorageFormat()):r instanceof Date?d.dateJSAndZoneToArcadeDate(r,v(a)):r}async function F(a,r,t){const e=a.getVariables();if(e.length>0){const o={};for(const n of e)o[n]=r.evaluateIdentifier(t,{name:n});a.parameters=o}return a}function Y(a){a.mode==="async"&&(a.functions.stdev=function(r,t){return a.standardFunctionAsync(r,t,(e,o,n)=>i("stdev",r,n,a))},a.functions.variance=function(r,t){return a.standardFunctionAsync(r,t,(e,o,n)=>i("variance",r,n,a))},a.functions.average=function(r,t){return a.standardFunctionAsync(r,t,(e,o,n)=>i("mean",r,n,a))},a.functions.mean=function(r,t){return a.standardFunctionAsync(r,t,(e,o,n)=>i("mean",r,n,a))},a.functions.sum=function(r,t){return a.standardFunctionAsync(r,t,(e,o,n)=>i("sum",r,n,a))},a.functions.min=function(r,t){return a.standardFunctionAsync(r,t,(e,o,n)=>i("min",r,n,a))},a.functions.max=function(r,t){return a.standardFunctionAsync(r,t,(e,o,n)=>i("max",r,n,a))},a.functions.count=function(r,t){return a.standardFunctionAsync(r,t,async(e,o,n)=>{if(p(n,1,1,r,t),n[0]==null)return 0;if(c(n[0]))return n[0].count(e.abortSignal);if(f(n[0])||x(n[0]))return n[0].length;if(m(n[0]))return n[0].length();if(w(n[0]))return n[0].entryCount();throw new l(r,"InvalidParameter",t)})},a.functions.isempty=function(r,t){return a.standardFunctionAsync(r,t,async(e,o,n)=>{if(p(n,1,2,e,o),n.length>=2&&!I(n[1]))throw new l(e,"InvalidParameter",o);return s(n[1],!1)?c(n[0])?await n[0].isEmpty(e.abortSignal):A(n[0]):h(n[0])})})}export{Y as registerFunctions};
