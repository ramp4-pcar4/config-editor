import{g as a}from"./utils-CRANtbnc-C6zyufvL.js";import{t as p,v as u,cl as c}from"./index-BeTPrQ6f.js";import{Y as f}from"./normalizeUtils-DK5542Ty-DtqBcgc2.js";import{m as v,S as y}from"./query-DALknG0A-COo-2vjI.js";import{c as l}from"./FeatureSet-BIUKCqNW-D9YRl-VE.js";import{v as P}from"./PivotQuery-CAYSNQs8-u-iDIs8l.js";import"./Cyclical-Bzwh_QaL-CXh-hbnA.js";import"./normalizeUtilsCommon-5DjefBp7-CQyUDMQp.js";import"./utils-t279O251-BBk6rV0U.js";import"./pbfQueryUtils-DYXcN4x1-BpgjQRlR.js";import"./pbf-42TrGguk-Dw0lh_Mv.js";import"./memoryEstimations-C_GUL8g_-JniNFd5l.js";import"./OptimizedGeometry-BYxlP_oK-DvAqrgO1.js";import"./OptimizedFeature-C33SioFK-sn7DeAq-.js";import"./OptimizedFeatureSet-Dz5hF8Qm-CgsRgxJh.js";import"./queryZScale-B66ZWsfS-D7Zc2_Zh.js";import"./zscale-PLuFqpaL-BIEnWBsg.js";import"./Field-Dn1Bgq7n-CJCGLoNR.js";import"./fieldType-DvW5hpfa-DYUbIy_X.js";import"./Query-DKLDaFaA-I4zhlfzt.js";function g(i){const t=y(i),o=t.outPivots;if(o!=null&&o.length){for(const r of o)r.pivotType==="Pivot"&&r.pivotParameters.outStatistic?r.pivotParameters.outStatistic=JSON.stringify(r.pivotParameters.outStatistic):r.pivotType==="Unpivot"&&(r.unPivotParameters.sourceFields=r.unPivotParameters.sourceFields.join(","));t.outPivots=JSON.stringify(o)}return t}async function S(i,t,o){return await d(i,t,o)}async function d(i,t,o={}){const r=typeof i=="string"?p(i):i,m=t.geometry?[t.geometry]:[],e=await f(m,null,{signal:o.signal}),n=e==null?void 0:e[0];n!=null&&((t=t.clone()).geometry=n);const s=v({...r.query,f:"json",...g(t)});return u(c(r.path,"queryPivot"),{...o,query:{...s,...o.query}})}async function D(i,t,o){const r=a(i),m={...o},{data:e}=await S(r,P.from(t),m);return l.fromJSON(e)}export{D as executePivotQuery};
