const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./symbolLayerUtils-CkAiZyuQ-BVVbFlPY.js","./index-BeTPrQ6f.js","./index-BlWAJbpo.css","./LRUCache-CvGiiws0-B3io5Jp4.js","./MemCache-TG-MhOJy-BkjKRNR7.js"])))=>i.map(i=>d[i]);
import{bp as h,ci as y,gv as m,gw as _,gx as S,_ as E,gj as u,gk as R,bX as A,v as O}from"./index-BeTPrQ6f.js";import{f as D}from"./asyncUtils-Cu__bxqs-ecCTUaGV.js";import{c as I}from"./jsonUtils-Bl9MVnOR-Be8hf0yA.js";import{R as M,g}from"./cimSymbolUtils-BJ01Nooc-BfOR3Irv.js";import{i as N}from"./LRUCache-CvGiiws0-B3io5Jp4.js";const k="picture-fill",v="simple-fill",P="simple-line",x="simple-marker",T="text",V="cim",b=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),w=new N(1e3);function ot(t){const e=t.style;let n=null;if(t)switch(t.type){case x:e!=="cross"&&e!=="x"&&(n=t.color);break;case v:e&&e!=="solid"?e!=="none"&&(n={type:"pattern",x:0,y:0,src:A(`esri/symbols/patterns/${e}.png`),width:5,height:5}):n=t.color;break;case k:n={type:"pattern",src:t.url,width:u(t.width)*t.xscale,height:u(t.height)*t.yscale,x:u(t.xoffset),y:u(t.yoffset)};break;case T:n=t.color;break;case V:n=g(t)}return n}function lt(t,e){const n=t+"-"+e,r=w.get(n);return r!=null?Promise.resolve(r):O(t,{responseType:"image"}).then(l=>{const o=l.data,i=o.naturalWidth,a=o.naturalHeight,s=document.createElement("canvas");s.width=i,s.height=a;const c=s.getContext("2d");c.fillStyle=e,c.fillRect(0,0,i,a),c.globalCompositeOperation="destination-in",c.drawImage(o,0,0);const p=s.toDataURL();return w.put(n,p),p})}function L(t){if(!t)return null;let e=null;switch(t.type){case v:case k:case x:e=L(t.outline);break;case P:{const n=u(t.width);t.style!=null&&t.style!=="none"&&n!==0&&(e={color:t.color,style:$(t.style),width:n,cap:t.cap,join:t.join==="miter"?u(t.miterLimit):t.join},e.dashArray=W(e).join(",")||"none");break}default:e=null}return e}function W(t){if(!(t!=null&&t.style))return[];const{dashArray:e,style:n,width:r}=t;if(typeof e=="string"&&e!=="none")return e.split(",").map(i=>Number(i));const l=r??0,o=b.has(n)?b.get(n).map(i=>i*l):[];if(t.cap!=="butt")for(const[i,a]of o.entries())o[i]=i%2==1?a+l:Math.max(a-l,1);return o}const $=(()=>{const t={};return e=>{if(t[e])return t[e];const n=e.replaceAll("-","");return t[e]=n,n}})(),it=new h([128,128,128]);function C(t){var n,r;const e=(n=t.symbolLayers)==null?void 0:n.at(-1);if(e&&"outline"in e)return(r=e==null?void 0:e.outline)==null?void 0:r.size}function st(t){var e;return t?y(t)?C(t)??0:R((e=L(t))==null?void 0:e.width):0}function at(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(e=>e.type==="object");case"line-3d":return t.symbolLayers.some(e=>e.type==="path");case"polygon-3d":return t.symbolLayers.some(e=>e.type==="object"||e.type==="extrude");default:return!1}}function ct(t){var e;return((e=t.resource)==null?void 0:e.href)??""}function ut(t,e){if(!t)return null;let n=null;return y(t)?n=H(t):m(t)&&(n=t.type==="cim"?g(t):t.color?new h(t.color):null),n?f(n,e):null}function H(t){const e=t.symbolLayers;if(!e)return null;let n=null;return e.forEach(r=>{var l;r.type==="object"&&((l=r.resource)!=null&&l.href)||(n=r.type==="water"?r.color:r.material?r.material.color:null)}),n?new h(n):null}function f(t,e){if(e==null||t==null)return t;const n=t.toRgba();return n[3]=n[3]*e,new h(n)}function J(t,e,n){const r=t.symbolLayers;if(!r)return;const l=(o,i=!1)=>{let a=e??o??null;return(n==null?void 0:n.override)!=null&&(!a&&i&&(a=new h([255,255,255])),a&&(a.a=n.override)),f(a,n==null?void 0:n.add)};r.forEach(o=>{var s,c;if(o.type==="water")return void(o.color=f(o.color,n==null?void 0:n.add));const i=o.material!=null?o.material.color:null,a=l(i,o.type==="icon"&&((s=o.resource)==null?void 0:s.href)!=null);o.material==null?o.material=new _({color:a}):o.material.color=a,"outline"in o&&((c=o.outline)!=null&&c.color)&&(n==null?void 0:n.add)!=null&&(o.outline.color=f(o.outline.color,n.add)),"marker"in o&&o.marker!=null&&(o.marker.color=l(o.marker.color))})}function U(t,e,n){var r;e=e??t.color,(n==null?void 0:n.override)!=null&&e&&(e.a=n.override),e&&(t.color=f(e,n==null?void 0:n.add)),"outline"in t&&((r=t.outline)!=null&&r.color)&&(t.outline.color=f(t.outline.color,n==null?void 0:n.add))}function ft(t,e,n){t&&(e||n!=null)&&(e&&(e=new h(e)),y(t)?J(t,e,n):m(t)&&U(t,e,n))}async function X(t,e){const n=t.symbolLayers;n&&await D(n,async r=>Z(r,e))}async function Z(t,e){switch(t.type){case"extrude":B(t,e);break;case"icon":case"line":case"text":q(t,e);break;case"path":G(t,e);break;case"object":await F(t,e)}}function q(t,e){const n=j(e);n!=null&&(t.size=n)}function j(t){for(const e of t)if(typeof e=="number")return e;return null}function B(t,e){const n=e[2];typeof n=="number"&&(t.size=n)}async function F(t,e){const{resourceSize:n,symbolSize:r}=await K(t),l=z(e,n,r);l!=null&&(t.width=d(e[0],r[0],n[0],l),t.depth=d(e[1],r[1],n[1],l),t.height=d(e[2],r[2],n[2],l))}function G(t,e){const n=z(e,S,[t.width,void 0,t.height]);n!=null&&(t.width=d(e[0],t.width,1,n),t.height=d(e[2],t.height,1,n))}function z(t,e,n){for(let r=0;r<3;r++){const l=t[r];switch(l){case"symbol-value":{const o=n[r];return o!=null?o/e[r]:1}case"proportional":break;default:if(l&&e[r])return l/e[r]}}return null}async function K(t){const{computeObjectLayerResourceSize:e}=await E(()=>import("./symbolLayerUtils-CkAiZyuQ-BVVbFlPY.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),n=await e(t,10),{width:r,height:l,depth:o}=t,i=[r,o,l];let a=1;for(let s=0;s<3;s++){const c=i[s];if(c!=null){a=c/n[s];break}}for(let s=0;s<3;s++)i[s]==null&&(i[s]=n[s]*a);return{resourceSize:n,symbolSize:i}}function d(t,e,n,r){switch(t){case"proportional":return n*r;case"symbol-value":return e??n;default:return t}}function Q(t,e){const n=j(e);if(n!=null)switch(t.type){case"simple-marker":t.size=n;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=n,t.height=n*r):(t.width=n*r,t.height=n);break}case"simple-line":t.width=n;break;case"text":t.font.size=n}}async function ht(t,e){if(t&&e)return y(t)?X(t,e):void(m(t)&&Q(t,e))}function dt(t,e,n){if(t&&e!=null){if(y(t)){const r=t.symbolLayers;r&&r.forEach(l=>{if(l.type==="object")switch(n){case"tilt":l.tilt=(l.tilt??0)+e;break;case"roll":l.roll=(l.roll??0)+e;break;default:l.heading=(l.heading??0)+e}l.type==="icon"&&(l.angle+=e)})}else if(m(t))switch(t.type){case"simple-marker":case"picture-marker":case"text":t.angle+=e;break;case"cim":M(t,e,!0)}}}function yt(t,e){if(!t)return null;const n=t.effects.map(r=>r.toJSON());return I(n)}function mt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}export{st as B,at as F,ct as G,ut as K,ot as T,lt as U,it as W,ft as _,mt as c,yt as i,W as j,ht as l,L as p,dt as s,$ as z};
