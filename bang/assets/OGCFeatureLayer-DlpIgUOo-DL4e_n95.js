import{ch as O,l as b,fj as z,fk as N,fl as U,bK as k,cY as R,be as C,fo as J,m as r,E as o,n as E,Q as V,F as Z,ck as I,c5 as H}from"./index-BeTPrQ6f.js";import{M as W}from"./MultiOriginJSONSupport-DNNJhlNT-Bm4fcG4m.js";import{a as K,s as Y}from"./GraphicOrigin-BZpgptRb-BMZxic91.js";import{j as X,g as D,F as T,h as ee,b as te,w as re,I as se,y as oe,Z as ie}from"./ogcFeatureUtils-DaWiy-u5-CUjUK097.js";import{s as ae}from"./capabilities-BXcqol5v-Cs4k8cuT.js";import{c as pe}from"./FeatureSet-BIUKCqNW-D9YRl-VE.js";import{l as ne}from"./APIKeyMixin-DYy2zfLn-D3z7LonQ.js";import{c as le}from"./BlendLayer-D8oJmNCO-A0sTzbOF.js";import{n as ue}from"./CustomParametersMixin-CqtpZgix-ZCd9Um94.js";import{I as de}from"./DisplayFilteredLayer-Ce0lf91Z-D_UnOF-a.js";import{c as ce}from"./FeatureEffectLayer-Bw8pqFtl-COIpRlV8.js";import{h as fe}from"./FeatureReductionLayer-fRVzjp_G-BAykrsM3.js";import{b as me,s as ye,i as he,n as ge,t as ve,r as Se,a as be}from"./OperationalLayer-Ds0FQSCg-DEUbTcjK.js";import{p as Ce}from"./OrderedLayer-BpzV2gVo-B7bag0TS.js";import{x as we}from"./PortalLayer-B52AUJ7S-DLZhjKpz.js";import{k as xe}from"./RefreshableLayer-BEBm0YMm-CEdeDwog.js";import{r as Fe}from"./ScaleRangeLayer-DkZwCH6_-C95kTMqN.js";import{v as Oe}from"./TemporalLayer-D43PzGI2-BVfMl_Wx.js";import{F as Re}from"./TrackableLayer-B6TLWZyJ-CFqD-uca.js";import{o as Ie}from"./FeatureType-BaXpcfS--CXOAiC-Q.js";import{m as De}from"./Field-Dn1Bgq7n-CJCGLoNR.js";import{f as Te}from"./fieldProperties-B4tOVJmv-DQSPMAAi.js";import{i as je,u as Pe}from"./labelingInfo-jIy5P_vY-D8rEl7NY.js";import{V as Ee,_ as qe}from"./typeUtils-BTAsL08--B1VjqkPN.js";import{b as j}from"./Query-DKLDaFaA-I4zhlfzt.js";import{y as _e}from"./popupUtils-D0h6TFFF-Bch8GtRu.js";import"./featureConversionUtils-CZmIxyv5-DHwRSztU.js";import"./OptimizedFeature-C33SioFK-sn7DeAq-.js";import"./memoryEstimations-C_GUL8g_-JniNFd5l.js";import"./OptimizedGeometry-BYxlP_oK-DvAqrgO1.js";import"./OptimizedFeatureSet-Dz5hF8Qm-CgsRgxJh.js";import"./geojson-IFfWNbn5--Ds_bCet.js";import"./date-B2Zfy8vK-Dmoe2f9T.js";import"./clientSideDefaults-BTftx6ta-Bkc3-ooB.js";import"./QueryEngineCapabilities-DPRPXYxY-DJC_YILC.js";import"./sourceUtils-CVk32wTy-BZMHds0J.js";import"./FieldsIndex-Ds4D9xP7-BiTuE5Z3.js";import"./UnknownTimeZone-DzO8gKMe-d6rtFXqm.js";import"./timeZoneUtils-CdK7eU4Y-fyhJ3EFx.js";import"./fieldType-DvW5hpfa-DYUbIy_X.js";import"./layerContainerType-CJrPp4UB-BIF7XAYP.js";import"./jsonUtils-Bl9MVnOR-Be8hf0yA.js";import"./parser-CXoJuqeV-C7irlk5U.js";import"./mat4f32-BdRMyjXW-CWt6U0BP.js";import"./mat4-R0VY9B_E-DoEP887i.js";import"./scaleUtils-Ckma21r5-DhwWQymd.js";import"./uuid-CFz2qBzH-cIdlpVG-.js";import"./displayFilterUtils-BCW-UeaE-CnjPWjFU.js";import"./FeatureEffect-xxDa5IRG-DfQBGcCi.js";import"./FeatureFilter-D0iZ4sKI-BBZH0Xo9.js";import"./FeatureReductionSelection-BYDlwJ5u-CQfZ-i0-.js";import"./jsonUtils-5anAqpiW-BnpEYfRl.js";import"./ClassBreaksRenderer-AH_lBYRG-CIe34emV.js";import"./commonProperties-CYpRbAZr-PcmW9U_y.js";import"./colorRamps-C5pnMn-A-BSSJ2zvJ.js";import"./ColorStop-CBXZUZ6o-_LZdJKea.js";import"./visualVariableUtils-DzY4BXXy-D_1S-x1B.js";import"./lengthUtils-CopeXEyE-DjCEitlq.js";import"./RendererLegendOptions-_ue7FeM0-ROeRce-g.js";import"./LRUCache-CvGiiws0-B3io5Jp4.js";import"./MemCache-TG-MhOJy-BkjKRNR7.js";import"./DictionaryScriptEvaluator-DrG0wIBl-D15kCKMK.js";import"./Version-DSJSGSLA-Cg87msWM.js";import"./ArcadeExpression-BGPPS6z--7N6gsB31.js";import"./TimeOnly-BFfVS_ja-C4MPGwCM.js";import"./enum-D3e-PyKo-Bl5V5br5.js";import"./utils-CIm5uQvO-CtKf129F.js";import"./defaultCIMValues-BWu-APou-XI-Li77m.js";import"./heatmapUtils-Bf2yRyEN-BAQJ1IRB.js";import"./vec42-DHp-FUwt-Br7hmYJs.js";import"./vec4f64-DD-nkcCV-CSNWKRqG.js";import"./SimpleRenderer-DSyBXxyY-CGNZcXII.js";import"./UniqueValueRenderer-4zUMozui-C0Y5GPGV.js";import"./diffUtils-D3O4EfgX-CznKxD4n.js";import"./styleUtils-DoTsJ8ze-DHY40A2q.js";import"./MD5-CXHDUqXT-CMrYdOi6.js";import"./ElevationInfo-tlrAM5SV-D86C1F9d.js";import"./OrderByInfo-D0eImi6z-Dv2CatL0.js";import"./asyncUtils-Cu__bxqs-ecCTUaGV.js";import"./PortalItem-BrQqKoE_-zs2bKsCH.js";import"./portalItemUtils-C12I5owR-Iiaf4oEu.js";import"./projectionUtils-CsX1UTBu-DsZaU4xz.js";import"./projectBuffer-CMNsPBq1-CMpE7Jo3.js";import"./zscale-PLuFqpaL-BIEnWBsg.js";import"./TimeInfo-BoebCPJB-ubr6IA4W.js";import"./FeatureTemplate-DN-lMS1p-caqKKpFl.js";import"./RelationshipQuery-Cf-_aN1Z-mThKQ0J2.js";import"./NormalizationBinParametersMixin-DuEmpnQx-abBJwXnQ.js";import"./labelUtils-BLNYRrPe-Cv1ZZjAO.js";const Qe=Symbol("isOGCFeatureGraphicOrigin");var P;class Ae extends K{get[(P=Qe,N)](){return this.layer}get[U](){return this.layer}get[Y](){return this.layer}constructor(t){super(),this[P]=!0,this.type="ogc-feature",this.layer=t}get id(){return this.layer.id}}let d=class extends k{constructor(){super(...arguments),this.featureDefinition=null,this.type="ogc-feature"}load(e){return this.addResolvingPromise(this._loadOGCServices(this.layer,e)),this.when()}getSource(){const{featureDefinition:{collection:e,layerDefinition:t,spatialReference:i,supportedCrs:a},layer:{apiKey:p,customParameters:l,effectiveMaxRecordCount:n}}=this;return{type:"ogc-source",collection:e,layerDefinition:t,maxRecordCount:n,queryParameters:{apiKey:p,customParameters:l},spatialReference:i,supportedCrs:a}}queryExtent(e,t={}){return null}queryFeatureCount(e,t={}){return null}queryFeatures(e,t={}){return this.queryFeaturesJSON(e,t).then(i=>pe.fromJSON(i))}queryFeaturesJSON(e,t={}){const i=this.getSource();return this.load(t).then(()=>X(i,e,t))}queryObjectIds(e,t={}){return null}serviceSupportsSpatialReference(e){const{isWebMercator:t,isWGS84:i,latestWkid:a,wkid:p}=e,{supportedCrs:l}=this.featureDefinition;return i||t||!!p&&!!l[p]||!!a&&!!l[a]}_conformsToType(e,t){const i=new RegExp(`^${R(t)}$`,"i");return e.conformsTo.some(a=>i.test(a))??!1}_getCapabilities(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryBins:!1,supportsQueryPivot:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},query:{maxRecordCount:t,maxRecordCountFactor:void 0,maxUniqueIDCount:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsCentroidOnDegeneratedQuantizedGeometry:!1,supportsCurrentUser:!1,supportsDegeneratedQuantizedGeometry:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPaginationOnAggregatedQueries:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsReturnMesh:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,supportsSqlExpression:!1,supportsTrueCurve:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:ae,editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}_getMaxRecordCount(e){var i,a,p,l,n;const t=(i=e==null?void 0:e.components)==null?void 0:i.parameters;return((p=(a=t==null?void 0:t.limit)==null?void 0:a.schema)==null?void 0:p.maximum)??((n=(l=t==null?void 0:t.limitFeatures)==null?void 0:l.schema)==null?void 0:n.maximum)}_getStorageSpatialReference(e){const t=e.storageCrs??D,i=T(t);return i==null?C.WGS84:new C({wkid:i})}_getSupportedSpatialReferences(e,t){const i="#/crs",a=e.crs??[D],p=a.includes(i)?a.filter(n=>n!==i).concat(t.crs??[]):a,l=/^http:\/\/www\.opengis.net\/def\/crs\/epsg\/.*\/3785$/i;return p.filter(n=>!l.test(n))}async _loadOGCServices(e,t){const i=t!=null?t.signal:null,{apiKey:a,collectionId:p,customParameters:l,fields:n,geometryType:m,hasZ:y,objectIdField:q,timeInfo:h,url:_}=e,Q={fields:n==null?void 0:n.map(u=>u.toJSON()),geometryType:J.toJSON(m),hasZ:y??!1,objectIdField:q,timeInfo:h==null?void 0:h.toJSON()},c={apiKey:a,customParameters:l,signal:i},g=await ee(_,c),[w,x]=await Promise.all([te(g,c),re(g,c)]);if(!this._conformsToType(w,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson"))throw new b("ogc-feature-layer:no-geojson-support","Server does not support geojson");const f=x.collections.find(({id:u})=>u===p);if(!f)throw new b("ogc-feature-layer:collection-not-found","Server does not contain the named collection");const A=this._conformsToType(w,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30")?await se(g,c):null,F=await oe(f,Q,c),B=this._getMaxRecordCount(A),G=this._getCapabilities(F.hasZ,B),M=this._getStorageSpatialReference(f).toJSON(),$=this._getSupportedSpatialReferences(f,x),L=new RegExp(`^${R(ie)}`,"i"),v={};for(const u of $){const S=T(u);S!=null&&(v[S]||(v[S]=u.replace(L,"")))}this.featureDefinition={capabilities:G,collection:f,layerDefinition:F,spatialReference:M,supportedCrs:v}}};r([o()],d.prototype,"featureDefinition",void 0),r([o({constructOnly:!0})],d.prototype,"layer",void 0),r([o()],d.prototype,"type",void 0),d=r([E("esri.layers.graphics.sources.OGCFeatureSource")],d);const Be=Te();let s=class extends de(ne(ue(fe(ce(le(Ce(Oe(Re(Fe(me(we(xe(W(V)))))))))))))){constructor(e){super(e),this.capabilities=null,this.collectionId=null,this.copyright=null,this.description=null,this.displayField=null,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new Ae(this),this.hasZ=void 0,this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.maxRecordCount=null,this.objectIdField=null,this.operationalLayerType="OGCFeatureLayer",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new d({layer:this}),this.spatialReference=null,this.title=null,this.type="ogc-feature",this.typeIdField=null,this.types=null,this.url=null}destroy(){var e;(e=this.source)==null||e.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["OGCFeatureServer"]},e).then(()=>this._fetchService(e))),this.when()}get defaultPopupTemplate(){return this.createPopupTemplate()}get effectiveMaxRecordCount(){var e;return this.maxRecordCount??((e=this.capabilities)==null?void 0:e.query.maxRecordCount)??5e3}get isTable(){return this.loaded&&this.geometryType==null}set renderer(e){O(e,this.fieldsIndex),this._set("renderer",e)}createPopupTemplate(e){return _e(this,e)}createQuery(){return new j}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var n;let i,a=!1;const p=(n=t==null?void 0:t.feature)==null?void 0:n.attributes,l=this.typeIdField&&(p==null?void 0:p[this.typeIdField]);return l!=null&&this.types&&(a=this.types.some(m=>{var y;return m.id==l&&(i=(y=m.domains)==null?void 0:y[e],(i==null?void 0:i.type)==="inherited"&&(i=this._getLayerDomain(e)),!0)})),a||i||(i=this._getLayerDomain(e)),i}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(j.from(e)||this.createQuery(),t)).then(i=>{var a;return(a=i==null?void 0:i.features)==null||a.forEach(p=>{p.layer=p.sourceLayer=this,p.origin=this.graphicOrigin}),i})}async queryAttributeBins(e,t){throw new b("OGCFeatureLayer","Layer source does not support queryAttributeBins capability")}serviceSupportsSpatialReference(e){var t;return((t=this.source)==null?void 0:t.serviceSupportsSpatialReference(e))??!1}async _fetchService(e){await this.source.load(e),this.read(this.source.featureDefinition,{origin:"service"}),O(this.renderer,this.fieldsIndex),z(this.timeInfo,this.fieldsIndex)}_getLayerDomain(e){if(!this.fields)return null;for(const t of this.fields)if(t.name===e&&t.domain)return t.domain;return null}};r([o({readOnly:!0,json:{origins:{service:{read:!0}}}})],s.prototype,"capabilities",void 0),r([o({type:String,json:{write:!0}})],s.prototype,"collectionId",void 0),r([o({type:String})],s.prototype,"copyright",void 0),r([o({readOnly:!0})],s.prototype,"defaultPopupTemplate",null),r([o({readOnly:!0,type:String,json:{origins:{service:{name:"collection.description"}}}})],s.prototype,"description",void 0),r([o({type:String})],s.prototype,"displayField",void 0),r([o({type:Number})],s.prototype,"effectiveMaxRecordCount",null),r([o(ye)],s.prototype,"elevationInfo",void 0),r([o({type:[De],json:{origins:{service:{name:"layerDefinition.fields"}}}})],s.prototype,"fields",void 0),r([o(Be.fieldsIndex)],s.prototype,"fieldsIndex",void 0),r([o({readOnly:!0,type:Z,json:{origins:{service:{name:"layerDefinition.extent"}}}})],s.prototype,"fullExtent",void 0),r([o({type:I.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:I.read}}}}})],s.prototype,"geometryType",void 0),r([o({readOnly:!0,clonable:!1})],s.prototype,"graphicOrigin",void 0),r([o({type:Boolean,json:{origins:{service:{name:"layerDefinition.hasZ"}}}})],s.prototype,"hasZ",void 0),r([o({type:Boolean,readOnly:!0})],s.prototype,"isTable",null),r([o({type:[Pe],json:{origins:{"web-document":{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:je},write:!0}}}})],s.prototype,"labelingInfo",void 0),r([o(he)],s.prototype,"labelsVisible",void 0),r([o(ge)],s.prototype,"legendEnabled",void 0),r([o({type:Number})],s.prototype,"maxRecordCount",void 0),r([o({type:String,json:{origins:{service:{name:"layerDefinition.objectIdField"}}}})],s.prototype,"objectIdField",void 0),r([o({type:["OGCFeatureLayer"]})],s.prototype,"operationalLayerType",void 0),r([o(ve)],s.prototype,"popupEnabled",void 0),r([o({type:H,json:{name:"popupInfo",write:!0}})],s.prototype,"popupTemplate",void 0),r([o({types:qe,json:{origins:{service:{name:"layerDefinition.drawingInfo.renderer",write:!1},"web-scene":{types:Ee,name:"layerDefinition.drawingInfo.renderer",write:!0}},name:"layerDefinition.drawingInfo.renderer",write:!0}})],s.prototype,"renderer",null),r([o(Se)],s.prototype,"screenSizePerspectiveEnabled",void 0),r([o({readOnly:!0})],s.prototype,"source",void 0),r([o({readOnly:!0,type:C,json:{origins:{service:{read:!0}}}})],s.prototype,"spatialReference",void 0),r([o({type:String,json:{write:{enabled:!0,ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"collection.title"}}}})],s.prototype,"title",void 0),r([o({readOnly:!0,json:{read:!1}})],s.prototype,"type",void 0),r([o({type:String,readOnly:!0})],s.prototype,"typeIdField",void 0),r([o({type:[Ie]})],s.prototype,"types",void 0),r([o(be)],s.prototype,"url",void 0),s=r([E("esri.layers.OGCFeatureLayer")],s);const Sr=s;export{Sr as default};
