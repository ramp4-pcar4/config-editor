import{ag as At,gt as st}from"./index-BeTPrQ6f.js";import{f as R}from"./PixelBlock-DwvqalBN-B5no8ogH.js";import{N as ut}from"./pixelRangeUtils-DcEknavd-BIL6Doop.js";const at=9,Pt="PixelID";function $(t){var i;return t!=null&&((i=t.pixels)==null?void 0:i.length)>0}function Jt(t){var m;if(!(t!=null&&t.length)||t.some(s=>!$(s)))return null;if(t.length===1)return((m=t[0])==null?void 0:m.clone())??null;const i=t,{width:e,height:o,pixelType:a}=i[0];if(i.some(s=>s.width!==e||s.height!==o))return null;const n=i.map(({mask:s})=>s).filter(s=>s!=null);let h=null;n.length&&(h=new Uint8Array(e*o),h.set(n[0]),n.length>1&&mt(n.slice(1),h));const c=[];i.forEach(({pixels:s})=>c.push(...s));const l=i.map(({statistics:s})=>s).filter(s=>s==null?void 0:s.length),r=[];return l.forEach(s=>r.push(...s)),new R({pixelType:a,width:e,height:o,mask:h,pixels:c,statistics:r.length?r:null})}function Vt(t){if(!t)return;const i=t.colormap;if(!i||i.length===0)return;const e=i.sort((l,r)=>l[0]-r[0]),o=e[0][0]<0?e[0][0]:0,a=Math.max(256,e[e.length-1][0]-o+1),n=new Uint8Array(4*a),h=[],c=e[0].length===5;if(a>65536)return e.forEach(l=>{h[l[0]-o]=c?l.slice(1):l.slice(1).concat([255])}),{indexed2DColormap:h,offset:o,alphaSpecified:c};if(t.fillUnspecified){let l=e[0];for(let r=l[0]-o,m=0;r<a;r++)n[4*r]=l[1],n[4*r+1]=l[2],n[4*r+2]=l[3],n[4*r+3]=c?l[4]:255,r===l[0]-o&&(l=m===e.length-1?l:e[++m])}else for(let l=0;l<e.length;l++){const r=e[l],m=4*(r[0]-o);n[m]=r[1],n[m+1]=r[2],n[m+2]=r[3],n[m+3]=c?r[4]:255}return{indexedColormap:n,offset:o,alphaSpecified:c}}function qt(t,i){if(!$(t)||!i||!i.indexedColormap&&!i.indexed2DColormap)return t;const e=t.clone(),o=e.pixels;let a=e.mask;const n=e.width*e.height;if(o.length!==1)return t;const{indexedColormap:h,indexed2DColormap:c,offset:l,alphaSpecified:r}=i,m=o[0],s=new Uint8Array(m.length),u=new Uint8Array(m.length),p=new Uint8Array(m.length);let f,d=0;if(h){const g=h.length-1;if(a!=null)for(let x=0;x<n;x++)a[x]&&(d=4*(m[x]-l),d<l||d>g?a[x]=0:(s[x]=h[d],u[x]=h[d+1],p[x]=h[d+2],a[x]=h[d+3]));else{a=new Uint8Array(n);for(let x=0;x<n;x++)d=4*(m[x]-l),d<l||d>g?a[x]=0:(s[x]=h[d],u[x]=h[d+1],p[x]=h[d+2],a[x]=h[d+3]);e.mask=a}}else if(c)if(a!=null)for(let g=0;g<n;g++)a[g]&&(f=c[m[g]],s[g]=f[0],u[g]=f[1],p[g]=f[2],a[g]=f[3]);else{a=new Uint8Array(n);for(let g=0;g<n;g++)f=c[m[g]],s[g]=f[0],u[g]=f[1],p[g]=f[2],a[g]=f[3];e.mask=a}return e.pixels=[s,u,p],e.statistics=null,e.pixelType="u8",e.maskIsAlpha=r,e}function jt(t,i){if(!$(t))return null;const{pixels:e,mask:o}=t,a=e.length;let n=i.lut;const{offset:h}=i;n&&n[0].length===1&&(n=e.map(()=>n));const c=[],l=i.outputPixelType||"u8";for(let m=0;m<a;m++){const s=pt(e[m],o,n[m],h||0,l);c.push(s)}const r=new R({width:t.width,height:t.height,pixels:c,mask:o,pixelType:l});return r.updateStatistics(),r}function pt(t,i,e,o,a){const n=t.length,h=R.createEmptyBand(a,n);if(i)for(let c=0;c<n;c++)i[c]&&(h[c]=e[t[c]-o]);else for(let c=0;c<n;c++)h[c]=e[t[c]-o];return h}function zt(t,i,e){if(!$(t))return;const{width:o,height:a,pixels:n,mask:h}=t,c=o*a,l=new Uint8Array(c);for(let s=1;s<=e.length;s++){const{bandId:u,ranges:p}=e[s-1],f=n[u];if(!f)continue;const d=p.length===1,[g,x]=p[0];for(let y=0;y<c;y++)if(!h||h[y]){const k=f[y];if(d)k>=g&&k<=x&&(l[y]=s);else for(let M=0;M<p.length;M++){const[w,b]=p[M];if(k>=w&&k<=b){l[y]=s;break}}}}const{pixels:r}=i;r.length===1&&(r[1]=r[0].slice(),r[2]=r[0].slice());const m=e.map(s=>s.color);if(i.mask){const s=i.mask;for(let u=0;u<c;u++)if(s[u]){s[u]=255;const p=l[u];if(p){const f=m[p-1];r[0][u]=f[0],r[1][u]=f[1],r[2][u]=f[2],s[u]=f[3]}}}else{const s=new Uint8Array(c).fill(255);for(let u=0;u<c;u++){const p=l[u];if(p){const f=m[p-1];r[0][u]=f[0],r[1][u]=f[1],r[2][u]=f[2],s[u]=f[3]}}i.mask=s}i.maskIsAlpha=!0}function Lt(t,i){if(!$(t))return null;const e=t.clone(),{pixels:o}=e,a=e.width*e.height,n=i.length,h=Math.floor(n/2),c=i[Math.floor(h)],l=o[0],r=new Uint8Array(a),m=new Uint8Array(a),s=new Uint8Array(a);let u=e.mask;const p=i[0].mappedColor.length===4;u||(u=new Uint8Array(a),u.fill(p?255:1),e.mask=u);for(let f=0;f<a;f++)if(u[f]){const d=l[f];let g=!1,x=h,y=c,k=0,M=n-1;for(;M-k>1;){if(d===y.value){g=!0;break}d>y.value?k=x:M=x,x=Math.floor((k+M)/2),y=i[Math.floor(x)]}g||(d===i[k].value?(y=i[k],g=!0):d===i[M].value?(y=i[M],g=!0):d<i[k].value?g=!1:d>i[k].value&&(d<i[M].value?(y=i[k],g=!0):M===n-1?g=!1:(y=i[M],g=!0))),g?(r[f]=y.mappedColor[0],m[f]=y.mappedColor[1],s[f]=y.mappedColor[2],u[f]=y.mappedColor[3]):r[f]=m[f]=s[f]=u[f]=0}return e.pixels=[r,m,s],e.mask=u,e.pixelType="u8",e.maskIsAlpha=p,e}function Kt(t,i,e=!1){const o=new Float32Array(3*at),a=i.length;for(let n=0;n<at;n++)o[3*n]=t[2*n]??st-1,o[3*n+1]=t[2*n+1]??st,o[3*n+2]=i[n]??0,n<a&&(n>0&&(o[3*n]-=1e-5),t[2*n+1]!==t[2*n]&&(n<a-1||!e)&&(o[3*n+1]-=1e-5));return o}function Ht(t,i){if(!$(t))return null;const{width:e,height:o}=t,{inputRanges:a,outputValues:n,outputPixelType:h,noDataRanges:c,allowUnmatched:l,replacementValue:r,isLastInputRangeInclusive:m}=i,s=t.pixels[0],u=R.createEmptyBand(h,s.length),p=t.mask,f=new Uint8Array(e*o);p?f.set(p):f.fill(255);const d=t.pixelType.startsWith("f")?1e-6:0,g=a.map(w=>w-d);g[0]=a[0],g[g.length-1]=a[a.length-1]+(m?1e-6:0);const x=a.length/2,[y,k]=ut(h);for(let w=0;w<o;w++)for(let b=0;b<e;b++){const U=w*e+b;if(f[U]){const P=s[U];let S=!1;for(let v=x-1;v>=0;v--)if(P===a[2*v]||P>g[2*v]&&P<g[2*v+1]){u[U]=n[v],S=!0;break}S||(l?u[U]=P>k?k:P<y?y:r??P:f[U]=0)}}const M=c==null?void 0:c.length;if(M)for(let w=0;w<o;w++)for(let b=0;b<e;b++){const U=w*e+b;if(!p||p[U]){const P=s[U];for(let S=0;S<M;S+=2)if(P>=c[S]&&P<=c[S+1]){u[U]=0,f[U]=0;break}}}return new R({width:e,height:o,pixelType:h,pixels:[u],mask:f})}function lt(t,i,e,o){const a=e!=null&&e.length>=2?new Set(e):null,n=(e==null?void 0:e.length)===1?e[0]:null,h=!!(i!=null&&i.length);for(let c=0;c<t.length;c++)if(o[c]){const l=t[c];if(h){let r=!1;for(let m=0;m<i.length;m+=2)if(l>=i[m]&&l<=i[m+1]){r=!0;break}r||(o[c]=0)}o[c]&&(l===n||a!=null&&a.has(l))&&(o[c]=0)}}function ht(t,i){const e=t[0].length;for(let o=0;o<e;o++)if(i[o]){let a=!1;for(let n=0;n<t.length;n++)if(t[n][o]){a=!0;break}a||(i[o]=0)}}function mt(t,i){const e=t[0].length;for(let o=0;o<e;o++)if(i[o]){let a=!1;for(let n=0;n<t.length;n++)if(t[n][o]===0){a=!0;break}a&&(i[o]=0)}}function Xt(t,i){if(!$(t))return null;const{width:e,height:o,pixels:a}=t,n=e*o,h=new Uint8Array(n);t.mask?h.set(t.mask):h.fill(255);const c=a.length,{includedRanges:l,noDataValues:r,outputPixelType:m,matchAll:s,lookups:u}=i;if(u){const p=[];for(let f=0;f<c;f++){const d=u[f],g=pt(a[f],h,d.lut,d.offset||0,"u8");p.push(g)}p.length===1?h.set(p[0]):s?ht(p,h):mt(p,h)}else if(s){const p=[];for(let f=0;f<c;f++){const d=new Uint8Array(n);d.set(h),lt(a[f],l==null?void 0:l.slice(2*f,2*f+2),r==null?void 0:r[f],d),p.push(d)}p.length===1?h.set(p[0]):ht(p,h)}else for(let p=0;p<c;p++)lt(a[p],l==null?void 0:l.slice(2*p,2*p+2),r==null?void 0:r[p],h);return new R({width:e,height:o,pixelType:m,pixels:a,mask:h})}function Gt(t){const{srcPixelType:i,inputRanges:e,outputValues:o,allowUnmatched:a,noDataRanges:n,isLastInputRangeInclusive:h,outputPixelType:c}=t;if(i!=="u8"&&i!=="s8"&&i!=="u16"&&i!=="s16")return null;const l=i.includes("16")?65536:256,r=i.includes("s")?-l/2:0,m=R.createEmptyBand(c,l),s=new Uint8Array(l);a&&s.fill(255);const[u,p]=ut(c);if(e!=null&&e.length&&(o!=null&&o.length)){const f=e.map(d=>d-1e-6);f[0]=e[0],h&&(f[f.length-1]=e[e.length-1]);for(let d=0;d<f.length;d++){const g=o[d]>p?p:o[d]<u?u:o[d],x=Math.ceil(f[2*d]-r),y=e[2*d+1]===e[2*d]?x:Math.floor(f[2*d+1]-r);for(let k=x;k<=y;k++)m[k]=g,s[k]=255}}if(n!=null&&n.length)for(let f=0;f<n.length;f++){const d=Math.ceil(n[2*f]-r),g=Math.floor(n[2*f+1]-r);for(let x=d;x<=g;x++)s[x]=0}return{lut:m,offset:r,mask:s}}function Zt(t,i,e){if(t!=="u8"&&t!=="s8"&&t!=="u16"&&t!=="s16")return null;const o=t.includes("16")?65536:256,a=t.includes("s")?-o/2:0,n=new Uint8Array(o);if(i)for(let h=0;h<i.length;h++){const c=Math.ceil(i[2*h]-a),l=Math.floor(i[2*h+1]-a);for(let r=c;r<=l;r++)n[r]=255}else n.fill(255);if(e)for(let h=0;h<e.length;h++)n[e[h]-a]=0;return{lut:n,offset:a}}function Ut(t,i,e,o,a,n,h,c){return{xmin:a<=e*t?0:a<e*t+t?a-e*t:t,ymin:n<=o*i?0:n<o*i+i?n-o*i:i,xmax:a+h<=e*t?0:a+h<e*t+t?a+h-e*t:t,ymax:n+c<=o*i?0:n+c<o*i+i?n+c-o*i:i}}function Qt(t,i){if(!t||t.length===0)return null;const e=t.find(f=>f.pixelBlock);if((e==null?void 0:e.pixelBlock)==null)return null;const o=(e.extent.xmax-e.extent.xmin)/e.pixelBlock.width,a=(e.extent.ymax-e.extent.ymin)/e.pixelBlock.height,n=.01*Math.min(o,a),h=t.sort((f,d)=>Math.abs(f.extent.ymax-d.extent.ymax)>n?d.extent.ymax-f.extent.ymax:Math.abs(f.extent.xmin-d.extent.xmin)>n?f.extent.xmin-d.extent.xmin:0),c=Math.min.apply(null,h.map(f=>f.extent.xmin)),l=Math.min.apply(null,h.map(f=>f.extent.ymin)),r=Math.max.apply(null,h.map(f=>f.extent.xmax)),m=Math.max.apply(null,h.map(f=>f.extent.ymax)),s={x:Math.round((i.xmin-c)/o),y:Math.round((m-i.ymax)/a)},u={width:Math.round((r-c)/o),height:Math.round((m-l)/a)},p={width:Math.round((i.xmax-i.xmin)/o),height:Math.round((i.ymax-i.ymin)/a)};return Math.round(u.width/e.pixelBlock.width)*Math.round(u.height/e.pixelBlock.height)!==h.length||s.x<0||s.y<0||u.width<p.width||u.height<p.height?null:{extent:i,pixelBlock:vt(h.map(f=>f.pixelBlock),u,{clipOffset:s,clipSize:p})}}function et(t,i,e,o,a,n){const{width:h,height:c}=e.block,{x:l,y:r}=e.offset,{width:m,height:s}=e.mosaic,u=Ut(h,c,o,a,l,r,m,s);let p=0,f=0;if(n){const d=n.hasGCSSShiftTransform?360:n.halfWorldWidth??0,g=h*n.resolutionX,x=n.startX+o*g;x<d&&x+g>d?f=n.rightPadding:x>=d&&(p=n.leftMargin-n.rightPadding,f=0)}if(u.xmax-=f,typeof i!="number")for(let d=u.ymin;d<u.ymax;d++){const g=(a*c+d-r)*m+(o*h-l)+p,x=d*h;for(let y=u.xmin;y<u.xmax;y++)t[g+y]=i[x+y]}else for(let d=u.ymin;d<u.ymax;d++){const g=(a*c+d-r)*m+(o*h-l)+p;for(let x=u.xmin;x<u.xmax;x++)t[g+x]=i}}function vt(t,i,e={}){var v;const{clipOffset:o,clipSize:a,alignmentInfo:n,blockWidths:h}=e;if(h)return It(t,i,{blockWidths:h});const c=t.find(I=>$(I));if(c==null)return null;const l=a?a.width:i.width,r=a?a.height:i.height,m=c.width,s=c.height,u=i.width/m,p=i.height/s,f={offset:o||{x:0,y:0},mosaic:a||i,block:{width:m,height:s}},d=c.pixelType,g=R.getPixelArrayConstructor(d),x=c.pixels.length,y=[];let k,M;for(let I=0;I<x;I++){M=new g(l*r);for(let A=0;A<p;A++)for(let T=0;T<u;T++){const B=t[A*u+T];$(B)&&(k=B.pixels[I],et(M,k,f,T,A,n))}y.push(M)}const w=t.some(I=>I==null||I.mask!=null&&I.mask.length>0),b=t.some(I=>(I==null?void 0:I.bandMasks)&&I.bandMasks.length>1),U=w?new Uint8Array(l*r):void 0,P=b?[]:void 0;if(U){for(let I=0;I<p;I++)for(let A=0;A<u;A++){const T=t[I*u+A],B=T!=null?T.mask:null;et(U,B??(T?255:0),f,A,I,n)}if(P)for(let I=0;I<x;I++){const A=new Uint8Array(l*r);for(let T=0;T<p;T++)for(let B=0;B<u;B++){const C=t[T*u+B],_=((v=C==null?void 0:C.bandMasks)==null?void 0:v[I])??(C==null?void 0:C.mask);et(A,_??(C?255:0),f,B,T,n)}P.push(A)}}const S=new R({width:l,height:r,pixels:y,pixelType:d,bandMasks:P,mask:U});return S.updateStatistics(),S}function It(t,i,e){var g;const o=t.find(x=>x!=null);if(o==null)return null;const a=t.some(x=>x==null||!!x.mask),{width:n,height:h}=i,c=a?new Uint8Array(n*h):null,{blockWidths:l}=e,r=[],m=o.getPlaneCount(),s=R.getPixelArrayConstructor(o.pixelType);if(a)for(let x=0,y=0;x<t.length;y+=l[x],x++){const k=t[x];if(!$(k))continue;const M=k.mask;for(let w=0;w<h;w++)for(let b=0;b<l[x];b++)c[w*n+b+y]=M==null?255:M[w*k.width+b]}const u=t.some(x=>(x==null?void 0:x.bandMasks)&&x.bandMasks.length>1),p=u?[]:void 0,f=n*h;for(let x=0;x<m;x++){const y=new s(f),k=u?new Uint8Array(f):void 0;for(let M=0,w=0;M<t.length;w+=l[M],M++){const b=t[M];if(!$(b))continue;const U=b.pixels[x];if(U!=null){for(let P=0;P<h;P++)for(let S=0;S<l[M];S++)y[P*n+S+w]=U[P*b.width+S];if(k){const P=((g=b.bandMasks)==null?void 0:g[x])??b.mask;for(let S=0;S<h;S++)for(let v=0;v<l[M];v++)k[S*n+v+w]=P?P[S*b.width+v]:255}}}r.push(y),p&&k&&p.push(k)}const d=new R({width:n,height:h,mask:c,bandMasks:p,pixels:r,pixelType:o.pixelType});return d.updateStatistics(),d}function Yt(t,i,e){if(!$(t))return null;const{width:o,height:a}=t,n=i.x,h=i.y,c=e.width+n,l=e.height+h;if(n<0||h<0||c>o||l>a||n===0&&h===0&&c===o&&l===a)return t;t.mask||(t.mask=new Uint8Array(o*a));const r=t.mask;for(let m=0;m<a;m++){const s=m*o;for(let u=0;u<o;u++)r[s+u]=m<h||m>=l||u<n||u>=c?0:1}return t.updateStatistics(),t}function St(t){if(!$(t))return null;const i=t.clone(),{width:e,height:o,pixels:a}=t,n=a[0],h=i.pixels[0],c=t.mask;for(let l=2;l<o-1;l++){const r=new Map;for(let s=l-2;s<l+2;s++)for(let u=0;u<4;u++){const p=s*e+u;K(r,n[p],c?c[p]:1)}h[l*e]=ft(r),h[l*e+1]=h[l*e+2]=h[l*e];let m=3;for(;m<e-1;m++){let s=(l-2)*e+m+1;K(r,n[s],c?c[s]:1),s=(l-1)*e+m+1,K(r,n[s],c?c[s]:1),s=l*e+m+1,K(r,n[s],c?c[s]:1),s=(l+1)*e+m+1,K(r,n[s],c?c[s]:1),s=(l-2)*e+m-3,X(r,n[s],c?c[s]:1),s=(l-1)*e+m-3,X(r,n[s],c?c[s]:1),s=l*e+m-3,X(r,n[s],c?c[s]:1),s=(l+1)*e+m-3,X(r,n[s],c?c[s]:1),h[l*e+m]=ft(r)}h[l*e+m+1]=h[l*e+m]}for(let l=0;l<e;l++)h[l]=h[e+l]=h[2*e+l],h[(o-1)*e+l]=h[(o-2)*e+l];return i.updateStatistics(),i}function ft(t){if(t.size===0)return 0;let i=0,e=-1,o=0;const a=t.keys();let n=a.next();for(;!n.done;)o=t.get(n.value),o>i&&(e=n.value,i=o),n=a.next();return e}function X(t,i,e){if(e===0)return;const o=t.get(i);o===1?t.delete(i):t.set(i,o-1)}function K(t,i,e){e!==0&&t.set(i,t.has(i)?t.get(i)+1:1)}function dt(t,i,e){let{x:o,y:a}=i;const{width:n,height:h}=e;if(o===0&&a===0&&h===t.height&&n===t.width)return t;const{width:c,height:l}=t,r=Math.max(0,a),m=Math.max(0,o),s=Math.min(o+n,c),u=Math.min(a+h,l);if(s<0||u<0||!$(t))return null;o=Math.max(0,-o),a=Math.max(0,-a);const{pixels:p}=t,f=n*h,d=p.length,g=[];for(let M=0;M<d;M++){const w=p[M],b=R.createEmptyBand(t.pixelType,f);for(let U=r;U<u;U++){const P=U*c;let S=(U+a-r)*n+o;for(let v=m;v<s;v++)b[S++]=w[P+v]}g.push(b)}const x=new Uint8Array(f),y=t.mask;for(let M=r;M<u;M++){const w=M*c;let b=(M+a-r)*n+o;for(let U=m;U<s;U++)x[b++]=y?y[w+U]:1}const k=new R({width:e.width,height:e.height,pixelType:t.pixelType,pixels:g,mask:x});return k.updateStatistics(),k}function xt(t,i=!0){if(!$(t))return null;const{pixels:e,width:o,height:a,mask:n,pixelType:h}=t,c=[],l=Math.round(o/2),r=Math.round(a/2),m=a-1,s=o-1;for(let p=0;p<e.length;p++){const f=e[p],d=R.createEmptyBand(h,l*r);let g=0;for(let x=0;x<a;x+=2)for(let y=0;y<o;y+=2){const k=f[x*o+y];if(i){const M=y===s?k:f[x*o+y+1],w=x===m?k:f[x*o+y+o],b=y===s?w:x===m?M:f[x*o+y+o+1];d[g++]=(k+M+w+b)/4}else d[g++]=k}c.push(d)}let u=null;if(n!=null){u=new Uint8Array(l*r);let p=0;for(let f=0;f<a;f+=2)for(let d=0;d<o;d+=2){const g=n[f*o+d];if(i){const x=d===s?g:n[f*o+d+1],y=f===m?g:n[f*o+d+o],k=d===s?y:f===m?x:n[f*o+d+o+1];u[p++]=g*x*y*k?1:0}else u[p++]=g}}return new R({width:l,height:r,pixelType:h,pixels:c,mask:u})}function te(t,i,e=0,o=!0){if(!$(t))return null;const{width:a,height:n}=i;let{width:h,height:c}=t;const l=new Map,r={x:0,y:0},m=1+e;let s=t;for(let u=0;u<m;u++){const p=Math.ceil(h/a),f=Math.ceil(c/n);for(let d=0;d<f;d++){r.y=d*n;for(let g=0;g<p;g++){r.x=g*a;const x=dt(s,r,i);l.set(`${u}/${d}/${g}`,x)}}u<m-1&&(s=xt(s,o)),h=Math.round(h/2),c=Math.round(c/2)}return l}function ee(t){const{pixelBlock:i,tileSize:e,level:o,row:a,col:n,useBilinear:h}=t;if(!$(i))return null;const{width:c,height:l}=e,r=2**o,m=r*c,s=r*l;let u=dt(i,{y:a*s,x:n*m},{width:m,height:s});if(!u)return null;for(let p=o;p>0;p--)u=xt(u,h);return u}function gt(t,i,e,o,a=0){const{width:n,height:h}=t,{width:c,height:l}=i,r=o.cols,m=o.rows,s=Math.ceil(c/r-.1/r),u=Math.ceil(l/m-.1/m);let p,f,d,g,x,y,k;const M=s*r,w=M*u*m,b=new Float32Array(w),U=new Float32Array(w),P=new Uint32Array(w),S=new Uint32Array(w);let v,I,A=0;for(let T=0;T<u;T++)for(let B=0;B<s;B++){p=12*(T*s+B),f=e[p],d=e[p+1],g=e[p+2],x=e[p+3],y=e[p+4],k=e[p+5];for(let C=0;C<m;C++){A=(T*m+C)*M+B*r,I=(C+.5)/m;for(let _=0;_<C;_++)v=(_+.5)/r,b[A+_]=(f*v+d*I+g)*n+a,U[A+_]=(x*v+y*I+k)*h+a,P[A+_]=Math.floor(b[A+_]),S[A+_]=Math.floor(U[A+_])}p+=6,f=e[p],d=e[p+1],g=e[p+2],x=e[p+3],y=e[p+4],k=e[p+5];for(let C=0;C<m;C++){A=(T*m+C)*M+B*r,I=(C+.5)/m;for(let _=C;_<r;_++)v=(_+.5)/r,b[A+_]=(f*v+d*I+g)*n+a,U[A+_]=(x*v+y*I+k)*h+a,P[A+_]=Math.floor(b[A+_]),S[A+_]=Math.floor(U[A+_])}}return{offsets_x:b,offsets_y:U,offsets_xi:P,offsets_yi:S,gridWidth:M}}function ne(t,i){const{coefficients:e,spacing:o}=i,{offsets_x:a,offsets_y:n,gridWidth:h}=gt(t,t,e,{rows:o[0],cols:o[1]}),{width:c,height:l}=t,r=new Float32Array(c*l),m=180/Math.PI;for(let s=0;s<l;s++)for(let u=0;u<c;u++){const p=s*h+u,f=s===0?p:p-h,d=s===l-1?p:p+h,g=a[f]-a[d],x=n[d]-n[f];if(isNaN(g)||isNaN(x))r[s*c+u]=90;else{let y=Math.atan2(x,g)*m;y=(360+y)%360,r[s*c+u]=y}}return r}function ie(t,i,e,o,a="nearest"){if(!$(t))return null;a==="majority"&&(t=St(t));const{pixels:n,mask:h,bandMasks:c,pixelType:l}=t,r=t.width,m=t.height,s=R.getPixelArrayConstructor(l),u=n.length,{width:p,height:f}=i;let d=!1;for(let A=0;A<e.length;A+=3)e[A]===-1&&e[A+1]===-1&&e[A+2]===-1&&(d=!0);const{offsets_x:g,offsets_y:x,offsets_xi:y,offsets_yi:k,gridWidth:M}=gt({width:r,height:m},i,e,o,a==="majority"?.5:0);let w;const b=(A,T,B,C)=>{const _=A instanceof Float32Array||A instanceof Float64Array?0:.5;for(let N=0;N<f;N++){w=N*M;for(let E=0;E<p;E++){if(g[w]<0||x[w]<0)A[N*p+E]=0;else if(C)A[N*p+E]=T[y[w]+k[w]*r];else{const D=Math.floor(g[w]),O=Math.floor(x[w]),q=Math.ceil(g[w]),j=Math.ceil(x[w]),W=g[w]-D,z=x[w]-O;if(!B||B[D+O*r]&&B[q+O*r]&&B[D+j*r]&&B[q+j*r]){const H=(1-W)*T[D+O*r]+W*T[q+O*r],L=(1-W)*T[D+j*r]+W*T[q+j*r];A[N*p+E]=(1-z)*H+z*L+_}else A[N*p+E]=T[y[w]+k[w]*r]}w++}}},U=[];let P;const S=(c==null?void 0:c.length)===u,v=[];for(let A=0;A<u;A++){if(S){const T=new Uint8Array(p*f);b(T,c[A],c[A],!0),v.push(T)}P=new s(p*f),b(P,n[A],S?c[A]:h,a==="nearest"||a==="majority"),U.push(P)}const I=new R({width:p,height:f,pixelType:l,pixels:U,bandMasks:S?v:void 0});if(h!=null)I.mask=new Uint8Array(p*f),b(I.mask,h,h,!0);else if(d){I.mask=new Uint8Array(p*f);for(let A=0;A<p*f;A++)I.mask[A]=g[A]<0||x[A]<0?0:1}return I.updateStatistics(),I}function oe(t){const{pixelBlock:i,extent:e,fieldNames:o,skipFactor:a,skipSpatialReference:n=!1,pixelIdOffset:h=0}=t,c=[],{width:l,height:r,pixels:m,mask:s}=i,u=t.imageRowSize??l,p=e.width/l,f=e.height/r,d=m.length,g=Math.floor(a/2),{xmin:x,ymax:y}=e,k=n?void 0:e.spatialReference.toJSON();for(let M=g;M<r;M+=a)for(let w=g;w<l;w+=a){const b=M*l+w;if(!s||s[b]){const U={x:x+(w+.5)*p,y:y-(M+.5)*f,spatialReference:k},P={[Pt]:h+M*u+w};for(let S=0;S<d;S++)P[o[S+1]]=m[S][b];c.push({geometry:U,attributes:P})}}return c}const V=new Map;V.set("meter-per-second",1),V.set("kilometer-per-hour",.277778),V.set("knots",.514444),V.set("feet-per-second",.3048),V.set("mile-per-hour",.44704);const it=180/Math.PI,ot=5,Z=new At({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function rt(t,i){return V.get(t)/V.get(i)||1}function wt(t){return(450-t)%360}function yt(t,i="geographic"){const[e,o]=t,a=Math.sqrt(e*e+o*o);let n=Math.atan2(o,e)*it;return n=(360+n)%360,i==="geographic"&&(n=wt(n)),[a,n]}function Tt(t,i="geographic"){let e=t[1];i==="geographic"&&(e=wt(e)),e%=360;const o=t[0];return[o*Math.cos(e/it),o*Math.sin(e/it)]}function re(t,i,e,o="geographic"){if(!$(t)||e==null)return t;const a=i==="vector-magdir"?t.clone():ct(t,i),n=a.pixels[1];for(let h=0;h<n.length;h++)n[h]=o==="geographic"?(n[h]+e[h]+270)%360:(n[h]+360-e[h])%360;return i==="vector-magdir"?a:ct(a,"vector-magdir")}function ct(t,i,e="geographic",o=1){if(!$(t))return t;const{pixels:a,width:n,height:h}=t,c=n*h,l=a[0],r=a[1],m=t.pixelType.startsWith("f")?t.pixelType:"f32",s=R.createEmptyBand(m,c),u=R.createEmptyBand(m,c);let p=0;for(let d=0;d<h;d++)for(let g=0;g<n;g++)i==="vector-uv"?([s[p],u[p]]=yt([l[p],r[p]],e),s[p]*=o):([s[p],u[p]]=Tt([l[p],r[p]],e),s[p]*=o,u[p]*=o),p++;const f=new R({pixelType:m,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[s,u]});return f.updateStatistics(),f}function se(t,i,e=1){if(e===1||!$(t))return t;const o=t.clone(),{pixels:a,width:n,height:h}=o,c=a[0];a[1];let l=0;for(let r=0;r<h;r++)for(let m=0;m<n;m++)c[l]*=e,l++;return o.updateStatistics(),o}function ae(t,i,e,o,a){if(a==null||!a.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(i/o),height:Math.round(e/o),resolution:t.width/i};const n=a.xmin,h=a.ymax,c=(t.xmax-t.xmin)/i*o,l=(t.ymax-t.ymin)/e*o,r=(c+l)/2;return t.xmin=n+Math.floor((t.xmin-n)/c)*c,t.xmax=n+Math.ceil((t.xmax-n)/c)*c,t.ymin=h+Math.floor((t.ymin-h)/l)*l,t.ymax=h+Math.ceil((t.ymax-h)/l)*l,{extent:t,width:Math.round(t.width/c),height:Math.round(t.height/l),resolution:r}}const _t=kt(0,0,0);function kt(t=0,i=0,e=Math.PI,o=!0){o&&(e=(2*Math.PI-e)%(2*Math.PI));const a=o?-1:1,n=13*a,h=-7*a,c=-2*a,l=-16*a,r=21.75,[m,s]=F(0,i+n,e,r),[u,p]=F(t-5.5,i+h,e,r),[f,d]=F(t+5.5,i+h,e,r),[g,x]=F(t-1.5,i+c,e,r),[y,k]=F(t+1.5,i+c,e,r),[M,w]=F(t-1.5,i+l,e,r),[b,U]=F(t+1.5,i+l,e,r);return[m,s,u,p,g,x,y,k,f,d,M,w,b,U]}function Bt(t=0,i=Math.PI,e=!0){e&&(i=(2*Math.PI-i)%(2*Math.PI));const o=10,a=e?-1:1,n=5*a,h=20*a,c=25*a,l=45,r=0,m=0,s=2,u=0,p=s*a,f=e?1:-1,d=o/2*f;let[g,x]=[r+d,m-h],[y,k]=[g+s*f,x],[M,w]=[y-u*f,k+p],[b,U]=[r-d,m-c],[P,S]=[b+u*f,U-p],v=Math.ceil(t/ot),I=Math.floor(v/10);v-=8*I;const A=[],T=[];for(let W=0;W<v/2;W++,I--){I<=0&&v%2==1&&W===(v-1)/2&&(b=r,P=b+u*f,U=(U+x)/2,S=U-p);const[z,H]=F(b,U,i,l);if(I>0){const[L,Q]=F(y,U,i,l),[Y,tt]=F(g,x,i,l);A.push(L),A.push(Q),A.push(z),A.push(H),A.push(Y),A.push(tt)}else{const[L,Q]=F(y,k,i,l),[Y,tt]=F(M,w,i,l),[Mt,bt]=F(P,S,i,l);T.push(z),T.push(H),T.push(Mt),T.push(bt),T.push(Y),T.push(tt),T.push(L),T.push(Q)}U+=n,x+=n,k+=n,w+=n,S+=n}const[B,C]=F(r+d,m+h,i,l),_=(o/2+s)*f,[N,E]=F(r+_,m+h,i,l),[D,O]=F(r+d,m-c,i,l),[q,j]=F(r+_,m-c,i,l);return{pennants:A,barbs:T,shaft:[B,C,N,E,D,O,q,j]}}function F(t,i,e,o=1){const a=Math.sqrt(t*t+i*i)/o,n=(2*Math.PI+Math.atan2(i,t))%(2*Math.PI);return[a,(2*Math.PI+n-e)%(2*Math.PI)]}const G=[0,1,3,6,10,16,21,27,33,40,47,55,63],Ct=[0,.5,1,1.5,2],Rt=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function J(t,i,e,o){const a=rt(o||"knots",e);let n;for(n=1;n<i.length;n++)if(n===i.length-1){if(t<i[n]*a)break}else if(t<=i[n]*a)break;return Math.min(n-1,i.length-2)}function $t(t,i,e,o,a){let n=0;switch(i){case"beaufort_kn":n=J(t,G,"knots",e);break;case"beaufort_km":n=J(t,G,"kilometer-per-hour",e);break;case"beaufort_ft":n=J(t,G,"feet-per-second",e);break;case"beaufort_m":n=J(t,G,"meter-per-second",e);break;case"classified_arrow":n=J(t,a??[],o,e);break;case"ocean_current_m":n=J(t,Ct,"meter-per-second",e);break;case"ocean_current_kn":n=J(t,Rt,"knots",e)}return n}function Ft(t,i){const{style:e,inputUnit:o,outputUnit:a,breakValues:n}=i,h=Z.fromJSON(o),c=Z.fromJSON(a),l=42,r=15;let m=0,s=0;const{width:u,height:p,mask:f}=t,d=t.pixels[0],g=t.pixels[1],x=f!=null?f.filter(w=>w>0).length:u*p,y=new Float32Array(x*l),k=new Uint32Array(r*x),M=i.invertDirection?kt(0,0,0,!1):_t;for(let w=0;w<p;w++)for(let b=0;b<u;b++){const U=w*u+b;if(!f||f[w*u+b]){const P=(g[U]+360)%360/180*Math.PI,S=$t(d[U],e,h,c,n);for(let I=0;I<M.length;I+=2)y[m++]=(b+.5)/u,y[m++]=(w+.5)/p,y[m++]=M[I],y[m++]=M[I+1]+P,y[m++]=S,y[m++]=d[U];const v=7*(m/l-1);k[s++]=v,k[s++]=v+1,k[s++]=v+2,k[s++]=v+0,k[s++]=v+4,k[s++]=v+3,k[s++]=v+0,k[s++]=v+2,k[s++]=v+3,k[s++]=v+2,k[s++]=v+5,k[s++]=v+3,k[s++]=v+5,k[s++]=v+6,k[s++]=v+3}}return{vertexData:y,indexData:k}}const nt=[];function Nt(t,i){if(nt.length===0)for(let p=0;p<30;p++)nt.push(Bt(5*p,0,!i.invertDirection));const e=rt(Z.fromJSON(i.inputUnit),"knots"),{width:o,height:a,mask:n}=t,h=t.pixels[0],c=t.pixels[1],l=6,r=[],m=[];let s=0,u=0;for(let p=0;p<a;p++)for(let f=0;f<o;f++){const d=p*o+f,g=h[d]*e;if((!n||n[p*o+f])&&g>=ot){const x=(c[d]+360)%360/180*Math.PI,{pennants:y,barbs:k,shaft:M}=nt[Math.min(Math.floor(g/5),29)];if(y.length+k.length===0)continue;let w=r.length/l;const b=(f+.5)/o,U=(p+.5)/a;for(let P=0;P<y.length;P+=2)r[s++]=b,r[s++]=U,r[s++]=y[P],r[s++]=y[P+1]+x,r[s++]=0,r[s++]=g;for(let P=0;P<k.length;P+=2)r[s++]=b,r[s++]=U,r[s++]=k[P],r[s++]=k[P+1]+x,r[s++]=0,r[s++]=g;for(let P=0;P<M.length;P+=2)r[s++]=b,r[s++]=U,r[s++]=M[P],r[s++]=M[P+1]+x,r[s++]=0,r[s++]=g;for(let P=0;P<y.length/6;P++)m[u++]=w,m[u++]=w+1,m[u++]=w+2,w+=3;for(let P=0;P<k.length/8;P++)m[u++]=w,m[u++]=w+1,m[u++]=w+2,m[u++]=w+1,m[u++]=w+2,m[u++]=w+3,w+=4;m[u++]=w+0,m[u++]=w+1,m[u++]=w+2,m[u++]=w+1,m[u++]=w+3,m[u++]=w+2,w+=4}}return{vertexData:new Float32Array(r),indexData:new Uint32Array(m)}}function Et(t,i){let e=0,o=0;const{width:a,height:n,mask:h}=t,c=t.pixels[0],l=[],r=[],m=rt(Z.fromJSON(i.inputUnit),"knots"),s=i.style==="wind_speed"?ot:Number.MAX_VALUE;for(let u=0;u<n;u++)for(let p=0;p<a;p++){const f=c[u*a+p]*m;if((!h||h[u*a+p])&&f<s){for(let g=0;g<4;g++)l[e++]=(p+.5)/a,l[e++]=(u+.5)/n,l[e++]=g<2?-.5:.5,l[e++]=g%2==0?-.5:.5,l[e++]=0,l[e++]=f;const d=4*(e/24-1);r[o++]=d,r[o++]=d+1,r[o++]=d+2,r[o++]=d+1,r[o++]=d+2,r[o++]=d+3}}return{vertexData:new Float32Array(l),indexData:new Uint32Array(r)}}function le(t,i){return i.style==="simple_scalar"?Et(t,i):i.style==="wind_speed"?Nt(t,i):Ft(t,i)}function he(t,i,e,o=[0,0],a=.5){const{width:n,height:h,mask:c}=t,[l,r]=t.pixels,[m,s]=o,u=Math.round((n-m)/e),p=Math.round((h-s)/e),f=u*p,d=new Float32Array(f),g=new Float32Array(f),x=new Uint8Array(f);for(let k=0;k<p;k++)for(let M=0;M<u;M++){let w=0;const b=k*u+M,U=Math.max(0,k*e+s),P=Math.max(0,M*e+m),S=Math.min(h,U+e),v=Math.min(n,P+e);for(let I=U;I<S;I++)for(let A=P;A<v;A++){const T=I*n+A;if(!c||c[T]){w++;const B=[l[T],r[T]],[C,_]=B;d[b]+=C,g[b]+=_}}if(w>=(S-U)*(v-P)*(1-a)){x[b]=1;const[I,A]=yt([d[b]/w,g[b]/w]);d[b]=I,g[b]=A}else x[b]=0,d[b]=0,g[b]=0}const y=new R({width:u,height:p,pixels:[d,g],mask:x});return y.updateStatistics(),y}export{Zt as $,Et as A,zt as B,Lt as C,Kt as D,Xt as F,se as G,oe as H,Vt as I,ee as J,re as K,ne as L,Gt as N,rt as Q,Ht as R,Jt as S,qt as T,Yt as V,Qt as W,Z as X,jt as _,yt as a,$ as b,ae as c,le as d,vt as g,ct as h,te as j,pt as l,at as n,dt as o,ie as q,he as s};
