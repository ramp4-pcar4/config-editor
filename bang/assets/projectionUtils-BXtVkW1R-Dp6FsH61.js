const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./geometryServiceUtils-xDNkl0XV-BbFquCF4.js","./index-BeTPrQ6f.js","./index-BlWAJbpo.css","./project-DVSYTwmh-D1oJHtjg.js","./utils-CRANtbnc-C6zyufvL.js","./utils-t279O251-BBk6rV0U.js"])))=>i.map(i=>d[i]);
import{l as o,S as w,_ as v,N as b}from"./index-BeTPrQ6f.js";import{i as u}from"./HeightModelInfo-Cjals-AI-DMpn5Tsh.js";import{H as M,W as I,G as k,J as R,L as $}from"./projectionUtils-CsX1UTBu-DsZaU4xz.js";function F(e,n,r){const t=H(e),a=n,g=U(t,a,r);if(t){const i=u.deriveUnitFromSR(t,e.spatialReference).heightUnit;if(!r&&i!==t.heightUnit){const s=new o("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${i})`,{horizontalUnit:i});return new o("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:t,error:s})}}if(!T(e)||g===4)return new o("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:t});switch(g){case 1:{const i=(t==null?void 0:t.heightUnit)||"unknown",s=(a==null?void 0:a.heightUnit)||"unknown",c=new o("layerview:incompatible-height-unit",`The vertical units of the layer (${i}) must match the vertical units of the scene (${s})`,{layerUnit:i,sceneUnit:s});return new o("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:t,sceneHeightModelInfo:a,error:c})}case 2:{const i=(t==null?void 0:t.heightModel)||"unknown",s=(a==null?void 0:a.heightModel)||"unknown",c=new o("layerview:incompatible-height-model",`The height model of the layer (${i}) must match the height model of the scene (${s})`,{layerHeightModel:i,sceneHeightModel:s});return new o("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:t,sceneHeightModelInfo:a,error:c})}case 3:{const i=(t==null?void 0:t.vertCRS)||"unknown",s=(a==null?void 0:a.vertCRS)||"unknown",c=new o("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${i}) must match the vertical datum of the scene (${s})`,{layerDatum:i,sceneDatum:s});return new o("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:t,sceneHeightModelInfo:a,error:c})}}return null}function U(e,n,r){if(!d(e)||!d(n))return 4;if(e==null||n==null)return 0;if(!r&&e.heightUnit!==n.heightUnit)return 1;if(e.heightModel!==n.heightModel)return 2;switch(e.heightModel){case"gravity-related-height":return 0;case"ellipsoidal":return e.vertCRS===n.vertCRS?0:3;default:return 4}}function d(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function T(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!p(e)}function H(e){var r;if(e.type==="integrated-mesh-3dtiles"||e.type==="gaussian-splat")return null;const n=e.url?w(e.url):void 0;return!(((r=e.spatialReference)==null?void 0:r.vcsWkid)==null&&n!=null&&n.serverType==="ImageServer")&&f(e)&&e.heightModelInfo?e.heightModelInfo:p(e)?u.deriveUnitFromSR(S,e.spatialReference):null}function f(e){return"heightModelInfo"in e}function m(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function p(e){return m(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):y(e)}function P(e){return e.layers!=null||y(e)||m(e)||f(e)}function y(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"gaussian-splat":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}const S=new u({heightModel:"gravity-related-height"});let h,l=null;async function _(e){l||(l=v(()=>import("./geometryServiceUtils-xDNkl0XV-BbFquCF4.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(n=>h=n)),await l,b(e)}async function C(e,n,r,t){if(!e)return null;const a=e.spatialReference;return k()||R(a,n)?I(e,n):h?h.projectGeometry(e,n,r,t):(await Promise.race([_(t),$(t)]),C(e,n,r,t))}async function x(e,n){try{return e!=null&&e.spatialReference?await M(e,n):null}catch{return null}}export{P as C,x as F,F as H,H as f,C as v};
