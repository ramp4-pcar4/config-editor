const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./visualVariableUtils-DzY4BXXy-D_1S-x1B.js","./index-BeTPrQ6f.js","./index-BlWAJbpo.css","./lengthUtils-CopeXEyE-DjCEitlq.js"])))=>i.map(i=>d[i]);
import{am as E,_ as g,aB as R,bp as A,fX as F,mS as x,g3 as N,mI as U,k6 as M}from"./index-BeTPrQ6f.js";import{g as T}from"./utils-DqlCEhl6-DBO0-7VG.js";import{V as _,b as O}from"./jsxFactory-DN-m49_5-CUFCpKPo.js";import"./intl-DRhjUnwt-Dihhq8dq.js";import{C as B,z as S,R as b}from"./messages-DQ10DjvF-6kk0dzjG.js";import{H as Q}from"./utils-B2aAE6RS-DpuzYE1J.js";import{w as L}from"./typeUtils-BTAsL08--B1VjqkPN.js";function mn({level:n,class:t,...e},o){const l=I(n);return _(`h${l}`,{...e,"aria-level":String(l),class:O(T.heading,t),role:"heading"},o)}function I(n){return E(Math.ceil(n),1,6)}function pn(n,t=1){return I(n+t)}const k=/^-?(\d+)(\.(\d+))?$/i;function q(n,t){return n-t}function D(n,t){let e,o;return e=Number(n.toFixed(t)),e<n?o=e+1/10**t:(o=e,e-=1/10**t),e=Number(e.toFixed(t)),o=Number(o.toFixed(t)),[e,o]}function H(n,t,e,o,l){const r=z(n,t,e,o),i=r.previous==null||r.previous<=l,a=r.next==null||r.next<=l;return i&&a||r.previous+r.next<=2*l}function y(n){const t=String(n),e=t.match(k);if(e!=null&&e[1])return{integer:e[1].split("").length,fractional:e[3]?e[3].split("").length:0};if(t.toLowerCase().includes("e")){const o=t.split("e"),l=o[0],r=o[1];if(l&&r){const i=Number(l);let a=Number(r);const s=a>0;s||(a=Math.abs(a));const u=y(i);return s?(u.integer+=a,a>u.fractional?u.fractional=0:u.fractional-=a):(u.fractional+=a,a>u.integer?u.integer=1:u.integer-=a),u}}return{integer:0,fractional:0}}function z(n,t,e,o){const l={previous:null,next:null};if(e!=null){const r=n-e,i=t-e-r;l.previous=Math.floor(Math.abs(100*i/r))}if(o!=null){const r=o-n,i=o-t-r;l.next=Math.floor(Math.abs(100*i/r))}return l}function dn(n,t={}){const e=n.slice(),{tolerance:o=2,strictBounds:l=!1,indexes:r=e.map((i,a)=>a)}=t;r.sort(q);for(let i=0;i<r.length;i++){const a=r[i],s=e[a],u=a===0?null:e[a-1],c=a===e.length-1?null:e[a+1],f=y(s).fractional;if(f){let m,p=0,d=!1;for(;p<=f&&!d;){const w=D(s,p);m=l&&i===0?w[1]:w[0],d=H(s,m,u,c,o),p++}d&&(e[a]=m)}}return e}const K={maximumFractionDigits:20};function P(n){return b(n,K)}const W="<",Z=">";function $(n,t,e,o){let l="";t===0?l=`${W} `:t===e&&(l=`${Z} `);const r=G(n,o);return r==null?"":l+r}function j(n){const{format:t,fieldFormat:e}=n||{};return(e==null?void 0:e.type)==="number"||!!t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)}function G(n,t){if(n==null)return n;const{fieldType:e,format:o,fieldFormat:l,timeZoneOptions:r}=t||{};if(h(e))return Q(n,{fieldType:e,format:o==null?void 0:o.dateFormat,fieldFormat:(l==null?void 0:l.type)==="date-time"?l:void 0,timeZoneOptions:r});if(typeof n=="string"&&j(t)){const a=Number(n);isNaN(a)||(n=a)}if(typeof n=="string")return n;const i=(l==null?void 0:l.type)==="number"?B(l):o?S(o):void 0;return i?b(n,i):P(n)}const gn=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function X(n){if(!("visualVariables"in n)||!n.visualVariables)return null;const t=n.visualVariables.find(i=>i.type==="color");if(!t)return null;let e=null,o=null;if(t.stops){if(t.stops.length===1)return t.stops[0].color;e=t.stops[0].value,o=t.stops[t.stops.length-1].value}const l=e!=null&&o!=null?e+(o-e)/2:0,{getColor:r}=await g(async()=>{const{getColor:i}=await import("./visualVariableUtils-DzY4BXXy-D_1S-x1B.js");return{getColor:i}},__vite__mapDeps([0,1,2,3]),import.meta.url).then(i=>i.v);return r(t,l)??null}async function hn(n,t){const e=n.trailCap,o=n.trailWidth||1,l=t||await X(n)||n.color;return new F({cap:e,color:l,width:o})}function Y(n,t){var e,o;if(!t)return null;if("featureReduction"in n)switch((e=n.featureReduction)==null?void 0:e.type){case"cluster":case"binning":{const l=n.featureReduction.fields.find(({name:r})=>r.toLowerCase()===t.toLowerCase());return l&&"getField"in n?n.getField(l.onStatisticField):null}}return"getField"in n?(o=n.getField)==null?void 0:o.call(n,t):null}function J(n,t){var o;const e="popupTemplate"in n?(o=n.popupTemplate)==null?void 0:o.fieldInfos:null;if(e!=null&&e.length&&t)return e.find(l=>{var r;return((r=l.fieldName)==null?void 0:r.toLowerCase())===t.toLowerCase()})}function v(n){var o,l,r,i;let t=0,e=0;return n.stops?(t=((l=(o=n.stops)==null?void 0:o.at(0))==null?void 0:l.value)??t,e=((i=(r=n.stops)==null?void 0:r.at(-1))==null?void 0:i.value)??e):"minDataValue"in n&&"maxDataValue"in n&&(t=n.minDataValue??t,e=n.maxDataValue??e),e-t>2*M.days?"short-date":"short-date-short-time"}function h(n){return["date","date-only","time-only","timestamp-offset"].includes(n||"")}function C(n){return U(n)&&!("featureReduction"in n&&n.featureReduction)}function wn(n,t,e){const o=nn(n,t.field,e);return o?(h(o.fieldType)&&(C(n)?o.fieldFormat??(o.fieldFormat=new x({dateStyle:"short",timeStyle:v(t)==="short-date-short-time"?"short":null})):o.format??(o.format=new N({dateFormat:v(t)}))),o):null}function nn(n,t,e){var a,s;const o=Y(n,t),l=o==null?void 0:o.name;if(!l)return null;const r=o==null?void 0:o.type,i=C(n);return{fieldType:r,format:i?null:(a=J(n,l))==null?void 0:a.format,fieldFormat:i?(s=n.getFieldConfiguration(l))==null?void 0:s.fieldFormat:null,timeZoneOptions:h(r)?{layerTimeZone:"preferredTimeZone"in n?n.preferredTimeZone:null,viewTimeZone:e,datesInUnknownTimezone:"datesInUnknownTimezone"in n&&n.datesInUnknownTimezone}:null}}function vn(n,t){var e,o;if("authoringInfo"in n)return(o=(e=n.authoringInfo)==null?void 0:e.visualVariables)==null?void 0:o.find(({theme:l})=>l===t)}function bn(n,t){let e=n??"";return t!=null&&t&&(e=e?"("+e+") AND ("+t+")":t),e}const en=new A([64,64,64]);function V(n,t){const e=[],o=n.length-1;return n.length===5?e.push(0,2,4):e.push(0,o),n.map((l,r)=>e.includes(r)?$(l,r,o,t):null)}async function In(n,t,e){let o=!1,l=[],r=[];if(n.stops){const u=n.stops;l=u.map(c=>c.value),o=u.some(c=>!!c.label),o&&(r=u.map(c=>c.label))}const i=l[0],a=l[l.length-1];if(i==null&&a==null)return null;const s=o?null:V(l,e);return(await Promise.all(l.map(async(u,c)=>{const f=n.type==="opacity"?await tn(u,n,t):(await g(()=>import("./visualVariableUtils-DzY4BXXy-D_1S-x1B.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(p=>p.v)).getColor(n,u),m=o?r[c]:(s==null?void 0:s[c])??"";return f==null?null:{value:u,color:f,label:m}}))).filter(R).reverse()}async function tn(n,t,e){const o=new A(e??en),l=(await g(()=>import("./visualVariableUtils-DzY4BXXy-D_1S-x1B.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(r=>r.v)).getOpacity(t,n);return l!=null&&(o.a=l),o}function yn(n){let t=!1,e=[],o=[];e=n.map(a=>a.value),t=n.some(a=>!!a.label),t&&(o=n.map(a=>a.label??""));const l=e[0],r=e[e.length-1];if(l==null&&r==null)return null;const i=t?null:V(e);return e.map((a,s)=>({value:a,color:on(a,n),label:t?o[s]:(i==null?void 0:i[s])??""})).reverse()}function on(n,t){const{startIndex:e,endIndex:o,weight:l}=ln(n,t);if(e===o)return t[e].color;const r=A.blendColors(t[e].color,t[o].color,l);return new A(r)}function ln(n,t){let e=0,o=t.length-1;return t.some((l,r)=>n<l.value?(o=r,!0):(e=r,!1)),{startIndex:e,endIndex:o,weight:(n-t[e].value)/(t[o].value-t[e].value)}}function Cn(n,t){let e=[];if(n&&n.type==="multipart")n.colorRamps.reverse().forEach((o,l)=>{l===0?e.push({value:t.max,color:new A(o.toColor),label:"high"}):e.push({value:null,color:new A(o.toColor),label:""}),l===n.colorRamps.length-1?e.push({value:t.min,color:new A(o.fromColor),label:"low"}):e.push({value:null,color:new A(o.fromColor),label:""})});else{let o,l;n&&n.type==="algorithmic"?(o=n.fromColor,l=n.toColor):(o=[0,0,0,1],l=[255,255,255,1]),e=[{value:t.max,color:new A(l),label:"high"},{value:t.min,color:new A(o),label:"low"}]}return e}function Vn(n){if(!n.colorStops)return[];const t=[...n.colorStops].filter(o=>{var l;return((l=o.color)==null?void 0:l.a)>0});let e=t.length-1;if(t&&t[0]){const o=t[e];o&&o.ratio!==1&&(t.push(new L({ratio:1,color:o.color})),e++)}return t.map((o,l)=>{var i,a;let r="";return l===0?r=((i=n.legendOptions)==null?void 0:i.minLabel)||"low":l===e&&(r=((a=n.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:o.color,label:r,ratio:o.ratio}}).reverse()}export{dn as $,W as C,on as E,$ as F,mn as H,Z as I,X as N,nn as R,wn as a,In as c,Vn as d,yn as f,y as g,vn as i,gn as n,hn as o,Cn as p,bn as s,G as x,z as y,pn as z};
