import{b as E}from"./quickselect-DHTstthl-Ds_Aj0x5.js";function B(i,t){if(!(this instanceof B))return new B(i,t);this._maxEntries=Math.max(4,i||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&(typeof t=="function"?this.toBBox=t:this._initFormat(t)),this.clear()}function S(i,t,n){if(!n)return t.indexOf(i);for(var r=0;r<t.length;r++)if(n(i,t[r]))return r;return-1}function c(i,t){x(i,0,i.children.length,t,i)}function x(i,t,n,r,h){h||(h=f(null)),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(var a,e=t;e<n;e++)a=i.children[e],d(h,i.leaf?r(a):a);return h}function d(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function _(i,t){return i.minX-t.minX}function v(i,t){return i.minY-t.minY}function Y(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function p(i){return i.maxX-i.minX+(i.maxY-i.minY)}function w(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function F(i,t){var n=Math.max(i.minX,t.minX),r=Math.max(i.minY,t.minY),h=Math.min(i.maxX,t.maxX),a=Math.min(i.maxY,t.maxY);return Math.max(0,h-n)*Math.max(0,a-r)}function g(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function M(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function f(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function b(i,t,n,r,h){for(var a,e=[t,n];e.length;)(n=e.pop())-(t=e.pop())<=r||(a=t+Math.ceil((n-t)/r/2)*r,E(i,a,t,n,h),e.push(t,a,a,n))}B.prototype={all:function(){return this._all(this.data,[])},search:function(i){var t=this.data,n=[],r=this.toBBox;if(!M(i,t))return n;for(var h,a,e,o,s=[];t;){for(h=0,a=t.children.length;h<a;h++)e=t.children[h],M(i,o=t.leaf?r(e):e)&&(t.leaf?n.push(e):g(i,o)?this._all(e,n):s.push(e));t=s.pop()}return n},collides:function(i){var t=this.data,n=this.toBBox;if(!M(i,t))return!1;for(var r,h,a,e,o=[];t;){for(r=0,h=t.children.length;r<h;r++)if(a=t.children[r],M(i,e=t.leaf?n(a):a)){if(t.leaf||g(i,e))return!0;o.push(a)}t=o.pop()}return!1},load:function(i){if(!i||!i.length)return this;if(i.length<this._minEntries){for(var t=0,n=i.length;t<n;t++)this.insert(i[t]);return this}var r=this._build(i.slice(),0,i.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var h=this.data;this.data=r,r=h}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(i){return i!=null&&this._insert(i,this.data.height-1),this},clear:function(){return this.data=f([]),this},remove:function(i,t){if(i==null)return this;for(var n,r,h,a,e=this.data,o=this.toBBox(i),s=[],l=[];e||s.length;){if(e||(e=s.pop(),r=s[s.length-1],n=l.pop(),a=!0),e.leaf&&(h=S(i,e.children,t))!==-1)return e.children.splice(h,1),s.push(e),this._condense(s),this;a||e.leaf||!g(e,o)?r?(n++,e=r.children[n],a=!1):e=null:(s.push(e),l.push(n),n=0,r=e,e=e.children[0])}return this},toBBox:function(i){return i},compareMinX:_,compareMinY:v,toJSON:function(){return this.data},fromJSON:function(i){return this.data=i,this},_all:function(i,t){for(var n=[];i;)i.leaf?t.push.apply(t,i.children):n.push.apply(n,i.children),i=n.pop();return t},_build:function(i,t,n,r){var h,a=n-t+1,e=this._maxEntries;if(a<=e)return c(h=f(i.slice(t,n+1)),this.toBBox),h;r||(r=Math.ceil(Math.log(a)/Math.log(e)),e=Math.ceil(a/Math.pow(e,r-1))),(h=f([])).leaf=!1,h.height=r;var o,s,l,u,m=Math.ceil(a/e),X=m*Math.ceil(Math.sqrt(e));for(b(i,t,n,X,this.compareMinX),o=t;o<=n;o+=X)for(b(i,o,l=Math.min(o+X-1,n),m,this.compareMinY),s=o;s<=l;s+=m)u=Math.min(s+m-1,l),h.children.push(this._build(i,s,u,r-1));return c(h,this.toBBox),h},_chooseSubtree:function(i,t,n,r){for(var h,a,e,o,s,l,u,m;r.push(t),!t.leaf&&r.length-1!==n;){for(u=m=1/0,h=0,a=t.children.length;h<a;h++)s=Y(e=t.children[h]),(l=w(i,e)-s)<m?(m=l,u=s<u?s:u,o=e):l===m&&s<u&&(u=s,o=e);t=o||t.children[0]}return t},_insert:function(i,t,n){var r=this.toBBox,h=n?i:r(i),a=[],e=this._chooseSubtree(h,this.data,t,a);for(e.children.push(i),d(e,h);t>=0&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(h,a,t)},_split:function(i,t){var n=i[t],r=n.children.length,h=this._minEntries;this._chooseSplitAxis(n,h,r);var a=this._chooseSplitIndex(n,h,r),e=f(n.children.splice(a,n.children.length-a));e.height=n.height,e.leaf=n.leaf,c(n,this.toBBox),c(e,this.toBBox),t?i[t-1].children.push(e):this._splitRoot(n,e)},_splitRoot:function(i,t){this.data=f([i,t]),this.data.height=i.height+1,this.data.leaf=!1,c(this.data,this.toBBox)},_chooseSplitIndex:function(i,t,n){var r,h,a,e,o,s,l,u;for(s=l=1/0,r=t;r<=n-t;r++)e=F(h=x(i,0,r,this.toBBox),a=x(i,r,n,this.toBBox)),o=Y(h)+Y(a),e<s?(s=e,u=r,l=o<l?o:l):e===s&&o<l&&(l=o,u=r);return u},_chooseSplitAxis:function(i,t,n){var r=i.leaf?this.compareMinX:_,h=i.leaf?this.compareMinY:v;this._allDistMargin(i,t,n,r)<this._allDistMargin(i,t,n,h)&&i.children.sort(r)},_allDistMargin:function(i,t,n,r){i.children.sort(r);var h,a,e=this.toBBox,o=x(i,0,t,e),s=x(i,n-t,n,e),l=p(o)+p(s);for(h=t;h<n-t;h++)a=i.children[h],d(o,i.leaf?e(a):a),l+=p(o);for(h=n-t-1;h>=t;h--)a=i.children[h],d(s,i.leaf?e(a):a),l+=p(s);return l},_adjustParentBBoxes:function(i,t,n){for(var r=n;r>=0;r--)d(t[r],i)},_condense:function(i){for(var t,n=i.length-1;n>=0;n--)i[n].children.length===0?n>0?(t=i[n-1].children).splice(t.indexOf(i[n]),1):this.clear():c(i[n],this.toBBox)},_initFormat:function(i){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(i[0])),this.compareMinY=new Function("a","b",t.join(i[1])),this.toBBox=new Function("a","return {minX: a"+i[0]+", minY: a"+i[1]+", maxX: a"+i[2]+", maxY: a"+i[3]+"};")}};function j(i,{timeZone:t,timeExtent:n}){return{$view:{scale:i,timeZone:t,timeProperties:{currentStart:n==null?void 0:n.start,currentEnd:n==null?void 0:n.end}}}}export{B as p,j as y};
