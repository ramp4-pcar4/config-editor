import{dF as N,dG as S,dH as y,dI as g,dJ as O,dK as c,dL as f,P as R,l as b,cC as q,x as B,c_ as z,dM as L,dN as x,dO as D}from"./index-BeTPrQ6f.js";import{n as I}from"./UnknownTimeZone-DzO8gKMe-d6rtFXqm.js";import{s as h}from"./timeZoneUtils-CdK7eU4Y-fyhJ3EFx.js";function J(n){return"timeZone"in n}function v(n){return"timeZone"in n}function C(n){return"dateFieldsTimeZone"in n}const A=new Map;let k=class u{static fromJSON(e){return new u(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new u(e.fields??[],T(e))}static fromLayerJSON(e){return new u(e.fields??[],T(e))}constructor(e=[],t){var l;this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const s=[];for(const i of this.fields){const r=i==null?void 0:i.name,d=_(r);if(r&&d){const o=a(r);this._fieldsMap.set(r,i),this._fieldsMap.set(o,i),this._normalizedFieldsMap.set(d,i),s.push(`${o}:${i.type}:${(l=this._timeZoneByFieldName)==null?void 0:l.get(r)}`),N(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):S(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),y(i)||g(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}s.sort(),this.uid=s.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)y(e)||g(e)||e.nullable||O(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===(e==null?void 0:e.uid)}has(e){return this.get(e)!=null}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(a(e))??this._normalizedFieldsMap.get(_(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(e){const t=this.get(e&&typeof e!="string"?e.name:e);return t?this._timeZoneByFieldName?this._timeZoneByFieldName.get(t.name):t.type==="date"||t.type==="esriFieldTypeDate"?(R.getLogger("esri.layers.support.FieldsIndex").errorOnce(new b("getTimeZone:no-timezone-information",`no time zone information for field '${t.name}'`)),c):Z.has(t.type)?f:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===f?I.instance:t===c?q.utcInstance:B(A,t,()=>z.create(t)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return L(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){var t;return((t=this.get(e))==null?void 0:t.name)??void 0}toJSON(){return{fields:this.fields.map(e=>x(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function a(n){return n.trim().toLowerCase()}function _(n){var e;return((e=D(n))==null?void 0:e.toLowerCase())??""}const Z=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function T(n){const e=new Map;if(!n.fields)return e;const t=n.datesInUnknownTimezone===!0,{timeInfo:s,editFieldsInfo:l}=n,i=(s?"startField"in s?s.startField:s.startTimeField:"")??"",r=(s?"endField"in s?s.endField:s.endTimeField:"")??"",d=C(n)?n.dateFieldsTimeZone??null:n.dateFieldsTimeReference?h(n.dateFieldsTimeReference):null,o=l?J(l)?l.timeZone??d:l.dateFieldsTimeReference?h(l.dateFieldsTimeReference):d??c:null,p=s?v(s)?s.timeZone??d:s.timeReference?h(s.timeReference):d:null,w=new Map([[a((l==null?void 0:l.creationDateField)??""),o],[a((l==null?void 0:l.editDateField)??""),o],[a(i),p],[a(r),p]]);for(const{name:m,type:F}of n.fields)if(Z.has(F))e.set(m,f);else if(F!=="date"&&F!=="esriFieldTypeDate")e.set(m,null);else if(t)e.set(m,f);else{const M=w.get(a(m??""))??d;e.set(m,M)}return e}export{k as o};
