import{as as Se,eL as te,at as Ce,aG as Ge,ar as B,bw as Ee,av as D,a2 as G,ae as ie,nX as Re,nY as ze,ab as He,a5 as $e,a3 as oe,eE as j,aj as Le,a7 as ne,aJ as re,a4 as se,eq as Fe,bN as Ae,B as De,i4 as Ne,lg as ae,nG as le,m as n,E as r,n as k}from"./index-BeTPrQ6f.js";import{i as Ze}from"./UpdatingHandles-XotKWqvb-CyHJIoZx.js";import{g as Ye}from"./asyncUtils-Cu__bxqs-ecCTUaGV.js";import{b as Be,n as Je,e as Xe,f as je,k as U,g as qe}from"./SketchTooltipInfo-EowXqHHv-Yp97uw3T.js";import Ke from"./GraphicsLayer-DPoztXf7-DWF8RDJT.js";import{v as Qe,V as We,c as et}from"./drawSurfaces--K8ToToC-FllffqSc.js";import{P as tt,L as ce,Z as it,z as pe,I as ot,a as nt,U as de,C as rt}from"./createUtils-QoBeynM5-wXx8RLRA.js";import{o as st,m as L,g as V,i as at,d as lt}from"./quantityUtils-v7kjLywD-Cq6IoGLM.js";import{E as ct,c as pt,R as dt,x as ut}from"./elevationInfoUtils-DFX5QvG8-DWLx2t7K.js";import{_ as ve,j as X,w as ue,E as he}from"./vec32-CI1xtKog-DFVYRcgb.js";import{o as F,$ as ht,t as yt,H as we,E as Oe,e as gt,K as mt}from"./TooltipInfoWithCoordinates-Ddvg_E_1-DHPxpvzo.js";import{L as ft}from"./angularMeasurementUtils-CVK8K4WU-C6RO-Ta3.js";import{z as _e,N as vt,j as wt}from"./SketchViewModel-BCVIeloG-Cwmt4M0t.js";import{I as Ot,M as Z}from"./boundedPlane-CehKkKe3-4WekUEh5.js";import{R as E}from"./vectorStacks-B2ngxq6F-myhPBoPk.js";import{f as _t,y as kt,V as xt,H as bt}from"./SnappingContext-pR4ApgxC--JaBRde9.js";const q={UndoRedoUpdating:"Cannot perform operation whilst undo redo is updating",UndoInvalidError:"There are no items to Undo",RedoInvalidError:"There are no items to Redo"};class R extends Error{constructor(){super(q.UndoRedoUpdating),this.type="undo-redo-updating-error"}}let Vt=class extends Error{constructor(){super(q.UndoInvalidError),this.type="undo-redo-undo-error"}};class ye extends Error{constructor(){super(q.RedoInvalidError),this.type="undo-redo-redo-error"}}let w=class extends Le{constructor(){super(...arguments),this._stack=new ne,this._stackPosition=-1,this._updatingHandles=new Ze}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(e=>e.destroy())}_drainStack(){this._stack.drain(e=>e.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new Vt;if(this.updating)throw new R;const e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(1),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new ye;if(this.updating)throw new R;const e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new ye;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(2),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new R;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(t=>t.destroy()),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new R;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,t=!1){if(this.updating&&!t)return;await re(()=>!this.updating);const i=new ne;for(let o=0;o<this._stack.length;o++){const s=this._stack.getItemAt(o);s&&(s.tag===e?(s.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(s))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(e=!1){if(this.updating&&!e)throw new R;await re(()=>!this.updating),this._drainStack()}};n([r()],w.prototype,"_stack",void 0),n([r()],w.prototype,"_stackPosition",void 0),n([r()],w.prototype,"updating",null),n([r({readOnly:!0})],w.prototype,"canUndo",null),n([r({readOnly:!0})],w.prototype,"hasUndo",null),n([r({readOnly:!0})],w.prototype,"canRedo",null),n([r({readOnly:!0})],w.prototype,"hasRedo",null),w=n([k("esri.UndoRedo")],w);let Ut=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function M(e,t,i){if(e==null)return"noTool";switch(e){case"point":return Pt();case"multipoint":return"multipoint";case"polyline":return Tt(t,i);case"polygon":return Mt(t,i);case"rectangle":case"circle":return It(t,i);default:return}}function Pt(e){return"point"}function Tt(e,t){const i=e!=null&&e.type==="polyline"&&e.paths.length?e.paths[0].length:0;return t==="freehand"?i<2?"freehandStart":"freehandEnd":i<2?"polylineZeroVertices":"polylineOneVertex"}function Mt(e,t){const i=e!=null&&e.type==="polygon"&&e.rings.length?e.rings[0].length:0;if(i<3)switch(t){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(i<4)return t==="freehand"?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}function It(e,t){if((e!=null&&e.type==="polygon"&&e.rings.length?e.rings[0].length:0)<3)switch(t){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(t){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}function St(e,t){const i=e==null?void 0:e.geometry;if(!e||(i==null?void 0:i.type)!=="mesh"||!t)return;const{renderCoordsHelper:o,elevationProvider:s}=t,{camera:p}=t.state,{extent:l}=i,{center:c,spatialReference:a}=l,h=se(a),y=j(a),g=se(o.spatialReference),v=l.width*h,d=l.height*y,x=(l.zmax??0)*y,S=x-(l.zmin??0)*y,A=Math.max(v,d,S)/g,{x:f,y:b}=c,C=c.z??0;ve(N,f,b,C),o.toRenderCoords(N,a,N);const ee=A/p.computeScreenPixelSizeAt(N);if(ee>Math.min(p.width,p.height)/p.pixelRatio*Gt)return"meshTooClose";if(ee<Ct)return"meshTooFar";const Me=dt(e),{absoluteZ:Ie}=ut(f,b,x,a,t,Me);return Ie<(s.getElevation(f,b,C,a,"ground")??0)*y+S*Et?"meshUnderground":"mesh"}const Ct=20,Gt=1,Et=.1,N=Fe();let O=class extends U{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=L}get allFields(){return[]}};n([r()],O.prototype,"type",void 0),n([r()],O.prototype,"radius",void 0),n([r()],O.prototype,"xSize",void 0),n([r()],O.prototype,"ySize",void 0),n([r()],O.prototype,"area",void 0),n([r()],O.prototype,"helpMessage",void 0),n([r()],O.prototype,"allFields",null),O=n([k("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],O);let z=class extends F(U){constructor(e){super(e),this.type="draw-mesh",this.orientation=ht({lockable:!1}),this.scale=yt({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};n([r()],z.prototype,"helpMessage",void 0),n([r()],z.prototype,"allFields",null),z=n([k("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],z);let H=class extends F(U){constructor(e){super(e),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([r()],H.prototype,"helpMessage",void 0),n([r()],H.prototype,"allFields",null),H=n([k("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],H);let $=class extends F(U){constructor(e){super(e),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([r()],$.prototype,"helpMessage",void 0),n([r()],$.prototype,"allFields",null),$=n([k("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],$);let P=class extends F(U){constructor(e){super(e),this.type="draw-polygon",this.direction=we(),this.distance=Oe(),this.area=gt(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};n([r()],P.prototype,"xyMode",void 0),n([r()],P.prototype,"helpMessage",void 0),n([r()],P.prototype,"allFields",null),P=n([k("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],P);let T=class extends F(U){constructor(e){super(e),this.type="draw-polyline",this.direction=we(),this.distance=Oe(),this.totalLength=mt(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};n([r()],T.prototype,"helpMessage",void 0),n([r()],T.prototype,"xyMode",void 0),n([r()],T.prototype,"allFields",null),T=n([k("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],T);let _=class extends U{constructor(e){super(e),this.type="draw-rectangle",this.xSize=V,this.ySize=V,this.area=L}get allFields(){return[]}};n([r()],_.prototype,"type",void 0),n([r()],_.prototype,"xSize",void 0),n([r()],_.prototype,"ySize",void 0),n([r()],_.prototype,"area",void 0),n([r()],_.prototype,"helpMessage",void 0),n([r()],_.prototype,"allFields",null),_=n([k("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],_);function Rt(e,t){return{point:new $({sketchOptions:t,viewType:e}),multipoint:new H({sketchOptions:t,viewType:e}),polyline:new T({sketchOptions:t,viewType:e}),polygon:new P({sketchOptions:t,viewType:e}),mesh:new z({sketchOptions:t,viewType:e}),rectangle:new _({sketchOptions:t}),circle:new O({sketchOptions:t})}}function ge(e){const{directionOptions:t,geometryType:i,sketchOptions:o,tooltipInfos:s}=e,p=c=>{const a=Y(e).mode,h=s[c].elevation;a==="relative-to-ground"||a==="relative-to-scene"||a==="on-the-ground"?h.lock(W(e)):h.unlock()},l=c=>{if(t){const a=s[c].direction;a.committed=t.angle,a.unlockOnVertexPlacement=!1,o.values.directionMode=t.mode}};switch(i){case"polygon":case"polyline":p(i),l(i);break;case"point":case"mesh":p(i)}}function zt(e,t){const{drawOperation:i,view:o}=t,s=K(t),p=Y(t);if(o.type==="2d"||!e||p.mode!=="absolute-height"||(i==null?void 0:i.numCommittedVertices)!==1||!s||s.type!=="draw-polyline"&&s.type!=="draw-polygon"||s.elevation.locked)return;const[l,c,a]=e,h=jt(l,c,a,p,t);h!=null&&s.elevation.lock(h)}function me(e){var t;(t=K(e))==null||t.allFields.forEach(i=>{i.unlockOnVertexPlacement&&i.unlock()})}function K({geometryType:e,graphic:t,tooltipInfos:i}){var o;return((o=t==null?void 0:t.geometry)==null?void 0:o.type)!==Ht[e]?e==="circle"||e==="rectangle"?i[e]:null:i[e]}const Ht={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline",text:"point"};function $t(e,t){switch(e==null?void 0:e.type){case"draw-point":Lt(e,t);break;case"draw-multipoint":Ft(e,t);break;case"draw-polyline":Dt(e,t);break;case"draw-polygon":Nt(e,t);break;case"draw-rectangle":Yt(e,t);break;case"draw-circle":Bt(e,t);break;case"draw-mesh":At(e,t)}}function Lt(e,t){var o;const i=(o=t.graphic)==null?void 0:o.geometry;(i==null?void 0:i.type)==="point"&&(Q(e,i,t),e.helpMessage=M("point",i,t.drawOperation.drawingMode))}function Ft(e,t){var o;const i=(o=t.graphic)==null?void 0:o.geometry;(i==null?void 0:i.type)==="multipoint"&&(Q(e,i,t),e.helpMessage=M("multipoint",i,t.drawOperation.drawingMode))}function At(e,t){const{graphic:i,view:o}=t,s=i==null?void 0:i.geometry;o.type!=="3d"||s&&s.type!=="mesh"||(Q(e,s==null?void 0:s.origin,t),s&&qe(e,s),e.helpMessage=St(i,o))}function Q(e,t,i){const{drawOperation:o,view:s,sketchOptions:p}=i,{cursorVertex:l}=o;e.sketchOptions=p,e.viewType=s.type;const c=(t==null?void 0:t.type)==="multipoint"?t.getPoint(t.points.length-1):t;if(e.setLocationFromPoint(c,I(i)),xe(e.elevation,i),!l)return void(o.constraints=void 0);const a=l;o.constraints={context:Pe(a,i),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}}function Dt(e,t){const{createOperationGeometry:i,drawOperation:o,automaticLengthMeasurementUtils:s}=t,p=i!=null?i.full:null;p&&p.type!=="polyline"||(ke(e,t),e.totalLength.actual=o.lastVertex?(p?s.autoLength2D(p):null)??V:null,e.helpMessage=M("polyline",p,t.drawOperation.drawingMode))}function Nt(e,t){const{createOperationGeometry:i,drawOperation:o}=t,s=i!=null?i.full:null;s&&s.type!=="polygon"||(ke(e,t),e.area.actual=o.lastVertex?(s?t.automaticAreaMeasurementUtils.autoArea2D(s):null)??L:null,e.helpMessage=M("polygon",s,t.drawOperation.drawingMode))}const fe=Ae(De);function ke(e,t){const{drawOperation:i,sketchOptions:o,view:s,automaticLengthMeasurementUtils:p}=t,{cursorVertex:l,lastVertex:c,secondToLastVertex:a}=i,h=o.values.effectiveDirectionMode;e.sketchOptions=o,e.viewType=s.type;const y=c&&l?p.autoDistanceBetweenPoints2D(fe(c),fe(l))??V:null;if(e.distance.actual=y,e.distance.readOnly=c==null,e.direction.actual=null,e.direction.readOnly=!0,c&&l&&(h==="absolute"||a)){const d=ft(a,c,l,h);e.direction.actual=d??lt,e.direction.readOnly=!1}e.setLocationFromPoint(l,I(t)),xe(e.elevation,t);const g=Zt(c,t);e.xyMode=g,e.direction.visible=g==="direction-distance",e.distance.visible=g==="direction-distance",e.effectiveX.visible=g==="coordinates",e.effectiveY.visible=g==="coordinates";const v=l??c;i.constraints=v?{context:Pe(v,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function Zt(e,{sketchOptions:t}){const i=t.tooltips.xyMode;return i==="auto"?e?"direction-distance":"coordinates":i}function Yt(e,t){var i;e.sketchOptions=t.sketchOptions,e.xSize=Ve(t),e.ySize=Ue(t),e.area=be(t),e.helpMessage=M("rectangle",(i=t.graphic)==null?void 0:i.geometry,t.drawOperation.drawingMode)}function Bt(e,t){var s;const{forceUniformSize:i,sketchOptions:o}=t;e.sketchOptions=o,e.radius=i?Jt(t):null,e.xSize=i?null:Ve(t),e.ySize=i?null:Ue(t),e.area=be(t),e.helpMessage=M("circle",(s=t.graphic)==null?void 0:s.geometry,t.drawOperation.drawingMode)}function xe(e,t){const{drawOperation:i}=t,o=(i==null?void 0:i.cursorVertex)??(i==null?void 0:i.lastVertex);e.actual=wt(o)??W(t),e.visible=i.hasZ,e.readOnly=!1,e.showAsZ=!0}function be(e){var i;const t=(i=e.createOperationGeometry)==null?void 0:i.full;return(t==null?void 0:t.type)!=="polygon"?L:e.automaticAreaMeasurementUtils.autoArea2D(t)??L}function Ve({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){var o;const i=(o=e==null?void 0:e.rectangle)==null?void 0:o.midpoints;return(i!=null?t.autoDistanceBetweenPoints2D(i.left,i.right):null)??V}function Ue({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){var o;const i=(o=e==null?void 0:e.rectangle)==null?void 0:o.midpoints;return(i!=null?t.autoDistanceBetweenPoints2D(i.top,i.bottom):null)??V}function Jt({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){var i;return(((i=e==null?void 0:e.circle)==null?void 0:i.center)!=null&&e.circle.edge!=null?t.autoDistanceBetweenPoints2D(e.circle.center,e.circle.edge):null)??V}function Xt(e){const{geometryType:t,tooltipInfos:i}=e;switch(t){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const o=i[t].elevation.committed;return o?st(o,"meters")/j(I(e)):void 0}default:return}}function jt(e,t,i,o,s){const{view:p,drawOperation:l}=s;if(p.type!=="3d"||!l)return;i??(i=0);const c=I(s),a=Y(s),h=pt(p,e,t,i,c,a,o);return vt(h,c)??W(s)}function Y(e){return e.drawOperation.elevationInfo??ct}function I(e){return e.drawOperation.coordinateHelper.spatialReference}function W(e){const t=j(I(e));return at(e.defaultZ*t,"meters")}function Pe(e,t){return et(e,t.view,I(t),Y(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}let u=class extends Qe{constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new _e}initialize(){const{view:e}=this;this.internalGraphicsLayer=new Ke({listMode:"hide",internal:!0,title:"DrawGraphicTool layer"}),this.view.map.layers.add(this.internalGraphicsLayer);const t=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Rt(e.type,this.sketchOptions);const i=Be(()=>({view:e,options:this.sketchOptions.tooltips}));this.tooltip=i,ge(this._tooltipsContext),this._coordinateFormatterLoadTask=Ye(()=>Je()),this.addHandles([t.on("vertex-add",o=>this.onVertexAdd(o)),t.on("vertex-remove",o=>this.onVertexRemove(o)),t.on("vertex-update",o=>this.onVertexUpdate(o)),t.on("cursor-update",o=>this.onCursorUpdate(o)),t.on("cursor-remove",()=>this._updateGraphic()),t.on("complete",o=>this.onComplete(o)),this._coordinateFormatterLoadTask,i.on("paste",o=>Xe(o,this.activeTooltipInfo)),Se(()=>this.cursor,o=>{t.cursor=o},Ce),te(()=>{const{activeTooltipInfo:o,sketchOptions:s}=this;$t(o,this._tooltipsContext),i.info=s.tooltips.effectiveEnabled?o:null}),te(()=>{t.constraintZ=Xt(this._tooltipsContext)},Ge)]),this.finishToolCreation(),t.initializePointer()}destroy(){this.drawOperation=B(this.drawOperation),this.tooltip=B(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=B(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){const{defaultZ:e,directionOptions:t,drawOperation:i,forceUniformSize:o,geometryType:s,graphic:p,sketchOptions:l,tooltipInfos:c,view:a,automaticAreaMeasurementUtils:h,automaticLengthMeasurementUtils:y}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:e,directionOptions:t,drawOperation:i,forceUniformSize:o,geometryType:s,graphic:p,sketchOptions:l,tooltipInfos:c,view:a,automaticAreaMeasurementUtils:h,automaticLengthMeasurementUtils:y}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),this._graphic!=null&&(this._graphic.symbol=e)}set mode(e){const t=this.drawOperation;t&&(t.drawingMode=e),this._set("mode",e)}get updating(){var e;return((e=this.drawOperation)==null?void 0:e.updating)??!1}get undoRedo(){const{view:{type:e,map:t}}=this;return e==="2d"&&t&&"undoRedo"in t&&t.undoRedo instanceof w?t.undoRedo:null}set undoRedo(e){this._override("undoRedo",e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||je(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&ge(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(m.outline),this.removeHandles(m.regularVertices),this.removeHandles(m.activeVertex),this.removeHandles(m.activeEdge),this.removeHandles(J)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this.updateGraphicGeometry(e),this._graphic;const t=new Ee({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=t,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange("graphic"),this.addHandles(D(()=>{this.internalGraphicsLayer.remove(t),this._graphic===t&&(this._graphic=null)}),J),t}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){var S,A;if(this.drawOperation==null)return;const{coordinateHelper:t,view:i,visualizationCursorVertex:o,lastVertex:s,committedVertices:p,geometryIncludingUncommittedVertices:l,numCommittedVertices:c}=this.drawOperation;if(!(c>0||o!=null))return;const a=e.operationComplete?p:l,h=a.length,y=o!=null?t.pointToArray(o):null,g=this._drawSpatialReference,v=i.type==="3d"&&i.viewingMode==="global",d=new Ut;d.committedVertices=p,d.cursorVertex=y;const{geometryType:x}=this;switch(x){case"point":case"mesh":d.full=t.arrayToPoint(a[0]);break;case"multipoint":d.full=h>0?rt(a,g):null;break;case"polyline":case"polygon":h>0&&(d.full=x==="polygon"?nt([a],g,v,!0):de([a],g,v),d.cursorEdge=y!=null&&s&&!We(o,s)?de([[y,t.pointToArray(s)]],g,v):null,d.outline=h>1?d.full:null);break;case"circle":case"rectangle":{if(d.committedVertices=d.cursorVertex=null,!h)break;const f=tt(i,a[0]),b=a[0],C=f.makeMapPoint(b[0]+qt*i.resolution,b[1]);x==="circle"?h===1&&e.operationComplete?d.circle=ce([b,C],f,!0):h===2&&(this.forceUniformSize?d.circle=ce(a,f,this.centered):d.rectangle=it(a,f,this.centered)):h===1&&e.operationComplete?d.rectangle=pe([b,C],f,!0):h===2&&(d.rectangle=this.forceUniformSize?pe(a,f,this.centered):ot(a,f,this.centered)),d.full=d.circle!=null?d.circle.geometry:(S=d.rectangle)==null?void 0:S.geometry,d.outline=((A=d.full)==null?void 0:A.type)==="polygon"?d.full:null;break}default:return null}return d}initializeGraphic(e){return D()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(t=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){const{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return D()}onCursorEdgeChanged(e){return D()}onVertexAdd(e){var t;me(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||zt((t=e.vertices.at(0))==null?void 0:t.coordinates,this._tooltipsContext),this.emit("vertex-add",e)}onVertexRemove(e){me(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e!=null?(e.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),m.activeEdge):this.removeHandles(m.activeEdge),e.outline!=null?this.addHandles(this.onOutlineChanged(e.outline),m.outline):this.removeHandles(m.outline),e.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(e.committedVertices),m.regularVertices):this.removeHandles(m.regularVertices),e.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(e.cursorVertex),m.activeVertex):this.removeHandles(m.activeVertex),e.full!=null?this._createOrUpdateGraphic(e.full):this.removeHandles(J)):this._destroyAllVisualizations()}get activeTooltipInfo(){var e;return(e=this._coordinateFormatterLoadTask)!=null&&e.finished?K(this._tooltipsContext):null}};n([r()],u.prototype,"_coordinateFormatterLoadTask",void 0),n([r()],u.prototype,"_createOperationGeometry",void 0),n([r()],u.prototype,"_tooltipsContext",null),n([r({value:!0})],u.prototype,"centered",null),n([r()],u.prototype,"cursor",null),n([r({nonNullable:!0})],u.prototype,"defaultZ",void 0),n([r({constructOnly:!0})],u.prototype,"directionOptions",void 0),n([r()],u.prototype,"drawOperation",void 0),n([r()],u.prototype,"elevationLockOnVertexAddDisabled",void 0),n([r({value:!0})],u.prototype,"enabled",null),n([r({value:!0})],u.prototype,"forceUniformSize",null),n([r({constructOnly:!0})],u.prototype,"geometryType",void 0),n([r()],u.prototype,"graphic",null),n([r({constructOnly:!0})],u.prototype,"graphicProperties",void 0),n([r()],u.prototype,"graphicSymbol",null),n([r({constructOnly:!0})],u.prototype,"hasZ",void 0),n([r({constructOnly:!0})],u.prototype,"geometryToPlace",void 0),n([r()],u.prototype,"mode",null),n([r()],u.prototype,"snappingManager",void 0),n([r()],u.prototype,"snapToScene",void 0),n([r()],u.prototype,"tooltip",void 0),n([r()],u.prototype,"tooltipInfos",void 0),n([r({constructOnly:!0,type:_e})],u.prototype,"sketchOptions",void 0),n([r()],u.prototype,"updating",null),n([r({constructOnly:!0,nonNullable:!0})],u.prototype,"view",void 0),n([r({constructOnly:!0})],u.prototype,"automaticAreaMeasurementUtils",void 0),n([r({constructOnly:!0})],u.prototype,"automaticLengthMeasurementUtils",void 0),n([r({constructOnly:!0})],u.prototype,"undoRedo",null),n([r()],u.prototype,"activeTooltipInfo",null),u=n([k("esri.views.draw.DrawGraphicTool")],u);const J=Symbol("create-operation-graphic"),m={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function mi(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const qt=48;function fi(e,t){return Te(e,t,!1)}function vi(e,t){return Te(e,t,!0)}function Te(e,t,i){if(e instanceof _t){if(e.operation instanceof kt)return Kt(e.operation,t,i),!0;if(e.operation instanceof xt)return Qt(e.operation,t,i),!0;if(e.operation instanceof bt)return Wt(e.operation,t,i),!0}return!1}function Kt(e,t,i=!1){const o=i?-1:1,s=Ne(o*e.dx,o*e.dy,o*e.dz);X(t.origin,t.origin,s),Z(t)}function Qt(e,t,i=!1){const o=i?-e.angle:e.angle;ue(t.basis1,t.basis1,ae,o),ue(t.basis2,t.basis2,ae,o),Z(t)}function Wt(e,t,i=!1){const o=i?1/e.factor1:e.factor1,s=i?1/e.factor2:e.factor2;he(t.basis1,t.basis1,o),he(t.basis2,t.basis2,s),le(t.origin,t.origin,e.origin,e.axis1,o),le(t.origin,t.origin,e.origin,e.axis2,s),Z(t)}function wi(e,t,i,o,s=!1){o||(o=Ot());const p=G(E.get(),e[1],-e[0]),l=G(E.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=G(E.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),a=E.get(),h=t.allVerticesUnordered;h.forEach(({pos:d})=>{G(a,ie(e,d),ie(p,d)),Re(l,l,a),ze(c,c,a)});const y=1e-6,g=G(E.get(),c[0]-l[0]<y?i/2:0,c[1]-l[1]<y?i/2:0);He(l,l,g),$e(c,c,g);const v=s?h.reduce((d,x)=>d+(x.pos[2]??0),0)/h.length:0;return oe(o.basis1,e,(c[0]-l[0])/2),oe(o.basis2,p,(c[1]-l[1])/2),ve(o.origin,l[0]*e[0]+l[1]*p[0],l[0]*e[1]+l[1]*p[1],v),X(o.origin,o.origin,o.basis1),X(o.origin,o.origin,o.basis2),Z(o),o}export{vi as $,mi as J,fi as K,wi as o,u};
