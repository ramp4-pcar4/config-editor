import{ao as q,dz as C,fs as A,a8 as O}from"./index-DLCK036j.js";import{m as P}from"./lengthUtils-wU9RRIqK-6yOWjVC2.js";var S,m;function L(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function z(e){return e!=null&&!isNaN(e)&&isFinite(e)}function Z(e){return e.valueExpression?S.Expression:e.field&&typeof e.field=="string"?S.Field:S.Unknown}function te(e,a){const t=a||Z(e),n=e.valueUnit||"unknown";return t===S.Unknown?m.Constant:e.stops?m.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?m.ClampedLinear:n==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?m.Proportional:m.Additive:m.Identity:m.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(S||(S={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(m||(m={}));const D=()=>O.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),g=e=>D().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),w=()=>D().error("Use of arcade expressions requires an arcade context"),R=new q,y=Math.PI,_=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function M(e,a,t){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(c=>c.type==="color"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void g("ColorVariable");const i=typeof a=="number",r=i?null:a,s=r==null?void 0:r.attributes;let o=i?a:null;const l=n.field,{ipData:d,hasExpression:p}=n.cache;let u=n.cache.compiledFunc;if(!l&&!p){const c=n.stops;return c&&c[0]&&c[0].color}if(typeof o!="number")if(p){if((t==null?void 0:t.arcade)==null)return void w();const c={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},f=t.arcade.arcadeUtils,V=f.getViewInfo(c),x=f.createExecContext(r,V,t.timeZone);if(!u){const k=f.createSyntaxTree(n.valueExpression);u=f.createFunction(k),n.cache.compiledFunc=u}o=f.executeFunction(u,x)}else s&&(o=s[l]);const v=n.normalizationField,b=s!=null&&v!=null?parseFloat(s[v]):void 0;if(o!=null&&(!v||i||!isNaN(b)&&b!==0)){isNaN(b)||i||(o/=b);const c=E(o,d);if(c){const f=c[0],V=c[1],x=f===V?n.stops[f].color:C.blendColors(n.stops[f].color,n.stops[V].color,c[2],t==null?void 0:t.color);return new C(x)}}}function N(e,a,t){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(c=>c.type==="opacity"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void g("OpacityVariable");const i=typeof a=="number",r=i?null:a,s=r==null?void 0:r.attributes;let o=i?a:null;const l=n.field,{ipData:d,hasExpression:p}=n.cache;let u=n.cache.compiledFunc;if(!l&&!p){const c=n.stops;return c&&c[0]&&c[0].opacity}if(typeof o!="number")if(p){if((t==null?void 0:t.arcade)==null)return void w();const c={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},f=t.arcade.arcadeUtils,V=f.getViewInfo(c),x=f.createExecContext(r,V,t.timeZone);if(!u){const k=f.createSyntaxTree(n.valueExpression);u=f.createFunction(k),n.cache.compiledFunc=u}o=f.executeFunction(u,x)}else s&&(o=s[l]);const v=n.normalizationField,b=s!=null&&v!=null?parseFloat(s[v]):void 0;if(o!=null&&(!v||i||!isNaN(b)&&b!==0)){isNaN(b)||i||(o/=b);const c=E(o,d);if(c){const f=c[0],V=c[1];if(f===V)return n.stops[f].opacity;{const x=n.stops[f].opacity;return x+(n.stops[V].opacity-x)*c[2]}}}}function U(e,a,t){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(b=>b.type==="rotation"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void g("RotationVariable");const i=n.axis||"heading",r=i==="heading"&&n.rotationType==="arithmetic"?90:0,s=i==="heading"&&n.rotationType==="arithmetic"?-1:1,o=typeof a=="number"?null:a,l=o==null?void 0:o.attributes,d=n.field,{hasExpression:p}=n.cache;let u=n.cache.compiledFunc,v=0;if(!d&&!p)return v;if(p){if((t==null?void 0:t.arcade)==null)return void w();const b={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},c=t.arcade.arcadeUtils,f=c.getViewInfo(b),V=c.createExecContext(o,f,t.timeZone);if(!u){const x=c.createSyntaxTree(n.valueExpression);u=c.createFunction(x),n.cache.compiledFunc=u}v=c.executeFunction(u,V)}else l&&(v=l[d]||0);return v=typeof v!="number"||isNaN(v)?null:r+s*v,v}function $(e,a,t){const n=typeof a=="number",i=n?null:a,r=i==null?void 0:i.attributes;let s=n?a:null;const{isScaleDriven:o}=e.cache;let l=e.cache.compiledFunc;if(o){const p=t==null?void 0:t.scale,u=t==null?void 0:t.view;s=p==null||u==="3d"?j(e):p}else if(!n)switch(e.inputValueType){case S.Expression:{if((t==null?void 0:t.arcade)==null)return void w();const p={viewingMode:t.viewingMode,scale:t.scale,spatialReference:t.spatialReference},u=t.arcade.arcadeUtils,v=u.getViewInfo(p),b=u.createExecContext(i,v,t.timeZone);if(!l){const c=u.createSyntaxTree(e.valueExpression);l=u.createFunction(c),e.cache.compiledFunc=l}s=u.executeFunction(l,b);break}case S.Field:r&&(s=r[e.field]);break;case S.Unknown:s=null}if(!z(s))return null;if(n||!e.normalizationField)return s;const d=r?parseFloat(r[e.normalizationField]):null;return z(d)&&d!==0?s/d:null}function j(e){let a=null,t=null;const n=e.stops;return n?(a=n[0].value,t=n[n.length-1].value):(a=e.minDataValue||0,t=e.maxDataValue||0),(a+t)/2}function F(e,a,t){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find(r=>r.type==="size"):e;if(!n)return;if(n.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void g("SizeVariable");const i=I($(n,a,t),n,a,t,n.cache.ipData);return i==null||isNaN(i)?0:i}function h(e,a,t){return e==null?null:L(e)?F(e,a,t):z(e)?e:null}function T(e,a,t){return z(t)&&e>t?t:z(a)&&e<a?a:e}function W(e,a,t,n){return e+((h(a.minSize,t,n)||a.minDataValue)??0)}function B(e,a,t){const n=e.stops;let i=(n==null?void 0:n.length)&&n[0].size;return i==null&&(i=e.minSize),h(i,a,t)}function G(e,a,t,n){const i=(e-a.minDataValue)/(a.maxDataValue-a.minDataValue),r=h(a.minSize,t,n),s=h(a.maxSize,t,n),o=n==null?void 0:n.shape;if(e<=a.minDataValue)return r;if(e>=a.maxDataValue)return s;if(r==null||s==null)return null;if(a.scaleBy==="area"&&o){const l=o==="circle",d=l?y*(r/2)**2:r*r,p=d+i*((l?y*(s/2)**2:s*s)-d);return l?2*Math.sqrt(p/y):Math.sqrt(p)}return r+i*(s-r)}function H(e,a,t,n){const i=n==null?void 0:n.shape,r=e/a.minDataValue,s=h(a.minSize,t,n),o=h(a.maxSize,t,n);let l=null;return l=i==="circle"?2*Math.sqrt(r*(s/2)**2):i==="square"||i==="diamond"||i==="image"?Math.sqrt(r*s**2):r*s,T(l,s,o)}function J(e,a,t,n,i){var l,d,p;const[r,s,o]=E(e,i);if(r===s)return h((l=a.stops)==null?void 0:l[r].size,t,n);{const u=h((d=a.stops)==null?void 0:d[r].size,t,n);return u+(h((p=a.stops)==null?void 0:p[s].size,t,n)-u)*o}}function K(e,a,t,n){const i=((n==null?void 0:n.resolution)??1)*P[a.valueUnit],r=h(a.minSize,t,n),s=h(a.maxSize,t,n),{valueRepresentation:o}=a;let l=null;return l=o==="area"?2*Math.sqrt(e/y)/i:o==="radius"||o==="distance"?2*e/i:e/i,T(l,r,s)}function I(e,a,t,n,i){switch(a.transformationType){case m.Additive:return W(e,a,t,n);case m.Constant:return B(a,t,n);case m.ClampedLinear:return G(e,a,t,n);case m.Proportional:return H(e,a,t,n);case m.Stops:return J(e,a,t,n,i);case m.RealWorldSize:return K(e,a,t,n);case m.Identity:return e;case m.Unknown:return null}}function Q(e,a,t){const{isScaleDriven:n}=e.cache;if(!(n&&t==="3d"||a))return null;const i={scale:a,view:t};let r=h(e.minSize,R,i),s=h(e.maxSize,R,i);if(r!=null||s!=null){if(r>s){const o=s;s=r,r=o}return{minSize:r,maxSize:s}}}function X(e,a,t){if(!e.visualVariables)return;const n=[],i=[],r=[],s=[],o=[];for(const l of e.visualVariables)switch(l.type){case"color":i.push(l);break;case"opacity":r.push(l);break;case"rotation":o.push(l);break;case"size":s.push(l)}return i.forEach(l=>{const d=M(l,a,t);n.push({variable:l,value:d})}),r.forEach(l=>{const d=N(l,a,t);n.push({variable:l,value:d})}),o.forEach(l=>{const d=U(l,a,t);n.push({variable:l,value:d})}),s.forEach(l=>{const d=F(l,a,t);n.push({variable:l,value:d})}),n.filter(l=>l.value!=null)}function E(e,a){if(!a)return;let t=0,n=a.length-1;return a.some((i,r)=>e<i?(n=r,!0):(t=r,!1)),[t,n,(e-a[t])/(a[n]-a[t])]}function Y(e,a,t){const n=["proportional","proportional","proportional"];for(const i of e){const r=i.useSymbolValue?"symbol-value":F(i,a,t);switch(i.axis){case"width":n[0]=r;break;case"depth":n[1]=r;break;case"height":n[2]=r;break;case"width-and-depth":n[0]=r,n[1]=r;break;case"all":case void 0:case null:n[0]=r,n[1]=r,n[2]=r;break;default:A(i.axis)}}return n}const ae=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Y,getColor:M,getOpacity:N,getRotationAngle:U,getSize:F,getSizeForValue:I,getSizeFromNumberOrVariable:h,getSizeRangeAtScale:Q,getVisualVariableValues:X,viewScaleRE:_},Symbol.toStringTag,{value:"Module"}));export{X as R,Y as T,te as a,ae as b,L as e,U as h,m as i,Z as t,_ as v};
