var ae=Object.defineProperty;var ne=(v,t,n)=>t in v?ae(v,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):v[t]=n;var B=(v,t,n)=>ne(v,typeof t!="symbol"?t+"":t,n);import{fv as P,fw as K,fx as oe,fy as N,fz as R,fA as V,fB as q,fC as G,fD as p,fE as k,fF as X,fG as L,fH as z,fI as S,fJ as O,fK as _,fL as ie,fM as Z,fN as ee,fO as T,fP as $,fQ as W,fR as te,fS as se,fT as le,fU as re,fV as pe,fW as ue,fX as ce,fY as F,fZ as E,f_ as M,f$ as Q,g0 as U,g1 as de,g2 as fe,g3 as me,g4 as j,g5 as ve}from"./index-JysQxb7m.js";class D{constructor(t){B(this,"id");B(this,"options");B(this,"componentId");const n={options:{},...t};({id:this.id,options:this.options,componentId:this.componentId}=n)}}const he=["innerHTML"],H=P({__name:"default-button",props:{panelId:{type:String,required:!0},minimize:{type:Boolean,default:!1},overflow:{type:Boolean}},setup(v){const{t}=R(),n=V("iApi"),i=v,f=q(()=>{var a;return(a=n.panel.get(i.panelId))==null?void 0:a.button}),l=()=>{i.minimize?n.panel.toggleMinimize(i.panelId):n.panel.toggle(i.panelId)};return(a,I)=>{const u=G("appbar-button");return f.value?(p(),k(u,{key:0,onClickFunction:l,tooltip:S(t)(f.value.tooltip),id:v.panelId},{default:X(()=>[L("div",{class:z(["default fill-current w-24 h-24 ml-8 sm:ml-20",{"ml-20":v.overflow}]),innerHTML:f.value.icon},null,10,he)]),_:1},8,["tooltip","id"])):O("",!0)}}}),ge={},be={class:"border-b p-0 self-center w-2/3"};function $e(v,t){return p(),$("span",be)}const Y=K(ge,[["render",$e],["__scopeId","data-v-5d32b715"]]);var ye={name:"maxSize",enabled:!0,phase:"main",requiresIfExists:["offset","preventOverflow","flip"],fn:function(v){var t=v.state,n=v.name,i=v.options,f=ve(t,i),l=t.modifiersData.preventOverflow||{x:0,y:0},a=l.x,I=l.y,u=t.rects.popper,c=u.width,b=u.height,C=t.placement.split("-"),y=C[0],A=y==="left"?"left":"right",s=y==="top"?"top":"bottom";t.modifiersData[n]={width:c-f[A]-a,height:b-f[s]-I}}};const we=["content","aria-label"],xe=P({__name:"more-button",props:{position:{type:String,default:"right-end"},popperOptions:{type:Object,default(){return{}}},numItems:{type:Number,default:1},renderWatch:{type:Number,default:0}},emits:["updateParent"],setup(v,{expose:t,emit:n}){const{t:i}=R(),f=V("iApi"),l=v,a=n;function I(){a("updateParent")}const u=_(!1),c=_(0),b=_(),C=_(),y=_();function A(){I(),F(()=>{s(),u.value=!u.value})}ie(()=>l.renderWatch,()=>{A()});const s=()=>{u.value=!u.value;const e=f.$vApp.$el.querySelector(".inner-shell"),d={name:"applyMaxSize",enabled:!0,phase:"beforeWrite",requires:["maxSize"],fn({state:m}){var h;const{width:w}=m.modifiersData.maxSize;m.styles.popper={...m.styles.popper,maxWidth:`${w}px`,maxHeight:`${e.offsetHeight-45}px`};const g=Math.min(l.numItems<=0?0:55+44*(l.numItems-1),e.offsetHeight-45);m.styles.popper.height=`${g}px`,(h=y==null?void 0:y.value)!=null&&h.offsetHeight&&(y.value.style.height=`${g}px`),m.styles.popper.overflowY="auto",m.styles.popper.overflowX="hidden"}};C.value&&y.value&&(c.value++,me(C.value,y.value,{placement:l.position||"right-end",modifiers:[{...ye,options:{boundary:e}},d,{name:"offset",options:{offset:[0,5]}},{name:"preventOverflow",enabled:!0,options:{boundary:e}}],...l.popperOptions})),c.value===1&&A()};return Z(()=>{window.addEventListener("click",e=>{var d;e.target instanceof HTMLElement&&!((d=b.value)!=null&&d.contains(e.target))&&(u.value=!1)},{capture:!0})}),ee(()=>{window.removeEventListener("click",e=>{var d;e.target instanceof HTMLElement&&!((d=b.value)!=null&&d.contains(e.target))&&(u.value=!1)},{capture:!0})}),t({rerender:A}),(e,d)=>{const m=T("focus-item"),w=T("tippy");return p(),$("div",{class:"appbar-item relative inset-x-0 w-full text-center",ref_key:"el",ref:b},[W((p(),$("button",{type:"button",class:"text-gray-400 w-full h-48 focus:outline-none hover:text-white",onClick:d[0]||(d[0]=g=>s()),content:S(i)("appbar.more"),"aria-label":S(i)("appbar.more"),ref_key:"dropdownTrigger",ref:C},d[1]||(d[1]=[L("svg",{class:"fill-current w-24 h-24 m-auto",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[L("path",{d:"M0 0h24v24H0z",fill:"none"}),L("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})],-1)]),8,we)),[[m],[w,{placement:"right-end"}]]),W(L("div",{id:"dropdown",class:"dropdown shadow-md border border-gray:200 absolute w-64 flex flex-col bg-white rounded",ref_key:"dropdown",ref:y},[se(e.$slots,"default",{},void 0,!0)],512),[[te,u.value]])],512)}}}),Ie=K(xe,[["__scopeId","data-v-87bcc276"]]),Ee={key:0,class:"number absolute top-1 right-2 text-white w-18 rounded-full"},ke=P({__name:"appbar-button",setup(v){const t=le(),{t:n}=R(),i=V("iApi"),f=q(()=>t.notificationNumber),l=()=>{i.panel.toggle("notifications")};return(a,I)=>{const u=G("appbar-button",!0);return p(),k(u,{onClickFunction:l,tooltip:S(n)("notifications.title"),class:"notification-button",id:""},{default:X(()=>[I[0]||(I[0]=L("svg",{class:"fill-current w-24 h-24 mx-8 sm:mx-20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[L("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})],-1)),f.value&&f.value>0?(p(),$("span",Ee,re(f.value),1)):O("",!0)]),_:1},8,["tooltip"])}}}),_e=K(ke,[["__scopeId","data-v-787da765"]]),ze=["content"],Ae=P({__name:"appbar",setup(v){const t=pe(),n=N(),i=_(0),f=_(0),l=q(()=>n.visible),a=q(()=>n.temporary),{t:I}=R(),u=_(!1),c=_({}),b=_(),C=()=>{F(()=>{var s,e;(e=(s=j())==null?void 0:s.proxy)==null||e.$forceUpdate()})},y=()=>{b.value._tippy.hide()},A=s=>{var e;s.key==="Tab"&&((e=b.value)!=null&&e.matches(":focus"))&&b.value._tippy.show()};return Z(()=>{var s,e;(s=b.value)==null||s.addEventListener("blur",y),(e=b.value)==null||e.addEventListener("keyup",A)}),ue(()=>{const s=j();window.addEventListener("resize",()=>{var e;return(e=s==null?void 0:s.proxy)==null?void 0:e.$forceUpdate()})}),ee(()=>{var e,d;const s=j();window.removeEventListener("resize",()=>{var m;return(m=s==null?void 0:s.proxy)==null?void 0:m.$forceUpdate()}),(e=b.value)==null||e.removeEventListener("blur",y),(d=b.value)==null||d.removeEventListener("keyup",A)}),ce(()=>{F(()=>{const s=b.value;let e;const d=[...s.children];let m=d[d.length-2].getBoundingClientRect().top;t.mobileView||(m=s.getBoundingClientRect().bottom-38);const w=s.querySelector("#dropdown");for(let o=d.length-4;o>=0;o--){const r=d[o].getBoundingClientRect().bottom;if(m&&w&&(r>m||u.value&&r+56>m))d[o].classList.forEach(x=>{x.includes("identifier")&&(e=x.slice(11))}),e&&(c.value[e]=!0,e.includes("divider")||i.value++,f.value++),u.value||(u.value=!0);else if(r!==0)break}const g=s.querySelector("#more");let h=g.getBoundingClientRect().bottom;if(e=void 0,u.value&&m&&g&&w&&h!==0&&(h<=m-56||w.childElementCount==1&&h<=m)){let o=w.childElementCount,r=0;for(;h<=m-56||o==1;){const x=w.children[r];if(x&&(x.classList.forEach(J=>{J.includes("identifier")&&(e=J.slice(11))}),e&&(c.value[e]=!1,e.includes("divider")||i.value--),h+=48,o-=1,r+=1),o===0){u.value=!1;break}}}Object.keys(c.value).forEach(o=>{s.querySelector(`.identifier-${o}`)||(delete c.value[o],o.includes("divider")||(i.value=Math.max(0,i.value-1)),f.value++)})})}),(s,e)=>{var w;const d=T("focus-list"),m=T("tippy");return W((p(),$("div",{class:"absolute top-0 left-0 bottom-28 flex flex-col w-40 pointer-events-auto appbar z-50 sm:z-20 bg-black-75 sm:w-64 sm:bottom-38",content:S(I)("panels.controls.items"),ref_key:"el",ref:b},[(p(!0),$(E,null,M(l.value,(g,h)=>(p(),$(E,null,[(p(!0),$(E,null,M(g,(o,r)=>(p(),$(E,null,[typeof o=="string"&&c.value[`${o}-${r}`]!==!0?(p(),k(H,{key:`${o}-${r}-default`,panelId:o,class:z(["appbar-item h-48",`identifier-${o}-${r}`])},null,8,["panelId","class"])):c.value[`${o.id}-${r}`]!==!0?(p(),k(Q(o.componentId),{key:`${o.id}-${r}-custom`,options:o.options,class:z(["appbar-item h-48",`identifier-${o.id}-${r}`]),buttonId:o.id},null,8,["options","buttonId","class"])):O("",!0)],64))),256)),c.value[`divider-${h}`]!==!0?(p(),k(Y,{class:z(["appbar-item",`identifier-divider-${h}`]),key:`${g}-${h}-default`},null,8,["class"])):O("",!0)],64))),256)),(p(!0),$(E,null,M((w=a.value)==null?void 0:w.filter(g=>c.value[`${g}-temp`]!==!0),g=>(p(),k(H,{panelId:g,minimize:!0,key:`${g}-temp`,class:z([`identifier-${g}-temp`,"appbar-item h-48"])},null,8,["panelId","class"]))),128)),W(U(Ie,{id:"more",numItems:i.value,renderWatch:f.value,onUpdateParent:C},{default:X(()=>{var g;return[(p(!0),$(E,null,M(l.value,(h,o)=>(p(),$(E,{key:o},[(p(!0),$(E,null,M(h,(r,x)=>(p(),$(E,null,[typeof r=="string"&&c.value[`${r}-${x}`]?(p(),k(H,{key:`${r}-${x}-default`,panelId:r,class:z(["text-black hover:bg-gray my-4 h-36",`identifier-${r}-${x}`]),overflow:""},null,8,["panelId","class"])):c.value[`${r.id}-${x}`]?(p(),k(Q(r.componentId),{key:`${r.id}-${x}-custom`,options:r.options,buttonId:r.id,class:z(["appbar-item h-48",`identifier-${r.id}-${x}`])},null,8,["options","buttonId","class"])):O("",!0)],64))),256)),c.value[`divider-${o}`]?(p(),k(Y,{key:0,class:z(["border-black my-4",`identifier-divider-${o}`])},null,8,["class"])):O("",!0)],64))),128)),(p(!0),$(E,null,M((g=a.value)==null?void 0:g.filter(h=>c.value[`${h}-temp`]),h=>(p(),k(H,{panelId:h,minimize:!0,key:`${h}-temp`,class:z([`identifier-${h}-temp`,"text-black hover:bg-gray my-4 h-36"]),overflow:""},null,8,["panelId","class"]))),128))]}),_:1},8,["numItems","renderWatch"]),[[te,u.value]]),U(_e,{class:"appbar-item bottom-48 h-48 sm:display-none"}),U(de,{class:"absolute bottom-0 h-40 sm:display-none w-full text-center",position:"right-start"})],8,ze)),[[d],[m,{trigger:"manual",touch:!1,placement:"top-end",popperOptions:{placement:"top",modifiers:[{name:"preventOverflow",options:{altAxis:!0}},{name:"flip",options:{fallbackPlacements:["top"]}}]}}]])}}});class Ce extends fe{get config(){return super.config}_parseConfig(t){if(!t)return;const n=N(this.$vApp.$pinia);let i;Array.isArray(t.items[0])?i=t.items:i=[t.items];const f=[];i.forEach(l=>{f.push(l.map(a=>typeof a=="string"?a:new D(a)))}),n.items=f.flat().reduce((l,a)=>(l[a instanceof D?a.id:a]=a,l),{}),n.order=f.map(l=>l.map(a=>a instanceof D?a.id:a)),this._validateItems()}_validateItems(){const t=N(this.$vApp.$pinia);t.order.flat().forEach(n=>{typeof t.items[n]!="string"&&[n].some(i=>{this.$iApi.fixture.exists(i)&&!t.items[n]&&(t.items[n].componentId=`${i}-appbar-button`)})})}}const Le={en:{"appbar.navigation":"Navigation","appbar.more":"More","navigation.export":"Export","navigation.map.export":"Export Map"},fr:{"appbar.navigation":"Navigation","appbar.more":"Plus","navigation.export":"Exporter","navigation.map.export":"Exporter la Carte"}};class Se extends Ce{initialized(){}async added(){Object.entries(Le).forEach(a=>this.$iApi.$i18n.mergeLocaleMessage(...a));const{destroy:t,el:n}=this.mount(Ae,{app:this.$element}),i=this.$vApp.$el.getElementsByClassName("inner-shell")[0];i.insertBefore(n.childNodes[0],i.querySelector(".panel-stack")),this._parseConfig(this.config);const f=this.$vApp.$watch(()=>this.config,a=>this._parseConfig(a)),l=[];l.push(this.$iApi.event.on(oe.COMPONENT,()=>{this._parseConfig(this.config)})),this.removed=()=>{const a=N(this.$vApp.$pinia);f(),l.forEach(c=>this.$iApi.event.off(c));const I={...a.items},u=[...a.temporary];Object.keys(I).forEach(c=>a.removeButton(c)),u.forEach(c=>a.removeButton(c)),t(),a.$reset()}}}export{Se as default};
