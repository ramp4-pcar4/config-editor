const L=9999999e31,S=2e-7,w={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function x(e){return w[e]??[-34028234663852886e22,34028234663852886e22]}const U={u1:1,u2:1,u4:1,u8:1,s8:1,u16:2,s16:2,u32:4,s32:4,f32:4,f64:8,unknown:4,c64:16,c128:32};function V(e){return U[e]}function P(e){return V(e.pixelType)*e.bandCount}function T(e,n){return e==null||n==null?"s32":e<0?e>=-128&&n<128?"s8":e>=-32768&&n<32768?"s16":"s32":n<256?"u8":n<65536?"u16":"u32"}function v(e){return((e==null?void 0:e.startsWith("s"))||(e==null?void 0:e.startsWith("u")))??!1}function W(e,n,s,f){let[l,i]=x(s);const t=v(s);return t&&(l-=1e-5,i+=1e-5),t?s.startsWith("u")?C(e,n,f,[l,i]):I(e,n,f,[l,i]):O(e,n,f,[l,i])}function X(e,n){for(let s=0;s<n.length;s++)n[s]&&isNaN(e[s])&&(n[s]=0,e[s]=0)}function C(e,n,s,f){const[l,i]=f;for(let t=0;t<n.length;t++)if(n[t]){const u=e[t];u<l||u>i?n[t]=0:s[t]=u+.5|0}}function I(e,n,s,f){const[l,i]=f;for(let t=0;t<n.length;t++)if(n[t]){const u=e[t];u<l||u>i?n[t]=0:s[t]=u+(u>0?.5:-.5)|0}}function O(e,n,s,f){const[l,i]=f;for(let t=0;t<n.length;t++)if(n[t]){const u=e[t];u<l||u>i?n[t]=0:s[t]=u}}function _(e,n,s){var k,M;if(e.depthCount&&e.depthCount>1)return;const{pixels:f,statistics:l,pixelType:i}=e,t=f[0].length,u=e.bandMasks??[],g=e.mask??new Uint8Array(t).fill(255),y=i==="f32"||i==="f64",N=x(i);let p=!1;for(let o=0;o<f.length;o++){const a=typeof n=="number"?n:n[o];if(a==null)continue;const d=((k=l==null?void 0:l[o])==null?void 0:k.minValue)??N[0],m=((M=l==null?void 0:l[o])==null?void 0:M.maxValue)??N[1];if(d>a+Number.EPSILON||m<a-Number.EPSILON)continue;const h=u[o]||g.slice(),c=f[o],A=s==null?void 0:s.customFloatTolerance;if(y&&A!==0){let r=A;r||(r=Math.abs(a)>=L?S*Math.abs(a):i==="f32"?2**-23:Number.EPSILON);for(let b=0;b<c.length;b++)h[b]&&Math.abs(c[b]-a)<r&&(c[b]=0,h[b]=0,g[b]=0,p=!0)}else for(let r=0;r<c.length;r++)h[r]&&c[r]===a&&(c[r]=0,h[r]=0,g[r]=0,p=!0);u[o]=h}if(p){const o=e.bandMasks||e.pixels.length>1?u:null;s!=null&&s.matchAllNoData?e.mask=o&&o.length>1?E(o):g:(e.bandMasks=o,e.mask=g)}function E(o){if(o.length<2)return o[0];const a=o[0].length,d=new Uint8Array(a).fill(0);for(let m=0;m<o.length;m++){const h=o[m];for(let c=0;c<a;c++)h[c]&&(d[c]=255)}return d}p&&"updateStatistics"in e&&e.updateStatistics()}export{v as A,W as C,X as I,x as N,P as V,_ as W,T as v};
