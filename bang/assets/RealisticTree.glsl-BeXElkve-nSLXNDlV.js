import{k3 as d,eq as G,is as O,ih as V,kB as T}from"./index-BeTPrQ6f.js";import{K as U,U as M,G as P,W as j,k as S,a as E,q as I}from"./HUDMaterial.glsl-CxXm6elT-D8B376d1.js";import{c as L,l as W}from"./memoryEstimations-C_GUL8g_-JniNFd5l.js";import{Y as b}from"./mat4-R0VY9B_E-DoEP887i.js";import{b as k,E as R,j as B,l as z,A as p}from"./vec32-CI1xtKog-DFVYRcgb.js";import{D as A}from"./vec42-DHp-FUwt-Br7hmYJs.js";import{o as $}from"./vec4f64-DD-nkcCV-CSNWKRqG.js";import{C as q,R as _}from"./sphere-CIGsF4vz-C3zVQu9y.js";import"./glsl-CfY1Aoj6-DPHSeNd9.js";import"./vec2f64-CkowXrDb-3zFQ3LNH.js";import"./ShaderBuilder-ufvKEDd5-DMnPqr6U.js";import{H as C,k as D,F as K,x as F,I as H}from"./DefaultMaterial-BRCr1DHi-kRRyJwPx.js";import"./OutputColorHighlightOID.glsl-fUhBGshN-Ctm9N97M.js";import"./lengthUtils-CopeXEyE-DjCEitlq.js";import"./projectionUtils-CsX1UTBu-DsZaU4xz.js";import"./projectBuffer-CMNsPBq1-CMpE7Jo3.js";import"./zscale-PLuFqpaL-BIEnWBsg.js";import"./meshVertexSpaceUtils-EbHpWZGf-CmRuaT8m.js";import"./MeshLocalVertexSpace-CxmyTFZH-DhgfYuby.js";import"./projectVectorToVector-OCoJKalB-CQIDHzSm.js";import"./projectPointToVector-BHS0gJJf-DOVZH8Fn.js";import"./hydratedFeatures-82j52esm-6EbRngQ4.js";import"./vec3f32-GX_cKsFD-UJPpzdNc.js";import"./Indices-CAn-HCVv-hWNN5onC.js";import"./plane-wUwHaY3K-ZwGBF7HQ.js";import"./vectorStacks-B2ngxq6F-myhPBoPk.js";import"./quatf64-C16JxGFv-BKWK1F8U.js";import"./orientedBoundingBox-DAJ-bKlA-DbqXagWB.js";import"./quat-B6H0knG8-DtO1-hlf.js";import"./spatialReferenceEllipsoidUtils-Ty3j4VoE-BUAsRqCF.js";import"./computeTranslationToOriginAndRotation-CsOb5S2S-CE5ZgVBy.js";import"./BufferView-B6RYETl3-CMoUTBv6.js";import"./InterleavedLayout-CuMGnz6O-DkraWivs.js";import"./types-l27bT09Q-DE0QfIFp.js";import"./enums-DDJfd4_p-D3z9tmVA.js";import"./VertexElementDescriptor-DLvjNrmQ-Cuvx5w94.js";import"./VertexAttributeLocations-DBgVVQz--D3wovAvC.js";import"./renderState-CsafAKLy-B8R8ns_l.js";import"./VertexBuffer-7GCTDD7e-CbRHEILO.js";import"./BufferObject-RHe5uojV-C-IINTcZ.js";import"./Texture-DLw7oaIg-fTsxdRzn.js";import"./Cyclical-Bzwh_QaL-CXh-hbnA.js";import"./triangle-DA_o7I-u-CHbj6sRJ.js";import"./lineSegment-D8lwRkdT-CnWWOaLb.js";import"./frustum-D1Y7pP8E-DUyP3Dvr.js";import"./normalizeUtils-DK5542Ty-DtqBcgc2.js";import"./normalizeUtilsCommon-5DjefBp7-CQyUDMQp.js";import"./utils-CRANtbnc-C6zyufvL.js";import"./utils-t279O251-BBk6rV0U.js";class N{get ray(){return this._ray}get distanceInRenderSpace(){return this.distance==null?null:(R(h,this.ray.direction,this.distance),k(h))}withinDistance(e){return!!w(this)&&this.distanceInRenderSpace<=e}getIntersectionPoint(e){return!!w(this)&&(R(h,this.ray.direction,this.distance),B(e,this.ray.origin,h),!0)}getTransformedNormal(e){return p(l,this.normal),l[3]=0,A(l,l,this.transformation),p(e,l),z(e,e)}constructor(e){this.intersector=4,this.normal=G(),this.transformation=O(),this._ray=q(),this.init(e)}init(e){this.distance=this.target=this.drapedLayerOrder=this.renderPriority=null,this.intersector=4,_(e,this._ray)}set(e,r,t,s,n,a,o){this.intersector=e,this.distance=t,p(this.normal,s??V),b(this.transformation,n??T),this.target=r,this.drapedLayerOrder=a,this.renderPriority=o}copy(e){_(e.ray,this._ray),this.intersector=e.intersector,this.distance=e.distance,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.renderPriority=e.renderPriority,p(this.normal,e.normal),b(this.transformation,e.transformation)}}function w(i){return(i==null?void 0:i.distance)!=null}const h=G(),l=$();class Y{constructor(e){this.layerViewUid=e}}class Z extends Y{constructor(e,r){super(e),this.graphicUid=r}}class J extends Z{constructor(e,r,t,s,n){super(e,r),this.layerViewUid=e,this.graphicUid=r,this.triangleNr=t,this.baseBoundingSphere=s,this.numLodLevels=n}}class Q{constructor(e,r,t,s){this.material=e,this.buffer=r,this.numVertices=t,this.boundingInfo=s,this.bufferWriter=e.createBufferWriter()}get layout(){return this.bufferWriter.layout}get numTriangles(){return this.numVertices/3}computeUsedMemory(){return this.buffer.byteLength+W}get renderGeometry(){return this}intersect(e,r,t,s,n,a,o,m){const c=this.bufferWriter,u=this.buffer;c.intersect(u,this.material.parameters,null,e,t,s,(f,g,x)=>v(f,g,x,e,r,a,o,n,m))}}class X{constructor(e){this.engineGeometry=e;const r=this.material,t=this.engineGeometry,s=t.attributes,n=t.boundingInfo,a=r.createBufferWriter(),o=a.layout,m=a.elementCount(s),c=o.createBuffer(m);a.write(null,null,s,null,c,0),this.renderGeometry=new Q(r,c.buffer,m,n)}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.indexCount}get numTriangles(){return this.numVertices/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce((e,r)=>e+L(r.data,r.indices),0)}intersect(e,r,t,s,n,a,o,m){const c=this.engineGeometry;this.material.intersect(c,e.transform.transform,e,t,s,(u,f,g)=>v(u,f,g,e,r,a,o,n,m))}}function v(i,e,r,t,s,n,a,o,m){if(i<0||s&&!s(t.rayBegin,t.rayEnd,i))return;const c=new J(n.layerViewUid,n.graphicUid(o),r,a,m);if((t.results.min.distance==null||i<t.results.min.distance)&&t.results.min.set(3,c,i,e,t.transform.transform),(t.results.max.distance==null||i>t.results.max.distance)&&t.results.max.set(3,c,i,e,t.transform.transform),t.options.store===2){const u=new N(t.results.min.ray);u.set(3,c,i,e,t.transform.transform),t.results.all.push(u)}}let ee=class{constructor(i,e=null){this.geometry=i,this.textures=e}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}};class te{constructor(e,r,t){this.components=e,this.minScreenSpaceRadius=r,this.pivotOffset=t;const s=d(this.components.map(n=>n.geometry));this.numVertices=s.reduce((n,a)=>n+a.numVertices,0)}}class re{constructor(e){this.levels=e,this.levels.sort((r,t)=>r.minScreenSpaceRadius===t.minScreenSpaceRadius?r.numVertices-t.numVertices:r.minScreenSpaceRadius-t.minScreenSpaceRadius)}get materialParameters(){return this.levels[0].components[0].geometry.material.parameters}getMaterials(){const e=[];return this.levels.forEach(r=>r.components.forEach(t=>e.push(t.geometry.material))),d(e)}getTextures(){const e=new Array;return this.levels.forEach(r=>r.components.forEach(t=>{t.textures!=null&&e.push(...t.textures)})),d(e)}getGeometries(){const e=new Array;return this.levels.forEach(r=>r.components.forEach(t=>{e.push(t.geometry)})),d(e)}getEngineGeometries(){return this.getGeometries().map(e=>e.engineGeometry).filter(e=>e!=null)}computeUsedMemory(){const e=this.getGeometries(),r=this.getTextures(),t=e.reduce((s,n)=>s+n.computeUsedMemory(),0);return r.reduce((s,n)=>s+n.usedMemory,0)+t}}function Qe(i){switch(i){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Xe(i,e){const r=(t,s,n=!1)=>new re(t.map(a=>{const o=s(a.tesselation);return n&&U(o),new te([new ee(new X(o))],a.minScreenSpaceRadius)}));switch(i){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],t=>I(e,.5,t));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>E(e,1));case"cone":return r(y,t=>S(e,1,.5,t,!1),!0);case"inverted-cone":return r(y,t=>S(e,1,.5,t,!0),!0);case"cylinder":return r(y,t=>j(e,1,.5,t,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>P(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>M(e,1),!0);default:return}}const y=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}],et=Object.freeze(Object.defineProperty({__proto__:null,build:K},Symbol.toStringTag,{value:"Module"})),tt=Object.freeze(Object.defineProperty({__proto__:null,build:H,getRadius:F},Symbol.toStringTag,{value:"Module"})),rt=Object.freeze(Object.defineProperty({__proto__:null,build:C},Symbol.toStringTag,{value:"Module"})),it=Object.freeze(Object.defineProperty({__proto__:null,build:D},Symbol.toStringTag,{value:"Module"}));export{rt as D,it as R,Qe as S,te as a,et as b,re as c,tt as d,N as f,Xe as l,ee as m,X as o};
