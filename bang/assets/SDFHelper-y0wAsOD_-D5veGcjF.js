import{x as X}from"./rasterizingUtils-Cf1zdzIw-BfJyHaiy.js";import{gN as Y}from"./index-BeTPrQ6f.js";import{o as A}from"./CIMSymbolHelper-C-M9oL19-BYnF76mM.js";import{I as L,H as z}from"./definitions-DVO21zOC-BwakNu1s.js";const $=.45;function j(n,t=.5){var r;switch(n.type){case"CIMPointSymbol":{const o=n.symbolLayers;if(!o||o.length!==1)return null;const e=o[0];return e.type!=="CIMVectorMarker"?null:j(e)}case"CIMVectorMarker":{const o=n.markerGraphics;if(!o||o.length!==1)return null;const e=o[0];if(!e)return null;const i=e.geometry;if(!i)return null;const l=e.symbol;return!l||l.type!=="CIMPolygonSymbol"&&l.type!=="CIMLineSymbol"||(r=l.symbolLayers)!=null&&r.some(a=>!!a.effects)?null:{type:"sdf",geom:i,sdfPaddingRatio:t,asFill:l.type==="CIMPolygonSymbol"}}}}function q(n){return n?n.rings?n.rings:n.paths?n.paths:n.xmin!==void 0&&n.ymin!==void 0&&n.xmax!==void 0&&n.ymax!==void 0?[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]]:null:null}function B(n){let t=1/0,r=-1/0,o=1/0,e=-1/0;for(const i of n)for(const l of i)l[0]<t&&(t=l[0]),l[0]>r&&(r=l[0]),l[1]<o&&(o=l[1]),l[1]>e&&(e=l[1]);return new A(t,o,r-t,e-o)}function V(n){let t=1/0,r=-1/0,o=1/0,e=-1/0;for(const i of n)for(const l of i)l[0]<t&&(t=l[0]),l[0]>r&&(r=l[0]),l[1]<o&&(o=l[1]),l[1]>e&&(e=l[1]);return[t,o,r,e]}function E(n){return n?n.rings?V(n.rings):n.paths?V(n.paths):Y(n)?[n.xmin,n.ymin,n.xmax,n.ymax]:null:null}function Z(n,t){const[r,o,e,i]=E(n),l=e-r,a=i-o,m=L,c=z,s=Math.floor(.5*(m*t-c)),f=(m-2*(s+c))/Math.max(l,a),x=Math.round(l*f),h=Math.round(a*f);return{pixelDimensions:[l,a],texelDimensions:[Math.round((x+2*s)/f),Math.round((h+2*s)/f)]}}function _(n,t,r,o,e,i,l){const[a,m,c,s]=n;if(c<a||s<m)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};const f=c-a,x=s-m,h=Math.max(f,x);let u=.5;if(i!=null&&r!=null){!l&&t!=null&&(i*=(t.ymax-t.ymin)/r);const b=i/(i+h);b>$&&b<1&&(u=Math.min(b+.1,.99))}const d=L,M=z,p=Math.floor(.5*(d*u-M)),g=(d-2*(p+M))/h,C=Math.round(f*g)+2*p,w=Math.round(x*g)+2*p;let y=1;t&&(y=w*(1-u)/((t.ymax-t.ymin)*g));let P=0,R=0,I=1;o&&(e?t&&r&&t.ymax-t.ymin>0&&(I=(t.xmax-t.xmin)/(t.ymax-t.ymin),P=o.x/(r*I),R=o.y/r):(P=o.x,R=o.y)),t&&(P=.5*(t.xmax+t.xmin)+P*(t.xmax-t.xmin),R=.5*(t.ymax+t.ymin)+R*(t.ymax-t.ymin)),P-=a,R-=m,P*=g,R*=g,P+=p,R+=p;let S=P/C-.5,v=R/w-.5;return e&&r&&(S*=r*I,v*=r),{frameSizeRatio:y,anchorX:S,anchorY:v,widthRatio:I,sdfPaddingRatio:u}}function Q(n){const t=q(n.geom),r=B(t),o=L,e=z,i=Math.floor(.5*(o*n.sdfPaddingRatio-e)),l=o-2*(i+e),a=l/Math.max(r.width,r.height),m=Math.round(r.width*a)+2*i,c=Math.round(r.height*a)+2*i,s=[];for(const x of t)if(x&&x.length>1){const h=[];for(const u of x){let[d,M]=u;d-=r.x,M-=r.y,d*=a,M*=a,d+=i-.5,M+=i-.5,n.asFill?h.push([d,M]):h.push([Math.round(d),Math.round(M)])}if(n.asFill){const u=h.length-1;h[0][0]===h[u][0]&&h[0][1]===h[u][1]||h.push(h[0])}s.push(h)}const f=G(s,m,c,i);return n.asFill&&J(s,m,c,i,f),{data:K(f,i),width:m,height:c,sdfPaddingRatio:n.sdfPaddingRatio,sdfDecodeCoeff:2*i/l}}function G(n,t,r,o){const e=t*r,i=new Array(e),l=o*o+1;for(let a=0;a<e;++a)i[a]=l;for(const a of n){const m=a.length;for(let c=1;c<m;++c){const s=a[c-1],f=a[c];let x,h,u,d;s[0]<f[0]?(x=s[0],h=f[0]):(x=f[0],h=s[0]),s[1]<f[1]?(u=s[1],d=f[1]):(u=f[1],d=s[1]);let M=Math.floor(x)-o,p=Math.floor(h)+o,g=Math.floor(u)-o,C=Math.floor(d)+o;M<0&&(M=0),p>t&&(p=t),g<0&&(g=0),C>r&&(C=r);const w=f[0]-s[0],y=f[1]-s[1],P=w*w+y*y;for(let R=M;R<p;R++)for(let I=g;I<C;I++){const S=R+.5,v=I+.5;let b,F,k=(S-s[0])*w+(v-s[1])*y;k<0?(b=s[0],F=s[1]):k>P?(b=f[0],F=f[1]):(k/=P,b=s[0]+k*w,F=s[1]+k*y);const D=(S-b)*(S-b)+(v-F)*(v-F),H=(r-I-1)*t+R;D<i[H]&&(i[H]=D)}}}for(let a=0;a<e;++a)i[a]=Math.sqrt(i[a]);return i}function J(n,t,r,o,e){for(const i of n){const l=i.length;for(let a=1;a<l;++a){const m=i[a-1],c=i[a];let s,f,x,h;m[0]<c[0]?(s=m[0],f=c[0]):(s=c[0],f=m[0]),m[1]<c[1]?(x=m[1],h=c[1]):(x=c[1],h=m[1]);let u=Math.floor(s),d=Math.floor(f)+1,M=Math.floor(x),p=Math.floor(h)+1;u<o&&(u=o),d>t-o&&(d=t-o),M<o&&(M=o),p>r-o&&(p=r-o);for(let g=M;g<p;++g){if(m[1]>g==c[1]>g)continue;const C=g+.5,w=(r-g-1)*t;for(let y=u;y<d;++y)y+.5<(c[0]-m[0])*(C-m[1])/(c[1]-m[1])+m[0]&&(e[w+y]=-e[w+y]);for(let y=o;y<u;++y)e[w+y]=-e[w+y]}}}}function K(n,t){const r=2*t,o=n.length,e=new Uint8Array(4*o);for(let i=0;i<o;++i){const l=.5-n[i]/r;X(l,e,4*i)}return e}export{Z as H,_ as J,Q as K,j as V,E as Y};
