import{Y as R,q as j,aB as q,gq as B,B as $,m as w,E as T,gr as M,n as J}from"./index-BeTPrQ6f.js";var C;let p=C=class extends R{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new C({variableName:this.variableName,dimensionName:this.dimensionName,values:j(this.values),isSlice:this.isSlice})}};w([T({type:String,json:{write:!0}})],p.prototype,"variableName",void 0),w([T({type:String,json:{write:!0}})],p.prototype,"dimensionName",void 0),w([T({type:M.array(M.oneOf([M.native(Number),M.array(M.native(Number))])),json:{write:!0}})],p.prototype,"values",void 0),w([T({type:Boolean,json:{write:!0}})],p.prototype,"isSlice",void 0),p=C=w([J("esri.layers.support.DimensionalDefinition")],p);function k(e,n,a){var i;const u=n.shift();if(a.length===0){const s=[];a.push({sliceId:-1,multidimensionalDefinition:s})}const t=a.length;for(let s=0;s<t;s++){const o=a.shift().multidimensionalDefinition;(i=u.values)==null||i.forEach(m=>{a.push({sliceId:-1,multidimensionalDefinition:[...o,{variableName:e,dimensionName:u.name,values:[m]}]})})}n.length&&k(e,n,a)}function X(e,n){const a=[];let u=0;return(n?e.variables.filter(t=>t.name.toLowerCase()===n.toLowerCase()):[...e.variables].sort((t,i)=>t.name>i.name?1:-1)).forEach(t=>{const i=[],s=[...t.dimensions].sort((o,m)=>o.name>m.name?-1:1);k(t.name,s,i),i.forEach(o=>{a.push({...o,sliceId:u++})})}),a}function Z(e,n,a){let u=e;if(n&&(n=[...n].sort((t,i)=>t.dimensionName<i.dimensionName?-1:1)).forEach(({dimensionName:t,values:i,isSlice:s})=>{i.length&&(u=u.filter(o=>{const m=o.multidimensionalDefinition.find(l=>l.dimensionName===t);if(m==null)return!1;const r=m.values[0];return typeof r=="number"?typeof i[0]=="number"?i.includes(r):i.some(l=>l[0]<=r&&l[1]>=r):typeof i[0]=="number"?i.some(l=>r[0]<=l&&r[1]>=l):s?i.some(l=>l[0]===r[0]&&l[0]===r[1]):i.some(l=>l[0]>=r[0]&&l[0]<=r[1]||l[1]>=r[0]&&l[1]<=r[1]||l[0]<r[0]&&l[1]>r[1])}))}),u.length&&(a==null?void 0:a.start)!=null&&a.end!=null){const t=a.start.getTime(),i=a.end.getTime(),s=u[0].multidimensionalDefinition.findIndex(o=>o.dimensionName==="StdTime");s>-1&&(u=u.filter(o=>{const m=o.multidimensionalDefinition[s].values[0];return t<=m&&i>=m}))}return u.map(t=>t.sliceId)}function F(e,n){return Array.isArray(e)?n[0]===n[1]?e[0]===n[0]||e[1]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]}function P(e,n){return e[0]<=n[0]&&e[1]>=n[0]||e[0]<=n[1]&&e[1]>=n[1]||e[0]>=n[0]&&e[1]<=n[1]}function Y(e){return e.length===1?[e[0],e[0]]:[e[0],e[e.length-1]]}function I(e,n,a){var s,o,m;if(!((s=n==null?void 0:n.subsetDefinitions)!=null&&s.length))return e;let u;if(a){const{variables:r}=n;if(r.length&&!r.includes(a))return null;const l=n.subsetDefinitions.find(f=>f.dimensionName===e.name&&f.variableName===a);if(!((o=l==null?void 0:l.values)!=null&&o.length))return e;u=Y(l.values)}else u=(m=n.dimensions.find(({name:r})=>r===e.name))==null?void 0:m.extent;const t=u;if(!(t!=null&&t.length))return e;const i=e.values.filter(r=>F(r,t));return{...e,extent:[...t],values:i}}function S(e,n,a){var t;if(!((t=n==null?void 0:n.subsetDefinitions)!=null&&t.length))return!1;const{variables:u}=n;if(u.length&&e.some(({variableName:i})=>i&&!u.includes(i)))return!0;for(let i=0;i<e.length;i++){const s=e[i],o=n.subsetDefinitions.find(m=>(s.variableName===""||m.variableName===s.variableName)&&m.dimensionName===s.dimensionName);if(o!=null&&o.values.length){const m=Y(o.values);if(!s.isSlice&&s.values.length===2&&!Array.isArray(s.values[0])&&s.values[0]!==s.values[1]&&a){if(!P(s.values,m))return!0}else if(s.values.some(r=>!F(r,m)))return!0}}return!1}function _(e,n){if(e==null)return{isOutside:!1};const{geometry:a,timeExtent:u,multidimensionalDefinition:t}=n;let i=null;if(u!=null&&(i=W(e,u),i==null))return{isOutside:!0};const{areaOfInterest:s}=e;if(s&&a){const o=V(a);if(o&&!s.contains(o))return{isOutside:!0}}return t!=null&&t.length&&S(t,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:a,timeExtent:i,multidimensionalDefinition:t}}}function V(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":{const n=B(e);return n?$.fromJSON(n):null}}return null}function W(e,n){const a=e.dimensions.find(({name:s})=>s==="StdTime");if(a==null||n.start==null&&n.end==null)return n;n=n.clone();const{start:u,end:t}=n.toJSON(),i=u===t?[u]:u!=null&&t!=null?[u,t]:[u??t];return i.length===2&&(a!=null&&a.extent.length)&&(i[0]=Math.max(i[0],a.extent[0]),i[1]=Math.min(i[1],a.extent[1]??a.extent[0]),i[1]<i[0])||S([new p({variableName:"",dimensionName:"StdTime",isSlice:i.length===1,values:i})],e,!0)?null:(n.start=new Date(i[0]),n.end=new Date(i[1]??i[0]),n)}function ee(e){var s,o,m;const{rasterInfo:n,multidimensionalSubset:a}=e,{multidimensionalInfo:u}=n;if(u==null)return null;let t=(s=e.multidimensionalDefinition)!=null&&s.length?e.multidimensionalDefinition:U(n,{multidimensionalSubset:a});if(!(t!=null&&t.length))return null;if(t.some(r=>!r.dimensionName)){const{variableName:r}=t[0],l=U(n,{multidimensionalSubset:a,variableName:r});l==null||l.forEach(f=>{var b;const d=t==null?void 0:t.find(({dimensionName:D})=>D===f.dimensionName);(b=d==null?void 0:d.values)!=null&&b.length&&(f.values=d.values,f.isSlice=d.isSlice)}),t=l}const{timeExtent:i}=e;if(t!=null&&i!=null&&(i.start!=null||i.end!=null)){t=t.map(v=>v.clone());const r=(m=(o=u.variables.find(({name:v})=>v===t[0].variableName))==null?void 0:o.dimensions)==null?void 0:m.find(({name:v})=>v==="StdTime"),l=t.find(({dimensionName:v})=>v==="StdTime");if(!r||!l)return null;const{start:f,end:d}=i,b=f==null?null:f.getTime(),D=d==null?null:d.getTime(),h=b??D,g=D??b;if(r.values!=null){const v=r.values.filter(c=>{if(Array.isArray(c)){if(h===g)return c[0]<=h&&c[1]>=h;const y=c[0]<=h&&c[1]>h||c[0]<g&&c[1]>=g,N=c[0]>=h&&c[1]<=g||c[0]<h&&c[1]>g;return y||N}return h===g?c===h:c>=h&&c<=g});if(v.length){const c=v.sort((y,N)=>{const x=Array.isArray(y)?y[0]:y,O=Array.isArray(y)?y[1]:y,E=Array.isArray(N)?N[0]:N,L=Array.isArray(N)?N[1]:N;return h===g?x-E:Math.abs(O-g)-Math.abs(L-g)})[0];l.values=[c]}else t=null}else if(r.hasRegularIntervals&&r.extent){const[v,c]=r.extent;h>c||g<v?t=null:l.values=h===g?[h]:[Math.max(v,h),Math.min(c,g)]}}return t!=null&&S(t,a)?null:t}function z(e,n={}){var l,f;const{multidimensionalInfo:a,keyProperties:u}=e;if(a==null)return null;const{variableName:t,multidimensionalSubset:i,multidimensionalDefinition:s}=n,o=s!=null?(l=s[0])==null?void 0:l.variableName:null,m=t||o||(u==null?void 0:u.DefaultVariable);let{variables:r}=a;return(f=i==null?void 0:i.variables)!=null&&f.length&&(r=r.filter(({name:d})=>i.variables.includes(d))),m?r.find(({name:d})=>d===m)??r[0]:r[0]}function U(e,n={}){const a=z(e,n);if(!a)return null;const u=[],{dimensions:t,name:i}=a;if(t.length===0)return[new p({variableName:i,dimensionName:"",values:[],isSlice:!0})];for(let s=0;s<t.length;s++){const o=I(t[s],n.multidimensionalSubset,i);if(!o)return null;const{values:m,extent:r}=o;let l=(m==null?void 0:m[0])??(r==null?void 0:r[0]);o.name.toLowerCase()==="stdz"&&!o.hasRanges&&r&&Math.abs(r[1])<=Math.abs(r[0])&&(l=m!=null&&m.length?m[m.length-1]:r[1]),u.push(new p({variableName:i,dimensionName:o.name,values:[l],isSlice:!n.useRangeForRangedDimensionInfo||!!o.hasRanges}))}return u}function ne(e){return!!(e!=null&&e.length)&&e.some(n=>{if(n.values==null)return!0;const a=n.values.length;return a===0||a>1||!n.isSlice&&Array.isArray(n.values[0])})}function te(e,n){var u;if(n==null||e==null)return null;let a=n.variables.map(t=>({...t}));return(u=e==null?void 0:e.variables)!=null&&u.length&&(a=a.filter(({name:t})=>e.variables.includes(t)),a.forEach(t=>{t.dimensions=t.dimensions.map(i=>I(i,e,t.name)).filter(q)})),a}function G(e,n){var o;const{values:a}=n;if(a!=null&&a.length){const m=Array.isArray(a[0]),r=Array.isArray(e);return m!==r?-1:m&&r?a.findIndex(l=>l[0]===e[0]&&l[1]===e[1]):a.indexOf(e)}const{extent:u}=n;if(Array.isArray(e)||!u||e<u[0]||e>u[1])return-1;const t=n.interval||1;if(n.unit!=="ISO8601")return Math.round((e-u[0])/t);const i=u[0];let s=-1;switch(((o=n.intervalUnit)==null?void 0:o.toLowerCase())||"days"){case"seconds":s=Math.round((e-i)/1e3/t);break;case"minutes":s=Math.round((e-i)/6e4/t);break;case"hours":s=Math.round((e-i)/36e5/t);break;case"days":s=Math.round((e-i)/864e5/t);break;case"months":{const m=new Date(e).getUTCFullYear()-new Date(i).getUTCFullYear(),r=new Date(i).getUTCMonth(),l=new Date(e).getUTCMonth();s=m===0?l-r:l+11-r+12*(m-1)}break;case"years":s=Math.round((new Date(e).getUTCFullYear()-new Date(i).getUTCFullYear())/t);break;case"decades":s=Math.round((new Date(e).getUTCFullYear()-new Date(i).getUTCFullYear())/10/t)}return s}function A(e){var s,o;let n=(s=e.values)==null?void 0:s.length;if(n)return n;const{extent:a,unit:u}=e,t=e.interval||1,i=a?a[1]-a[0]:0;if(u!=="ISO8601")return Math.round(i/t);switch(((o=e.intervalUnit)==null?void 0:o.toLowerCase())??"seconds"){case"seconds":n=Math.round(i/1e3/t);break;case"minutes":n=Math.round(i/6e4/t);break;case"hours":n=Math.round(i/36e5/t);break;case"days":n=Math.round(i/864e5/t);break;case"months":if(a){const m=new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear(),r=new Date(a[0]).getUTCMonth(),l=new Date(a[1]).getUTCMonth();n=m===0?l-r+1:l+11-r+12*(m-1)+1}else n=0;break;case"years":n=a?Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/t):0;break;case"decades":n=a?Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/10/t):0;break;default:n=0}return n}function ie(e){var i,s;if(((i=e.extent)==null?void 0:i.length)!==2||!e.interval)return[];const{extent:[n,a],interval:u}=e;if(e.unit==="ISO8601"){const o=((s=e.intervalUnit)==null?void 0:s.toLowerCase())??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(o)?H(n,a,u,o):[]}const t=Math.round((a-n)/u);return Array.from({length:t},(o,m)=>m===t-1?a:n+m*u)}function H(e,n,a,u){const t=[];let i=e;const s=new Date(e);for(;i<=n;)switch(t.push(i),u){case"decades":s.setUTCFullYear(s.getUTCFullYear()+10*a),i=s.getTime();break;case"years":s.setUTCFullYear(s.getUTCFullYear()+a),i=s.getTime();break;case"months":s.setUTCMonth(s.getUTCMonth()+a),i=s.getTime();break;case"days":i+=864e5*a;break;case"hours":i+=36e5*a;break;case"minutes":i+=6e4*a;break;case"seconds":i+=1e3*a}return t.length===1?t[1]=n:t[t.length-1]=n,t}function ae(e,n){let a=0;const u=e[0].variableName,t=[...n.variables].sort((i,s)=>i.name>s.name?1:-1);for(let i=0;i<t.length;i++){const s=t[i],o=[...s.dimensions].sort((l,f)=>l.name>f.name?-1:1);if(s.name!==u){a+=o.map(l=>A(l)).reduce((l,f)=>l*f);continue}const m=o.map(l=>A(l)),r=o.length;for(let l=0;l<r;l++){const f=e.find(b=>b.dimensionName===o[l].name);if(f==null)return null;const d=G(f.values[0],o[l]);if(d===-1)return null;m.shift(),a+=l===r-1?d:d*m.reduce((b,D)=>b*D)}break}return a}function se(e){return Math.round(24*(e-25569)*3600*1e3)}function K(e){return(e==null?void 0:e.datasetFormat)==="Function"}function re(e){return K(e)?e.primaryRasters.rasters:[e]}function le(e,n,a,u){const{x:t,y:i}=n,{x:s,y:o}=a,{xmin:m,xmax:r,ymin:l,ymax:f}=e,{width:d,height:b}=e,D=d/s,h=b/o,g=Math.min(D,h),v=g<=1?0:Math.min(.1,g/100),c=Math.floor((m-t)/s+v),y=Math.floor((i-f)/o+v),N=Math.floor((r-t)/s-v),x=Math.floor((i-l)/o-v);return{ul:{x:c,y},width:u>0&&D<.1?0:N-c+1,height:u>0&&h<.1?0:x-y+1}}export{K as E,X as G,ee as H,z as I,ne as K,Z as P,te as Q,S as T,U,ie as X,_ as Z,ae as e,le as i,se as n,re as t,p as y};
