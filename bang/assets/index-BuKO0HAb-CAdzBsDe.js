const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./details-screen-NGmvOT_1-BW1i4s2Q.js","./index-DRDU_nTl.js","./index-6GCfk1Ih.css","./toggle-switch-control-x7xAfM2r-diZaq7lg.js"])))=>i.map(i=>d[i]);
var g=Object.defineProperty;var u=(o,l,e)=>l in o?g(o,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[l]=e;var d=(o,l,e)=>u(o,typeof l!="symbol"?l+"":l,e);import{g6 as c,_ as y,fy as f,g9 as p,g2 as x,ga as v}from"./index-DRDU_nTl.js";import{a as E}from"./hilight-defs-DzKgjtLG-D-utaUCJ.js";class w{constructor(l){d(this,"id");d(this,"name");d(this,"template");d(this,"priority");d(this,"fields");d(this,"componentId");const e={...typeof l=="string"?{id:l,template:"",name:"",priority:50}:l};({template:this.template,id:this.id,name:this.name,fields:this.fields,priority:this.priority}=e)}}const m="details";class A extends x{constructor(){super(...arguments);d(this,"detailsStore",p(this.$vApp.$pinia))}get config(){return super.config}openDetails(e){e.forEach(s=>{this._loadDetailsConfig(this.$iApi.geo.layer.getLayer(s.uid))}),this.detailsStore.payload=e;const t=this.$iApi.panel.get("details");this.detailsStore.origin="identify",t.button.tooltip="details.layers.title.identifyOrigin",this.$iApi.panel.get("details").isOpen||this.$iApi.panel.open({id:"details"})}toggleFeature(e,t){const s=this.$iApi.panel.get("details");if(t===!1){s.close(),this.detailsStore.currentFeatureId=void 0;return}const i=this.$iApi.geo.layer.getLayer(e.uid),a=`${e.uid}-${i!=null&&i.supportsFeatures?e.data[(i==null?void 0:i.oidField)??""]:JSON.stringify(e.data)}`;if(s.isOpen&&a===this.detailsStore.currentFeatureId&&t!==!0){s.close(),this.detailsStore.currentFeatureId=void 0;return}this.detailsStore.origin="toggleEvent",s.button.tooltip="details.layers.title.gridOrigin",this.detailsStore.currentFeatureId=a,this._loadDetailsConfig(i);const r={items:[v.makeRawItem(e.format,e.data)],uid:e.uid,layerId:e.layerId||(i==null?void 0:i.id)||"error-not-found",loading:Promise.resolve(),loaded:!0,errored:!1,requestTime:Date.now()};this.detailsStore.payload=[r],s.isOpen||s.open()}_parseConfig(e){e&&e.templates&&(this.detailsStore.defaultTemplates=e.templates),this.handlePanelWidths(["details"]),this.handlePanelTeleports(["details"]);const t=this.getLayerFixtureConfigs(),s=[];Object.keys(t).forEach(a=>{s.push({id:a,name:t[a].name,template:t[a].template,fields:t[a].fields,priority:t[a].priority??50})});const i=s.map(a=>new w(a));this.detailsStore.properties=i.reduce((a,r)=>(a[r.id]=r,a),{}),this._validateItems()}_loadDetailsConfig(e){if(e&&this.detailsStore.properties[e.id]===void 0){const t=this.getLayerFixtureConfigs()[e.id];t&&this.detailsStore.addConfigProperty({id:e.id,name:t.name,template:t.template,fields:t.fields,priority:t.priority??50})}}_validateItems(){Object.values(this.detailsStore.properties).forEach(e=>{e.template in this.$vApp.$options.components&&(this.detailsStore.properties[e.id].componentId=e.template)})}async hilightDetailsItems(e,t){const s=e instanceof Array?e:[e],i=this.$iApi.fixture.get("hilight");if(i){const a=await i.getGraphicsByKey(m);await i.removeHilight(a);const r=Date.now();this.detailsStore.lastHilight=r;const n=await this.getHilightGraphics(s,t);this.detailsStore.lastHilight===r&&(await i.addHilight(n),this.detailsStore.lastHilight!==r&&i.removeHilight(n))}}async removeDetailsHilight(){const e=this.$iApi.fixture.get("hilight");if(e){this.detailsStore.lastHilight=Date.now();const t=await e.getGraphicsByKey(m);await e.removeHilight(t)}}async reloadDetailsHilight(e,t){const s=e instanceof Array?e:[e],i=this.$iApi.fixture.get("hilight");if(i){const a=await this.getHilightGraphics(s,t);i.reloadHilight(a)}}async getHilightGraphics(e,t){const s=this.$iApi.geo.layer.getLayer(t),i=this.$iApi.fixture.get("hilight"),a=[];return s&&await Promise.all(e.map(async r=>{await r.loading;const n=r.data[s.oidField],h=await s.getGraphic(n,{getGeom:!0,getAttribs:!0,getStyle:!0});h.id=i.constructGraphicKey(m,t,n),a.push(h)})),a}onHilightToggle(e,t,s){this.detailsStore.hilightToggle=e,e&&t&&s?this.hilightDetailsItems(t,s):e||this.removeDetailsHilight()}hasHilighter(){const e=this.$iApi.fixture.get("hilight");return e&&e.hilightMode.mode!==E.NONE}}const $={en:{"details.layers.title.identifyOrigin":"Identify Details","details.layers.title.gridOrigin":"Details","details.layers.found":"Found {numResults} results in {numLayers} layers","details.layers.loading":"The layer is loading...","details.layers.error":"Error","details.layers.results.empty":"No results found for any layer.","details.layers.results.empty.currentLayer":"No results found for the selected layer.","details.layers.results.empty.noLayers":"No layers for identification.","details.layers.results.list.tooltip":"Use the arrow keys to navigate the items","details.result.default.name":"Identify Item {0}","details.loading":"Loading...","details.items.title":"Details","details.items.range":"{0} - {1} of {2}","details.items.next":"Next page","details.items.previous":"Previous page","details.items.page":"Items per page","details.item.see.list":"See List","details.item.zoom":"Zoom to feature","details.item.zoom.zooming":"Zooming...","details.item.zoom.error":"Zoom failed","details.item.zoom.zoomed":"Zoomed","details.item.previous.item":"Previous item","details.item.next.item":"Next item","details.item.count":"{0} of {1}","details.item.loading":"Loading results...","details.item.no.data":"No data to show because the layer has been removed","details.item.alert.zoom":"Zoomed into feature","details.item.alert.show.item":"Showing result {itemName}","details.item.alert.show.list":"Showing all results for {layerName}","details.item.alert.defaultAltText":"Image associated with {alias} field","details.togglehilight.title":"Toggle Highlight","details.item.open":"Expand","details.item.collapse":"Collapse"},fr:{"details.layers.title.identifyOrigin":"Identifier les détails","details.layers.title.gridOrigin":"Détails","details.layers.found":"{numResults} résultats trouvés dans {numLayers} couches","details.layers.loading":"La couche est en cours de chargement...","details.layers.error":"Erreur","details.layers.results.empty":"Aucun résultat trouvé pour aucune couche.","details.layers.results.empty.currentLayer":"Aucun résultat trouvé pour la couche sélectionnée.","details.layers.results.empty.noLayers":"Pas de couches pour l'identification.","details.layers.results.list.tooltip":"Utilisez les touches fléchées pour naviguer entre les éléments","details.result.default.name":"Désigner l'élément {0}","details.loading":"Chargement en cours...","details.items.title":"Détails","details.items.range":"{0} - {1} de {2}","details.items.next":"Page suivante","details.items.previous":"Page précédente","details.items.page":"éléments par page","details.item.see.list":"Voir la liste","details.item.zoom":"Zoom à l'élément","details.item.zoom.zooming":"Zoom en cours...","details.item.zoom.error":"Échec du zoom","details.item.zoom.zoomed":"Zoom terminé","details.item.previous.item":"Élément précédent","details.item.next.item":"Élément suivant","details.item.count":"{0} de {1}","details.item.loading":"Chargement des résultats...","details.item.no.data":"Aucune donnée à afficher","details.item.alert.zoom":"Zoom sur la caractéristique","details.item.alert.show.item":"Affichage du résultat {itemName}","details.item.alert.show.list":"Affichage de tous les résultats pour {layerName}","details.item.alert.defaultAltText":"Image associée au champ {alias}","details.togglehilight.title":"Basculer vers l'élément principal","details.item.open":"Développer","details.item.collapse":"Réduire"}};class I extends A{async added(){this.$iApi.panel.register({details:{screens:{"details-screen":()=>c(y(()=>import("./details-screen-NGmvOT_1-BW1i4s2Q.js"),__vite__mapDeps([0,1,2,3]),import.meta.url))},style:{width:"425px"},button:{tooltip:"details.layers.title.identifyOrigin",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none" /><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" /></svg>'},alertName:"details.items.title"}},{i18n:{messages:$}}),this._parseConfig(this.config);const l=this.$vApp.$watch(()=>this.config,e=>this._parseConfig(e));this.removed=()=>{l(),this.$iApi.panel.remove("details"),this.$iApi.fixture.exists("appbar")&&f(this.$vApp.$pinia).removeButton("details"),p(this.$vApp.$pinia).$reset()}}}export{I as default};
