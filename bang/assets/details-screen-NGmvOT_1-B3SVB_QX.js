import{fv as G,fw as ne,fK as _,fM as ue,fD as t,fP as n,fG as k,fZ as V,f_ as X,fH as Y,h3 as pe,fJ as q,fU as I,g9 as ee,fB as z,fO as B,fQ as A,g0 as se,hA as me,fz as K,hK as re,fW as te,fL as R,fN as le,fE as Z,fI as M,fA as ae,f$ as _e,fx as W,h4 as ie,fC as Te,fF as ce,hR as ye,gv as Me,hQ as je}from"./index-CQ8-0QQp.js";import{Y as ze}from"./toggle-switch-control-x7xAfM2r-DF8b4T57.js";const Ee={key:0,class:"relative"},He={key:0,class:"relative"},$e=["innerHTML"],Ce=["src"],Ie={key:1,class:"w-32 h-32"},Oe={class:"symbologyIcon"},qe=["innerHTML"],Ne=["src"],De={class:"badge z-50 rounded-full text-white absolute h-10 w-10 p-8 inline-flex items-center justify-center"},Se={key:0,class:"px-5"},Ae={key:1,class:"inline-flex justify-center items-center relative"},Be=G({__name:"symbology-stack",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0}},setup(c){const x=c,u=_([]);return ue(()=>{u.value=x.layer.legend}),(d,p)=>c.result.loaded?(t(),n("div",Ee,[k("div",{class:Y(c.result.items.length===0?"opacity-50":"")},[u.value.length>1?(t(),n("div",He,[(t(!0),n(V,null,X(u.value.slice(0,3).reverse(),(w,h)=>(t(),n("div",{class:Y(["absolute",[h==0?"symbol-0":h==1?"left-3":"left-6"]]),style:pe({"z-index":3-h}),key:h},[u.value[h].svgcode?(t(),n("span",{key:0,class:"symbologyIcon w-28 h-28",innerHTML:u.value[h].svgcode},null,8,$e)):u.value[h].imgUrl?(t(),n("img",{key:1,class:"symbologyIcon w-28 h-28",src:u.value[h].imgUrl},null,8,Ce)):q("",!0)],6))),128))])):u.value.length>0?(t(),n("div",Ie,[k("div",Oe,[u.value[0].svgcode?(t(),n("span",{key:0,innerHTML:u.value[0].svgcode},null,8,qe)):u.value[0].imgUrl?(t(),n("img",{key:1,class:"symbologyIcon w-full h-full",src:u.value[0].imgUrl},null,8,Ne)):q("",!0)])])):q("",!0)],2),k("div",De,[c.result.loaded?(t(),n("div",Se,I(c.result.items.length),1)):q("",!0)])])):(t(),n("div",Ae,p[0]||(p[0]=[k("div",{class:"symbologyIcon h-32 w-32"},[k("div",{class:"relative animate-spin spinner h-24 w-24"})],-1)])))}}),Fe=ne(Be,[["__scopeId","data-v-496d788d"]]),Pe=["content"],Ge={class:"symbologyLayerName truncate"},Ue=G({__name:"symbology-item",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0},selected:{type:Boolean,required:!0}},setup(c){const x=ee(),u=z(()=>x.properties),d=c,p=()=>{const w=d.layer;return w&&u.value[w.id]&&u.value[w.id].name?u.value[w.id].name:(w==null?void 0:w.name)??""};return(w,h)=>{const L=B("tippy");return A((t(),n("button",{class:Y(["flex flex-grow justify-start items-center px-7 py-10 default-focus-style symbologyStackButton truncate",c.selected?"detailsButtonSelected":"px-11"]),onClick:h[0]||(h[0]=me(()=>{},["stop"])),content:p()},[se(Fe,{class:"symbStack w-32 h-32 mr-10",layer:c.layer,result:c.result},null,8,["layer","result"]),k("div",Ge,I(p()),1)],10,Pe)),[[L,{placement:"right",sticky:!0}]])}}}),Re=["content"],Ye=G({__name:"symbology-list",props:{results:{type:Object,required:!0},selected:{type:String,required:!0}},emits:["selection-changed"],setup(c,{emit:x}){const{t:u}=K(),d=re(),p=_(),w=()=>{p.value._tippy.hide()},h=v=>{var $;v.key==="Tab"&&(($=p.value)!=null&&$.matches(":focus"))&&p.value._tippy.show()},L=x,y=c,s=_(""),f=_([]),r=_(!1),e=_(!1),i=v=>d.getLayerByUid(v),T=v=>{s.value=v,L("selection-changed",v),r.value=!1},O=()=>{e.value||setTimeout(()=>{r.value=e.value},500),e.value=!0},C=()=>{r.value=e.value=!1},m=()=>{e.value||(r.value=!0),e.value=!0},E=()=>{r.value=e.value=!1};return te(()=>{f.value.push(R(y,()=>{s.value=y.selected}))}),ue(()=>{var v,$;(v=p.value)==null||v.addEventListener("blur",w),($=p.value)==null||$.addEventListener("keyup",h)}),le(()=>{var v,$;f.value.forEach(N=>N()),(v=p.value)==null||v.removeEventListener("blur",w),($=p.value)==null||$.removeEventListener("keyup",h)}),(v,$)=>{const N=B("focus-item"),P=B("focus-list"),j=B("tippy");return A((t(),n("div",{class:Y(["symbology-list absolute overflow-hidden z-50 p-0 w-48 bg-white text-sm inline-flex flex-col",{"symbology-list-expanded":r.value}]),onMouseover:O,onMouseleave:C,onFocus:m,onBlur:me(E,["self"]),content:M(u)("details.layers.results.list.tooltip"),ref_key:"el",ref:p},[(t(!0),n(V,null,X(y.results,(D,l)=>(t(),n("div",{class:"flex justify-start relative",key:l},[A((t(),Z(Ue,{key:D.uid,layer:i(D.uid),result:D,selected:D.uid===s.value,onClick:o=>T(D.uid)},null,8,["layer","result","selected","onClick"])),[[N]])]))),128))],42,Re)),[[P],[j,{trigger:"manual",placement:"top-start",touch:!1}]])}}}),Qe={class:"inline font-bold"},Ze=["innerHTML"],Ke=G({__name:"esri-default",props:{fixtureFields:{type:Object,required:!1},fields:{type:Object,required:!0},identifyData:{type:Object,required:!0}},setup(c){const{t:x}=K(),u=ae("iApi"),d=c,p=(s,f,r,e)=>{const i=s.find(T=>T[f].toLowerCase()===r.toLowerCase());i&&delete e[i.name]},w=()=>{const s=Object.assign({},d.identifyData.data);p(d.fields,"type","geometry",s),u.ui.exposeOids||p(d.fields,"type","oid",s),u.ui.exposeMeasurements||(p(d.fields,"name","shape_length",s),p(d.fields,"name","shape_area",s));const f={};d.fields.forEach(e=>{var T;const i=(T=d.fixtureFields)==null?void 0:T.find(O=>e.name===O.field);f[e.name]={name:(i==null?void 0:i.alias)||e.alias||e.name,type:e.type,visible:(i==null?void 0:i.visible)??!0}});const r={};Object.keys(s).forEach(e=>{const i=f[e];if(i&&i.visible){const T=s[e];r[e]={value:typeof T=="number"?u.ui.formatNumber(T):T,alias:i.name,type:i.type}}});for(const[e]of Object.entries(r))u.ui.isPlainText(r[e].value)&&(r[e].value=u.ui.escapeHtml(r[e].value));return r},h=(s,f,r)=>{switch(r){case"date":return y(s);default:return L(s,f)}},L=(s,f)=>{var i;if(!s)return s;if(s.trim().match(/\.(jpeg|jpg|gif|png)$/)||s.trim().match(/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i))return`<img src="${s}" alt="${x("details.item.alert.defaultAltText",{alias:f})}" />`;const r="underline text-blue-700 break-all",e=document.createElement("div");return e.innerHTML=s.trim(),((i=e.firstElementChild)==null?void 0:i.tagName)=="A"?(e.firstElementChild.className=r,e.innerHTML):ye(s,{className:r,target:"_blank",validate:{url:T=>/^https?:\/\//.test(T)}})},y=s=>{const f=parseInt(s);return isNaN(f)?s:new Date(f).toISOString().split("T")[0]};return(s,f)=>(t(),n("div",null,[(t(!0),n(V,null,X(w(),(r,e,i)=>(t(),n("div",{class:"p-5 pl-3 flex justify-end flex-wrap even:bg-gray-300",key:i},[k("span",Qe,I(r.alias),1),f[0]||(f[0]=k("span",{class:"flex-auto"},null,-1)),k("span",{class:"inline",innerHTML:h(r.value,r.alias,r.type)},null,8,Ze)]))),128))]))}}),Ve=["innerHTML"],Je={key:1},We=G({__name:"html-default",props:{identifyData:{type:Object,required:!0}},setup(c){const{t:x}=K();return(u,d)=>c.identifyData?(t(),n("div",{key:0,class:"whitespace-pre-wrap break-words h-full overflow-auto",innerHTML:c.identifyData.data.data??c.identifyData.data},null,8,Ve)):(t(),n("div",Je,I(M(x)("details.layers.results.empty")),1))}}),Xe={class:"relative flex flex-grow truncate"},et={key:0,class:"flex flex-grow items-center truncate"},tt={class:"flex p-8 items-center"},lt=["innerHTML"],at={key:1,class:"symbologyIcon p-6"},st=["content","innerHTML","tabindex"],it={key:1,class:"flex p-6 flex-grow"},nt={key:2,class:"zoomButton text-center p-3"},ut=["content","aria-label"],rt={key:0,class:"m-auto animate-spin spinner h-20 w-20"},ot={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"green",class:"m-auto w-20 h-20"},dt={key:2,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"red",class:"m-auto w-20 h-20"},ct=["innerHTML"],ve=G({__name:"result-item",props:{uid:{type:String,required:!0},data:{type:Object,required:!0},open:{type:Boolean,required:!1},inList:{type:Boolean,required:!1}},setup(c){const x=re(),u=c,d=ae("iApi"),p=_([]),w=ee(),{t:h}=K(),L=_(!1),y=_(""),s=_("none"),f=_(),r=()=>x.getLayerByUid(u.uid),e=z(()=>w.properties),i=z(()=>w.defaultTemplates),T=z(()=>{var l;return((l=r())==null?void 0:l.supportsFeatures)??!1}),O=z(()=>{var l;return((l=r())==null?void 0:l.mapLayer)??!1}),C=z(()=>{const l=r();let o=l&&u.data.loaded?l.nameValue(u.data.data):d.$i18n.t("details.items.title");return d.ui.isPlainText(o)&&(o=d.ui.escapeHtml(o)),o}),m=l=>{var o;if(typeof l=="string"){const g="underline text-blue-700 break-all",H=document.createElement("div");return H.innerHTML=l.trim(),((o=H.firstElementChild)==null?void 0:o.tagName)=="A"?(H.firstElementChild.className=g,H.innerHTML):ye(l,{className:g,target:"_blank",validate:{url:S=>/^https?:\/\//.test(S)}})}return l},E=()=>{j("none"),u.data.loaded?v():u.data.load().then(()=>{v()})},v=()=>{if(y.value="",!(u.data&&u.data.loaded))return;const l=r();if(l===void 0){console.warn(`could not find layer for uid ${u.uid} during icon lookup`);return}if(l.supportsFeatures){const o=l.oidField;l.getIcon(u.data.data[o]).then(g=>{y.value=g})}},$=z(()=>{const l=r();return l&&e.value[l.id]&&e.value[l.id].template?e.value[l.id].template:i.value&&i.value[u.data.format]?i.value[u.data.format]:T.value?Ke:We}),N=z(()=>{var l;return T.value?((l=r())==null?void 0:l.fields)||[]:[]}),P=z(()=>{const l=r();if(l&&e.value[l.id]&&e.value[l.id].fields)return e.value[l.id].fields}),j=l=>{l==="zoomed"||l==="error"?setTimeout(()=>{var o;s.value=l,(o=f.value)==null||o._tippy.show(),setTimeout(()=>{var g;(g=f.value)==null||g._tippy.hide(),s.value="none"},3e3)},300):s.value=l},D=()=>{if(s.value!=="none")return;j("zooming");const l=r();if(l===void 0||!l.isLoaded){console.warn(`Could not find layer for uid ${u.uid} during zoom geometry lookup`),j("error");return}if(!u.data.loaded){console.warn("Details zoomToFeature call on item that is still loading. Should be impossible, alert the devs."),j("error");return}const o=u.data.data[l.oidField],g=()=>{const H={getGeom:!0};l.getGraphic(o,H).then(S=>{S.geometry.invalid()?(console.error(`Could not find graphic for objectid ${o}`),j("error")):(d.geo.map.zoomMapTo(S.geometry),j("zoomed"),d.updateAlert(d.$i18n.t("details.item.alert.zoom")))}).catch(()=>{j("error")})};l.layerType===Me.FEATURE&&l.geomType!==je.POINT?l.getGraphicExtent(o).then(H=>{d.geo.map.zoomMapTo(H),j("zoomed"),d.updateAlert(d.$i18n.t("details.item.alert.zoom"))}).catch(()=>{g()}):g()};return te(()=>{p.value.push(R(u,()=>{E()},{deep:!1,immediate:!0}))}),le(()=>{p.value.forEach(l=>l())}),(l,o)=>{const g=B("truncate"),H=B("tippy");return t(),n(V,null,[k("div",Xe,[T.value?(t(),n("div",et,[k("div",tt,[c.data.loaded&&y.value?(t(),n("span",{key:0,class:"flex-none symbologyIcon",innerHTML:y.value},null,8,lt)):(t(),n("div",at,o[3]||(o[3]=[k("div",{class:"animate-spin spinner h-20 w-20"},null,-1)])))]),c.data.loaded?A((t(),n("span",{key:0,class:"pl-3 text-left flex-grow itemName",content:C.value,innerHTML:m(C.value),onTouchstart:o[0]||(o[0]=S=>L.value=!0),onTouchend:o[1]||(o[1]=S=>L.value=!1),tabindex:c.inList?-1:0},null,40,st)),[[g,{options:{placement:"top-start",offset:()=>L.value?[0,25]:[0,0]}}]]):(t(),n("div",it,I(M(h)("details.loading")),1)),c.data.loaded?(t(),n("span",nt,[O.value?A((t(),n("button",{key:0,type:"button",content:M(h)(`details.item.zoom${s.value==="none"?"":`.${s.value}`}`),"aria-label":M(h)(`grid.cells.zoom${s.value==="none"?"":`.${s.value}`}`),ref_key:"zoomButton",ref:f,onClick:o[2]||(o[2]=S=>{S.stopPropagation(),D()}),class:"text-gray-600 w-24 h-24 p-2 flex justify-center items-center"},[s.value==="zooming"?(t(),n("div",rt)):s.value==="zoomed"?(t(),n("svg",ot,o[4]||(o[4]=[k("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1)]))):s.value==="error"?(t(),n("svg",dt,o[5]||(o[5]=[k("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1)]))):(t(),n("span",{key:3,innerHTML:M(d).ui.getZoomIcon()},null,8,ct))],8,ut)),[[H,{placement:"bottom"}]]):q("",!0)])):q("",!0)])):q("",!0)]),c.open?(t(),Z(_e($.value),{key:0,identifyData:c.data,fields:N.value,fixtureFields:P.value,class:"p-8"},null,8,["identifyData","fields","fixtureFields"])):q("",!0)],64)}}}),vt={key:0,class:"layerName w-full flex-grow p-5 pb-8 font-bold truncate",tabIndex:"0"},pt={key:1,class:"p-8 mb-8 bg-gray-100 flex justify-between"},mt={for:"toggle"},yt={key:2,class:"flex flex-col justify-between p-8 mb-8 bg-gray-100"},ft={class:"flex"},gt=["aria-label"],ht=["content","aria-label","disabled"],bt={class:"px-3 text-center flex-grow"},kt=["content","aria-label","disabled"],xt={key:3},wt={key:0},Lt=["content"],_t=["onClick"],Tt={key:1,class:"text-center"},Mt={key:4,class:"p-5"},jt=G({__name:"result-list",props:{uid:{type:String,required:!0},results:{type:Object,required:!0}},setup(c){const x=_(),u=()=>{x.value._tippy.hide()},d=a=>{var b;a.key==="Tab"&&((b=x.value)!=null&&b.matches(":focus"))&&x.value._tippy.show()},p=ae("iApi"),w=ee(),h=re(),L=c,{t:y}=K(),s=_(!1),f=_(p.fixture.get("details")),r=_(!0),e=_(!1),i=_(0),T=_(20),O=_([]),C=_([]),m=z(()=>w.activeGreedy),E=z(()=>w.properties),v=z(()=>i.value+T.value),$=()=>h.getLayerByUid(L.uid),N=()=>L.results.find(a=>a.uid===L.uid),P=z(()=>{var a;return((a=N())==null?void 0:a.loaded)??!1}),j=z(()=>{var a;return(a=N())==null?void 0:a.requestTime}),D=z(()=>s.value&&(!e.value&&g().length>1||e.value&&g().length>T.value)),l=z(()=>{const a=$();return a&&E.value[a.id]&&E.value[a.id].name?E.value[a.id].name:(a==null?void 0:a.name)??""}),o=z(()=>L.uid),g=()=>{const a=N();return a?a.items:[]},H=z(()=>g()[i.value]),S=z(()=>{if(f.value.hasHilighter()){const a=$();if(a)return a.mapLayer&&a.supportsFeatures}return!1}),fe=a=>{r.value=a,w.hilightToggle=a,U()},ge=()=>{const a=$();i.value=i.value??0,r.value=w.hilightToggle??r.value,e.value=!1,s.value=!!a,U()},oe=a=>{e.value?(i.value+=a*T.value,U()):i.value+=a},U=()=>{const a=g();if(r.value&&P.value&&a.length>0&&S.value)if(e.value)f.value.hilightDetailsItems(a.slice(i.value,v.value),L.uid);else{const b=a[i.value];b&&f.value.hilightDetailsItems([b],L.uid)}else f.value.removeDetailsHilight()},he=()=>{e.value=!0,i.value=Math.floor(i.value/T.value)*T.value,U()},be=()=>{f.value.removeDetailsHilight(),C.value.forEach(a=>a()),O.value.forEach(a=>p.event.off(a))},ke=()=>{f.value.removeDetailsHilight()},xe=a=>{const b=i.value;i.value=a,e.value=!1,b===a&&U()};return ue(()=>{var a,b;O.value.push(p.event.on(W.LAYER_REMOVE,F=>{const Q=p.panel.get("details");L.uid===F.uid&&Q&&Q.close()})),O.value.push(p.event.on(W.PANEL_CLOSED,F=>{F.id==="details"&&be()})),O.value.push(p.event.on(W.PANEL_MINIMIZED,F=>{F.id==="details"&&ke()})),O.value.push(p.event.on(W.MAP_BASEMAPCHANGE,F=>{r.value&&F.schemaChanged&&U()})),(a=x.value)==null||a.addEventListener("blur",u),(b=x.value)==null||b.addEventListener("keyup",d)}),te(()=>{C.value.push(R(H,()=>{e.value||(ge(),H.value===void 0&&f.value.removeDetailsHilight())},{deep:!1,immediate:!0})),C.value.push(R(o,()=>{const a=L.uid;if(e.value&&a){const b=N();b&&b.loading.then(()=>{L.uid===a&&e.value&&U()})}},{deep:!1,immediate:!0})),C.value.push(R(j,()=>{i.value=0})),C.value.push(R(()=>L.uid,()=>{i.value=0}))}),le(()=>{var a,b;(a=x.value)==null||a.removeEventListener("blur",u),(b=x.value)==null||b.removeEventListener("keyup",d)}),(a,b)=>{const F=B("truncate"),Q=B("tippy"),we=B("focus-item"),Le=B("focus-list");return P.value&&m.value===0?(t(),n("div",{key:0,class:"detailsContent relative flex flex-col flex-grow pl-5",style:pe(c.results.length>1?{"margin-left":"42px"}:"")},[s.value?A((t(),n("h1",vt,[ie(I(l.value),1)])),[[F,{options:{placement:"top-start"}}]]):q("",!0),S.value?(t(),n("div",pt,[k("label",mt,I(M(y)("details.togglehilight.title")),1),se(ze,{config:{value:r.value,disabled:!1},onToggled:fe},null,8,["config"])])):q("",!0),D.value?(t(),n("div",yt,[k("div",ft,[e.value?q("",!0):(t(),n("button",{key:0,type:"button",class:"px-8 font-bold hover:bg-gray-200 focus:bg-gray-200","aria-label":M(y)("details.item.see.list"),onClick:b[0]||(b[0]=J=>he())},I(M(y)("details.item.see.list")),9,gt)),k("div",{class:Y(["flex ml-auto bg-gray-200 py-8 items-center",{"w-full":e.value}])},[A((t(),n("button",{type:"button",content:M(y)(e.value?"details.items.previous":"details.item.previous.item"),onClick:b[1]||(b[1]=J=>oe(-1)),class:"mx-2 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":M(y)(e.value?"details.items.previous":"details.item.previous.item"),disabled:i.value===0},b[3]||(b[3]=[k("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[k("g",null,[k("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,ht)),[[Q,{placement:"top"}]]),k("span",bt,I(e.value?M(y)("details.items.range",[i.value+1,Math.min(v.value,g().length),g().length]):M(y)("details.item.count",[i.value+1,g().length])),1),A((t(),n("button",{type:"button",content:M(y)(e.value?"details.items.next":"details.item.next.item"),onClick:b[2]||(b[2]=J=>oe(1)),class:"mx-2 rotate-180 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":M(y)(e.value?"details.items.next":"details.item.next.item"),disabled:!e.value&&i.value===g().length-1||e.value&&v.value>=g().length},b[4]||(b[4]=[k("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[k("g",null,[k("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,kt)),[[Q,{placement:"top"}]])],2)])])):q("",!0),s.value?(t(),n("div",xt,[g().length>0?(t(),n("div",wt,[e.value?A((t(),n("div",{key:0,class:"flex flex-col",content:M(y)("details.layers.results.list.tooltip"),ref_key:"el",ref:x},[(t(!0),n(V,null,X(g().slice(i.value,v.value),(J,de)=>A((t(),n("button",{class:"flex flex-grow truncate default-focus-style hover:bg-gray-200",key:de,onClick:Ct=>xe(i.value+de)},[se(ve,{data:J,uid:c.uid,open:!1,"in-list":!0},null,8,["data","uid"])],8,_t)),[[we,"show-truncate"]])),128))],8,Lt)),[[Le],[Q,{trigger:"manual",placement:"top-start",touch:!1}]]):(t(),Z(ve,{key:1,data:H.value,uid:c.uid,open:!0,"in-list":!1},null,8,["data","uid"]))])):(t(),n("div",Tt,I(M(y)("details.layers.results.empty.currentLayer")),1))])):(t(),n("div",Mt,I(M(y)("details.item.no.data")),1))],4)):(t(),n("div",{key:1,class:Y(["flex justify-center py-10 items-center",c.results.length>1?"ml-42":""])},[b[5]||(b[5]=k("span",{class:"animate-spin spinner h-20 w-20 px-5 mr-8"},null,-1)),ie(" "+I(M(y)("details.item.loading")),1)],2))}}}),zt=ne(jt,[["__scopeId","data-v-b02a05d4"]]),Et={class:"relative h-full"},Ht={class:"detailsContentSection overflow-y-auto h-full"},$t=G({__name:"details-screen",props:{panel:{type:Object}},setup(c){const{t:x}=K(),u=ae("iApi"),d=ee(),p=_([]),w=_([]),h=_([]),L=_(!1),y=_(""),s=z(()=>d.activeGreedy),f=z(()=>d.payload),r=z(()=>d.properties),e=m=>{y.value=m},i=m=>h.value.find(E=>E.uid===m),T=m=>{m!==void 0&&(d.activeGreedy=m.length===0?0:m[0].requestTime,h.value=m,O(m))},O=m=>{if(y.value){const E=i(y.value);E?E.loading.then(()=>{E.requestTime===s.value&&(E.items.length>0?(d.activeGreedy=0,L.value=!1):C(m))}):C(m)}else C(m)},C=(m,E)=>{let v;if(E)v=E;else{const j=d.properties,D=m.map(o=>{var g;return[((g=j[o.layerId])==null?void 0:g.priority)??50,o.layerId]}),l=new Set(D.map(o=>o[0]));v=[],l.forEach(o=>{const g=D.filter(H=>H[0]===o).map(H=>H[1]);v.push([o,g])}),v.sort((o,g)=>g[0]-o[0])}if(v.length===0){d.activeGreedy=0,L.value=!0;return}const $=v[v.length-1][1],N=m.filter(j=>$.includes(j.layerId)).map(j=>j.loading.then(()=>j.items.length>0?Promise.resolve(j):Promise.reject())),P=m.length===0?0:m[0].requestTime;Promise.any(N).then(j=>{j.requestTime===s.value&&(d.activeGreedy=0,y.value=j.uid,L.value=!1)}).catch(()=>{P===s.value&&(v.pop(),C(m,v))})};return te(()=>{w.value.push(R(f,m=>{T(m)},{deep:!1,immediate:!0}))}),le(()=>{p.value.forEach(m=>u.event.off(m)),w.value.forEach(m=>m())}),(m,E)=>{const v=Te("panel-screen");return t(),Z(v,{panel:c.panel},{header:ce(()=>[ie(I(M(d).origin==="toggleEvent"?M(x)("details.layers.title.gridOrigin"):M(x)("details.layers.title.identifyOrigin")),1)]),content:ce(()=>[k("div",Et,[h.value.length>1?(t(),Z(Ye,{key:0,results:h.value,detailsProperties:r.value,selected:y.value,onSelectionChanged:e},null,8,["results","detailsProperties","selected"])):q("",!0),k("div",Ht,[L.value?(t(),n("div",{key:1,class:Y(["text-center",{"ml-42":h.value.length>1}])},I(h.value.length>=1?M(x)("details.layers.results.empty"):M(x)("details.layers.results.empty.noLayers")),3)):(t(),Z(zt,{key:0,uid:y.value,results:h.value},null,8,["uid","results"]))])])]),_:1},8,["panel"])}}}),qt=ne($t,[["__scopeId","data-v-60c889f3"]]);export{qt as default};
