var N=Object.defineProperty;var M=(x,d,n)=>d in x?N(x,d,{enumerable:!0,configurable:!0,writable:!0,value:n}):x[d]=n;var w=(x,d,n)=>M(x,typeof d!="symbol"?d+"":d,n);import{gS as R,iJ as $,gV as T,iK as E,iL as _,iM as B,gZ as V,gY as j,hy as q,hk as O,gX as U,h6 as v,hc as C,hn as I,h3 as A,hj as p,h7 as z,hm as a,hr as h,h9 as L,ha as H,hd as F}from"./index-BeTPrQ6f.js";const G={en:{"keyboardnav.activeNamespace":"Namespace Active: {name}","keyboardnav.helpTitle":"Keyboard Shortcuts","keyboardnav.keysTitle":"Keys for {name}","keyboardnav.helpDescription":'Press <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">S</span> to start fixture shortcuts then type the fixture key (for example <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">D</span>) followed by an action key like <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">L</span>. Use <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Escape</span> to clear the chain or <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Backspace</span> to undo the last key.',"keyboardnav.noShortcuts":"No shortcuts available.","keyboardnav.mainShortcuts.title":"Global controls","keyboardnav.mainShortcuts.numbers":"Focus on an open panel (1 being leftmost)","keyboardnav.mainShortcuts.escape":"Clear the chain or close the focused panel","keyboardnav.mainShortcuts.start":"Start or reset fixture shortcuts","keyboardnav.mainShortcuts.backspace":"Remove the last key in the chain","keyboardnav.chain.help":"Toggle shortcut guide"},fr:{"keyboardnav.activeNamespace":"Espace de noms actif : {name}","keyboardnav.helpTitle":"Raccourcis clavier","keyboardnav.keysTitle":"Raccourcis pour {name}","keyboardnav.helpDescription":`Appuyez sur <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">S</span> pour démarrer les raccourcis de module puis saisissez la touche du module (par exemple <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">D</span>) suivie d'une touche d'action comme <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">L</span>. Utilisez <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Échap</span> pour effacer la chaîne ou <span class="font-mono px-6 text-[0.825rem]/6 font-semibold rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400">Retour</span> pour enlever la dernière touche.`,"keyboardnav.noShortcuts":"Aucun raccourci disponible.","keyboardnav.mainShortcuts.title":"Contrôles globaux","keyboardnav.mainShortcuts.numbers":"Concentrer sur un panneau ouvert (1 étant le plus à gauche)","keyboardnav.mainShortcuts.escape":"Effacer la chaîne ou fermer le panneau actif","keyboardnav.mainShortcuts.start":"Démarrer ou réinitialiser les raccourcis de module","keyboardnav.mainShortcuts.backspace":"Retirer la dernière touche de la chaîne","keyboardnav.chain.help":"Afficher ou masquer le guide des raccourcis"}},J=["aria-label"],Q={class:"border-b border-gray-200 bg-white px-4 py-20 sm:px-24"},X={class:"text-base font-semibold text-gray-900"},P=["innerHTML"],W={role:"list",class:"m-0 max-w-[calc(var(--container-lg)-(--spacing(8)))] list-none divide-y divide-zinc-900/5 p-0 dark:divide-white/5"},Y={class:"pl-24 mb-8 py-16"},Z={class:"flex items-center gap-x-12"},ee={class:"font-mono text-md text-zinc-600"},ne={class:"space-y-4 p-16 pl-24"},te={class:"flex items-center gap-x-12"},ae={class:"font-mono text-md text-zinc-600"},ie={class:"flex items-center gap-x-12"},re={class:"font-mono text-md text-zinc-600"},se={class:"flex items-center gap-x-12"},ce={class:"font-mono text-md text-zinc-600"},oe={class:"flex items-center gap-x-12"},le={class:"font-mono text-md text-zinc-600"},de={key:0,class:"pl-24 mb-8 py-16 border-b"},pe={class:"font-mono text-md text-zinc-600"},ue={class:"flex items-center gap-x-4"},ge={class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},he={class:"font-mono text-md text-zinc-600"},me={key:0,class:"space-y-4 p-16 pl-24"},be={class:"flex items-center gap-x-4"},xe={class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},fe={class:"font-mono text-md text-zinc-600"},D='button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])',ke=R({__name:"keyboardnav",setup(x){const d=$(),{activeNamespace:n,namespaces:t,helpVisible:e}=B(d),{t:c}=V(),m=j(()=>Object.entries(t.value).map(([r,i])=>({id:r,keys:(i==null?void 0:i.keys)??[]}))),g=q("dialogRef"),s=O("iApi"),b=U(null);function f(r){return r?(r.tabIndex<0&&r.setAttribute("tabindex","-1"),r):null}function l(){var o;const r=g.value;if(!r)return;const i=r.querySelector(D);(o=f(i??r))==null||o.focus({preventScroll:!0})}function u(){var i,o,y;const r=((y=(o=(i=s==null?void 0:s.geo)==null?void 0:i.map)==null?void 0:o.esriView)==null?void 0:y.container)??document.getElementById("esriMap");return r?r.querySelector(".esri-view-surface")??r.querySelector(D)??r:null}function k(){var o;const r=u(),i=b.value&&document.contains(b.value)?b.value:null;(o=f(r??i))==null||o.focus({preventScroll:!0}),b.value=null}function S(){d.setHelpVisible(!1),d.resetChain({suppressHandler:!0})}function K(r){r.target===r.currentTarget&&S()}return I(e,async r=>{r?(b.value=document.activeElement instanceof HTMLElement?document.activeElement:null,await A(),e.value&&l()):(await A(),e.value||k())}),(r,i)=>p(e)?(z(),v("div",{key:0,class:"absolute inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 transition-opacity pointer-events-auto",tabindex:"-1",onClick:K},[a("div",{ref_key:"dialogRef",ref:g,class:"relative w-[640px] max-h-[80vh] overflow-y-auto rounded-xl bg-white py-8 px-10 shadow-xl",role:"dialog","aria-modal":"true","aria-live":"polite"},[a("button",{type:"button",class:"absolute right-8 top-8 text-gray-500 hover:text-black focus:text-black p-4","aria-label":p(c)("panels.controls.close"),onClick:S},i[0]||(i[0]=[a("svg",{class:"fill-current w-16 h-16",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 352 512"},[a("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"})],-1)]),8,J),a("div",Q,[a("h3",X,h(p(c)("keyboardnav.helpTitle")),1),a("div",{innerHTML:p(c)("keyboardnav.helpDescription"),class:"mt-6 text-sm text-gray-500"},null,8,P)]),a("ul",W,[a("li",Y,[a("div",Z,[a("span",ee,h(p(c)("keyboardnav.mainShortcuts.title")),1)]),a("div",ne,[a("div",te,[i[1]||(i[1]=a("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," 1-5 ",-1)),i[2]||(i[2]=a("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),a("span",ae,h(p(c)("keyboardnav.mainShortcuts.numbers")),1)]),a("div",ie,[i[3]||(i[3]=a("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," ESC ",-1)),i[4]||(i[4]=a("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),a("span",re,h(p(c)("keyboardnav.mainShortcuts.escape")),1)]),a("div",se,[i[5]||(i[5]=a("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," S ",-1)),i[6]||(i[6]=a("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),a("span",ce,h(p(c)("keyboardnav.mainShortcuts.start")),1)]),a("div",oe,[i[7]||(i[7]=a("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"}," Backspace ",-1)),i[8]||(i[8]=a("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),a("span",le,h(p(c)("keyboardnav.mainShortcuts.backspace")),1)])])]),m.value.length===0?(z(),v("li",de,[a("p",pe,h(p(c)("keyboardnav.noShortcuts")),1)])):C("",!0),(z(!0),v(L,null,H(m.value,o=>(z(),v("li",{key:o.id,class:"pl-24 mb-8 py-16 border-b"},[a("div",{class:F(["flex items-center gap-x-12",{"opacity-60":p(n)&&p(n)!==o.id}])},[a("div",ue,[i[9]||(i[9]=a("span",{class:"font-mono px-6 text-[0.825rem]/6 font-semibold whitespace-nowrap rounded-lg px-1.5 ring-1 ring-inset ring-zinc-300 bg-zinc-400/10 text-zinc-500 dark:ring-zinc-400/30 dark:bg-zinc-400/10 dark:text-zinc-400"},"S",-1)),a("span",ge,h(o.id),1)]),i[10]||(i[10]=a("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),a("span",he,h(p(c)(`keyboardnav.ns.${o.id}`)),1)],2),o.keys.length?(z(),v("div",me,[(z(!0),v(L,null,H(o.keys,y=>(z(),v("div",{key:y.key,class:"flex items-center gap-x-12"},[a("div",be,[a("span",xe,h(y.key),1)]),i[11]||(i[11]=a("span",{class:"h-2 w-2 rounded-full bg-zinc-300 dark:bg-zinc-600"},null,-1)),a("span",fe,h(p(c)(`keyboardnav.key.${o.id}.${y.key}`)),1)]))),128))])):C("",!0)]))),128))])],512)])):C("",!0)}});class ve extends T{constructor(){super(...arguments);w(this,"keyboardnavStore",$(this.$vApp.$pinia));w(this,"_handleKeyDown",n=>{var b,f;if(!(n instanceof KeyboardEvent))return;const t=n;if(this._isInput(t.target))return;const e=this.keyboardnavStore,c=e.keyChain,m=t.altKey||t.ctrlKey||t.metaKey;if(!t.shiftKey&&!m&&!c.length&&/^[1-5]$/.test(t.key)){const l=parseInt(t.key,10)-1,u=this.$iApi.panel.visible[l];u&&(t.preventDefault(),this.$iApi.panel.focus(u));return}const g=t.key,s=g.length===1?g.toUpperCase():g;if(!m&&s==="Escape"&&e.helpVisible){t.preventDefault(),e.setHelpVisible(!1),e.resetChain({suppressHandler:!0});return}if(!t.shiftKey&&!m&&s===E){t.preventDefault();const l=e.chainState==="complete";e.resetChain({suppressHandler:l}),e.setChain([E]),e.setLastAction(void 0),e.setChainState("awaitNamespace");return}if(e.chainState==="idle"){if(s==="Escape"&&!t.shiftKey&&!m){const l=t.target.closest("[data-cy]");if(l&&((f=(b=this.$iApi.$rootEl)==null?void 0:b.querySelector(".panel-container"))!=null&&f.contains(l))){t.preventDefault();const u=l.getAttribute("data-cy");u&&this.$iApi.panel.close(u)}}return}if(s==="Escape"){t.preventDefault(),e.resetChain({event:t});return}if(s==="Backspace"){if(!c.length)return;t.preventDefault();const l=e.chainState;if(e.setLastAction(void 0),e.popChain(),!e.keyChain.length){e.resetChain({suppressHandler:!0});return}if(e.keyChain.length===1){e.setChainState("awaitNamespace"),e.deactivate(t);return}if(e.keyChain.length===2){e.setChainState("awaitAction");const u=e.keyChain[1];l==="complete"&&u&&e.activate(u,t,{suppressHandler:!1});return}return}if(!(t.shiftKey||m)){if(e.chainState==="awaitNamespace"){const l=Object.keys(e.namespaces);if(s==="H"){t.preventDefault(),e.appendKey("H"),e.setLastAction({namespace:_,key:"H"}),e.finalizeChain({event:t}),e.setHelpVisible(!e.helpVisible);return}if(l.includes(s)){t.preventDefault(),e.appendKey(s),e.setLastAction(void 0),e.activate(s,t),e.setChainState("awaitAction");return}return}if(e.chainState==="awaitAction"){const l=e.activeNamespace??(c[1]||""),u=e.namespaces[l];if(!u){e.resetChain({suppressHandler:!0});return}if(!u.keys.map(S=>S.key.toUpperCase()).includes(s))return;t.preventDefault(),e.appendKey(s);const k=e.trigger(s,t);if(k!=null&&k.chainAction)return;k&&e.setLastAction(k),e.finalizeChain({event:t});return}}});w(this,"_handleBlur",()=>{this.keyboardnavStore.resetChain(),this.keyboardnavStore.setHelpVisible(!1)})}_isInput(n){return!n||!(n instanceof HTMLElement)?!1:!!n.closest('input, textarea, [contenteditable="true"]')}register(n,t){const e=n.toUpperCase(),c=this.keyboardnavStore.register(e,t),m=`keyboardnav.ns.${c}`;return Object.entries(t.name).forEach(([g,s])=>{this.$iApi.$i18n.mergeLocaleMessage(g,{[m]:s})}),t.keys.forEach(g=>{const s=`keyboardnav.key.${c}.${g.key}`;Object.entries(g.description).forEach(([b,f])=>{this.$iApi.$i18n.mergeLocaleMessage(b,{[s]:f})})}),c}unregister(n){this.keyboardnavStore.unregister(n.toUpperCase())}reset(){const n=this.keyboardnavStore,t=n.activeNamespace??n.keyChain[1];return t?(n.setChain([E,t]),n.setLastAction(void 0),n.setChainState("awaitAction"),n.activeNamespace=t,"reset"):(n.resetChain({suppressHandler:!0}),"reset")}clear(n){return this.keyboardnavStore.resetChain({event:n,suppressHandler:!0}),"clear"}added(){const n=this.$iApi.$rootEl;n==null||n.addEventListener("keydown",this._handleKeyDown),n==null||n.addEventListener("blur",this._handleBlur)}removed(){const n=this.$iApi.$rootEl;n==null||n.removeEventListener("keydown",this._handleKeyDown),n==null||n.removeEventListener("blur",this._handleBlur)}}class Se extends ve{added(){Object.entries(G).forEach(t=>this.$iApi.$i18n.mergeLocaleMessage(...t));const{destroy:d,el:n}=this.mount(ke,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(n.childNodes[0]),super.added(),this.removed=()=>{super.removed(),d(),$(this.$vApp.$pinia).$reset()}}}export{Se as default};
