import{P as B,l as F,kL as C}from"./index-BeTPrQ6f.js";import{N as d,_ as a}from"./enums-DDJfd4_p-D3z9tmVA.js";import{n as k}from"./definitions-DVO21zOC-BwakNu1s.js";import{r as O}from"./BoundingBox-DlCd_wcU-DBB4UfPl.js";import{c as v}from"./VertexElementDescriptor-DLvjNrmQ-Cuvx5w94.js";var f;let T=(f=class{constructor(t,r,n,s,i,o,c){this.instanceId=t,this.textureKey=r,this.indexStart=n,this.indexCount=s,this.vertexStart=i,this.vertexCount=o,this.overlaps=c}updateBaseOffsets(t){this.vertexStart+=t.vertexFrom,this.indexStart+=t.indexFrom}clone(){return new f(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(t,r,n,s,i,o,c,l){t.push(r),t.push(n),t.push(s),t.push(i),t.push(o),t.push(c),t.push(l)}serialize(t){return t.push(this.instanceId),t.push(this.textureKey),t.push(this.indexStart),t.push(this.indexCount),t.push(this.vertexStart),t.push(this.vertexCount),t.push(this.overlaps),t}static deserialize(t){const r=t.readInt32(),n=t.readInt32(),s=t.readInt32(),i=t.readInt32(),o=t.readInt32(),c=t.readInt32(),l=t.readInt32();return new f(r,n,s,i,o,c,l)}},f.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT,f.estimatedMemory=40,f);function $(e,t){if(t!==null){e.push(t.length);for(const r of t)r.serialize(e);return e}e.push(0)}function P(e,t,r){const n=e.readInt32(),s=new Array(n);for(let i=0;i<s.length;i++)s[i]=t.deserialize(e,r);return s}const y=class y{static estimateMemory(t){return 24+T.estimatedMemory*t}constructor(t,r){this.id=t,this.sortKey=r,this.records=[]}serialize(t){return t.push(this.id),t.writeF32(this.sortKey),$(t,this.records),t}static deserialize(t){const r=t.readInt32(),n=t.readF32(),s=new y(r,n);return s.records=P(t,T)??[],s}};y.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+T.byteSizeHint;let N=y;const M=new Float32Array(1),U=new Uint32Array(M.buffer);function z(e){return M[0]=e,U[0]}function J(e){return U[0]=e,M[0]}function Q(e,t){return 65535&e|t<<16}function g(e){const t=z(e),r=t>>>31;let n=t>>>23&255,s=8388607&t;return n-=127,n>15?r<<15|31744:n<-25?0:(n<-14&&(s+=8388608,s/=2**(-14-n),n=-15),n+=15,s/=8192,s=H(s,1023),r<<15|n<<10|s)}function H(e,t){const r=Math.floor(e),n=e-r;return r<t&&(n>.5||n===.5&&r%2==1)?r+1:r}function b(e){let t=e>>>15,r=e>>10&31,n=1023&e;return t=t?-1:1,r-=15,n/=1024,r>-15?n+=1:r=-14,t*2**r*n}function tt(e){const t=e.map(({name:r,count:n,type:s})=>`${r}.${n}.${s}`).join(",");return C(t)}function h(e,t,r,n,s,i,o){if(e.primitiveName===t){let c=n==null?void 0:n.readWithDefault(s,i,e[r]&&o);return e.type==="text"&&(c=c.toString()),void(e[r]=c)}if("type"in e&&e.type!=null){if(e.effects)for(const c of e.effects)h(c,t,r,n,s,i,o);switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.symbolLayers)for(const c of e.symbolLayers)h(c,t,r,n,s,i,o);break;case"CIMTextSymbol":e.symbol&&h(e.symbol,t,r,n,s,i,o);break;case"CIMHatchFill":e.lineSymbol&&h(e.lineSymbol,t,r,n,s,i,o);break;case"CIMPictureMarker":case"CIMCharacterMarker":case"CIMVectorMarker":if(e.markerPlacement&&h(e.markerPlacement,t,r,n,s,i,o),e.type==="CIMVectorMarker"&&e.markerGraphics)for(const c of e.markerGraphics)h(c,t,r,n,s,i,o),h(c.symbol,t,r,n,s,i,o)}}}const D=400;function et(e){const t=Math.max(1.25*e.width,20);return e.effects!=null&&e.effects.length>0?D:t}function rt(e,t,r,n){const s=r.packPrecisionFactor??1;switch(r.type){case a.BYTE:if(r.count===1)e.setInt8(n+r.offset,t*s);else for(let i=0;i<r.count;i++){const o=i*Int8Array.BYTES_PER_ELEMENT;e.setInt8(n+r.offset+o,t[i]*s)}break;case a.UNSIGNED_BYTE:if(r.count===1)e.setUint8(n+r.offset,t*s);else for(let i=0;i<r.count;i++){const o=i*Uint8Array.BYTES_PER_ELEMENT;e.setUint8(n+r.offset+o,t[i]*s)}break;case a.SHORT:if(r.count===1)e.setInt16(n+r.offset,t*s,!0);else for(let i=0;i<r.count;i++){const o=i*Int16Array.BYTES_PER_ELEMENT;e.setInt16(n+r.offset+o,t[i]*s,!0)}break;case a.UNSIGNED_SHORT:if(r.count===1)e.setUint16(n+r.offset,t*s,!0);else for(let i=0;i<r.count;i++){const o=i*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(n+r.offset+o,t[i]*s,!0)}break;case a.INT:if(r.count===1)e.setInt32(n+r.offset,t*s,!0);else for(let i=0;i<r.count;i++){const o=i*Int32Array.BYTES_PER_ELEMENT;e.setInt32(n+r.offset+o,t[i]*s,!0)}break;case a.UNSIGNED_INT:if(r.count===1)e.setUint32(n+r.offset,t*s,!0);else for(let i=0;i<r.count;i++){const o=i*Uint32Array.BYTES_PER_ELEMENT;e.setUint32(n+r.offset+o,t[i]*s,!0)}break;case a.FLOAT:if(r.count===1)e.setFloat32(n+r.offset,t*s,!0);else for(let i=0;i<r.count;i++){const o=i*Float32Array.BYTES_PER_ELEMENT;e.setFloat32(n+r.offset+o,t[i]*s,!0)}break;case a.HALF_FLOAT:if(r.count===1)e.setUint16(n+r.offset,g(t*s),!0);else for(let i=0;i<r.count;i++){const o=i*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(n+r.offset+o,g(t[i]*s),!0)}}}function nt(e,t,r){switch(t.type){case a.BYTE:{if(t.count===1)return e.getInt8(r+t.offset);const n=[];for(let s=0;s<t.count;s++){const i=s*Int8Array.BYTES_PER_ELEMENT;n.push(e.getInt8(r+t.offset+i))}return n}case a.UNSIGNED_BYTE:{if(t.count===1)return e.getUint8(r+t.offset);const n=[];for(let s=0;s<t.count;s++){const i=s*Uint8Array.BYTES_PER_ELEMENT;n.push(e.getUint8(r+t.offset+i))}return n}case a.SHORT:{if(t.count===1)return e.getInt16(r+t.offset,!0);const n=[];for(let s=0;s<t.count;s++){const i=s*Int16Array.BYTES_PER_ELEMENT;n.push(e.getInt16(r+t.offset+i,!0))}return n}case a.UNSIGNED_SHORT:{if(t.count===1)return e.getUint16(r+t.offset,!0);const n=[];for(let s=0;s<t.count;s++){const i=s*Uint16Array.BYTES_PER_ELEMENT;n.push(e.getUint16(r+t.offset+i,!0))}return n}case a.INT:{if(t.count===1)return e.getInt32(r+t.offset,!0);const n=[];for(let s=0;s<t.count;s++){const i=s*Int32Array.BYTES_PER_ELEMENT;n.push(e.getInt32(r+t.offset+i,!0))}return n}case a.UNSIGNED_INT:{if(t.count===1)return e.getUint32(r+t.offset,!0);const n=[];for(let s=0;s<t.count;s++){const i=s*Uint32Array.BYTES_PER_ELEMENT;n.push(e.getUint32(r+t.offset+i,!0))}return n}case a.FLOAT:{if(t.count===1)return e.getFloat32(r+t.offset,!0);const n=[];for(let s=0;s<t.count;s++){const i=s*Float32Array.BYTES_PER_ELEMENT;n.push(e.getFloat32(r+t.offset+i,!0))}return n}case a.HALF_FLOAT:{if(t.count===1)return b(e.getUint16(r+t.offset,!0));const n=[];for(let s=0;s<t.count;s++){const i=s*Uint16Array.BYTES_PER_ELEMENT;n.push(b(e.getUint16(r+t.offset+i,!0)))}return n}}}const w=2;class A{constructor(t,r,n,s,i,o,c,l,E,I,u,m=[],p=0,S=0){this.displayId=t,this.labelClassId=r,this.labelIdHash=n,this.hash=s,this.anchorX=i,this.anchorY=o,this.directionX=c,this.directionY=l,this.maxScale=E,this.minScale=I,this.referenceBounds=u,this.bounds=m,this.recordStart=p,this.recordCount=S,this.priority=0,this._colliders=null,this.uniqueSymbol=null,this.selectedForRendering=!1}get xTile(){return this.anchorX}get yTile(){return this.anchorY}colliders(t){var r;if(!this._colliders){const n=t.attributeView,s=k;let i=((r=this.referenceBounds)==null?void 0:r.size)??0;const o=t.layerView.labelingCollisionInfos[0].vvEvaluators[0];if(o!=null){const u=o(n.getVisualVariableData(this.displayId,0));i=isNaN(u)||u==null||u===1/0?i:u}const c=this.minScale?t.layerView.view.featuresTilingScheme.scaleToZoom(this.minScale):0,l=this.maxScale?t.layerView.view.featuresTilingScheme.scaleToZoom(this.maxScale):25,E=this.directionX*(s+i/2),I=this.directionY*(s+i/2);this._colliders=this.bounds.map(u=>({labelId:this.labelIdHash,xTile:this.anchorX,yTile:this.anchorY,dxPixels:u.x-u.halfWidth+E,dyPixels:u.y-u.halfHeight+I,hard:!0,partIndex:1,width:u.width+w,height:u.height+w,angle:0,xScreen:0,yScreen:0,dxScreen:0,dyScreen:0,enabled:!0,minLod:c,maxLod:l}))}return this._colliders}get id(){return this.displayId}serialize(t){t.push(this.displayId),t.push(this.labelClassId),t.push(this.labelIdHash),t.push(this.hash),t.push(this.recordStart),t.push(this.recordCount),t.writeF32(this.anchorX),t.writeF32(this.anchorY),t.writeF32(this.directionX),t.writeF32(this.directionY),t.writeF32(this.maxScale),t.writeF32(this.minScale),this.referenceBounds?(t.writeF32(this.referenceBounds.size),t.writeF32(this.referenceBounds.offsetX),t.writeF32(this.referenceBounds.offsetY)):(t.writeF32(0),t.writeF32(0),t.writeF32(0)),$(t,this.bounds)}static deserialize(t){const r=t.readInt32(),n=t.readInt32(),s=t.readInt32(),i=t.readInt32(),o=t.readInt32(),c=t.readInt32(),l=t.readF32(),E=t.readF32(),I=t.readF32(),u=t.readF32(),m=t.readF32(),p=t.readF32(),S=t.readF32(),L=t.readF32(),Y=t.readF32(),R=P(t,O)??[];return new A(r,n,s,i,l,E,I,u,m,p,{size:S,offsetX:L,offsetY:Y},R,o,c)}}function G(e){switch(e){case a.BYTE:case a.UNSIGNED_BYTE:return 1;case a.SHORT:case a.UNSIGNED_SHORT:case a.HALF_FLOAT:return 2;case a.FLOAT:case a.INT:case a.UNSIGNED_INT:return 4}}const x=()=>B.getLogger("esri.views.2d.engine.webgl.Utils");function st(e){switch(e){case d.UNSIGNED_BYTE:return 1;case d.UNSIGNED_SHORT_4_4_4_4:return 2;case d.FLOAT:return 4;default:return void x().error(new F("webgl-utils",`Unable to handle type ${e}`))}}function it(e){switch(e){case d.UNSIGNED_BYTE:return Uint8Array;case d.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case d.FLOAT:return Float32Array;default:return void x().error(new F("webgl-utils",`Unable to handle type ${e}`))}}function V(e){let t=0;const r=e.map(n=>{const s=new v(n.name,n.count,n.type,t,0,n.normalized||!1);return t+=n.count*G(n.type),s});return r.forEach(n=>n.stride=t),r}const X=e=>{const t=new Map;for(const r of e)t.set(r.name,r.location);return t},_=new Map,ot=(e,t)=>{if(!_.has(e)){const r={bufferLayout:V(t),attributes:X(t)};_.set(e,r)}return _.get(e)},at=e=>e.includes("data:image/svg+xml");function ct(e){const t=[];for(let r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t}function ut(e){if(e==null)return"";const{type:t}=e;switch(t){case"CIMMarkerPlacementAlongLineRandomSize":return`${t}-${e.seed}-${e.randomization}`;case"CIMMarkerPlacementAlongLineVariableSize":return`${t}-${e.maxRandomOffset}-${e.numberOfSizes}-${e.seed}-${e.variationMethod}`;case"CIMMarkerPlacementAtExtremities":return`${t}-${e.extremityPlacement}-${e.offsetAlongLine}`;case"CIMMarkerPlacementAtRatioPositions":return`${t}-${e.beginPosition}-${e.endPosition}-${e.flipFirst}-${JSON.stringify(e.positionArray)}`;case"CIMMarkerPlacementAtMeasuredUnits":return`${t}-${e.interval}-${e.skipMarkerRate}-${e.placeAtExtremities}`;case"CIMMarkerPlacementInsidePolygon":return`${t}-${e.stepX}-${e.stepY}-${e.randomness}-${e.gridType}-${e.seed}-${e.shiftOddRows}`;case"CIMMarkerPlacementOnLine":return`${t}-${e.relativeTo}-${e.startPointOffset}`;case"CIMMarkerPlacementOnVertices":return`${t}-${e.placeOnControlPoints}-${e.placeOnEndPoints}-${e.placeOnRegularVertices}`;case"CIMMarkerPlacementPolygonCenter":return`${t}-${e.method}`;default:return`${t}`}}export{T as E,tt as G,Q as H,st as J,rt as K,N,P as S,z as U,it as W,et as X,at as e,h as f,A as g,nt as j,ut as n,ct as s,ot as t,J as z};
