import{I as G,ap as A,aq as F,E as x,k as E,aa as S,a7 as j,h as B,ar as g,a as M}from"./Theme-B-bTIh2g-Cau2iaVg.js";class k extends M{_beforeChanged(){super._beforeChanged(),(this.isDirty("pointerBaseWidth")||this.isDirty("cornerRadius")||this.isDirty("pointerLength")||this.isDirty("pointerX")||this.isDirty("pointerY")||this.isDirty("width")||this.isDirty("height"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){this.markDirtyBounds();let t=this.width(),i=this.height();if(t>0&&i>0){let e=this.get("cornerRadius",8);e=g(e,0,Math.min(t/2,i/2));let l=this.get("pointerX",0),r=this.get("pointerY",0),o=this.get("pointerBaseWidth",15)/2,v=0,_=0,D=t,T=0,d=t,p=i,n=0,f=i,h=(l-v)*(p-_)-(r-_)*(d-v),u=(l-n)*(T-f)-(r-f)*(D-n);const s=this._display;if(s.moveTo(e,0),h>0&&u>0){let a=Math.round(g(l,e+o,t-o-e));r=g(r,-1/0,0),s.lineTo(a-o,0),s.lineTo(l,r),s.lineTo(a+o,0)}if(s.lineTo(t-e,0),s.arcTo(t,0,t,e,e),h>0&&u<0){let a=Math.round(g(r,e+o,i-o-e));l=g(l,t,1/0),s.lineTo(t,e),s.lineTo(t,Math.max(a-o,e)),s.lineTo(l,r),s.lineTo(t,a+o)}if(s.lineTo(t,i-e),s.arcTo(t,i,t-e,i,e),h<0&&u<0){let a=Math.round(g(l,e+o,t-o-e));r=g(r,i,1/0),s.lineTo(t-e,i),s.lineTo(a+o,i),s.lineTo(l,r),s.lineTo(a-o,i)}if(s.lineTo(e,i),s.arcTo(0,i,0,i-e,e),h<0&&u>0){let a=Math.round(g(r,e+o,i-e-o));l=g(l,-1/0,0),s.lineTo(0,i-e),s.lineTo(0,a+o),s.lineTo(l,r),s.lineTo(0,Math.max(a-o,e))}s.lineTo(0,e),s.arcTo(0,0,e,0,e),s.closePath()}}}}Object.defineProperty(k,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PointedRectangle"}),Object.defineProperty(k,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:M.classNames.concat([k.className])});class P extends G{constructor(t,i,e,l=[]){super(t,i,e,l),Object.defineProperty(this,"_fx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_fy",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_fillDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_fillGrDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_strokeDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_labelDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_w",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_h",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_keepHoverDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_htmlContentHovered",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_afterNew(){this._settings.themeTags=A(this._settings.themeTags,["tooltip"]),super._afterNew(),this._setDefaultFn("background",()=>k.new(this._root,{})).set("themeTags",["tooltip","background"]),this._label=this.children.push(F.new(this._root,{})),this._disposers.push(this._label.events.on("boundschanged",()=>{this._updateBackground()})),this._disposers.push(this.on("bounds",()=>{this._updateBackground()})),this._updateTextColor(),this._root.tooltipContainer.children.push(this),this.hide(0),this._disposers.push(this.label.onPrivate("htmlElement",t=>{t&&(this._disposers.push(x(t,"pointerover",i=>{this._htmlContentHovered=!0})),this._disposers.push(x(t,"pointerout",i=>{this._htmlContentHovered=!1})))})),this.on("visible",t=>{this._handleReaderAnnouncement()}),this.label.events.on("dataitemchanged",t=>{this._handleReaderAnnouncement()}),this._root._tooltips.push(this)}_handleReaderAnnouncement(){this.get("readerAnnounce")&&this.isVisibleDeep()&&this._root.readerAlert(this.label.getAccessibleText())}get label(){return this._label}_dispose(){super._dispose(),E(this._root._tooltips,this)}_updateChildren(){super._updateChildren(),(this.isDirty("pointerOrientation")||this.isPrivateDirty("minWidth")||this.isPrivateDirty("minHeight"))&&this.get("background")._markDirtyKey("width"),this.get("labelText")!=null&&this.label.set("text",this.get("labelText")),this.get("labelHTML")!=null&&this.label.set("html",this.get("labelHTML")),this.get("labelAriaLabel")!=null&&this.label.set("ariaLabel",this.get("labelAriaLabel"))}_changed(){if(super._changed(),(this.isDirty("pointTo")||this.isDirty("pointerOrientation"))&&this._updateBackground(),this.isDirty("tooltipTarget")&&this.updateBackgroundColor(),this.isDirty("keepTargetHover"))if(this.get("keepTargetHover")){const t=this.get("background");this._keepHoverDp=new S([t.events.on("pointerover",i=>{let e=this.get("tooltipTarget");e&&(e.parent&&e.parent.getPrivate("tooltipTarget")==e&&(e=e.parent),e.hover())}),t.events.on("pointerout",i=>{let e=this.get("tooltipTarget");e&&(e.parent&&e.parent.getPrivate("tooltipTarget")==e&&(e=e.parent),this._htmlContentHovered||e.unhover())})]),this.label.onPrivate("htmlElement",i=>{this._keepHoverDp&&i&&this._keepHoverDp.disposers.push(x(i,"pointerleave",e=>{const l=this.root._renderer.getEvent(e);t.events.dispatch("pointerout",{type:"pointerout",originalEvent:l.event,point:l.point,simulated:!1,target:t})}))})}else this._keepHoverDp&&(this._keepHoverDp.dispose(),this._keepHoverDp=void 0)}_onShow(){super._onShow(),this.updateBackgroundColor()}updateBackgroundColor(){let t=this.get("tooltipTarget");const i=this.get("background");let e,l;if(t&&i){if(e=t.get("fill"),l=t.get("stroke"),e==null&&(e=l),this.get("getFillFromSprite")&&(this._fillDp&&this._fillDp.dispose(),e!=null&&i.set("fill",e),this._fillDp=t.on("fill",r=>{r!=null&&(i.set("fill",r),this._updateTextColor(r))}),this._disposers.push(this._fillDp)),this.get("getFillGradientFromSprite")){this._fillGrDp&&this._fillGrDp.dispose();let r=t.get("fillGradient");r!=null&&i.set("fillGradient",r),this._fillGrDp=t.on("fillGradient",o=>{o!=null&&i.set("fillGradient",o)}),this._disposers.push(this._fillGrDp)}this.get("getStrokeFromSprite")&&(this._strokeDp&&this._strokeDp.dispose(),e!=null&&i.set("stroke",e),this._strokeDp=t.on("fill",r=>{r!=null&&i.set("stroke",r)}),this._disposers.push(this._strokeDp)),this.get("getLabelFillFromSprite")&&(this._labelDp&&this._labelDp.dispose(),e!=null&&this.label.set("fill",e),this._labelDp=t.on("fill",r=>{r!=null&&this.label.set("fill",r)}),this._disposers.push(this._labelDp))}this._updateTextColor(e)}_updateTextColor(t){this.get("autoTextColor")&&(t==null&&(t=this.get("background").get("fill")),t==null&&(t=this._root.interfaceColors.get("background")),t instanceof j&&this.label.set("fill",j.alternative(t,this._root.interfaceColors.get("alternativeText"),this._root.interfaceColors.get("text"))))}_setDataItem(t){super._setDataItem(t),this.label._setDataItem(t)}_updateBackground(){super.updateBackground();const t=this._root.container;if(t){let i=.5,e=.5,l=this.get("centerX");l instanceof B&&(i=l.value);let r=this.get("centerY");r instanceof B&&(e=r.value);let o=t.width(),v=t.height(),_=this.parent,D=0,T=0;if(_){D=_.x(),T=_.y();const c=_.get("layerMargin");c&&(D+=c.left||0,T+=c.top||0,o+=(c.left||0)+(c.right||0),v+=(c.top||0)+(c.bottom||0))}const d=this.get("bounds",{left:-D,top:-T,right:o-D,bottom:v-T});this._updateBounds();let p=this.width(),n=this.height();p===0&&(p=this._w),n===0&&(n=this._h);let f=this.get("pointTo",{x:o/2,y:v/2}),h=f.x,u=f.y,s=this.get("pointerOrientation"),a=this.get("background"),b=0,m=0,y=0;a instanceof k&&(b=a.get("pointerLength",0),m=a.get("strokeWidth",0)/2,y=m,a.set("width",p),a.set("height",n));let C=0,O=0,H=d.right-d.left,L=d.bottom-d.top;s=="horizontal"||s=="left"||s=="right"?(m=0,s=="horizontal"?h>d.left+H/2?(h-=p*(1-i)+b,y*=-1):h+=p*i+b:s=="left"?h+=p*(1-i)+b:(h-=p*i+b,y*=-1)):(y=0,s=="vertical"?u>d.top+n/2+b?u-=n*(1-e)+b:(u+=n*e+b,m*=-1):s=="down"?u-=n*(1-e)+b:(u+=n*e+b,m*=-1)),h=g(h,d.left+p*i,d.left+H-p*(1-i))+y,u=g(u,d.top+n*e,d.top+L-n*(1-e))-m,C=f.x-h+p*i+y,O=f.y-u+n*e-m,this._fx=h,this._fy=u;const w=this.get("animationDuration",0);if(w>0&&this.get("visible")&&this.get("opacity")>.1){const c=this.get("animationEasing");this.animate({key:"x",to:h,duration:w,easing:c}),this.animate({key:"y",to:u,duration:w,easing:c})}else this.set("x",h),this.set("y",u);a instanceof k&&(a.set("pointerX",C),a.set("pointerY",O)),p>0&&(this._w=p),n>0&&(this._h=n)}}}Object.defineProperty(P,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Tooltip"}),Object.defineProperty(P,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:G.classNames.concat([P.className])});export{P as w};
