import{ky as O}from"./index-BeTPrQ6f.js";import{E as v,h as L}from"./Indices-CAn-HCVv-hWNN5onC.js";function D(i,n,r){const l=Array.isArray(i),e=l?i.length/n:i.byteLength/(4*n),A=l?i:new Uint32Array(i,0,e*n),g=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,k=a?a.length:0,u=(r==null?void 0:r.componentOffsets)||null;let b=0;if(u)for(let t=0;t<u.length-1;t++){const s=u[t+1]-u[t];s>b&&(b=s)}else b=e;const w=Math.floor(1.1*b)+1;(y==null||y.length<2*w)&&(y=new Uint32Array(O(2*w)));for(let t=0;t<2*w;t++)y[t]=0;let o=0;const U=!!u&&!!a,c=U?k:e;let h=v(e);const p=new Uint32Array(k),q=1.96;let $=g!==0?Math.ceil(4*q*q/(g*g)*g*(1-g)):c,d=1,C=u?u[1]:c;for(let t=0;t<c;t++){if(t===$){const f=1-o/t;if(f+q*Math.sqrt(f*(1-f)/t)<g)return null;$*=2}if(t===C){for(let f=0;f<2*w;f++)y[f]=0;if(a)for(let f=u[d-1];f<u[d];f++)p[f]=h[a[f]];C=u[++d]}const s=U?a[t]:t,I=s*n,x=V(A,I,n);let m=x%w,E=o;for(;y[2*m+1]!==0;){if(y[2*m]===x){const f=y[2*m+1]-1;if(z(A,I,f*n,n)){E=h[f];break}}m++,m>=w&&(m-=w)}E===o&&(y[2*m]=x,y[2*m+1]=s+1,o++),h[s]=E}if(g!==0&&1-o/e<g)return null;if(U){for(let t=u[d-1];t<p.length;t++)p[t]=h[a[t]];h=L(p)}const M=l?new Array(o):new Uint32Array(o*n);o=0;for(let t=0;t<c;t++)h[t]===o&&(R(A,(U?a[t]:t)*n,M,o*n,n),o++);if(a&&!U){const t=new Uint32Array(k);for(let s=0;s<t.length;s++)t[s]=h[a[s]];h=L(t)}return{buffer:Array.isArray(M)?M:M.buffer,indices:h,uniqueCount:o}}function z(i,n,r,l){for(let e=0;e<l;e++)if(i[n+e]!==i[r+e])return!1;return!0}function R(i,n,r,l,e){for(let A=0;A<e;A++)r[l+A]=i[n+A]}function V(i,n,r){let l=0;for(let e=0;e<r;e++)l=i[n+e]+l|0,l=l+(l<<11)+(l>>>2)|0;return l>>>0}let y=null;export{D as v};
