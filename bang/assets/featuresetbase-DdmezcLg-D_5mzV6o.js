import{aA as we,v as b,S,n as ae,w as Ne,F as Ee,B as $e,j as P,i as j,bq as ve,aT as Me,cd as Oe,X as Ie,aF as Ge,N as Ve,aL as ze,a6 as Je,ba as He}from"./index-DECxckyg.js";import{i as We}from"./TimeOnly-CGkId3bj-BKQTBx4m.js";import{t as qe,D as Be,l as le}from"./arcade-BoHTeCSG-TF6SPSlb.js";import{a as k,A as Qe,z as de,K as U,j as O,p as x,S as _e,i as De,y as Se,X as ke,q as R,T as X,$ as te,b as Q,G as Ke,N as Y,V as Xe,Z as ne}from"./aiServices-u5nRiq9H-DSM_0MlO.js";import{l as y,r as w,M as Ye,i as et}from"./enum-g1DWyQyu-CSsVCFk1.js";import{R as tt,q as xe,p as nt,c as ue,e as it,a as rt,b as ot,N as re,j as at,F as st,E as lt,L as B,B as dt,d as ie,f as $,k as ce}from"./featureSetUtils--lhp90Mu-tCnKrFEW.js";import{n as ut}from"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import{n as ct}from"./portalUtils-COohlq76-DLJqVT5p.js";import{D as mt,e as Ae}from"./SpatialFilter-B44tswGH-CdI_s2lG.js";import{k as Ce,I as me}from"./shared-DttuBH5Z-DjYRMPUJ.js";import{R as E}from"./WhereClause-D4rZJkVN-RJBFiIHu.js";import Ze from"./FeatureLayer-D09djTpa-DCq2oP7p.js";import{m as M}from"./Field-BIQ-quF4-CUYPWLA1.js";import{m as ft,f as pt,d as yt}from"./utils-BO8hgPs3-BAVIrS87.js";import{t as K}from"./NetworkElement-DPZIJwbn-BlVFM8XS.js";import"./UnknownTimeZone-DxjyzFvs-o2mRsJrx.js";import"./featureConversionUtils-Bjjlcfdo-AS4Z7egt.js";import"./OptimizedFeature-mIz_HhJg-DMWtIZsL.js";import"./memoryEstimations-DeWfxwaV-D_nnXLqB.js";import"./OptimizedGeometry-pzfNw1AT-DKm61ZAr.js";import"./OptimizedFeatureSet-Dz5hF8Qm-B1brSkRC.js";import"./FieldsIndex-Bt0Y8aWr-eqnhpcIX.js";import"./timeZoneUtils-d5p0Jda1-D-JoHJ-F.js";import"./unitConversion-BxD3RA9Y-YdJCnHrC.js";import"./number-mnL_JN3f-CgTKKye2.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";import"./commonProperties-D1Pjvz5u-DHiB1uzW.js";import"./fieldType-PhcL4ff8-DZQJCxjF.js";import"./MD5-CXHDUqXT-CMrYdOi6.js";import"./RelationshipQuery-CaEbQySU-CMOyCKI_.js";import"./Query-n1aoaaFC-DEpJ8fHn.js";import"./TimeExtent-Cf2Pienb-DASHDtdu.js";import"./FeatureType-DdIqcZ2U-C9Ic-Xra.js";import"./FeatureTemplate-CW5LOQ_p-DBttq_v0.js";import"./Layer-DvVVmz9x-D2JZ_h1N.js";import"./PortalItem-BP-IQXnZ-Cz8SNVQk.js";import"./operatorsWorkerConnection-TmW3NQ3Q-CLrnoY1_.js";import"./workers-CeRXsnNJ-CF20ggQ3.js";import"./Queue-DV3gpSdl-dEQtqDMO.js";import"./intl-BAA1onnp-XtXh_4yZ.js";import"./MultiOriginJSONSupport-BqiFJbbt-oD1SLSZE.js";import"./layerContainerType-ChWdCT09-G5sdAsSy.js";import"./FeatureLayerBase-B8QtBTYG-sfYVNA7d.js";import"./HeightModelInfo-C4voFc4k-Cd8C4843.js";import"./OperationalLayer-CbXUnTH0-B-e9Y9EV.js";import"./ElevationInfo-DE5to86a-zZvCtC1M.js";import"./lengthUtils-C61nRlXw-CNiQkeeF.js";import"./labelingInfo-DuLk-IW_-CXJ7h4iC.js";import"./asyncUtils-BPUlNCrX-DKWscr2H.js";import"./SimpleRenderer-C1YRhRzu-hP2m7Srw.js";import"./commonProperties-CJLeiNuA-CwRS21rI.js";import"./colorRamps-trM-CPFS-CNTQCHxd.js";import"./ColorStop-CL7v3R-A-BE7q0cn-.js";import"./visualVariableUtils-BTS148WR-BVzMIUWV.js";import"./UniqueValueRenderer-CLXHFtg9-C9008phd.js";import"./diffUtils-BxG8DCnW-D0iSO3bg.js";import"./RendererLegendOptions-Bil_IDab-BZOeLBB7.js";import"./styleUtils-DBPDLVBX-CWlE6cqP.js";import"./NormalizationBinParametersMixin-70JA0FRq-umFigoJ8.js";import"./labelUtils-Oapo6DRu-CUekBtcy.js";import"./LayerFloorInfo-CkeH-P4_-CqrcFpxf.js";import"./Relationship-B6fQjk3--B-OmJi5k.js";import"./serviceCapabilitiesUtils-BerH-9mt-5GolApbS.js";import"./infoFor3D-BeWnZejW-CnXQECJx.js";import"./portalItemUtils-BfWDJg-S-ChmaXTTv.js";import"./projectionUtils-B-CplN3q-dCP8PmW1.js";import"./editsZScale-BWHgeDdL-C_SRP5l_.js";import"./queryZScale-CwrUzBjP-KIJAQi4H.js";import"./FeatureSet-BVGGhhH9-Dg6_2mHN.js";import"./APIKeyMixin-BNzYY3QS-DaVJW2RY.js";import"./ArcGISService-B6M5rzsr-Cci-WEQc.js";import"./BlendLayer-DjW_5k0v-CiV_4sQK.js";import"./jsonUtils-BwLwuQj7-s-55UT6y.js";import"./parser-CWccHtwJ-CKACZqwA.js";import"./mat4f32-BdRMyjXW-CWt6U0BP.js";import"./mat4-OOmHNWi7-BlAajtXL.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./CustomParametersMixin-CSMgHDaw-DmXJR7tx.js";import"./DisplayFilteredLayer-DTxK0R7U-BslcFD60.js";import"./scaleUtils-Br-smv3A-C1uCNvs3.js";import"./displayFilterUtils-DvWUbJDp-DnG5xCgP.js";import"./EditBusLayer-CAIKbP5V-BTrf2sUx.js";import"./FeatureEffectLayer-BVJTjFhg-CSDvcAVo.js";import"./FeatureEffect-D3G_gJ5F-D3M0qb_8.js";import"./FeatureFilter-DXpQKGs4-CDk3dZoB.js";import"./FeatureReductionLayer-vR-evpIv-eCaSh2kd.js";import"./FeatureReductionSelection-DzXAxMK9-CWwCAH9F.js";import"./jsonUtils-CzRaZnmS-CAv8NFve.js";import"./typeUtils-CB2EGBWO-BbWVE5il.js";import"./ClassBreaksRenderer-Bq2XGpfI-CohUmiv2.js";import"./LRUCache-DPWdPNTF-BhV6gJVw.js";import"./MemCache-qDGoejB7-Bz_y0gIH.js";import"./DictionaryScriptEvaluator-DW5hOK9A-DH1EVQrK.js";import"./Version-CnwD6MZa-C2nxDhmR.js";import"./ArcadeExpression-XjY3x7KV-D7__geg6.js";import"./utils-BfXZnjCE-BG_fzuVE.js";import"./defaultCIMValues-BcSaJjm--58G-soMN.js";import"./enums-a_LDTPYU-CBIcy3mM.js";import"./heatmapUtils-DRTN9U3a-BlkjTs5Q.js";import"./vec42-D8CJyqHG-DnfLTeQH.js";import"./vec4f64-DD-nkcCV-CSNWKRqG.js";import"./OrderedLayer-BD-wnvgD-mkDKX1dU.js";import"./OrderByInfo-SNGyPlhJ-C5fbsysA.js";import"./PortalLayer-B34ZUA2x-BOcx3ySU.js";import"./RefreshableLayer-Qpvyi8qY-CByAKO5Y.js";import"./ScaleRangeLayer-x42fwED3-BPHyoz7r.js";import"./TemporalLayer-lQRje9wB-CK4S3Pdw.js";import"./TimeInfo-COHxjenm-C9icsCrk.js";import"./TrackableLayer-D0OccxDX-Dt_Tr-Le.js";import"./fieldProperties-Cgp0UdcB-NmUK1gEI.js";import"./TitleCreator-DZ9r9lVc-Dq1AHAAk.js";import"./versionUtils-BwTR8Ufq-CSDfG9hr.js";import"./styleUtils-BnJpZ0Gl-C-r-gZIS.js";import"./popupUtils-B99PyAFi-Dgkeo8yi.js";import"./interfaces-Cwm0pihk-Ptzy6gTd.js";var je;(function(t){t[t.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity",t[t.RTContainment=2]="RTContainment",t[t.RTAttachment=3]="RTAttachment",t[t.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity",t[t.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity"})(je||(je={})),new we({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation",path:"path",circuit:"circuit"});const J=new we({junctionJunctionConnectivity:"junction-junction-connectivity",connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionEdgeMidspanConnectivity:"junction-edge-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"});new we({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"});let _=class extends K{constructor(t){super(t),this.type="telecomNetworkElement",this.firstUnit=null,this.numUnits=null}};b([S({json:{write:!1}})],_.prototype,"type",void 0),b([S({json:{write:!0}})],_.prototype,"firstUnit",void 0),b([S({json:{write:!0}})],_.prototype,"numUnits",void 0),_=b([ae("esri.rest.networks.support.TelecomNetworkElement")],_);let C=class extends Ie{constructor(t){super(t),this.globalId=null,this.associationType=null,this.fromNetworkElement=null,this.toNetworkElement=null,this.geometry=null,this.errorMessage=null,this.percentAlong=null,this.errorCode=null,this.isContentVisible=null,this.status=null}readFromNetworkElement(t,s){return s.fromFirstUnit||s.fromNumUnits?new _({globalId:s.fromGlobalId,networkSourceId:s.fromNetworkSourceId,terminalId:s.fromTerminalId,firstUnit:s.fromFirstUnit,numUnits:s.fromNumUnits}):new K({globalId:s.fromGlobalId,networkSourceId:s.fromNetworkSourceId,terminalId:s.fromTerminalId})}writeFromNetworkElement(t,s){if(t&&(s.fromGlobalId=t.globalId,s.fromNetworkSourceId=t.networkSourceId,s.fromTerminalId=t.terminalId,t.type==="telecomNetworkElement")){const n=t;s.fromFirstUnit=n.firstUnit,s.fromNumUnits=n.numUnits}}readToNetworkElement(t,s){return s.toFirstUnit||s.toNumUnits?new _({globalId:s.toGlobalId,networkSourceId:s.toNetworkSourceId,terminalId:s.toTerminalId,firstUnit:s.toFirstUnit,numUnits:s.toNumUnits}):new K({globalId:s.toGlobalId,networkSourceId:s.toNetworkSourceId,terminalId:s.toTerminalId})}writeToNetworkElement(t,s){if(t&&(s.toGlobalId=t.globalId,s.toNetworkSourceId=t.networkSourceId,s.toTerminalId=t.terminalId,t.type==="telecomNetworkElement")){const n=t;s.toFirstUnit=n.firstUnit,s.toNumUnits=n.numUnits}}};b([S({type:String,json:{write:!0}})],C.prototype,"globalId",void 0),b([S({type:J.apiValues,json:{type:J.jsonValues,read:J.read,write:J.write}})],C.prototype,"associationType",void 0),b([S({type:K,json:{write:{target:{fromGlobalId:{type:String},fromNetworkSourceId:{type:Number},fromTerminalId:{type:Number},fromFirstUnit:{type:Number},fromNumUnits:{type:Number}}},read:{source:["fromGlobalId","fromNetworkSourceId","fromTerminalId","fromFirstUnit","fromNumUnits"]}}})],C.prototype,"fromNetworkElement",void 0),b([Ne("fromNetworkElement")],C.prototype,"readFromNetworkElement",null),b([Ee("fromNetworkElement")],C.prototype,"writeFromNetworkElement",null),b([S({type:K,json:{write:{target:{toGlobalId:{type:String},toNetworkSourceId:{type:Number},toTerminalId:{type:Number},toFirstUnit:{type:Number},toNumUnits:{type:Number}}},read:{source:["toGlobalId","toNetworkSourceId","toTerminalId","toFirstUnit","toNumUnits"]}}})],C.prototype,"toNetworkElement",void 0),b([Ne("toNetworkElement")],C.prototype,"readToNetworkElement",null),b([Ee("toNetworkElement")],C.prototype,"writeToNetworkElement",null),b([S({type:$e,json:{write:!0}})],C.prototype,"geometry",void 0),b([S({type:String,json:{write:!0}})],C.prototype,"errorMessage",void 0),b([S({type:Number,json:{write:!0}})],C.prototype,"percentAlong",void 0),b([S({type:Number,json:{write:!0}})],C.prototype,"errorCode",void 0),b([S({type:Boolean,json:{write:!0}})],C.prototype,"isContentVisible",void 0),b([S({type:Number,json:{write:!0}})],C.prototype,"status",void 0),C=b([ae("esri.rest.networks.support.Association")],C);let oe=class extends Ie{constructor(t){super(t),this.associations=[]}};b([S({type:[C],json:{write:!0}})],oe.prototype,"associations",void 0),oe=b([ae("esri.rest.networks.support.QueryAssociationsResult")],oe);function wt(t){const{returnDeletes:s,elements:n,gdbVersion:r,moment:I}=t.toJSON();return{returnDeletes:s,elements:JSON.stringify(n.map(g=>({globalId:g.globalId,networkSourceId:g.networkSourceId,terminalId:g.terminalId}))),types:JSON.stringify(t.types.map(g=>J.toJSON(g))).replaceAll('"connectivity"','"junctionJunctionConnectivity"'),gdbVersion:r,moment:I??Date.now()}}async function It(t,s,n){const r=ft(t),I={...wt(s),f:"json"},g=pt({...r.query,...I}),e=yt(g,{...n,method:"post"}),i=`${r.path}/associations/query`,{data:a}=await Ve(i,e),l=oe.fromJSON(a);return s.types.includes("connectivity")&&ze(Je.getLogger("esri/rest/networks/support/QueryAssociationsParameters"),"types",{replacement:"Please use 'junction-junction-connectivity' instead of 'connectivity'.",see:"https://arcg.is/11Tr8a#types",version:"4.29",warnOnce:!0}),l}var pe;let q=pe=class extends Ie{static from(t){return Ge(pe,t)}constructor(t){super(t),this.returnDeletes=!1,this.elements=[],this.types=[],this.gdbVersion=null,this.moment=null}};b([S({type:Boolean,json:{write:!0}})],q.prototype,"returnDeletes",void 0),b([S({type:[K],json:{write:!0}})],q.prototype,"elements",void 0),b([S({type:[J.apiValues],json:{type:J.jsonValues,read:J.read,write:J.write}})],q.prototype,"types",void 0),b([S({type:String,json:{write:!0}})],q.prototype,"gdbVersion",void 0),b([S({type:Date,json:{type:Number,write:{writer:(t,s)=>{s.moment=t==null?void 0:t.getTime()}}}})],q.prototype,"moment",void 0),q=pe=b([ae("esri.rest.networks.support.QueryAssociationsParameters")],q);function gt(t){if(t.length===1){if(j(t[0]))return le("distinct",t[0],-1);if(Q(t[0]))return le("distinct",t[0].toArray(),-1)}return le("distinct",t,-1)}function fe(t,s,n){const r=t.getVariables();if(r.length>0){const I={};for(const g of r)I[g]=s.evaluateIdentifier(n,{name:g});t.parameters=I}return t}function m(t,s,n=null){for(const r in t)if(r.toLowerCase()===s.toLowerCase())return t[r];return n}function Ue(t){if(t===null)return null;const s={type:m(t,"type",""),name:m(t,"name","")};if(s.type==="range")s.range=m(t,"range",[]);else{s.codedValues=[];for(const n of m(t,"codedValues",[]))s.codedValues.push({name:m(n,"name",""),code:m(n,"code",null)})}return s}function ye(t){if(t===null)return null;const s={},n=m(t,"wkt");n!==null&&(s.wkt=n);const r=m(t,"wkid");return r!==null&&(s.wkid=r),s}function Le(t){if(t===null)return null;const s={hasZ:m(t,"hasz",!1),hasM:m(t,"hasm",!1)},n=m(t,"spatialreference");n!=null&&(s.spatialReference=ye(n));const r=m(t,"x",null);if(r!==null)return s.x=r,s.y=m(t,"y",null),s.hasZ&&(s.z=m(t,"z",null)),s.hasM&&(s.m=m(t,"m",null)),s;const I=m(t,"rings",null);if(I!==null)return s.rings=I,s;const g=m(t,"paths",null);if(g!==null)return s.paths=g,s;const e=m(t,"points",null);if(e!==null)return s.points=e,s;for(const i of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const a=m(t,i,null);a!==null&&(s[i]=a)}return s}function ht(t,s){for(const n of s)if(n===t)return!0;return!1}function bt(t){return!!t.layerDefinition&&!!t.featureSet&&ht(t.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])!==!1&&j(t.layerDefinition.fields)!==!1&&j(t.featureSet.features)!==!1}function ee(t){return(t==null?void 0:t.toLowerCase())==="utc"?"UTC":(t==null?void 0:t.toLowerCase())==="unknown"?"Unknown":t}async function Ft(t,s,n,r,I,g,e){var u,f,v;const i=await t.getFeatureSetInfo();if(((i==null?void 0:i.layerId)??null)===null||!I.layerIdLookup.get(i.layerId))return null;const a=t.serviceUrl().replace(/\/FeatureServer/i,"/UtilityNetworkServer"),l=[];switch(n){case"connected":l.push("connectivity"),l.push("junction-edge-from-connectivity"),l.push("junction-edge-to-connectivity"),l.push("junction-edge-midspan-connectivity"),l.push("junction-junction-connectivity");break;case"container":case"content":l.push("containment");break;case"structure":case"attached":l.push("attachment");break;case"junctionedge":l.push("junction-edge-from-connectivity"),l.push("junction-edge-to-connectivity");break;case"midspan":l.push("junction-edge-midspan-connectivity");break;default:throw new y(g,w.InvalidParameter,e)}let p=null,c=!1;if(r!==null&&r!==""&&r!==void 0){for(const h of I.terminals)h.terminalName===r&&(p=h.terminalId);p===null&&(c=!0)}const d=[];if(!c){const h=new K({globalId:s.field(t.globalIdField),networkSourceId:I.layerIdLookup.get(i.layerId).sourceId,...p?{terminalId:p}:""}),N=await It(a,new q({types:l,elements:[h]}));let D=0;for(const A of N.associations){let G=null,V="",L="";if(((u=A.fromNetworkElement)==null?void 0:u.globalId)===h.globalId?(G=A.toNetworkElement,L="to"):((f=A.toNetworkElement)==null?void 0:f.globalId)===h.globalId&&(G=A.fromNetworkElement,L="from"),!G)continue;switch(n){case"attached":if(A.associationType!=="attachment"||L!=="to")continue;break;case"structure":if(A.associationType!=="attachment"||L!=="from")continue;break;case"container":if(A.associationType!=="containment"||L!=="from")continue;break;case"content":if(A.associationType!=="containment"||L!=="to")continue;break;case"connected":break;case"junctionedge":A.associationType==="junction-edge-to-connectivity"?V="to":A.associationType==="junction-edge-from-connectivity"&&(V="from");break;case"midspan":if(A.associationType!=="junction-edge-midspan-connectivity")continue}const z=((v=I.sourceIdLookup.get(G.networkSourceId))==null?void 0:v.className)??"";d.push(new He({geometry:null,attributes:{objectId:D++,globalId:G.globalId,percentAlong:A.percentAlong??0,isContentVisible:A.isContentVisible?0:1,className:z,side:V}}))}}const o=new Ze({source:d,geometryType:null,objectIdField:"objectId",globalIdField:"globalId",fields:[new M({name:"objectId",alias:"objectId",type:"oid"}),new M({name:"globalId",alias:"globalId",type:"global-id"}),new M({name:"percentAlong",alias:"percentAlong",type:"double"}),new M({name:"side",alias:"side",type:"string"}),new M({name:"isContentVisible",alias:"isContentVisible",type:"integer"}),new M({name:"className",alias:"className",type:"string"})]});return re(o)}function Ai(t){if(t.mode==="async"){t.functions.timezone=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{var l,p;if(k(e,1,2,n,r),Qe(e[0])||de(e[0]))return"Unknown";if(U(e[0])){if(await e[0].load(),e.length===1||e[1]===null)return e[0].datesInUnknownTimezone?ee("unknown"):ee(e[0].dateFieldsTimeZone);if(!(e[1]instanceof O)||e[1].hasField("type")===!1)throw new y(n,w.InvalidParameter,r);const c=e[1].field("type");if(P(c)===!1)throw new y(n,w.InvalidParameter,r);switch(x(c).toLowerCase()){case"preferredtimezone":return ee(e[0].preferredTimeZone);case"editfieldsinfo":return ee(((l=e[0].editFieldsInfo)==null?void 0:l.timeZone)??null);case"timeinfo":return ee(((p=e[0].timeInfo)==null?void 0:p.timeZone)??null);case"field":if(e[1].hasField("fieldname")&&P(e[1].field("fieldname")))return ee(e[0].fieldTimeZone(x(e[1].field("fieldname"))))}throw new y(n,w.InvalidParameter,r)}const i=_e(e[0],De(n));if(i===null)return null;const a=i.timeZone;return a==="system"?We.systemTimeZoneCanonicalName:a.toLowerCase()==="utc"?"UTC":a.toLowerCase()==="unknown"?"Unknown":a})},t.functions.sqltimestamp=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{k(e,1,3,n,r);const i=e[0];if(Se(i)){if(e.length===1)return i.toSQLWithKeyword();if(e.length===2)return i.changeTimeZone(x(e[1])).toSQLWithKeyword();throw new y(n,w.InvalidParameter,r)}if(de(i))return i.toSQLWithKeyword();if(U(i)){if(e.length!==3)throw new y(n,w.InvalidParameter,r);await i.load();const a=x(e[1]);if(de(e[2]))return e[2].toSQLWithKeyword();if(Se(e[2])===!1)throw new y(n,w.InvalidParameter,r);const l=i.fieldTimeZone(a);return l==null?e[2].toSQLWithKeyword():e[2].changeTimeZone(l).toSQLWithKeyword()}throw new y(n,w.InvalidParameter,r)})},t.signatures.push({name:"sqltimestamp",min:2,max:4}),t.functions.featuresetbyid=function(n,r){return t.standardFunctionAsync(n,r,(I,g,e)=>{if(k(e,2,4,n,r),ke(e[0])){const i=x(e[1]);let a=R(e[2],null);const l=X(R(e[3],!0));if(a===null&&(a=["*"]),j(a)===!1)throw new y(n,w.InvalidParameter,r);return e[0].featureSetById(i,l,a)}throw new y(n,w.InvalidParameter,r)})},t.signatures.push({name:"featuresetbyid",min:2,max:4});const s=new Ye(["datasource","parent","root"]);t.functions.getfeatureset=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{if(k(e,1,2,n,r),te(e[0])){const i=e[1]==null?"datasource":s.lookup(x(e[1]));return tt(e[0].fullSchema(),i,n.lrucache,n.interceptor,n.spatialReference)}throw new y(n,w.InvalidParameter,r)})},t.signatures.push({name:"getfeatureset",min:1,max:2}),t.functions.featuresetbyportalitem=function(n,r){return t.standardFunctionAsync(n,r,(I,g,e)=>{var c,d;if(k(e,2,5,n,r),e[0]===null)throw new y(n,w.PortalRequired,r);if(e[0]instanceof qe){const o=x(e[1]),u=x(e[2]);let f=R(e[3],null);const v=X(R(e[4],!0));if(f===null&&(f=["*"]),j(f)===!1)throw new y(n,w.InvalidParameter,r);let h;return h=(c=n.services)!=null&&c.portal?n.services.portal:ve.getDefault(),h=ct(e[0],h),xe(o,u,n.spatialReference,f,v,h,n.lrucache,n.interceptor)}if(P(e[0])===!1)throw new y(n,w.PortalRequired,r);const i=x(e[0]),a=x(e[1]);let l=R(e[2],null);const p=X(R(e[3],!0));if(l===null&&(l=["*"]),j(l)===!1)throw new y(n,w.InvalidParameter,r);return xe(i,a,n.spatialReference,l,p,((d=n.services)==null?void 0:d.portal)??ve.getDefault(),n.lrucache,n.interceptor)})},t.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),t.functions.featuresetbyname=function(n,r){return t.standardFunctionAsync(n,r,(I,g,e)=>{if(k(e,2,4,n,r),ke(e[0])){const i=x(e[1]);let a=R(e[2],null);const l=X(R(e[3],!0));if(a===null&&(a=["*"]),j(a)===!1)throw new y(n,w.InvalidParameter,r);return e[0].featureSetByName(i,l,a)}throw new y(n,w.InvalidParameter,r)})},t.signatures.push({name:"featuresetbyname",min:2,max:4}),t.functions.featureset=function(n,r){return t.standardFunction(n,r,(I,g,e)=>{k(e,1,1,n,r);const i={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",hasM:!1,hasZ:!1,fields:[]},featureSet:{geometryType:"",features:[]}};if(P(e[0])){const a=JSON.parse(e[0]);a.layerDefinition!==void 0?(i.layerDefinition=a.layerDefinition,i.featureSet=a.featureSet,a.layerDefinition.spatialReference&&(i.layerDefinition.spatialReference=a.layerDefinition.spatialReference)):(i.featureSet.features=a.features,i.featureSet.geometryType=a.geometryType,i.layerDefinition.geometryType=i.featureSet.geometryType,i.layerDefinition.objectIdField=a.objectIdFieldName??"",i.layerDefinition.typeIdField=a.typeIdFieldName,i.layerDefinition.globalIdField=a.globalIdFieldName,i.layerDefinition.fields=a.fields,a.spatialReference&&(i.layerDefinition.spatialReference=a.spatialReference))}else{if(!(e[0]instanceof O))throw new y(n,w.InvalidParameter,r);{const a=JSON.parse(e[0].castToText(!0)),l=m(a,"layerdefinition");if(l!==null){i.layerDefinition.geometryType=m(l,"geometrytype",""),i.featureSet.geometryType=i.layerDefinition.geometryType,i.layerDefinition.globalIdField=m(l,"globalidfield",""),i.layerDefinition.objectIdField=m(l,"objectidfield",""),i.layerDefinition.typeIdField=m(l,"typeidfield",""),i.layerDefinition.hasZ=m(l,"hasz",!1)===!0,i.layerDefinition.hasM=m(l,"hasm",!1)===!0;const p=m(l,"spatialreference");p&&(i.layerDefinition.spatialReference=ye(p));const c=[];for(const o of m(l,"fields",[])){const u={name:m(o,"name",""),alias:m(o,"alias",""),type:m(o,"type",""),nullable:m(o,"nullable",!0),editable:m(o,"editable",!0),length:m(o,"length",null),domain:Ue(m(o,"domain"))};c.push(u)}i.layerDefinition.fields=c;const d=m(a,"featureset");if(d){const o={};for(const u of c)o[u.name.toLowerCase()]=u.name;for(const u of m(d,"features",[])){const f={},v=m(u,"attributes",{});for(const h in v)f[o[h.toLowerCase()]]=v[h];i.featureSet.features.push({attributes:f,geometry:Le(m(u,"geometry"))})}}}else{i.layerDefinition.hasZ=m(a,"hasz",!1)===!0,i.layerDefinition.hasM=m(a,"hasm",!1)===!0,i.layerDefinition.geometryType=m(a,"geometrytype",""),i.featureSet.geometryType=i.layerDefinition.geometryType,i.layerDefinition.objectIdField=m(a,"objectidfieldname",""),i.layerDefinition.typeIdField=m(a,"typeidfieldname","");const p=m(a,"spatialreference");p&&(i.layerDefinition.spatialReference=ye(p));const c=[],d=m(a,"fields",null);if(!j(d))throw new y(n,w.InvalidParameter,r);for(const f of d){const v={name:m(f,"name",""),alias:m(f,"alias",""),type:m(f,"type",""),nullable:m(f,"nullable",!0),editable:m(f,"editable",!0),length:m(f,"length",null),domain:Ue(m(f,"domain"))};c.push(v)}i.layerDefinition.fields=c;const o={};for(const f of c)o[f.name.toLowerCase()]=f.name;let u=m(a,"features",null);if(j(u))for(const f of u){const v={},h=m(f,"attributes",{});for(const N in h)v[o[N.toLowerCase()]]=h[N];i.featureSet.features.push({attributes:v,geometry:Le(m(f,"geometry",null))})}else u=null,i.featureSet.features=u}}}if(bt(i)===!1)throw new y(n,w.InvalidParameter,r);return i.layerDefinition.geometryType||(i.layerDefinition.geometryType="esriGeometryNull"),nt.create(i,n.spatialReference)})},t.signatures.push({name:"featureset",min:1,max:1}),t.functions.filter=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{if(k(e,2,2,n,r),j(e[0])||Q(e[0])){const i=[];let a,l=e[0];if(l instanceof ut&&(l=l.toArray()),!Ke(e[1]))throw new y(n,w.InvalidParameter,r);a=e[1].createFunction(n);for(const p of l){const c=a(p);Me(c)?await c===!0&&i.push(p):c===!0&&i.push(p)}return i}if(U(e[0])){const i=await e[0].load(),a=E.create(e[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),l=a.getVariables();if(l.length>0){const p={};for(const c of l)p[c]=t.evaluateIdentifier(n,{name:c});a.parameters=p}return new ue({parentfeatureset:e[0],whereclause:a})}throw new y(n,w.InvalidParameter,r)})},t.signatures.push({name:"filter",min:2,max:2}),t.functions.orderby=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{if(k(e,2,2,n,r),U(e[0])){const i=new it(e[1]);return new rt({parentfeatureset:e[0],orderbyclause:i})}throw new y(n,w.InvalidParameter,r)})},t.signatures.push({name:"orderby",min:2,max:2}),t.functions.top=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{if(k(e,2,2,n,r),U(e[0]))return new ot({parentfeatureset:e[0],topnum:e[1]});if(j(e[0]))return Y(e[1])>=e[0].length?e[0].slice():e[0].slice(0,Y(e[1]));if(Q(e[0]))return Y(e[1])>=e[0].length()?e[0].slice():e[0].slice(0,Y(e[1]));throw new y(n,w.InvalidParameter,r)})},t.signatures.push({name:"top",min:2,max:2}),t.functions.first=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{if(k(e,1,1,n,r),U(e[0])){const i=await e[0].first(I.abortSignal);if(i!==null){const a=Be.createFromGraphicLikeObject(i.geometry,i.attributes,e[0],n.timeZone);return a._underlyingGraphic=i,a}return i}return j(e[0])?e[0].length===0?null:e[0][0]:Q(e[0])?e[0].length()===0?null:e[0].get(0):null})},t.signatures.push({name:"first",min:1,max:1}),t.functions.attachments=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{k(e,1,2,n,r);const i={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1){if(e[1]instanceof O){if(e[1].hasField("minsize")&&(i.minsize=Y(e[1].field("minsize"))),e[1].hasField("metadata")&&(i.returnMetadata=X(e[1].field("metadata"))),e[1].hasField("maxsize")&&(i.maxsize=Y(e[1].field("maxsize"))),e[1].hasField("types")){const a=Xe(e[1].field("types"),!1);a.length>0&&(i.types=a)}}else if(e[1]!==null)throw new y(n,w.InvalidParameter,r)}if(te(e[0])){const a=e[0]._layer;let l;if(U(a))l=a;else{if(a==null||!Ce(a))return[];l=re(a,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)}return await l.load(),l.queryAttachments(e[0].field(l.objectIdField),i.minsize,i.maxsize,i.types,i.returnMetadata)}if(e[0]===null)return[];throw new y(n,w.InvalidParameter,r)})},t.signatures.push({name:"attachments",min:1,max:2}),t.functions.featuresetbyrelationshipname=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{k(e,2,4,n,r);const i=e[0],a=x(e[1]);let l=R(e[2],null);const p=X(R(e[3],!0));if(l===null&&(l=["*"]),j(l)===!1)throw new y(n,w.InvalidParameter,r);if(e[0]===null)return null;if(!te(e[0]))throw new y(n,w.InvalidParameter,r);const c=i._layer;let d;if(U(c))d=c;else{if(c==null||!Ce(c))return null;d=re(c,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)}d=await d.load();const o=d.relationshipMetaData().filter(N=>N.name===a);if(o.length===0)return null;if(o[0].relationshipTableId!==void 0&&o[0].relationshipTableId!==null&&o[0].relationshipTableId>-1)return at(d,o[0],i.field(d.objectIdField),d.spatialReference,l,p,n.lrucache,n.interceptor);let u=d.serviceUrl();if(!u)return null;u=u.charAt(u.length-1)==="/"?u+o[0].relatedTableId.toString():u+"/"+o[0].relatedTableId.toString();const f=await st(u,d.spatialReference,l,p,n.lrucache,n.interceptor);await f.load();let v=f.relationshipMetaData();if(v=v.filter(N=>N.id===o[0].id),i.hasField(o[0].keyField)===!1||i.field(o[0].keyField)===null){const N=await d.getFeatureByObjectId(i.field(d.objectIdField),[o[0].keyField]);if(N){const D=E.create(v[0].keyField+"= @id",{fieldsIndex:f.getFieldsIndex(),timeZone:f.dateFieldsTimeZoneDefaultUTC});return D.parameters={id:N.attributes[o[0].keyField]},f.filter(D)}return new mt({parentfeatureset:f})}const h=E.create(v[0].keyField+"= @id",{fieldsIndex:f.getFieldsIndex(),timeZone:f.dateFieldsTimeZoneDefaultUTC});return h.parameters={id:i.field(o[0].keyField)},f.filter(h)})},t.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),t.functions.featuresetbyassociation=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{k(e,2,3,n,r);const i=e[0],a=et(x(R(e[1],""))),l=P(e[2])?x(e[2]):null;if(e[0]===null)return null;if(!te(e[0]))throw new y(n,w.InvalidParameter,r);let p=i._layer;if(p instanceof Ze&&(p=re(p,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),p===null||U(p)===!1)return null;await p.load();const c=p.serviceUrl(),d=await lt(c,n.spatialReference,!0);if(d.unVersion>=8)return await Ft(p,i,a,l,d,n,r);const o=d.associations;let u=null,f=null,v=!1;if(l!==null&&l!==""&&l!==void 0){for(const T of d.terminals)T.terminalName===l&&(f=T.terminalId);f===null&&(v=!0)}const h=o.getFieldsIndex(),N=h.get("TOGLOBALID").name,D=h.get("FROMGLOBALID").name,A=h.get("TOTERMINALID").name,G=h.get("FROMTERMINALID").name,V=h.get("FROMNETWORKSOURCEID").name,L=h.get("TONETWORKSOURCEID").name,z=h.get("ASSOCIATIONTYPE").name,Pe=h.get("ISCONTENTVISIBLE").name,Re=h.get("OBJECTID").name;for(const T of p.fields)if(T.type==="global-id"){u=i.field(T.name);break}let H=null,ge=new B(new M({name:"percentalong",alias:"percentalong",type:"double"}),E.create("0",{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC})),he=new B(new M({name:"side",alias:"side",type:"string"}),E.create("''",{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}));const Z="globalid",be="globalId",Fe={};for(const T in d.lkp)Fe[T]=d.lkp[T].sourceId;const W=new dt(new M({name:"classname",alias:"classname",type:"string"}),null,Fe);let F="";switch(a){case"midspan":{F=`((${N}='${u}') OR ( ${D}='${u}')) AND (${z} IN (5))`,W.codefield=E.create(`CASE WHEN (${N}='${u}') THEN ${V} ELSE ${L} END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC});const T=me($.findField(o.fields,D));T.name=Z,T.alias=Z,H=new B(T,E.create(`CASE WHEN (${D}='${u}') THEN ${N} ELSE ${D} END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC})),ge=d.unVersion>=4?new ce($.findField(o.fields,h.get("PERCENTALONG").name)):new B(new M({name:"percentalong",alias:"percentalong",type:"double"}),E.create("0",{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}));break}case"junctionedge":{F=`((${N}='${u}') OR ( ${D}='${u}')) AND (${z} IN (4,6))`,W.codefield=E.create(`CASE WHEN (${N}='${u}') THEN ${V} ELSE ${L} END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC});const T=me($.findField(o.fields,D));T.name=Z,T.alias=Z,H=new B(T,E.create(`CASE WHEN (${D}='${u}') THEN ${N} ELSE ${D} END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC})),he=new B(new M({name:"side",alias:"side",type:"string"}),E.create(`CASE WHEN (${z}=4) THEN 'from' ELSE 'to' END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}));break}case"connected":{let T=`${N}='@T'`,Te=`${D}='@T'`;f!==null&&(T+=` AND ${A}=@A`,Te+=` AND ${G}=@A`),F="(("+T+") OR ("+Te+"))",F=ne(F,"@T",u??""),T=ne(T,"@T",u??""),f!==null&&(T=ne(T,"@A",f.toString()),F=ne(F,"@A",f.toString())),W.codefield=E.create("CASE WHEN "+T+` THEN ${V} ELSE ${L} END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC});const se=me($.findField(o.fields,D));se.name=Z,se.alias=Z,H=new B(se,E.create("CASE WHEN "+T+` THEN ${D} ELSE ${N} END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}));break}case"container":F=`${N}='${u}' AND ${z} = 2`,f!==null&&(F+=` AND ${A} = `+f.toString()),W.codefield=V,F="( "+F+" )",H=new ie($.findField(o.fields,D),Z,Z);break;case"content":F=`(${D}='${u}' AND ${z} = 2)`,f!==null&&(F+=` AND ${G} = `+f.toString()),W.codefield=L,F="( "+F+" )",H=new ie($.findField(o.fields,N),Z,Z);break;case"structure":F=`(${N}='${u}' AND ${z} = 3)`,f!==null&&(F+=` AND ${A} = `+f.toString()),W.codefield=V,F="( "+F+" )",H=new ie($.findField(o.fields,D),Z,be);break;case"attached":F=`(${D}='${u}' AND ${z} = 3)`,f!==null&&(F+=` AND ${G} = `+f.toString()),W.codefield=L,F="( "+F+" )",H=new ie($.findField(o.fields,N),Z,be);break;default:throw new y(n,w.InvalidParameter,r)}return v&&(F="1 <> 1"),new $({parentfeatureset:o,adaptedFields:[new ce($.findField(o.fields,Re)),new ce($.findField(o.fields,Pe)),H,he,W,ge],extraFilter:F?E.create(F,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}):null})})},t.signatures.push({name:"featuresetbyassociation",min:2,max:6}),t.functions.groupby=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{if(k(e,3,3,n,r),!U(e[0]))throw new y(n,w.InvalidParameter,r);const i=await e[0].load(),a=[],l=[];let p=!1,c=[];if(P(e[1]))c.push(e[1]);else if(e[1]instanceof O)c.push(e[1]);else if(j(e[1]))c=e[1];else{if(!Q(e[1]))throw new y(n,w.InvalidParameter,r);c=e[1].toArray()}for(const d of c)if(P(d)){const o=E.create(x(d),{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),u=Ae(o)===!0?x(d):"%%%%FIELDNAME";a.push({name:u,expression:o}),u==="%%%%FIELDNAME"&&(p=!0)}else{if(!(d instanceof O))throw new y(n,w.InvalidParameter,r);{const o=d.hasField("name")?d.field("name"):"%%%%FIELDNAME",u=d.hasField("expression")?d.field("expression"):"";if(o==="%%%%FIELDNAME"&&(p=!0),!o)throw new y(n,w.InvalidParameter,r);a.push({name:o,expression:E.create(u||o,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC})})}}if(c=[],P(e[2]))c.push(e[2]);else if(j(e[2]))c=e[2];else if(Q(e[2]))c=e[2].toArray();else{if(!(e[2]instanceof O))throw new y(n,w.InvalidParameter,r);c.push(e[2])}for(const d of c){if(!(d instanceof O))throw new y(n,w.InvalidParameter,r);{const o=d.hasField("name")?d.field("name"):"",u=d.hasField("statistic")?d.field("statistic"):"",f=d.hasField("expression")?d.field("expression"):"";if(!(o&&u&&P(u)&&f))throw new y(n,w.InvalidParameter,r);l.push({name:o,statistic:u,expression:E.create(f,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC})})}}if(p){const d={};for(const u of i.fields)d[u.name.toLowerCase()]=1;for(const u of a)u.name!=="%%%%FIELDNAME"&&(d[u.name.toLowerCase()]=1);for(const u of l)u.name!=="%%%%FIELDNAME"&&(d[u.name.toLowerCase()]=1);let o=0;for(const u of a)if(u.name==="%%%%FIELDNAME"){for(;d["field_"+o.toString()]===1;)o++;d["field_"+o.toString()]=1,u.name="FIELD_"+o.toString()}}for(const d of a)fe(d.expression,t,n);for(const d of l)fe(d.expression,t,n);return e[0].groupby(a,l)})},t.signatures.push({name:"groupby",min:3,max:3}),t.functions.distinct=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{if(U(e[0])){k(e,2,2,n,r);const i=await e[0].load(),a=[];let l=[];if(P(e[1]))l.push(e[1]);else if(e[1]instanceof O)l.push(e[1]);else if(j(e[1]))l=e[1];else{if(!Q(e[1]))throw new y(n,w.InvalidParameter,r);l=e[1].toArray()}let p=!1;for(const c of l)if(P(c)){const d=E.create(x(c),{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),o=Ae(d)===!0?x(c):"%%%%FIELDNAME";a.push({name:o,expression:d}),o==="%%%%FIELDNAME"&&(p=!0)}else{if(!(c instanceof O))throw new y(n,w.InvalidParameter,r);{const d=c.hasField("name")?c.field("name"):"%%%%FIELDNAME",o=c.hasField("expression")?c.field("expression"):"";if(d==="%%%%FIELDNAME"&&(p=!0),!d)throw new y(n,w.InvalidParameter,r);a.push({name:d,expression:E.create(o||d,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC})})}}if(p){const c={};for(const o of i.fields)c[o.name.toLowerCase()]=1;for(const o of a)o.name!=="%%%%FIELDNAME"&&(c[o.name.toLowerCase()]=1);let d=0;for(const o of a)if(o.name==="%%%%FIELDNAME"){for(;c["field_"+d.toString()]===1;)d++;c["field_"+d.toString()]=1,o.name="FIELD_"+d.toString()}}for(const c of a)fe(c.expression,t,n);return e[0].groupby(a,[])}return gt(e)})},t.functions.getfeaturesetinfo=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{if(k(e,1,1,n,r),!U(e[0]))return null;const i=await e[0].getFeatureSetInfo();return i?O.convertObjectToArcadeDictionary({layerId:i.layerId,layerName:i.layerName,itemId:i.itemId,serviceLayerUrl:i.serviceLayerUrl,webMapLayerId:i.webMapLayerId??null,webMapLayerTitle:i.webMapLayerTitle??null,className:null,objectClassId:null},De(n),!1,!1):null})},t.signatures.push({name:"getfeaturesetinfo",min:1,max:1}),t.functions.filterbysubtypecode=function(n,r){return t.standardFunctionAsync(n,r,async(I,g,e)=>{if(k(e,2,2,n,r),U(e[0])){const i=await e[0].load(),a=e[1];if(!Oe(a))throw new y(n,w.InvalidParameter,r);if(i.subtypeField){const p=E.create(`${i.subtypeField}= ${e[1]}`,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC});return new ue({parentfeatureset:e[0],whereclause:p})}if(i.typeIdField===null||i.typeIdField==="")throw new y(n,w.FeatureSetDoesNotHaveSubtypes,r);const l=E.create(`${i.typeIdField}= ${e[1]}`,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC});return new ue({parentfeatureset:e[0],whereclause:l})}throw new y(n,w.InvalidParameter,r)})},t.signatures.push({name:"filterbysubtypecode",min:2,max:2})}}export{Ai as registerFunctions};
