import{hf as ue,gS as G,gZ as W,hk as K,hw as ee,gX as _,gY as z,g$ as te,hn as Z,h1 as le,hl as Le,hb as V,h7 as t,hg as ce,hm as k,hc as O,h6 as u,hd as R,hr as $,hj as j,iA as se,jo as re,g_ as ne,h4 as P,h5 as N,h9 as X,ha as ae,j9 as me,h8 as ie,gT as J,iz as ye,he as ve,jr as fe,hB as je,jp as Me}from"./index-BeTPrQ6f.js";import{Z as ze}from"./toggle-switch-control-_RgRlIZ6-Dy8XcqVZ.js";const Ce={key:0,class:"relative"},Ee={key:0,class:"relative"},He=["innerHTML"],Ie=["src"],$e={key:1,class:"w-32 h-32"},qe={class:"symbologyIcon"},Oe=["innerHTML"],Ae=["src"],De={class:"badge z-50 rounded-full text-white absolute h-10 w-10 p-8 inline-flex items-center justify-center"},Be={key:0,class:"px-5"},Ne={key:1,class:"inline-flex justify-center items-center relative"},Pe=G({__name:"symbology-stack",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0}},setup(c){const x=c,n=_([]);return ne(()=>{n.value=x.layer.legend}),(d,p)=>c.result.loaded?(t(),u("div",Ce,[k("div",{class:R(c.result.items.length===0?"opacity-50":"")},[n.value.length>1?(t(),u("div",Ee,[(t(!0),u(X,null,ae(n.value.slice(0,3).reverse(),(w,h)=>(t(),u("div",{class:R(["absolute",[h==0?"symbol-0":h==1?"left-3":"left-6"]]),style:ye({"z-index":3-h}),key:h},[n.value[h].svgcode?(t(),u("span",{key:0,class:"symbologyIcon w-28 h-28",innerHTML:n.value[h].svgcode},null,8,He)):n.value[h].imgUrl?(t(),u("img",{key:1,class:"symbologyIcon w-28 h-28",src:n.value[h].imgUrl},null,8,Ie)):O("",!0)],6))),128))])):n.value.length>0?(t(),u("div",$e,[k("div",qe,[n.value[0].svgcode?(t(),u("span",{key:0,innerHTML:n.value[0].svgcode},null,8,Oe)):n.value[0].imgUrl?(t(),u("img",{key:1,class:"symbologyIcon w-full h-full",src:n.value[0].imgUrl},null,8,Ae)):O("",!0)])])):O("",!0)],2),k("div",De,[c.result.loaded?(t(),u("div",Be,$(c.result.items.length),1)):O("",!0)])])):(t(),u("div",Ne,p[0]||(p[0]=[k("div",{class:"symbologyIcon h-32 w-32"},[k("div",{class:"relative animate-spin spinner h-24 w-24"})],-1)])))}}),Se=ue(Pe,[["__scopeId","data-v-496d788d"]]),Fe=["content"],Ge={class:"symbologyLayerName truncate"},Ue=G({__name:"symbology-item",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0},selected:{type:Boolean,required:!0}},setup(c){const x=ee(),n=z(()=>x.properties),d=c,p=()=>{const w=d.layer;return w&&n.value[w.id]&&n.value[w.id].name?n.value[w.id].name:(w==null?void 0:w.name)??""};return(w,h)=>{const T=P("tippy");return N((t(),u("button",{class:R(["flex flex-grow justify-start items-center px-7 py-10 default-focus-style symbologyStackButton truncate",c.selected?"detailsButtonSelected":"px-11"]),onClick:h[0]||(h[0]=me(()=>{},["stop"])),content:p()},[ie(Se,{class:"symbStack w-32 h-32 mr-10",layer:c.layer,result:c.result},null,8,["layer","result"]),k("div",Ge,$(p()),1)],10,Fe)),[[T,{placement:"right",sticky:!0}]])}}}),Ze=["content"],Re=G({__name:"symbology-list",props:{results:{type:Object,required:!0},selected:{type:String,required:!0}},emits:["selection-changed"],setup(c,{emit:x}){const{t:n}=W(),d=re(),p=_(),w=()=>{p.value._tippy.hide()},h=v=>{var H;v.key==="Tab"&&((H=p.value)!=null&&H.matches(":focus"))&&p.value._tippy.show()},T=x,y=c,s=_(""),f=_([]),o=_(!1),e=_(!1),i=v=>d.getLayerByUid(v),L=v=>{s.value=v,T("selection-changed",v),o.value=!1},q=()=>{e.value||setTimeout(()=>{o.value=e.value},500),e.value=!0},I=()=>{o.value=e.value=!1},m=()=>{e.value||(o.value=!0),e.value=!0},C=()=>{o.value=e.value=!1};return te(()=>{f.value.push(Z(y,()=>{s.value=y.selected}))}),ne(()=>{var v,H;(v=p.value)==null||v.addEventListener("blur",w),(H=p.value)==null||H.addEventListener("keyup",h)}),le(()=>{var v,H;f.value.forEach(A=>A()),(v=p.value)==null||v.removeEventListener("blur",w),(H=p.value)==null||H.removeEventListener("keyup",h)}),(v,H)=>{const A=P("focus-item"),F=P("focus-list"),M=P("tippy");return N((t(),u("div",{class:R(["symbology-list absolute overflow-hidden z-50 p-0 w-48 bg-white text-sm inline-flex flex-col",{"symbology-list-expanded":o.value}]),onMouseover:q,onMouseleave:I,onFocus:m,onBlur:me(C,["self"]),content:j(n)("details.layers.results.list.tooltip"),ref_key:"el",ref:p},[(t(!0),u(X,null,ae(y.results,(D,a)=>(t(),u("div",{class:"flex justify-start relative",key:a},[N((t(),V(Ue,{key:D.uid,layer:i(D.uid),result:D,selected:D.uid===s.value,onClick:r=>L(D.uid)},null,8,["layer","result","selected","onClick"])),[[A]])]))),128))],42,Ze)),[[F],[M,{trigger:"manual",placement:"top-start",touch:!1}]])}}}),Qe={class:"inline font-bold"},Ve=["innerHTML"],We=G({__name:"esri-default",props:{fixtureFields:{type:Object,required:!1},fields:{type:Object,required:!0},identifyData:{type:Object,required:!0}},setup(c){const{t:x}=W(),n=K("iApi"),d=c,p=(s,f,o,e)=>{const i=s.find(L=>L[f].toLowerCase()===o.toLowerCase());i&&delete e[i.name]},w=()=>{const s=Object.assign({},d.identifyData.data);p(d.fields,"type","geometry",s),n.ui.exposeOids||p(d.fields,"type","oid",s),n.ui.exposeMeasurements||(p(d.fields,"name","shape_length",s),p(d.fields,"name","shape_area",s));const f={};d.fields.forEach(e=>{var L;const i=(L=d.fixtureFields)==null?void 0:L.find(q=>e.name===q.field);f[e.name]={name:(i==null?void 0:i.alias)||e.alias||e.name,type:e.type,visible:(i==null?void 0:i.visible)??!0}});const o={};Object.keys(s).forEach(e=>{const i=f[e];if(i&&i.visible){const L=s[e];o[e]={value:typeof L=="number"?n.ui.formatNumber(L):L,alias:i.name,type:i.type}}});for(const[e]of Object.entries(o))n.ui.isPlainText(o[e].value)&&(o[e].value=n.ui.escapeHtml(o[e].value));return o},h=(s,f,o)=>{switch(o){case"date":return y(s);default:return T(s,f)}},T=(s,f)=>{var i;if(!s)return s;if(s.trim().match(/\.(jpeg|jpg|gif|png)$/)||s.trim().match(/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i))return`<img src="${s}" alt="${x("details.item.alert.defaultAltText",{alias:f})}" />`;const o="underline text-blue-700 break-all",e=document.createElement("div");return e.innerHTML=s.trim(),((i=e.firstElementChild)==null?void 0:i.tagName)=="A"?(e.firstElementChild.className=o,e.innerHTML):fe(s,{className:o,target:"_blank",validate:{url:L=>/^https?:\/\//.test(L)}})},y=s=>{const f=parseInt(s);return isNaN(f)?s:new Date(f).toISOString().split("T")[0]};return(s,f)=>(t(),u("div",null,[(t(!0),u(X,null,ae(w(),(o,e,i)=>(t(),u("div",{class:"p-5 pl-3 flex justify-end flex-wrap even:bg-gray-300",key:i},[k("span",Qe,$(o.alias),1),f[0]||(f[0]=k("span",{class:"flex-auto"},null,-1)),k("span",{class:"inline",innerHTML:h(o.value,o.alias,o.type)},null,8,Ve)]))),128))]))}}),Xe=["innerHTML"],Ye={key:1},Je=G({__name:"html-default",props:{identifyData:{type:Object,required:!0}},setup(c){const{t:x}=W();return(n,d)=>c.identifyData?(t(),u("div",{key:0,class:"whitespace-pre-wrap break-words h-full overflow-auto",innerHTML:c.identifyData.data.data??c.identifyData.data},null,8,Xe)):(t(),u("div",Ye,$(j(x)("details.layers.results.empty")),1))}}),Ke={class:"relative flex flex-grow truncate"},et={key:0,class:"flex flex-grow items-center truncate"},tt={class:"flex p-8 items-center"},lt=["innerHTML"],at={key:1,class:"symbologyIcon p-6"},st=["content","innerHTML","tabindex"],it={key:1,class:"flex p-6 flex-grow"},ut={key:2,class:"zoomButton text-center p-3"},rt=["content","aria-label"],nt={key:0,class:"m-auto animate-spin spinner h-20 w-20"},ot={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"green",class:"m-auto w-20 h-20"},dt={key:2,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"red",class:"m-auto w-20 h-20"},ct=["innerHTML"],pe=G({__name:"result-item",props:{uid:{type:String,required:!0},data:{type:Object,required:!0},open:{type:Boolean,required:!1},inList:{type:Boolean,required:!1}},setup(c){const x=re(),n=c,d=K("iApi"),p=_([]),w=ee(),{t:h}=W(),T=_(!1),y=_(""),s=_("none"),f=_(),o=()=>x.getLayerByUid(n.uid),e=z(()=>w.properties),i=z(()=>w.defaultTemplates),L=z(()=>{var a;return((a=o())==null?void 0:a.supportsFeatures)??!1}),q=z(()=>{var a;return((a=o())==null?void 0:a.mapLayer)??!1}),I=z(()=>{const a=o();let r=a&&n.data.loaded?a.nameValue(n.data.data):d.$i18n.t("details.items.title");return d.ui.isPlainText(r)&&(r=d.ui.escapeHtml(r)),r}),m=a=>{var r;if(typeof a=="string"){const g="underline text-blue-700 break-all",E=document.createElement("div");return E.innerHTML=a.trim(),((r=E.firstElementChild)==null?void 0:r.tagName)=="A"?(E.firstElementChild.className=g,E.innerHTML):fe(a,{className:g,target:"_blank",validate:{url:B=>/^https?:\/\//.test(B)}})}return a},C=()=>{M("none"),n.data.loaded?v():n.data.load().then(()=>{v()})},v=()=>{if(y.value="",!(n.data&&n.data.loaded))return;const a=o();if(a===void 0){console.warn(`could not find layer for uid ${n.uid} during icon lookup`);return}if(a.supportsFeatures){const r=a.oidField;a.getIcon(n.data.data[r]).then(g=>{y.value=g})}},H=z(()=>{const a=o(),r=a&&e.value[a.id]&&e.value[a.id].template;if(r){if(typeof ve(r)!="string")return r;console.error(`Could not find custom details template named ${r}. Was it registered correctly?`)}return i.value&&i.value[n.data.format]?i.value[n.data.format]:L.value?We:Je}),A=z(()=>{var a;return L.value?((a=o())==null?void 0:a.fields)||[]:[]}),F=z(()=>{const a=o();if(a&&e.value[a.id]&&e.value[a.id].fields)return e.value[a.id].fields}),M=a=>{a==="zoomed"||a==="error"?setTimeout(()=>{var r;s.value=a,(r=f.value)==null||r._tippy.show(),setTimeout(()=>{var g;(g=f.value)==null||g._tippy.hide(),s.value="none"},3e3)},300):s.value=a},D=()=>{if(s.value!=="none")return;M("zooming");const a=o();if(a===void 0||!a.isLoaded){console.warn(`Could not find layer for uid ${n.uid} during zoom geometry lookup`),M("error");return}if(!n.data.loaded){console.warn("Details zoomToFeature call on item that is still loading. Should be impossible, alert the devs."),M("error");return}const r=n.data.data[a.oidField],g=()=>{const E={getGeom:!0};a.getGraphic(r,E).then(B=>{B.geometry.invalid()?(console.error(`Could not find graphic for objectid ${r}`),M("error")):(d.geo.map.zoomMapTo(B.geometry),M("zoomed"),d.updateAlert(d.$i18n.t("details.item.alert.zoom")))}).catch(()=>{M("error")})};a.layerType===je.FEATURE&&a.geomType!==Me.POINT?a.getGraphicExtent(r).then(E=>{d.geo.map.zoomMapTo(E),M("zoomed"),d.updateAlert(d.$i18n.t("details.item.alert.zoom"))}).catch(()=>{g()}):g()};return te(()=>{p.value.push(Z(n,()=>{C()},{deep:!1,immediate:!0}))}),le(()=>{p.value.forEach(a=>a())}),(a,r)=>{const g=P("truncate"),E=P("tippy");return t(),u(X,null,[k("div",Ke,[L.value?(t(),u("div",et,[k("div",tt,[c.data.loaded&&y.value?(t(),u("span",{key:0,class:"flex-none symbologyIcon",innerHTML:y.value},null,8,lt)):(t(),u("div",at,r[3]||(r[3]=[k("div",{class:"animate-spin spinner h-20 w-20"},null,-1)])))]),c.data.loaded?N((t(),u("span",{key:0,class:"pl-3 text-left flex-grow itemName",content:I.value,innerHTML:m(I.value),onTouchstart:r[0]||(r[0]=B=>T.value=!0),onTouchend:r[1]||(r[1]=B=>T.value=!1),tabindex:c.inList?-1:0},null,40,st)),[[g,{options:{placement:"top-start",offset:()=>T.value?[0,25]:[0,0]}}]]):(t(),u("div",it,$(j(h)("details.loading")),1)),c.data.loaded?(t(),u("span",ut,[q.value?N((t(),u("button",{key:0,type:"button",content:j(h)(`details.item.zoom${s.value==="none"?"":`.${s.value}`}`),"aria-label":j(h)(`grid.cells.zoom${s.value==="none"?"":`.${s.value}`}`),ref_key:"zoomButton",ref:f,onClick:r[2]||(r[2]=B=>{B.stopPropagation(),D()}),class:"text-gray-600 w-24 h-24 p-2 flex justify-center items-center"},[s.value==="zooming"?(t(),u("div",nt)):s.value==="zoomed"?(t(),u("svg",ot,r[4]||(r[4]=[k("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1)]))):s.value==="error"?(t(),u("svg",dt,r[5]||(r[5]=[k("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1)]))):(t(),u("span",{key:3,innerHTML:j(d).ui.getZoomIcon()},null,8,ct))],8,rt)),[[E,{placement:"bottom"}]]):O("",!0)])):O("",!0)])):O("",!0)]),c.open?(t(),V(ve(H.value),{key:0,identifyData:c.data,fields:A.value,fixtureFields:F.value,class:"p-8"},null,8,["identifyData","fields","fixtureFields"])):O("",!0)],64)}}}),vt={key:0,class:"layerName w-full flex-grow p-5 pb-8 font-bold truncate",tabIndex:"0"},pt={key:1,class:"p-8 mb-8 bg-gray-100 flex justify-between"},mt={for:"toggle"},yt={key:2,class:"flex flex-col justify-between p-8 mb-8 bg-gray-100"},ft={class:"flex"},gt=["aria-label"],ht=["content","aria-label","disabled"],bt={class:"px-3 text-center flex-grow"},kt=["content","aria-label","disabled"],xt={key:3},wt={key:0},Tt=["content"],_t=["onClick"],Lt={key:1,class:"text-center"},jt={key:4,class:"p-5"},Mt=G({__name:"result-list",props:{uid:{type:String,required:!0},results:{type:Object,required:!0}},setup(c){const x=_(),n=()=>{x.value._tippy.hide()},d=l=>{var b;l.key==="Tab"&&((b=x.value)!=null&&b.matches(":focus"))&&x.value._tippy.show()},p=K("iApi"),w=ee(),h=re(),T=c,{t:y}=W(),s=_(!1),f=_(p.fixture.get("details")),o=_(!0),e=_(!1),i=_(0),L=_(20),q=_([]),I=_([]),m=z(()=>w.activeGreedy),C=z(()=>w.properties),v=z(()=>i.value+L.value),H=()=>h.getLayerByUid(T.uid),A=()=>T.results.find(l=>l.uid===T.uid),F=z(()=>{var l;return((l=A())==null?void 0:l.loaded)??!1}),M=z(()=>{var l;return(l=A())==null?void 0:l.requestTime}),D=z(()=>s.value&&(!e.value&&g().length>1||e.value&&g().length>L.value)),a=z(()=>{const l=H();return l&&C.value[l.id]&&C.value[l.id].name?C.value[l.id].name:(l==null?void 0:l.name)??""}),r=z(()=>T.uid),g=()=>{const l=A();return l?l.items:[]},E=z(()=>g()[i.value]),B=z(()=>{if(f.value.hasHilighter()){const l=H();if(l)return l.mapLayer&&l.supportsFeatures}return!1}),ge=l=>{o.value=l,w.hilightToggle=l,U()},he=()=>{const l=H();i.value=i.value??0,o.value=w.hilightToggle??o.value,e.value=!1,s.value=!!l,U()},oe=l=>{e.value?(i.value+=l*L.value,U()):i.value+=l},U=()=>{const l=g();if(o.value&&F.value&&l.length>0&&B.value)if(e.value)f.value.hilightDetailsItems(l.slice(i.value,v.value),T.uid);else{const b=l[i.value];b&&f.value.hilightDetailsItems([b],T.uid)}else f.value.removeDetailsHilight()},be=()=>{e.value=!0,i.value=Math.floor(i.value/L.value)*L.value,U()},ke=()=>{f.value.removeDetailsHilight(),I.value.forEach(l=>l()),q.value.forEach(l=>p.event.off(l))},xe=()=>{f.value.removeDetailsHilight()},we=l=>{const b=i.value;i.value=l,e.value=!1,b===l&&U()};return ne(()=>{var l,b;q.value.push(p.event.on(J.LAYER_REMOVE,S=>{const Q=p.panel.get("details");T.uid===S.uid&&Q&&Q.close()})),q.value.push(p.event.on(J.PANEL_CLOSED,S=>{S.id==="details"&&ke()})),q.value.push(p.event.on(J.PANEL_MINIMIZED,S=>{S.id==="details"&&xe()})),q.value.push(p.event.on(J.MAP_BASEMAPCHANGE,S=>{o.value&&S.schemaChanged&&U()})),(l=x.value)==null||l.addEventListener("blur",n),(b=x.value)==null||b.addEventListener("keyup",d)}),te(()=>{I.value.push(Z(E,()=>{e.value||(he(),E.value===void 0&&f.value.removeDetailsHilight())},{deep:!1,immediate:!0})),I.value.push(Z(r,()=>{const l=T.uid;if(e.value&&l){const b=A();b&&b.loading.then(()=>{T.uid===l&&e.value&&U()})}},{deep:!1,immediate:!0})),I.value.push(Z(M,()=>{i.value=0})),I.value.push(Z(()=>T.uid,()=>{i.value=0}))}),le(()=>{var l,b;(l=x.value)==null||l.removeEventListener("blur",n),(b=x.value)==null||b.removeEventListener("keyup",d)}),(l,b)=>{const S=P("truncate"),Q=P("tippy"),Te=P("focus-item"),_e=P("focus-list");return F.value&&m.value===0?(t(),u("div",{key:0,class:"detailsContent relative flex flex-col flex-grow pl-5",style:ye(c.results.length>1?{"margin-left":"42px"}:"")},[s.value?N((t(),u("h1",vt,[se($(a.value),1)])),[[S,{options:{placement:"top-start"}}]]):O("",!0),B.value?(t(),u("div",pt,[k("label",mt,$(j(y)("details.togglehilight.title")),1),ie(ze,{config:{value:o.value,disabled:!1},onToggled:ge},null,8,["config"])])):O("",!0),D.value?(t(),u("div",yt,[k("div",ft,[e.value?O("",!0):(t(),u("button",{key:0,type:"button",class:"px-8 font-bold hover:bg-gray-200 focus:bg-gray-200","aria-label":j(y)("details.item.see.list"),onClick:b[0]||(b[0]=Y=>be())},$(j(y)("details.item.see.list")),9,gt)),k("div",{class:R(["flex ml-auto bg-gray-200 py-8 items-center",{"w-full":e.value}])},[N((t(),u("button",{type:"button",content:j(y)(e.value?"details.items.previous":"details.item.previous.item"),onClick:b[1]||(b[1]=Y=>oe(-1)),class:"mx-2 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":j(y)(e.value?"details.items.previous":"details.item.previous.item"),disabled:i.value===0},b[3]||(b[3]=[k("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[k("g",null,[k("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,ht)),[[Q,{placement:"top"}]]),k("span",bt,$(e.value?j(y)("details.items.range",[i.value+1,Math.min(v.value,g().length),g().length]):j(y)("details.item.count",[i.value+1,g().length])),1),N((t(),u("button",{type:"button",content:j(y)(e.value?"details.items.next":"details.item.next.item"),onClick:b[2]||(b[2]=Y=>oe(1)),class:"mx-2 rotate-180 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":j(y)(e.value?"details.items.next":"details.item.next.item"),disabled:!e.value&&i.value===g().length-1||e.value&&v.value>=g().length},b[4]||(b[4]=[k("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[k("g",null,[k("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,kt)),[[Q,{placement:"top"}]])],2)])])):O("",!0),s.value?(t(),u("div",xt,[g().length>0?(t(),u("div",wt,[e.value?N((t(),u("div",{key:0,class:"flex flex-col",content:j(y)("details.layers.results.list.tooltip"),ref_key:"el",ref:x},[(t(!0),u(X,null,ae(g().slice(i.value,v.value),(Y,de)=>N((t(),u("button",{class:"flex flex-grow truncate default-focus-style hover:bg-gray-200",key:de,onClick:It=>we(i.value+de)},[ie(pe,{data:Y,uid:c.uid,open:!1,"in-list":!0},null,8,["data","uid"])],8,_t)),[[Te,"show-truncate"]])),128))],8,Tt)),[[_e],[Q,{trigger:"manual",placement:"top-start",touch:!1}]]):(t(),V(pe,{key:1,data:E.value,uid:c.uid,open:!0,"in-list":!1},null,8,["data","uid"]))])):(t(),u("div",Lt,$(j(y)("details.layers.results.empty.currentLayer")),1))])):(t(),u("div",jt,$(j(y)("details.item.no.data")),1))],4)):(t(),u("div",{key:1,class:R(["flex justify-center py-10 items-center",c.results.length>1?"ml-42":""])},[b[5]||(b[5]=k("span",{class:"animate-spin spinner h-20 w-20 px-5 mr-8"},null,-1)),se(" "+$(j(y)("details.item.loading")),1)],2))}}}),zt=ue(Mt,[["__scopeId","data-v-b02a05d4"]]),Ct={class:"relative h-full"},Et={class:"detailsContentSection overflow-y-auto h-full"},Ht=G({__name:"details-screen",props:{panel:{type:Object}},setup(c){const{t:x}=W(),n=K("iApi"),d=ee(),p=_([]),w=_([]),h=_([]),T=_(!1),y=_(""),s=z(()=>d.activeGreedy),f=z(()=>d.payload),o=z(()=>d.properties),e=m=>{y.value=m},i=m=>h.value.find(C=>C.uid===m),L=m=>{m!==void 0&&(d.activeGreedy=m.length===0?0:m[0].requestTime,h.value=m,q(m))},q=m=>{if(y.value){const C=i(y.value);C?C.loading.then(()=>{C.requestTime===s.value&&(C.items.length>0?(d.activeGreedy=0,T.value=!1):I(m))}):I(m)}else I(m)},I=(m,C)=>{let v;if(C)v=C;else{const M=d.properties,D=m.map(r=>{var g;return[((g=M[r.layerId])==null?void 0:g.priority)??50,r.layerId]}),a=new Set(D.map(r=>r[0]));v=[],a.forEach(r=>{const g=D.filter(E=>E[0]===r).map(E=>E[1]);v.push([r,g])}),v.sort((r,g)=>g[0]-r[0])}if(v.length===0){d.activeGreedy=0,T.value=!0;return}const H=v[v.length-1][1],A=m.filter(M=>H.includes(M.layerId)).map(M=>M.loading.then(()=>M.items.length>0?Promise.resolve(M):Promise.reject())),F=m.length===0?0:m[0].requestTime;Promise.any(A).then(M=>{M.requestTime===s.value&&(d.activeGreedy=0,y.value=M.uid,T.value=!1)}).catch(()=>{F===s.value&&(v.pop(),I(m,v))})};return te(()=>{w.value.push(Z(f,m=>{L(m)},{deep:!1,immediate:!0}))}),le(()=>{p.value.forEach(m=>n.event.off(m)),w.value.forEach(m=>m())}),(m,C)=>{const v=Le("panel-screen");return t(),V(v,{panel:c.panel},{header:ce(()=>[se($(j(d).origin==="toggleEvent"?j(x)("details.layers.title.gridOrigin"):j(x)("details.layers.title.identifyOrigin")),1)]),content:ce(()=>[k("div",Ct,[h.value.length>1?(t(),V(Re,{key:0,results:h.value,detailsProperties:o.value,selected:y.value,onSelectionChanged:e},null,8,["results","detailsProperties","selected"])):O("",!0),k("div",Et,[T.value?(t(),u("div",{key:1,class:R(["text-center",{"ml-42":h.value.length>1}])},$(h.value.length>=1?j(x)("details.layers.results.empty"):j(x)("details.layers.results.empty.noLayers")),3)):(t(),V(zt,{key:0,uid:y.value,results:h.value},null,8,["uid","results"]))])])]),_:1},8,["panel"])}}}),Ot=ue(Ht,[["__scopeId","data-v-60c889f3"]]);export{Ot as default};
