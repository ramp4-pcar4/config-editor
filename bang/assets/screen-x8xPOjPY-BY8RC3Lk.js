import{fv as M,fw as Q,fz as S,h5 as A,fV as Z,fB as x,hm as U,fO as R,fD as t,fP as s,fG as r,fH as D,fI as u,hB as j,hA as B,fQ as L,h4 as E,fJ as _,fA as K,fK as z,fW as F,fL as J,fN as O,fU as y,fZ as G,f_ as I,fM as W,fx as X,fC as Y,fE as P,fF as H,g0 as V,fS as ee,hC as ae,hD as te,hE as le,hF as q,hG as N}from"./index-DBm8NF9m.js";const se={class:"rv-geosearch-bar relative h-26 mx-8 mb-8"},re=["placeholder","value","aria-label"],oe={class:"absolute inset-y-0 right-8 grid w-10 place-content-center"},ne=["aria-label","content"],ce=M({__name:"search-bar",setup(C){const{t:o}=S(),c=A(),n=Z(),g=x(()=>c.searchVal),v=x(()=>['"',"$","!","*","+","?","^","{","}","(",")","|","[","]"].filter(f=>c.searchVal.includes(f)).join("")),m=f=>{c.setSearchTerm(f),c.setSearchRegex(f)},b=U(500,f=>{m(f)});return(f,a)=>{const i=R("tippy");return t(),s("div",se,[r("input",{type:"text",class:D(["border-b w-full text-base py-8 outline-none focus:shadow-outline border-gray-600 h-full min-w-0",{"border-yellow-500":v.value}]),placeholder:u(o)("geosearch.searchText"),value:g.value,onInput:a[0]||(a[0]=l=>u(b)(l.target.value)),onKeyup:a[1]||(a[1]=j(l=>{u(n).mobileView&&l.target.blur()},["enter"])),"aria-label":u(o)("geosearch.searchText"),onKeypress:a[2]||(a[2]=j(B(()=>{},["prevent"]),["enter"])),enterkeyhint:"done"},null,42,re),r("span",oe,[v.value?L((t(),s("button",{key:0,class:"cursor-default","aria-label":u(o)("geosearch.badChars",{chars:v.value}),content:u(o)("geosearch.badChars",{chars:v.value})},a[3]||(a[3]=[E(" âš  ")]),8,ne)),[[i]]):_("",!0)])])}}}),ie={class:"rv-geosearch-top-filters sm:flex items-center w-full ml-8 mb-14"},ue={class:"w-fit inline-block sm:w-1/2 h-26 mb-8 sm:mb-0 pr-16 sm:pr-0"},pe=["value","aria-label"],ve={value:"",disabled:"",hidden:""},be={class:"sm:w-1/2 h-26 sm:mx-16 flex"},fe=["value","aria-label"],de={value:"",disabled:"",hidden:""},he=["disabled","content","aria-label"],ge=M({__name:"top-filters",setup(C){const{t:o}=S(),c=K("iApi"),n=A(),g=z([]),v=z([]),m=z([]),b=x(()=>n.queryParams),f=x(()=>c.language),a=p=>n.setProvince(p),i=p=>n.setType(p),l=()=>{a({}),i({})},w=()=>{var h,k;n.initService(c.language,c.fixture.get("geosearch").config);const p=(h=g.value.find(e=>b.value.province===e.name))==null?void 0:h.code,d=(k=v.value.find(e=>b.value.type===e.name))==null?void 0:k.code;n.getProvinces.then(e=>{var T;g.value=e,a({province:(T=e.find($=>$.code===p))==null?void 0:T.name,forceReRun:!0})}),n.getTypes.then(e=>{var T;v.value=e,i({type:(T=e.find($=>$.code===d))==null?void 0:T.name,forceReRun:!0})})};return F(()=>{w(),m.value.push(J(f,w))}),O(()=>{m.value.forEach(p=>p())}),(p,d)=>{const h=R("truncate"),k=R("tippy");return t(),s("div",ie,[r("div",ue,[L((t(),s("select",{class:"border-b border-b-gray-600 w-full h-full py-0 cursor-pointer",value:b.value.province,"aria-label":u(o)("geosearch.filters.province"),onChange:d[0]||(d[0]=e=>a({province:e.target.value}))},[L((t(),s("option",ve,[E(y(u(o)("geosearch.filters.province")),1)])),[[h]]),(t(!0),s(G,null,I(g.value,e=>L((t(),s("option",{key:e.code},[E(y(e.name),1)])),[[h]])),128))],40,pe)),[[h]])]),r("div",be,[L((t(),s("select",{class:"border-b border-b-gray-600 w-full h-full py-0 cursor-pointer max-w-150",value:b.value.type,"aria-label":u(o)("geosearch.filters.type"),onChange:d[1]||(d[1]=e=>i({type:e.target.value}))},[r("option",de,y(u(o)("geosearch.filters.type")),1),(t(!0),s(G,null,I(v.value,e=>(t(),s("option",{key:e.code},y(e.name),1))),128))],40,fe)),[[h]]),L((t(),s("button",{type:"button",class:"text-gray-500 w-1/8 h-24 pl-8 pr-16 sm:pr-8 hover:text-black disabled:cursor-default disabled:text-gray-400",disabled:!b.value.type&&!b.value.province,onClick:l,content:u(o)("geosearch.filters.clear"),"aria-label":u(o)("geosearch.filters.clear")},d[2]||(d[2]=[r("div",{class:"rv-geosearch-icon"},[r("svg",{class:"fill-current w-18 h-18",viewBox:"0 0 23 21"},[r("path",{d:"M 14.7574,20.8284L 17.6036,17.9822L 14.7574,15.1716L 16.1716,13.7574L 19.0178,16.568L 21.8284,13.7574L 23.2426,15.1716L 20.432,17.9822L 23.2426,20.8284L 21.8284,22.2426L 19.0178,19.3964L 16.1716,22.2426L 14.7574,20.8284 Z M 2,2L 19.9888,2.00001L 20,2.00001L 20,2.01122L 20,3.99999L 19.9207,3.99999L 13,10.9207L 13,22.909L 8.99999,18.909L 8.99999,10.906L 2.09405,3.99999L 2,3.99999L 2,2 Z "})])],-1)]),8,he)),[[k,{placement:"bottom"}]])])])}}}),me={class:"rv-geosearch-bottom-filters"},ye={class:"bg-white"},xe={class:"ml-8 cursor-pointer font-normal"},we=["checked"],Le=M({__name:"bottom-filters",setup(C){const{t:o}=S(),c=K("iApi"),n=A(),g=x(()=>n.resultsVisible),v=U(300,a=>{b(a).then(i=>{m({extent:i,visible:g.value})})}),m=a=>{n.setMapExtent(a)},b=async a=>a.sr.wkid===4326?a:await c.geo.proj.projectGeometry(4326,a),f=a=>{b(c.geo.map.getExtent()).then(i=>{m({extent:i,visible:a})})};return W(()=>{c.event.on(X.MAP_EXTENTCHANGE,v,"geosearch_map_extent")}),O(()=>{c.event.off("geosearch_map_extent")}),(a,i)=>(t(),s("div",me,[r("div",ye,[r("label",xe,[r("input",{type:"checkbox",class:"border-2 mx-8 border-gray-600 cursor-pointer",checked:g.value,onChange:i[0]||(i[0]=l=>f(l.target.checked)),onKeypress:i[1]||(i[1]=j(B(()=>{},["prevent"]),["enter"]))},null,40,we),E(y(u(o)("geosearch.visible")),1)])])]))}}),ke={},_e={class:"w-full h-6 relative overflow-hidden rounded-full indeterminate mb-14"},Te={class:"h-full progressbar bg-blue-800 rounded-full top-0","aria-valuemin":"0","aria-valuemax":"100"},Ee={class:"flex items-center h-full"};function Ce(C,o){return t(),s("div",_e,[r("div",Te,[r("span",Ee,[ee(C.$slots,"default",{},void 0,!0)])])])}const Re=Q(ke,[["render",Ce],["__scopeId","data-v-0a8d1c36"]]),$e={class:"flex flex-col h-full"},Me={key:1,class:"text-red-900 text-xs px-8 mb-10"},Se={key:2,class:"px-8 mb-10 py-8 flex-grow text-wrap border-y border-gray-600 overflow-y-auto"},Ae={class:"relative h-48"},ze={class:"font-bold text-blue-600"},Ve={key:3,class:"rv-results-list flex-grow mb-5 border-t border-b border-gray-600 overflow-y-auto"},je=["onClick"],Ge={class:"rv-result-description px-8"},Ie={class:"flex-1 text-left truncate font-bold leading-tight"},Ke=["innerHTML"],Pe={key:0,class:"text-gray-600 text-sm"},He={key:1,class:"hidden"},qe={key:2,class:"text-sm font-normal"},Ue=M({__name:"screen",props:{panel:{type:Object}},setup(C){const{t:o}=S(),c=K("iApi"),n=A(),g=x(()=>n.searchVal.replace(/["!*$+?^{}()|[\]\\]/g,"").trim()),v=x(()=>n.searchResults),m=x(()=>n.loadingResults),b=x(()=>n.failedServices),f=x(()=>n.GSservice.config.fsaUrl),a=async l=>{if(l.flav==="fsa"&&f.value){const p=f.value.replace(ae,l.name),[d,h]=await te(le(p));if(!d){const k=new q("fsazoom",h.features[0].geometry.rings,N.fromConfig(h.spatialReference),!0);c.geo.map.zoomMapTo(k);return}}const w=new q("zoomies",[[[l.bbox[0],l.bbox[1]],[l.bbox[0],l.bbox[3]],[l.bbox[2],l.bbox[3]],[l.bbox[2],l.bbox[1]],[l.bbox[0],l.bbox[1]]]],N.latLongSR(),!0);c.geo.map.zoomMapTo(w)},i=(l,w)=>{const p=l.replace(new RegExp(`${n.searchRegex}`,"gi"),d=>'<span class="font-bold text-blue-600">'+d+"</span>");return w?p+",":p};return(l,w)=>{const p=Y("panel-screen"),d=R("truncate"),h=R("focus-item"),k=R("focus-list");return t(),P(p,{panel:C.panel},{header:H(()=>[E(y(u(o)("geosearch.title")),1)]),content:H(()=>[r("div",$e,[V(ce),V(ge),m.value?(t(),P(Re,{key:0,class:"flex-none"})):_("",!0),b.value.length>0&&!m.value?(t(),s("div",Me,y(u(o)("geosearch.serviceError",{services:b.value.join(", ")})),1)):_("",!0),g.value&&v.value.length===0&&!m.value?(t(),s("div",Se,[r("span",Ae,[E(y(u(o)("geosearch.noResults")),1),r("span",ze,'"'+y(g.value)+'"',1)])])):_("",!0),v.value.length>0?L((t(),s("ul",Ve,[(t(!0),s(G,null,I(v.value,(e,T)=>(t(),s("li",{class:"relative h-56",key:T},[L((t(),s("button",{type:"button",class:"absolute inset-0 h-full w-full hover:bg-gray-300 default-focus-style",onClick:$=>a(e),style:{"border-bottom":"1px solid lightgray"},"truncate-trigger":""},[r("div",Ge,[L((t(),s("div",Ie,[r("span",{innerHTML:i(e.name,e.location.province)},null,8,Ke),e.location.province?(t(),s("span",Pe,y(e.location.city?" "+e.location.city+", "+e.location.province.abbr:" "+e.location.province.abbr),1)):_("",!0),e.type?(t(),s("span",He,"; ")):_("",!0),e.type?(t(),s("span",qe,[w[0]||(w[0]=r("br",null,null,-1)),E(y(e.type),1)])):_("",!0)])),[[d,{externalTrigger:!0,options:{placement:"top-start"}}]])])],8,je)),[[h,"show-truncate"]])]))),128))])),[[k]]):_("",!0),V(Le,{class:"mt-auto"})])]),_:1},8,["panel"])}}});export{Ue as default};
