const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./projectOperator-Ck1qoxA7-C8j49U3P.js","./index-BeTPrQ6f.js","./index-BlWAJbpo.css","./operatorProject-DXddukrY-D4o1pyBi.js","./SimpleGeometryCursor-DSF_YyIm-TAMgMsbK.js","./geographicTransformationUtils-D2w8s-LD-DiMLY-W9.js","./projectionUtils-CsX1UTBu-DsZaU4xz.js","./projectBuffer-CMNsPBq1-CMpE7Jo3.js","./zscale-PLuFqpaL-BIEnWBsg.js"])))=>i.map(i=>d[i]);
import{C as ot,c as _t,_ as ct,F,aB as Et,B as k,a4 as z,aa as kt,l as yt,gC as C,gD as v,be as dt,gE as Tt,gF as ut,gG as Nt}from"./index-BeTPrQ6f.js";import{Q as vt}from"./projectionUtils-CsX1UTBu-DsZaU4xz.js";function O(){if(!it)throw new yt("rasterprojectionhelper-project","projection operator is not loaded")}const ft=(t,e,o,i=0)=>{if(o[0]===1)return[0,0];let r=1,n=-1,s=1,u=-1;for(let c=0;c<t.length;c+=2)isNaN(t[c])||(r=r>t[c]?t[c]:r,n=n>t[c]?n:t[c],s=s>t[c+1]?t[c+1]:s,u=u>t[c+1]?u:t[c+1]);const{cols:l,rows:a}=e,f=(n-r)/l/o[0],d=(u-s)/a/o[1],h=2*i;let m=0,x=!1,p=[0,0];for(let c=0;c<l-3;c++){for(let R=0;R<a-3;R++){const g=c*a*2+2*R,y=(t[g]+t[g+4]+t[g+4*a]+t[g+4*a+4])/4,M=(t[g+1]+t[g+5]+t[g+4*a+1]+t[g+4*a+5])/4,w=Math.abs((y-t[g+2*a+2])/f),b=Math.abs((M-t[g+2*a+3])/d);if(w+b>m&&(m=w+b,p=[w,b]),h&&m>h){x=!0;break}}if(x)break}return p},Ct={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},Y=32,D=4,X=D,V=new Map,H=new Map,J=500,Lt=39.37,zt=96;let B,E,A,it=!1;async function Kt(){return B||(B=_t(),E=await ct(()=>import("./projectOperator-Ck1qoxA7-C8j49U3P.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),A=await ct(()=>import("./geographicTransformationUtils-D2w8s-LD-DiMLY-W9.js"),__vite__mapDeps([5,1,2,6,7,8]),import.meta.url),E.isLoaded()||await E.load(),A.isLoaded()||await A.load(),it=!0,B.resolve()),B.promise}function It(t,e,o){if(O(),o){const i=E.execute(t,e);return A.getTransformation(e,t.spatialReference,i)}return A.getTransformation(t.spatialReference,e,t)}function Qt(t,e,o,i){const r=t.spatialReference;if(!r||!e||r.equals(e))return t;O();const n=o.center,s=new F({xmin:n.x-t.x/2,xmax:n.x+t.x/2,ymin:n.y-t.y/2,ymax:n.y+t.y/2,spatialReference:r}),u=E.execute(s,e,{geographicTransformation:i}),l=T(e);return u==null||l!=null&&u.width>=l?q(t,r,e):{x:u.width,y:u.height}}function q(t,e,o){const i=z(e)/z(o);return{x:t.x*i,y:t.y*i}}function tt(t,e,o){const{spatialReference:i}=o;if(!i||!e||i.equals(e))return t;if(i.isGeographic&&e.isGeographic)return q(t,i,e);if(O(),!it)throw new yt("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:r,y:n}=t;const s=(r+n)/2*z(i);let u=1;s>30&&(u=30/s,r*=u,n*=u);const l=256,a=r*l/2,f=n*l/2,{x:d,y:h}=o.center,m=[];for(let P=0;P<=l;P++)m.push([d-a,h-f+P*n]);for(let P=1;P<=l;P++)m.push([d-a+P*r,h+f]);for(let P=1;P<=l;P++)m.push([d+a,h+f-P*n]);for(let P=1;P<l;P++)m.push([d+a-P*r,h-f]);m.push(m[0]);const x=new ot({rings:[m],spatialReference:i}),p=E.execute(x,e);if(!p)return q(t,i,e);const c=p.extent,R=T(e);if(c==null||R!=null&&c.width>=R)return q(t,i,e);const g=Dt(p.rings),y=r*n*l*l,M=Math.sqrt(g/y)/u,w={x:c.width/u/l,y:c.height/u/l},b={x:r*M,y:n*M},G=w.x*w.y;return Math.abs(G-b.x*b.y)/G<.1?w:b}function et(t,e){return(typeof t=="number"?t:(t.x+t.y)/2)*z(e)*zt*Lt}function Ut(t,e){const{pixelSize:o,extent:i}=t;return et(tt(o,e,i),e)}function _(t,e=.01){return z(t)?e/z(t):0}function xt(t,e,o,i=!0){const r=t.spatialReference;if(r.equals(e))return t;O();const n=E.execute(t,e,{geographicTransformation:o});return i&&n&&wt([t],[n],r,e),n}function wt(t,e,o,i){const r=$(o,!0),n=$(i,!0),s=_(o,J),u=_(i,J);if(s&&r!=null&&n!=null)for(let l=0;l<t.length;l++){const a=e[l];if(!a)continue;const{x:f}=t[l],{x:d}=a;d>=n[1]-u&&Math.abs(f-r[0])<s?a.x-=n[1]-n[0]:d<=n[0]+u&&Math.abs(f-r[1])<s&&(a.x+=n[1]-n[0])}}function Ot(t){const{inSR:e,outSR:o,preferPE:i}=t;if(e.equals(o)){const{points:r}=st(t,null);return r}return e.isWebMercator&&o.isWGS84||e.isWGS84&&o.isWebMercator?At(t):i&&(e.isGeographic||I(e)!=null)?jt(t):Wt(t)}function Wt(t){const{points:e}=st(t,null),{inSR:o,outSR:i,datumTransformation:r}=t,n=e.map(u=>new k(u[0],u[1],o)),s=E.executeMany(n,i,{geographicTransformation:r});return r&&wt(n,s,o,i),s.map(u=>u?[u.x,u.y]:[NaN,NaN])}function jt(t){const{inSR:e,outSR:o,datumTransformation:i}=t,r=I(e),{points:n,mask:s}=st(t,r);if(!e.isGeographic){const l=e.wkid?C.coordsys(e.wkid):C.fromString(e.isGeographic?v.PE_TYPE_GEOGCS:v.PE_TYPE_PROJCS,e.wkt2||e.wkt);ut.projToGeog(l,n.length,n)}if(i!=null&&i.steps.length){let l;if(o.isGeographic&&(l=n.map(([a])=>a>179.9955?1:a<-179.9955?-1:0)),i.steps.forEach(a=>{const f=a.wkid?C.geogtran(a.wkid):C.fromString(v.PE_TYPE_GEOGTRAN,a.wkt);Nt.geogToGeog(f,n.length,n,null,a.isInverse?v.PE_TRANSFORM_2_TO_1:v.PE_TRANSFORM_1_TO_2)}),l)for(let a=0;a<n.length;a++){const f=l[a],d=n[a][0],h=d>179.9955?1:d<-179.9955?-1:0;f&&h&&f!==h&&(n[a][0]=f>0?d+360:d-360)}}if(!o.isGeographic){const l=I(o,!0),a=l!=null&&l.isEnvelope?[l.bbox[1],l.bbox[3]]:[-90,90];Ft(n,a);const f=o.wkid?C.coordsys(o.wkid):C.fromString(o.isGeographic?v.PE_TYPE_GEOGCS:v.PE_TYPE_PROJCS,o.wkt2||o.wkt);ut.geogToProj(f,n.length,n)}let u=n;if(s&&n.length!==s.length){u=[];for(let l=0,a=0;l<s.length;l++)s[l]?u.push(n[a++]):u.push([NaN,NaN])}return u}function At(t){const{cols:e,rows:o,xres:i,yres:r,usePixelCenter:n,inSR:s,outSR:u}=t;let{xmin:l,ymax:a}=t;n&&(l+=i/2,a-=r/2);const f=[],d=[],h=Math.max(e,o);for(let x=0;x<h;x++){const p=l+i*Math.min(e,x),c=a-r*Math.min(o,x),R=vt(new k({x:p,y:c,spatialReference:s}),s,u);x<=e&&f.push(R.x),x<=o&&d.push(R.y)}const m=[];for(let x=0;x<e;x++)for(let p=0;p<o;p++)m.push([f[x],d[p]]);return m}function I(t,e=!1){let o=t.wkid||t.wkt2||t.wkt;if(!o||t.isGeographic)return null;if(o=String(o),V.has(o)){const s=V.get(o);return e?s==null?void 0:s.gcs:s==null?void 0:s.pcs}const i=t.wkid?C.coordsys(t.wkid):C.fromString(t.isGeographic?v.PE_TYPE_GEOGCS:v.PE_TYPE_PROJCS,t.wkt2||t.wkt),r=ht(i,_(t,1e-4)),n=ht(i,0,!0);return V.set(o,{pcs:r,gcs:n}),e?n:r}function ht(t,e=0,o=!1){const i=Tt.generate(t),r=o?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!i||!(r!=null&&r.length))return null;let n=!1,s=r.find(c=>c.getInclusive()===1&&c.getKind()===1);if(!s){if(s=r.find(c=>c.getInclusive()===1&&c.getKind()===0),!s)return null;n=!0}const u=o?0:(i.getNorthPoleLocation()===2?1:0)|(i.getSouthPoleLocation()===2?2:0),l=i.isPannableRectangle(),a=s.getCoord();if(n)return{isEnvelope:n,isPannable:l,vertices:a,coef:null,bbox:[a[0][0]-e,a[0][1]-e,a[1][0]+e,a[1][1]+e],poleLocation:u};let f=0;const d=[];let[h,m]=a[0],[x,p]=a[0];for(let c=0,R=a.length;c<R;c++){f++,f===R&&(f=0);const[g,y]=a[c],[M,w]=a[f];if(w===y)d.push([g,M,y,w,2]);else{const b=(M-g)/(w-y||1e-4),G=g-b*y;y<w?d.push([b,G,y,w,0]):d.push([b,G,w,y,1])}h=h<g?h:g,m=m<y?m:y,x=x>g?x:g,p=p>y?p:y}return{isEnvelope:!1,isPannable:l,vertices:a,coef:d,bbox:[h,m,x,p],poleLocation:u}}function st(t,e){const o=[],{cols:i,rows:r,xres:n,yres:s,usePixelCenter:u}=t;let{xmin:l,ymax:a}=t;if(u&&(l+=n/2,a-=s/2),e==null){for(let m=0;m<i;m++)for(let x=0;x<r;x++)o.push([l+n*m,a-s*x]);return{points:o}}const f=new Uint8Array(i*r);if(e.isEnvelope){const{bbox:[m,x,p,c]}=e;for(let R=0,g=0;R<i;R++){const y=l+n*R,M=e.isPannable||y>=m&&y<=p;for(let w=0;w<r;w++,g++){const b=a-s*w;M&&b>=x&&b<=c&&(o.push([y,b]),f[g]=1)}}return{points:o,mask:f}}const d=e.coef,h=[];for(let m=0;m<r;m++){const x=a-s*m,p=[],c=[];for(let g=0;g<d.length;g++){const[y,M,w,b,G]=d[g];if(x===w&&w===b)p.push(y),p.push(M),c.push(2),c.push(2);else if(x>=w&&x<=b){const P=y*x+M;p.push(P),c.push(G)}}let R=p;if(p.length>2){let g=c[0]===2?0:c[0],y=p[0];R=[];for(let M=1;M<c.length;M++)c[M]===2&&M!==c.length-1||(c[M]!==g&&(R.push(g===0?Math.min(y,p[M-1]):Math.max(y,p[M-1])),g=c[M],y=p[M]),M===c.length-1&&R.push(c[M]===0?Math.min(y,p[M]):Math.max(y,p[M])));R.sort((M,w)=>M-w)}else p[0]>p[1]&&(R=[p[1],p[0]]);h.push(R)}for(let m=0,x=0;m<i;m++){const p=l+n*m;for(let c=0;c<r;c++,x++){const R=a-s*c,g=h[c];if(g.length===2)p>=g[0]&&p<=g[1]&&(o.push([p,R]),f[x]=1);else if(g.length>2){let y=!1;for(let M=0;M<g.length;M+=2)if(p>=g[M]&&p<=g[M+1]){y=!0;break}y&&(o.push([p,R]),f[x]=1)}}}return{points:o,mask:f}}function Ft(t,e){const[o,i]=e;for(let r=0;r<t.length;r++){const n=t[r][1];(n<o||n>i)&&(t[r]=[NaN,NaN])}}function Mt(t,e){const o=T(t[0].spatialReference);if(t.length<2||o==null||(e=e??_(t[0].spatialReference),(t=t.filter(u=>u.width>e)).length===1))return t[0];let{xmin:i,xmax:r,ymin:n,ymax:s}=t[0];for(let u=1;u<t.length;u++){const l=t[u];r=l.xmax+o*u,n=Math.min(n,l.ymin),s=Math.max(s,l.ymax)}return new F({xmin:i,xmax:r,ymin:n,ymax:s,spatialReference:t[0].spatialReference})}function Rt(t,e,o=null,i=!0){const r=t.spatialReference;if(r.equals(e)||!e)return t;const n=rt(t),s=T(r,!0),u=T(e);if(n===0||s==null||u==null){const f=nt(t,e,o,i);if(f&&s==null&&u!=null&&Math.abs(f.width-u)<_(e)&&E.isLoaded()){const d=I(r);if(d!=null&&d.poleLocation===0&&t.width<(d.bbox[2]-d.bbox[0])/2)return Bt(t,e)||f}return f}const l=t.clone().normalize();if(l.length===1&&t.xmax<s&&t.xmax-s/2>_(r)){const{xmin:f,xmax:d}=t;for(let h=0;h<=n;h++){const m=h===0?f:-s/2,x=h===n?d-s*h:s/2;l[h]=new F({xmin:m,xmax:x,ymin:t.ymin,ymax:t.ymax,spatialReference:r})}}const a=l.map(f=>nt(f,e,o,i)).filter(Et);return a.length===0?null:Mt(a)}function Xt(t,e,o){if(t.type==="extent"){const{xmin:i,ymin:r,xmax:n,ymax:s,spatialReference:u}=t;t=new ot({rings:[[[i,s],[n,s],[n,r],[i,r],[i,s]]],spatialReference:u})}return t.spatialReference.equals(e)?t:(O(),E.execute(t,e,{geographicTransformation:o}))}function Bt(t,e){const o=T(e);if(o==null)return null;let{xmin:i,ymin:r,xmax:n,ymax:s}=t;const u=t.spatialReference,l=new ot({spatialReference:u,rings:[[[i,r],[n,r],[n,s],[i,s],[i,r]]]}),a=E.execute(l,e);if(a.rings.length!==2||!a.rings[0].length||!a.rings[1].length)return null;const{rings:f}=a,d=_(u),h=new F({spatialReference:e});for(let m=0;m<2;m++){i=n=f[m][0][0],r=s=f[m][0][1];for(let x=0;x<f[m].length;x++)i=i>f[m][x][0]?f[m][x][0]:i,n=n<f[m][x][0]?f[m][x][0]:n,r=r>f[m][x][1]?f[m][x][1]:r,s=s<f[m][x][1]?f[m][x][1]:s;if(m===0)h.ymin=r,h.ymax=s,h.xmin=i,h.xmax=n;else if(h.ymin=Math.min(h.ymin,r),h.ymax=Math.max(h.ymax,s),Math.abs(n-o/2)<d)h.xmin=i,h.xmax=h.xmax+o;else{if(!(Math.abs(i+o/2)<d))return null;h.xmax=n+o}}return h}function nt(t,e,o,i=!0,r=!0){const n=t.spatialReference;if(n.equals(e)||!e)return t;O();const s=E.execute(t,e,{geographicTransformation:o});if(r&&e.isWebMercator&&s&&(s.ymax=Math.min(20037508342787e-6,s.ymax),s.ymin=Math.max(-20037508342787e-6,s.ymin),s.ymin>=s.ymax))return null;if(!i||!s)return s;const u=$(n,!0),l=$(e,!0);if(u==null||l==null)return s;const a=_(n,.001),f=_(n,J),d=_(e,.001);if(Math.abs(s.xmin-l[0])<d&&Math.abs(s.xmax-l[1])<d){const h=Math.abs(t.xmin-u[0]),m=Math.abs(u[1]-t.xmax);if(h<a&&m>f){s.xmin=l[0];const x=[];x.push(new k(t.xmax,t.ymin,n)),x.push(new k(t.xmax,(t.ymin+t.ymax)/2,n)),x.push(new k(t.xmax,t.ymax,n));const p=x.map(c=>xt(c,e,o)).filter(c=>!isNaN(c==null?void 0:c.x)).map(c=>c.x);s.xmax=Math.max.apply(null,p)}if(m<a&&h>f){s.xmax=l[1];const x=[];x.push(new k(t.xmin,t.ymin,n)),x.push(new k(t.xmin,(t.ymin+t.ymax)/2,n)),x.push(new k(t.xmin,t.ymax,n));const p=x.map(c=>xt(c,e,o)).filter(c=>!isNaN(c==null?void 0:c.x)).map(c=>c.x);s.xmin=Math.min.apply(null,p)}}else{const h=_(e,.001);Math.abs(s.xmin-l[0])<h&&(s.xmin=l[0]),Math.abs(s.xmax-l[1])<h&&(s.xmax=l[1])}return s}function T(t,e=!1){if(!t)return null;const o=e?20037508342787e-6:20037508342788905e-9;return t.isWebMercator?2*o:t.wkid&&t.isGeographic?360:2*Ct[t.wkid]||null}function $(t,e=!1){if(t.isGeographic)return[-180,180];const o=T(t,e);return o!=null?[-o/2,o/2]:null}function mt(t,e,o,i){let r=(t-e)/o;return r-Math.floor(r)!==0?r=Math.floor(r):i&&(r-=1),r}function rt(t,e=!1){const o=T(t.spatialReference);if(o==null)return 0;const i=e?0:-(o/2),r=_(t.spatialReference),n=!e&&Math.abs(t.xmax-o/2)<r?o/2:t.xmax,s=!e&&Math.abs(t.xmin+o/2)<r?-o/2:t.xmin;return mt(n,i,o,!0)-mt(s,i,o,!1)}function Vt(t){const e=t.storageInfo.origin.x,o=T(t.spatialReference,!0);if(o==null)return{originX:e,halfWorldWidth:null,pyramidsInfo:null};const i=o/2,{nativePixelSize:r,storageInfo:n,extent:s}=t,{maximumPyramidLevel:u,blockWidth:l,pyramidScalingFactor:a}=n;let f=r.x;const d=[],h=t.transform!=null&&t.transform.type==="gcs-shift",m=e+(h?0:i),x=h?o-e:i-e;for(let p=0;p<=u;p++){const c=(s.xmax-e)/f/l,R=c-Math.floor(c)===0?c:Math.ceil(c),g=x/f/l,y=g-Math.floor(g)===0?g:Math.ceil(g),M=Math.floor(m/f/l),w=Math.round(m/f)%l,b=(l-Math.round(x/f)%l)%l;d.push({resolutionX:f,blockWidth:l,datasetColumnCount:R,worldColumnCountFromOrigin:y,leftMargin:w,rightPadding:b,originColumnOffset:M}),f*=a}return{originX:e,halfWorldWidth:i,pyramidsInfo:d,hasGCSSShiftTransform:h}}function qt(t){if(!t||t.isGeographic)return t;const e=String(t.wkid||t.wkt2||t.wkt);let o;return H.has(e)?o=H.get(e):(o=(t.wkid?C.coordsys(t.wkid):C.fromString(v.PE_TYPE_PROJCS,t.wkt2||t.wkt)).getGeogcs().getCode(),H.set(e,o)),new dt({wkid:o})}function Ht(t){const e=t.isAdaptive&&t.spacing==null;let o=t.spacing||[Y,Y],i=Z(t),r={cols:i.size[0]+1,rows:i.size[1]+1};const n=i.outofBoundPointCount>0&&i.outofBoundPointCount<i.offsets.length/2;let s=i.outofBoundPointCount===i.offsets.length/2||e&&n?[0,0]:ft(i.offsets,r,o,X);const u=(s[0]+s[1])/2,l=t.projectedExtent.spatialReference,a=t.srcBufferExtent.spatialReference;if(e&&(n||u>X)&&(l.isGeographic||I(l),o=[D,D],i=Z({...t,spacing:o}),r={cols:i.size[0]+1,rows:i.size[1]+1},s=ft(i.offsets,r,o,X)),i.error=s,o[0]>1&&(i.coefficients=pt(i.offsets,r,n)),t.includeGCSGrid&&!l.isGeographic&&!l.isWebMercator)if(a.isGeographic)i.gcsGrid={offsets:i.offsets,coefficients:i.coefficients,spacing:o};else{const f=I(l);if(f!=null&&!f.isEnvelope){const d=qt(l),h=Rt(t.projectedExtent,d),{offsets:m}=Z({...t,srcBufferExtent:h,spacing:o}),x=pt(m,r,n);i.gcsGrid={offsets:m,coefficients:x,spacing:o}}}return i}function Z(t){const{projectedExtent:e,srcBufferExtent:o,pixelSize:i,datumTransformation:r,rasterTransform:n}=t,s=e.spatialReference,u=o.spatialReference;O();const{xmin:l,ymin:a,xmax:f,ymax:d}=e,h=T(u),m=h!=null&&(t.hasWrapAround||(n==null?void 0:n.type)==="gcs-shift"),x=t.spacing||[Y,Y],p=x[0]*i.x,c=x[1]*i.y,R=x[0]===1,g=Math.ceil((f-l)/p-.1/x[0])+(R?0:1),y=Math.ceil((d-a)/c-.1/x[1])+(R?0:1),M=Ot({cols:g,rows:y,xmin:l,ymax:d,xres:p,yres:c,inSR:s,outSR:u,datumTransformation:r,preferPE:x[0]<=D,usePixelCenter:R}),w=[];let b,G=0;const P=R?-1:NaN,{xmin:N,xmax:L,ymax:K,width:Q,height:Pt}=o,bt=_(u,J),St=h!=null&&N>0&&L>h/2,at=I(s),Gt=at!=null&&at.poleLocation>0;for(let W=0;W<g;W++){const U=[];for(let j=0;j<y;j++){let S=M[W*y+j];if(m&&S[0]>L&&S[0]>h/2-bt?S[0]-=h:m&&W===0&&S[0]<0&&St&&!n&&(S[0]+=h),!S||isNaN(S[0])||isNaN(S[1]))w.push(P),w.push(P),U.push(null),G++;else{if(n){const lt=n.inverseTransform(new k({x:S[0],y:S[1],spatialReference:u}));S=[lt.x,lt.y]}U.push(S),W>0&&m&&b[j]&&S[0]<b[j][0]&&(S[0]+=h,Gt&&S[0]>L&&S[0]>h&&(S[0]-=h)),w.push((S[0]-N)/Q),w.push((K-S[1])/Pt)}}b=U}return{offsets:w,error:null,coefficients:null,outofBoundPointCount:G,spacing:x,size:R?[g,y]:[g-1,y-1]}}function pt(t,e,o){const{cols:i,rows:r}=e,n=new Float32Array((i-1)*(r-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),u=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<i-1;l++){for(let a=0;a<r-1;a++){let f=l*r*2+2*a;const d=t[f],h=t[f+1],m=t[f+2],x=t[f+3];f+=2*r;const p=t[f],c=t[f+1],R=t[f+2],g=t[f+3];let y=0,M=12*(a*(i-1)+l);for(let w=0;w<3;w++)n[M++]=s[y++]*d+s[y++]*m+s[y++]*R;y=0;for(let w=0;w<3;w++)n[M++]=s[y++]*h+s[y++]*x+s[y++]*g;y=0;for(let w=0;w<3;w++)n[M++]=u[y++]*d+u[y++]*p+u[y++]*R;y=0;for(let w=0;w<3;w++)n[M++]=u[y++]*h+u[y++]*c+u[y++]*g}if(o)for(let a=0;a<n.length;a++)isNaN(n[a])&&(n[a]=-1)}return n}function Yt(t,e){const o=t.clone().normalize();return o.length===1?o[0]:Mt(o,e)}function Zt(t){const{spatialReference:e}=t,o=kt(e);if(!o)return t;const[i,r]=o.valid,n=r-i;let s=0;if(t.xmin<i){const u=i-t.xmin;s=Math.ceil(u/n)}else if(t.xmin>r){const u=t.xmin-r;s=-Math.ceil(u/n)}return new F({spatialReference:t.spatialReference,xmin:t.xmin+s*n,ymin:t.ymin,xmax:t.xmax+s*n,ymax:t.ymax})}function te(t,e,o){var x;const{storageInfo:i,pixelSize:r}=e;let n=0,s=!1;const{pyramidResolutions:u}=i,l=((x=i.tileInfo.format)==null?void 0:x.toLowerCase())==="mixed"?Math.max(1,Math.min(3,i.tileInfo.dpi/96)):1,a=(t.x+t.y)/2/l;if(u!=null&&u.length){const p=u[u.length-1],c=(p.x+p.y)/2,R=(r.x+r.y)/2;if(a<=R)n=0;else if(a>=c)n=u.length,s=a/c>8;else{let y,M=R;for(let w=1;w<=u.length;w++){if(y=(u[w-1].x+u[w-1].y)/2,a<=y){a===y?n=w:o==="down"?(n=w-1,s=a/M>8):n=o==="up"||a-M>y-a||a/M>2?w:w-1;break}M=y}}const g=n===0?r:u[n-1];return s&&Math.min(g.x,g.y)*z(e.spatialReference)>19567&&(s=!1),{pyramidLevel:n,pyramidResolution:new k({x:g.x,y:g.y,spatialReference:e.spatialReference}),excessiveReading:s}}const f=Math.log(t.x/r.x)/Math.LN2,d=Math.log(t.y/r.y)/Math.LN2,h=e.storageInfo.maximumPyramidLevel||0;n=o==="down"?Math.floor(Math.min(f,d)):o==="up"?Math.ceil(Math.max(f,d)):Math.round((f+d)/2),n<0?n=0:n>h&&(s=n>h+3,n=h);const m=2**n;return{pyramidLevel:n,pyramidResolution:new k({x:m*e.nativePixelSize.x,y:m*e.nativePixelSize.y,spatialReference:e.spatialReference}),excessiveReading:s}}function gt(t,e,o=!1){const{pixelSize:i,extent:r}=t,n=It(r,e,!1),s=Rt(Yt(r,(i.x+i.y)/16),e,n);return!s||o||rt(s)===0?s:nt(r,e,n)}function ee(t,e,o){var G;const i=o==null?void 0:o.tileSize,r=o==null?void 0:o.alignGlobalDatasetWithAGOL,{extent:n,spatialReference:s,pixelSize:u}=t,l=tt(u,e,n);if(l==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const a=(l.x+l.y)/2,f=et(a,e),d=e.isGeographic?256/i*2958287637958547e-7:256/i*591657527591555e-6;let h=t.dataType==="vector-magdir"||t.dataType==="vector-uv";const m=gt(t,e,!0),x=Math.min(Math.ceil(Math.log(Math.min(t.width,t.height)/32)/Math.LN2),Math.ceil(Math.log(d/2/f)/Math.LN2));if(!h&&m&&r&&(e.isGeographic||e.isWebMercator)){const P=T(e);if(h=rt(m)>0||P!=null&&m.width>P/4,!h&&P!=null){let N=-1;if(x<3)N=2**x*a*i;else if(t.storageInfo){const{maximumPyramidLevel:K=0,pyramidScalingFactor:Q=2}=t.storageInfo;N=Q**K*a*i}const L=Math.ceil(P/N);h=L===1||L===2&&P/2-m.xmax<N}}let p,c=f;const R=1.001,g=Math.min(2,Math.max(1.414,((G=t.storageInfo)==null?void 0:G.pyramidScalingFactor)||2));if(h){c=d;const P=e.isGeographic?1341104507446289e-21:.29858214164761665,N=et(P,e),L=e.isGeographic?4326:3857;p=tt({x:P,y:P},s,gt(t,new dt({wkid:L}),!0)),p.x*=c/N,p.y*=c/N}else{p={x:u.x,y:u.y};let P=0;for(;c<d*(R/2)&&P<x;)P++,c*=g,p.x*=g,p.y*=g;Math.max(c,d)/Math.min(c,d)<=R&&(c=d)}const y=[c],M=[{x:p.x,y:p.y}],w=70.5310735,b=Math.min(w,f)/R;for(;c>=b;)c/=g,p.x/=g,p.y/=g,y.push(c),M.push({x:p.x,y:p.y});return{projectedPixelSize:l,scales:y,srcResolutions:M,isCustomTilingScheme:!h}}function Dt(t){let e=0;for(const o of t){const i=o.length;let r=o[0][0]*(o[1][1]-o[i-2][1]);for(let n=1;n<i-1;n++)r+=o[n][0]*(o[n+1][1]-o[n-1][1]);e+=r/2}return Math.abs(e)}export{Zt as $,Xt as B,te as D,rt as H,Qt as I,Vt as K,T as N,Ut as O,ee as U,Kt as W,Ht as a,xt as i,gt as l,It as p,Rt as s};
