import{f7 as p,f8 as g}from"./index-CQ8-0QQp.js";import{V as M}from"./CIMSymbolHelper-34UsTwam-Ch--OD_s.js";import{CIMSymbolRasterizer as j}from"./CIMSymbolRasterizer-CHPajZH1-D85MnlRC.js";import{OverrideHelper as q}from"./OverrideHelper-DgyARgwI-PDmAzQ2V.js";import{k as O}from"./utils-BfXZnjCE-CopoHYAx.js";import{S as P,P as D}from"./symbolUtils-D5Wjfwrf-DeD8gFR7.js";import"./BidiEngine-DusKzrO8-BlAgW8mu.js";import"./fontUtils-C37p4Hgq-DMSXfgA3.js";import"./OptimizedGeometry-pzfNw1AT-Ckm1nrtQ.js";import"./memoryEstimations-DeWfxwaV-D8kkh29b.js";import"./GeometryUtils-B8e3Iwyx-BftZgfY6.js";import"./enums-a_LDTPYU-CBIcy3mM.js";import"./defaultCIMValues-BcSaJjm--58G-soMN.js";import"./definitions-MCCItX4r-o3EUznKY.js";import"./rasterizingUtils-1wASRzSP-DxFaW1Ru.js";import"./floatRGBA-DRFmbkvz-DfeZyJQq.js";import"./mat2d-BQA-1WB--Pnyy0dhf.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./mat2df32-fg3OHsAI-BF2V2zqo.js";import"./vec2-BnynUbeJ-CKtGJQAy.js";import"./vec2f32-hTAvipMV-C0AQcwEv.js";import"./Rect-DD6XS68q-D_hsV3ag.js";import"./BoundingBox-DlCd_wcU-DBB4UfPl.js";import"./CIMResourceManager-DyRf92xI-mTh-YK6f.js";import"./imageUtils-D3tfFRL_-Dq8cPdlp.js";import"./colorUtils-Eg6lOlXm-7UV7YEXV.js";import"./vec42-D8CJyqHG-DnfLTeQH.js";import"./vec4f64-DD-nkcCV-CSNWKRqG.js";import"./FieldsIndex-Bt0Y8aWr-Dy7qhi0q.js";import"./UnknownTimeZone-DxjyzFvs-Bj2Ovyjw.js";import"./timeZoneUtils-d5p0Jda1-CK3w7ysb.js";import"./ArcadeExpression-XjY3x7KV-BmzhFoaj.js";import"./TimeOnly-CGkId3bj-JDOpcZSO.js";import"./enum-g1DWyQyu-Ak-qLf19.js";import"./callExpressionWithFeature-Bk8k1lJI-tiLb6kma.js";import"./quantizationUtils-D907S7Bm-GtM-hh0K.js";import"./utils-Cb2uXNfG-DKAy_g3B.js";import"./asyncUtils-BPUlNCrX-C7s4Eh4u.js";import"./jsonUtils-BwLwuQj7-BBqLvREw.js";import"./parser-CWccHtwJ-CeF_pdxX.js";import"./mat4f32-BdRMyjXW-CWt6U0BP.js";import"./mat4-OOmHNWi7-_RgowJk9.js";import"./cimSymbolUtils-DCedSSCN-CSq18u1I.js";import"./LRUCache-DPWdPNTF-BhV6gJVw.js";import"./MemCache-qDGoejB7-Bz_y0gIH.js";import"./jsxFactory-Cua8zWVZ-CUIB-Lcq.js";import"./intl-BAA1onnp-CmgFU7qQ.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";import"./sanitizerUtils-B1yRmbO2-B7KG_jBT.js";import"./webStyleSymbolUtils-r0H5toyk-Rf-0TE3r.js";import"./devEnvironmentUtils-CxrVv3RG-ktR0Kqgv.js";import"./styleUtils-DBPDLVBX-jec2DPp4.js";const d=new j(null),u=p(P.size),G=p(P.maxSize),v=p(P.lineWidth),E=1;async function $(o,t,l){const e=t==null?void 0:t.size;let i=e!=null&&typeof e=="object"&&"width"in e?e.width:e,m=e!=null&&typeof e=="object"&&"height"in e?e.height:e;if(!i||!m)if(l==="esriGeometryPolygon")i=m=t.maxSize?Math.min(t.maxSize,u):u;else{const n=await k(o,t,l);n&&(i=n.width,m=n.height),l==="esriGeometryPolyline"&&(i=t.maxSize?Math.min(t.maxSize,v):v),i=i!=null&&isFinite(i)?Math.min(i,G):u,m=m!=null&&isFinite(m)?Math.max(Math.min(m,G),E):u}return t.style==="legend"&&l==="esriGeometryPolyline"&&(i=v),{width:i,height:m}}async function k(o,t={},l){var h;const e=t.cimOptions||t;l??(l=e.geometryType||O((h=o==null?void 0:o.data)==null?void 0:h.symbol));const{feature:i,fieldMap:m,viewParams:n}=e,a=await q.resolveSymbolOverrides(o.data,i,null,m,l,null,n);if(!a)return null;(o=o.clone()).data={type:"CIMSymbolReference",symbol:a},o.data.primitiveOverrides=void 0;const r=[];return M.fetchResources(a,d.resourceManager,r),M.fetchFonts(a,d.resourceManager,r),r.length>0&&await Promise.all(r),M.getEnvelope(a,null,d.resourceManager)}async function $t(o,t={}){var C,I;const{node:l,opacity:e,symbolConfig:i}=t,m=i!=null&&typeof i=="object"&&"isSquareFill"in i&&i.isSquareFill,n=t.cimOptions||t,a=n.geometryType||O((C=o==null?void 0:o.data)==null?void 0:C.symbol),r=await $(o,t,a),{feature:h,fieldMap:F}=n,L=t!=null&&t.geometry||m||a!=="esriGeometryPolygon"?"preview":"legend";let z=r;const x=r;if(t!=null&&t.geometry&&(a==="esriGeometryPolygon"||a==="esriGeometryPolyline")&&(g(r.width)<200||g(r.height)<200)){const S=r.width>r.height?p(200)*r.height/r.width:p(200);z={width:r.width>r.height?p(200):p(200)*r.width/r.height,height:S}}const f=await d.rasterizeCIMSymbolAsync(o,h,z,L,F,a,null,n.viewParams,n.allowScalingUp,(I=t==null?void 0:t.geometry)==null?void 0:I.toJSON());if(!f)return null;const{width:R,height:U}=f,c=document.createElement("canvas");c.width=R,c.height=U,c.getContext("2d").putImageData(f,0,0);const w=g(x.width),b=g(x.height),s=new Image(w,b);s.src=c.toDataURL(),s.ariaLabel=t.ariaLabel??null,s.alt=t.ariaLabel??"",e!=null&&(s.style.opacity=`${e}`);let y=s;if(t.effectView!=null){const S={shape:{type:"image",x:0,y:0,width:w,height:b,src:s.src},fill:null,stroke:null,offset:[0,0]};y=D([[S]],[w,b],t)}return l&&y&&l.appendChild(y),y}export{k as getCIMSymbolPreviewSize,$t as previewCIMSymbol};
