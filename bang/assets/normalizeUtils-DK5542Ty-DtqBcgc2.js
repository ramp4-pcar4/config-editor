import{b as E,aa as I,H as C,bj as T,c1 as W,b$ as X,v as k,bm as G,t as K,C as F,l as Q,P as Y,be as D,eg as B}from"./index-BeTPrQ6f.js";import{a as V}from"./Cyclical-Bzwh_QaL-CXh-hbnA.js";import{p as A,f as R,t as P,u as Z}from"./normalizeUtilsCommon-5DjefBp7-CQyUDMQp.js";import{g as $}from"./utils-CRANtbnc-C6zyufvL.js";import{c as ee,f as ne}from"./utils-t279O251-BBk6rV0U.js";async function te(e,n,i,r){const t=$(e),l=n[0].spatialReference,o={...r,responseType:"json",query:{...t.query,f:"json",sr:X(l),target:JSON.stringify({geometryType:W(n[0]),geometries:n}),cutter:JSON.stringify(i)}},s=await k(t.path+"/cut",o),{cutIndexes:a,geometries:f=[]}=s.data;return{cutIndexes:a,geometries:f.map(u=>{const m=G(u);return m.spatialReference=l,m})}}async function se(e,n,i){const r=typeof e=="string"?K(e):e,t=n[0].spatialReference,l=W(n[0]),o={...i,query:{...r.query,f:"json",sr:X(t),geometries:JSON.stringify(ee(n))}},{data:s}=await k(r.path+"/simplify",o);return ne(s.geometries,l,t)}const _=()=>Y.getLogger("esri.geometry.support.normalizeUtils");function re(e){return e.type==="polygon"}function oe(e){return e[0].type==="polygon"}function ie(e){return e[0].type==="polyline"}function J(e){const n=[];let i=0,r=0;for(let t=0;t<e.length;t++){const l=e[t];let o=null;for(let s=0;s<l.length;s++)o=l[s],n.push(o),s===0?(i=o[0],r=i):(i=Math.min(i,o[0]),r=Math.max(r,o[0]));o&&n.push([(i+r)/2,0])}return n}function le(e,n){if(!(e instanceof C||e instanceof F)){const t="straightLineDensify: the input geometry is neither polyline nor polygon";throw _().error(t),new Q("internal:geometry",t)}const i=P(e),r=[];for(const t of i){const l=[];r.push(l),l.push([t[0][0],t[0][1]]);for(let o=0;o<t.length-1;o++){const s=t[o][0],a=t[o][1],f=t[o+1][0],u=t[o+1][1],m=Math.sqrt((f-s)*(f-s)+(u-a)*(u-a)),p=(u-a)/m,d=(f-s)/m,g=m/n;if(g>1){for(let v=1;v<=g-1;v++){const q=v*n,c=d*q+s,h=p*q+a;l.push([c,h])}const M=(m+Math.floor(g-1)*n)/2,N=d*M+s,L=p*M+a;l.push([N,L])}l.push([f,u])}}return re(e)?new F({rings:r,spatialReference:e.spatialReference}):new C({paths:r,spatialReference:e.spatialReference})}function O(e,n,i){if(n){const r=le(e,1e6);e=B(r,!0)}return i&&(e=Z(e,i)),e}function U(e,n,i){if(Array.isArray(e)){const r=e[0];if(r>n){const t=R(r,n);e[0]=r+t*(-2*n)}else if(r<i){const t=R(r,i);e[0]=r+t*(-2*i)}}else{const r=e.x;if(r>n){const t=R(r,n);e=e.clone().offset(t*(-2*n),0)}else if(r<i){const t=R(r,i);e=e.clone().offset(t*(-2*i),0)}}return e}function ae(e,n){let i=-1;for(let r=0;r<n.cutIndexes.length;r++){const t=n.cutIndexes[r],l=n.geometries[r],o=P(l);for(let s=0;s<o.length;s++){const a=o[s];a.some(f=>{if(f[0]<180)return!0;{let u=0;for(let p=0;p<a.length;p++){const d=a[p][0];u=d>u?d:u}u=Number(u.toFixed(9));const m=-360*R(u,180);for(let p=0;p<a.length;p++){const d=l.getPoint(s,p);l.setPoint(s,p,d.clone().offset(m,0))}return!0}})}if(t===i){if(oe(e))for(const s of P(l))e[t]=e[t].addRing(s);else if(ie(e))for(const s of P(l))e[t]=e[t].addPath(s)}else i=t,e[t]=l}return e}async function ce(e,n,i){if(!Array.isArray(e))return ce([e],n);n&&typeof n!="string"&&_().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof n=="string"?n:(n==null?void 0:n.url)??E.geometryServiceUrl;let t,l,o,s,a,f,u,m,p=0;const d=[],g=[];for(const c of e)if(c!=null)if(t||(t=c.spatialReference,l=I(t),o=t.isWebMercator,f=o?102100:4326,s=A[f].maxX,a=A[f].minX,u=A[f].plus180Line,m=A[f].minus180Line),l)if(c.type==="mesh")g.push(c);else if(c.type==="point")g.push(U(c.clone(),s,a));else if(c.type==="multipoint"){const h=c.clone();h.points=h.points.map(x=>U(x,s,a)),g.push(h)}else if(c.type==="extent"){const h=c.clone()._normalize(!1,!1,l);g.push(h.rings?new F(h):h)}else if(c.extent){const h=c.extent,x=R(h.xmin,a)*(2*s);let b=x===0?c.clone():Z(c.clone(),x);h.offset(x,0);let{xmin:w,xmax:y}=h;w=Number(w.toFixed(9)),y=Number(y.toFixed(9)),h.intersects(u)&&y!==s?(p=y>p?y:p,b=O(b,o),d.push(b),g.push("cut")):h.intersects(m)&&w!==a?(p=y*(2*s)>p?y*(2*s):p,b=O(b,o,360),d.push(b),g.push("cut")):g.push(b)}else g.push(c.clone());else g.push(c);else g.push(c);let M=R(p,s),N=-90;const L=M,v=new C;for(;M>0;){const c=360*M-180;v.addPath([[c,N],[c,-1*N]]),N*=-1,M--}if(d.length>0&&L>0){const c=ae(d,await te(r,d,v,i)),h=[],x=[];for(let y=0;y<g.length;y++){const S=g[y];if(S!=="cut")x.push(S);else{const z=c.shift(),j=e[y];j!=null&&j.type==="polygon"&&j.rings&&j.rings.length>1&&z.rings.length>=j.rings.length?(h.push(z),x.push("simplify")):x.push(o?T(z):z)}}if(!h.length)return x;const b=await se(r,h,i),w=[];for(let y=0;y<x.length;y++){const S=x[y];S!=="simplify"?w.push(S):w.push(o?T(b.shift()):b.shift())}return w}const q=[];for(let c=0;c<g.length;c++){const h=g[c];if(h!=="cut")q.push(h);else{const x=d.shift();q.push(o===!0?T(x):x)}}return q}function me(e){if(!e)return null;const n=e.extent;if(!n)return null;const i=e.spatialReference&&I(e.spatialReference);if(!i)return n;const[r,t]=i.valid,l=2*t,{width:o}=n;let s,{xmin:a,xmax:f}=n;if([a,f]=[f,a],e.type==="extent"||o===0||o<=t||o>l||a<r||f>t)return n;switch(e.type){case"polygon":if(!(e.rings.length>1))return n;s=J(e.rings);break;case"polyline":if(!(e.paths.length>1))return n;s=J(e.paths);break;case"multipoint":s=e.points}const u=n.clone();for(let m=0;m<s.length;m++){let p=s[m][0];p<0?(p+=t,f=Math.max(p,f)):(p-=t,a=Math.min(p,a))}return u.xmin=a,u.xmax=f,u.width<o?(u.xmin-=t,u.xmax-=t,u):n}function ye(e,n,i){const r=I(i);if(r==null)return e;const[t,l]=r.valid,o=2*l;let s=0,a=0;n>l?s=Math.ceil(Math.abs(n-l)/o):n<t&&(s=-Math.ceil(Math.abs(n-t)/o)),e>l?a=Math.ceil(Math.abs(e-l)/o):e<t&&(a=-Math.ceil(Math.abs(e-t)/o));let f=e+(s-a)*o;const u=f-n;return u>l?f-=o:u<t&&(f+=o),f}function xe(e,n){var i;return((i=H(n))==null?void 0:i.normalize(e))??e}function H(e){const n=I(e);if(n==null)return null;const[i,r]=n.valid;return new V(i,r)}const de=H(D.WGS84);H(D.WebMercator);export{le as D,ce as Y,me as f,de as h,xe as p,ye as u};
