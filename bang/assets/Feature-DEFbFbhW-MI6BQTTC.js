import{i as p,I as Q,u as B}from"./TimeOnly-BFfVS_ja-C4MPGwCM.js";import{A as N,U as K,d as q,y as H,O as k,l as Z,j as S,m as z,a6 as W,$ as G,w as c,a7 as X}from"./Dictionary-B0UU8VOj-BnHchtFP.js";import{c as l}from"./enum-D3e-PyKo-Bl5V5br5.js";import{b5 as L,bm as F,s as Y,z as ee,w as te,K as ie,B as A,c0 as C}from"./index-BeTPrQ6f.js";import{u as se}from"./featureConversionUtils-CZmIxyv5-DHwRSztU.js";import{o as ne}from"./FieldsIndex-Ds4D9xP7-BiTuE5Z3.js";import"./UnknownTimeZone-DzO8gKMe-d6rtFXqm.js";import"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import"./shared-DXZ65waB-BM-XH3jC.js";import"./Field-Dn1Bgq7n-CJCGLoNR.js";import"./fieldType-DvW5hpfa-DYUbIy_X.js";import"./number-BsNxu9Ry-D0lLRJTw.js";import"./OptimizedFeature-C33SioFK-sn7DeAq-.js";import"./memoryEstimations-C_GUL8g_-JniNFd5l.js";import"./OptimizedGeometry-BYxlP_oK-DvAqrgO1.js";import"./OptimizedFeatureSet-Dz5hF8Qm-CgsRgxJh.js";import"./timeZoneUtils-CdK7eU4Y-fyhJ3EFx.js";function re(e,i,s=null){const t=P(e,!0);if(t.hasm!==void 0&&(t.hasM=t.hasm,delete t.hasm),t.hasz!==void 0&&(t.hasZ=t.hasz,delete t.hasz),t.spatialreference!==void 0&&(t.spatialReference=t.spatialreference,delete t.spatialreference),t.spatialReference||(t.spatialReference=i),t.curverings!==void 0){const n=T(t.curverings,t.hasZ,t.hasM,O);if(n==null)return null;t.curveRings=n.arrays,delete t.curverings,delete t.rings,t.hasZ=n.hasZ,t.hasM=n.hasM}else if(t.rings!==void 0){const n=T(t.rings,t.hasZ,t.hasM,f);if(n==null)return null;t.rings=n.arrays,t.hasZ=n.hasZ,t.hasM=n.hasM}if(t.curvepaths!==void 0){const n=T(t.curvepaths,t.hasZ,t.hasM,O);if(n==null)return null;t.curvePaths=n.arrays,delete t.curvepaths,delete t.paths,t.hasZ=n.hasZ,t.hasM=n.hasM}else if(t.paths!==void 0){const n=T(t.paths,t.hasZ,t.hasM,f);if(n==null)return null;t.paths=n.arrays,t.hasZ=n.hasZ,t.hasM=n.hasM}if(t.points!==void 0){const n=pe(t.points,t.hasZ,t.hasM);if(n==null)return null;t.points=n.array,t.hasZ=n.hasZ,t.hasM=n.hasM}const r=F(t);if(s!=null&&(r==null?void 0:r.type)!==s)throw new l(null,"InvalidParameter",null);return r}function P(e,i=!1){const s={};for(const t of e.keys()){const r=i?t.toLowerCase():t,n=e.attributes[t];s[r]=G(n)?P(n):n}return s}const v=Symbol("NoValue");function g(e){return Array.isArray(e)&&e.length>0?e[0]:c(e)&&e.length()>0?e.get(0):v}function ae(e){const i=g(g(e));return i===v||Array.isArray(i)||c(i)||i instanceof A?e:[e]}const w=0;function R(e){return C(e,w)??w}function U(e){return typeof e=="number"&&!Number.isNaN(e)}const x=null;function $(e){return C(e,x)??x}function J(e){return typeof e=="number"&&!Number.isNaN(e)||e===null}function D(e){return!(e.length<2)&&typeof e[0]=="number"&&!Number.isNaN(e[0])&&typeof e[1]=="number"&&!Number.isNaN(e[1])}function b(e){return D(e)?e.length>2?e.slice(0,2):e:null}function le(e){return D(e)?U(e[2])?e.length>3?e.slice(0,3):e:[e[0],e[1],R(e[2])]:null}function oe(e){return D(e)?e.length>=3&&!J(e[2])?[e[0],e[1],$(e[2])]:e.length>3?e.slice(0,3):e:null}function ue(e){return D(e)?U(e[2])&&J(e[3])?e.length>4?e.slice(0,4):e:[e[0],e[1],R(e[2]),$(e[3])]:null}function _(e){return[e.x,e.y]}function fe(e){return[e.x,e.y,e.z??w]}function ce(e){return[e.x,e.y,e.m??x]}function he(e){return[e.x,e.y,e.z??w,e.m??x]}function de(e,i,s){if(c(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==2)throw new l(null,"InvalidParameter",null);const t=f(e[0],i,s);if(t==null)return null;const r=f(e[1],_,b);return r==null?null:{c:[t,r]}}function ye(e,i,s){if(c(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==4&&e.length!==7)throw new l(null,"InvalidParameter",null);const t=f(e[0],i,s);if(t==null)return null;const r=f(e[1],_,b);if(r==null)return null;const n=e[2];if(n!==0&&n!==1)throw new l(null,"InvalidParameter",null);const a=e[3];if(a!==0&&a!==1)throw new l(null,"InvalidParameter",null);if(e.length===4)return{a:[t,r,n,a]};const o=e[4];if(typeof o!="number")throw new l(null,"InvalidParameter",null);if(Number.isNaN(o))return null;const y=e[5];if(typeof y!="number")throw new l(null,"InvalidParameter",null);if(Number.isNaN(y))return null;const h=e[6];if(typeof h!="number")throw new l(null,"InvalidParameter",null);return Number.isNaN(h)?null:{a:[t,r,n,a,o,y,h]}}function me(e,i,s){if(c(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==3)throw new l(null,"InvalidParameter",null);const t=f(e[0],i,s);if(t==null)return null;const r=f(e[1],_,b);if(r==null)return null;const n=f(e[2],_,b);return n==null?null:{b:[t,r,n]}}function j(e,i){return e?i?ue:le:i?oe:b}function V(e,i){return e?i?he:fe:i?ce:_}function f(e,i,s){return Array.isArray(e)?s(e):e instanceof A?i(e):c(e)?s(e.toArray()):null}function O(e,i,s){return Array.isArray(e)?s(e):G(e)?e.hasField("c")?de(e.field("c"),i,s):e.hasField("a")?ye(e.field("a"),i,s):e.hasField("b")?me(e.field("b"),i,s):null:e instanceof A?i(e):c(e)?s(e.toArray()):null}function I(e,i,s,t){const r=[];if(Array.isArray(e))for(const n of e){const a=i(n,s,t);a!=null&&r.push(a)}else if(c(e))for(let n=0;n<e.length();n++){const a=i(e.get(n),s,t);a!=null&&r.push(a)}return r}function m(e,i,s){return Array.isArray(e)?e.length>=i:c(e)?e.length()>=i:e instanceof A&&e[s]}function E(e,i,s){return e===void 0&&i===void 0?{hasZ:m(s,3,"hasZ"),hasM:m(s,4,"hasM")}:e===void 0?i===!0?{hasZ:m(s,4,"hasZ"),hasM:!0}:{hasZ:m(s,3,"hasZ"),hasM:!1}:i===void 0?e===!0?{hasZ:!0,hasM:m(s,4,"hasM")}:{hasZ:!1,hasM:m(s,3,"hasM")}:{hasZ:e===!0,hasM:i===!0}}function pe(e,i,s){const t=g(e);if(t===v)return null;const{hasZ:r,hasM:n}=E(i,s,t);return{array:I(e,f,V(r,n),j(r,n)),hasZ:r,hasM:n}}function T(e,i,s,t){const r=g(g(e=ae(e)));if(r===v)return null;const{hasZ:n,hasM:a}=E(i,s,r),o=V(n,a),y=j(n,a),h=[];if(Array.isArray(e))for(let d=0;d<e.length;d++)h.push(I(e[d],t,o,y));else if(c(e))for(let d=0;d<e.length();d++)h.push(I(e.get(d),t,o,y));return{arrays:h,hasZ:n,hasM:a}}function ge(e){switch(e.type){case"small-integer":case"esriFieldTypeSmallInteger":case"integer":case"esriFieldTypeInteger":case"single":case"esriFieldTypeSingle":case"double":case"esriFieldTypeDouble":case"big-integer":case"esriFieldTypeBigInteger":case"long":case"esriFieldTypeLong":case"oid":case"esriFieldTypeOID":return{name:e.name,type:"number"};case"global-id":case"esriFieldTypeGlobalID":case"guid":case"esriFieldTypeGUID":case"string":case"esriFieldTypeString":return{name:e.name,type:"text"};case"date":case"esriFieldTypeDate":case"timestamp-offset":case"esriFieldTypeTimestampOffset":return{name:e.name,type:"date"};case"date-only":case"esriFieldTypeDateOnly":return{name:e.name,type:"dateOnly"};case"time-only":case"esriFieldTypeTimeOnly":return{name:e.name,type:"time"};default:return null}}function M(e,i,s){if(e==null)return null;switch(i){case"time-only":return S(e)?e:B.fromReader(e.toString());case"date-only":return z(e)?e:Q.fromReader(e.toString());case"timestamp-offset":return Z(e)?e:p.fromReaderAsTimeStampOffset(e.toString());case"date":return Z(e)?e:ie(e)?p.dateJSAndZoneToArcadeDate(e,s):p.epochToArcadeDate(e,s);case"geometry":return null;default:return e}}class u{constructor(){this.arcadeDeclaredClass="esri.arcade.Feature",this._optimizedGeomDefinition=null,this._geometry=null,this.attributes=null,this._layer=null,this._fieldTypesFixed=!0,this.fieldsIndex=null,this.contextTimeZone=null,this.immutable=!0,this._fieldsToFixDataTypes=null,this.immutable=!0}static createFromGraphic(i,s){const t=new u;return t.contextTimeZone=s??null,t._geometry=i.geometry!=null?i.geometry:null,i.attributes===void 0||i.attributes===null?t.attributes={}:t.attributes=i.attributes,i._sourceLayer?(t._layer=i._sourceLayer,t._fieldTypesFixed=!1):i._layer?(t._layer=i._layer,t._fieldTypesFixed=!1):i.layer&&"fields"in i.layer?(t._layer=i.layer,t._fieldTypesFixed=!1):i.sourceLayer&&"fields"in i.sourceLayer&&(t._layer=i.sourceLayer,t._fieldTypesFixed=!1),t._layer&&!t._fieldTypesFixed&&(t.fieldsIndex=this.hydrateFieldsIndex(t._layer)),t}static createFromArcadeFeature(i){if(i instanceof u){const t=new u;return t._fieldTypesFixed=i._fieldTypesFixed,t.attributes=i.attributes,t._geometry=i._geometry,t._optimizedGeomDefinition=i._optimizedGeomDefinition,i._layer&&(t._layer=i._layer),t.fieldsIndex=i.fieldsIndex,t.contextTimeZone=i.contextTimeZone,t}const s={};for(const t of i.keys())s[t]=i.field(t);return u.createFromGraphicLikeObject(i.geometry(),s,i.fullSchema(),i.contextTimeZone)}static createFromOptimisedFeature(i,s,t){const r=new u;return r._geometry=i.geometry?{geometry:i.geometry}:null,r._optimizedGeomDefinition=t,r.attributes=i.attributes||{},r._layer=s,r._fieldTypesFixed=!1,r}static createFromArcadeDictionary(i,s){const t=new u;return t.attributes=i.field("attributes"),t.attributes!==null&&t.attributes instanceof N?(t.attributes=t.attributes.attributes,t.attributes===null&&(t.attributes={})):t.attributes={},t._geometry=i.field("geometry"),t._geometry!==null&&(t._geometry instanceof N?t._geometry=re(t._geometry,s):t._geometry instanceof L||(t._geometry=null)),t}static createFromGraphicLikeObject(i,s,t=null,r){const n=new u;return n.contextTimeZone=r??null,s===null&&(s={}),n.attributes=s,n._geometry=i??null,n._layer=t,n._layer&&(n._fieldTypesFixed=!1,n.fieldsIndex=this.hydrateFieldsIndex(n._layer)),n}static hydrateFieldsIndex(i){return i===null?null:K(i)?i.getFieldsIndex():i.fieldsIndex?i.fieldsIndex:ne.fromLayerJSON({datesInUnknownTimezone:i.datesInUnknownTimezone,fields:i.fields,timeInfo:i.timeInfo,editFieldsInfo:i.editFieldsInfo,dateFieldsTimeReference:i.dateFieldsTimeReference??{timeZone:"UTC",respectsDaylightSaving:!1}})}repurposeFromGraphicLikeObject(i,s,t=null){s===null&&(s={}),this.attributes=s,this._geometry=i??null,this._layer=t,this._layer?this._fieldTypesFixed=!1:this._fieldTypesFixed=!0}castToText(i=!1){this._fieldTypesFixed===!1&&this._fixFieldTypes();const s=q(this.attributes,{useNumbersForDates:i});return'{"geometry":'+(this.geometry()===null?"null":H(this.geometry()))+',"attributes":'+s+"}"}_fixFieldTypes(){var t;if(this._fieldsToFixDataTypes&&((t=this._fieldsToFixDataTypes)==null?void 0:t.length)>0)return this._fixAllFields(this._fieldsToFixDataTypes),void(this._fieldTypesFixed=!0);const i=[],s=this._layer.fields;for(let r=0;r<((s==null?void 0:s.length)??0);r++){const n=s[r],{name:a,type:o}=n;switch(o){case"date":case"esriFieldTypeDate":i.push({field:a,dataType:"date"});break;case"date-only":case"esriFieldTypeDateOnly":i.push({field:a,dataType:"date-only"});break;case"time-only":case"esriFieldTypeTimeOnly":i.push({field:a,dataType:"time-only"});break;case"timestamp-offset":case"esriFieldTypeTimestampOffset":i.push({field:a,dataType:"timestamp-offset"});break;case"geometry":case"esriFieldTypeGeometry":i.push({field:a,dataType:"geometry"})}}this._fieldsToFixDataTypes=i,i.length>0&&this._fixAllFields(i),this._fieldTypesFixed=!0}isUnknownDateTimeField(i){var s;return((s=this.fieldsIndex)==null?void 0:s.getTimeZone(i))==="unknown"}_fixAllFields(i){this.attributes={...this.attributes};const s=this.contextTimeZone??"system";for(let t=0;t<i.length;t++){const r=i[t].field,n=i[t].dataType;let a=this.attributes[r];if(a===void 0){for(const o in this.attributes)if(o.toLowerCase()===r.toLowerCase()){a=this.attributes[o],this.attributes[o]=M(a,n,this.isUnknownDateTimeField(o)?"unknown":s);break}}else a!==null&&(this.attributes[r]=M(a,n,this.isUnknownDateTimeField(r)?"unknown":s))}}geometry(){return this._geometry===null||this._geometry instanceof L||(this._optimizedGeomDefinition?(this._geometry=F(se(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM)),this._geometry.spatialReference=this._optimizedGeomDefinition.spatialReference):this._geometry=F(this._geometry)),this._geometry}field(i){this._fieldTypesFixed||this._fixFieldTypes();const s=this.attributes[i];if(s!==void 0)return s;const t=i.toLowerCase();for(const r in this.attributes)if(r.toLowerCase()===t)return this.attributes[r];if(this._hasFieldDefinition(t))return null;throw new l(null,"FieldNotFound",null,{key:i})}_hasFieldDefinition(i){if(this._layer===null)return!1;for(let s=0;s<this._layer.fields.length;s++)if(this._layer.fields[s].name.toLowerCase()===i)return!0;return!1}setField(i,s){if(this.immutable)throw new l(null,"Immutable",null);if(s instanceof Date&&(s=this.isUnknownDateTimeField(i)?p.unknownDateJSToArcadeDate(s):p.dateJSToArcadeDate(s)),k(s)===!1)throw new l(null,"TypeNotAllowedInFeature",null);const t=i.toLowerCase();if(this.attributes[i]===void 0){for(const r in this.attributes)if(r.toLowerCase()===t)return void(this.attributes[r]=s);this.attributes[i]=s}else this.attributes[i]=s}hasField(i){const s=i.toLowerCase();if(this.attributes[i]!==void 0)return!0;for(const t in this.attributes)if(t.toLowerCase()===s)return!0;return!!this._hasFieldDefinition(s)}keys(){let i=[];const s={};for(const t in this.attributes)i.push(t),s[t.toLowerCase()]=1;if(this._layer!==null)for(let t=0;t<this._layer.fields.length;t++){const r=this._layer.fields[t];s[r.name.toLowerCase()]!==1&&i.push(r.name)}return i=i.sort(),i}isEmpty(){for(const i in this.attributes)return!1;return!(this._layer!=null&&this._layer.fields.length>0)&&this.geometry()==null}static parseAttributesFromDictionary(i){const s={};for(const t in i.attributes){const r=i.attributes[t];if(!k(r))throw new l(null,"InvalidParameter",null);s[t]=r}return s}static fromJson(i,s){let t=null;i.geometry!==null&&i.geometry!==void 0&&(t=F(i.geometry));const r={};if(i.attributes!==null&&i.attributes!==void 0)for(const n in i.attributes){const a=i.attributes[n];if(a===null)r[n]=a;else{if(!(Y(a)||ee(a)||te(a)||Z(a)||S(a)||z(a)))throw new l(null,"InvalidParameter",null);r[n]=a}}return u.createFromGraphicLikeObject(t,r,null,s??null)}fullSchema(){return this._layer}gdbVersion(){var s;if(this._layer===null)return"";const i=this._layer.gdbVersion;return i===void 0?"":i===""&&((s=this._layer.capabilities)!=null&&s.isVersioned)?"SDE.DEFAULT":i}castAsJson(i){var t;const s={attributes:{},geometry:(i==null?void 0:i.keepGeometryType)===!0?this.geometry():((t=this.geometry())==null?void 0:t.toJSON())??null};for(const r in this.attributes){const n=this.attributes[r];n!==void 0&&(s.attributes[r]=W(n,i))}return s}async castAsJsonAsync(i=null,s){return this.castAsJson(s)}}X(u);const ze=Object.freeze(Object.defineProperty({__proto__:null,Feature:u,convertAttributeToArcadeValue:M,getArcadeVariableForField:ge},Symbol.toStringTag,{value:"Module"}));export{ge as D,ze as F,u as I,re as a,M as w};
