import{l as N,r as T}from"./enum-g1DWyQyu-Ak-qLf19.js";import{i as z,I as tn,u as nn,m as en}from"./TimeOnly-CGkId3bj-JDOpcZSO.js";import{aT as rn,l as q,j as m,k as b,G as S,i as v,Z as ft,B as ht,m as dt,o as mt,b8 as I,bP as Jt,ce as sn,z as W,cj as an,ar as on,f as ln,aB as zt,ch as un,cd as cn,v as w,S as C,n as pt,$ as fn,X as yt,h as hn,a6 as dn,bq as mn,N as pn,D as yn}from"./index-CQ8-0QQp.js";import{n as M}from"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import{v as gn,h as Lt}from"./shared-DttuBH5Z-Bv7AyvY-.js";import{M as bn,z as Sn}from"./number-mnL_JN3f-tG8t-bWU.js";import{t as _n}from"./commonProperties-D1Pjvz5u-DHiB1uzW.js";import{J as wn,m as Nn,d as Tn}from"./utils-BO8hgPs3-DAcioTpx.js";import"./UnknownTimeZone-DxjyzFvs-Bj2Ovyjw.js";import"./Field-BIQ-quF4-kqmmAHwF.js";import"./fieldType-PhcL4ff8-X0HNaUrC.js";function vn(t){if(typeof t=="string")return t.toLowerCase();if("name"in t)return t.name.toLowerCase();if(typeof t.value!="string")throw new N(null,T.InvalidIdentifier,null);return t.value.toLowerCase()}const ye=Object.freeze({aborted:!1});let gt=class{};class B{constructor(){}}function It(t,n,e){if(t instanceof B&&!(t instanceof it)){const r=new it;return r.fn=t,r.parameterEvaluator=e,r.context=n,r}return t}let ge=class extends B{constructor(t){super(),this.fn=t}createFunction(t){return(...n)=>this.fn(t,{preparsed:!0,arguments:n})}call(t,n){return this.fn(t,n)}marshalledCall(t,n,e,r){return r(t,n,(s,a,i)=>{i=i.map(u=>u instanceof B&&!(u instanceof it)?It(u,t,r):u);const o=this.call(e,{args:i});return rn(o)?o.then(u=>It(u,e,r)):o})}},it=class extends B{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(t){return this.fn.createFunction(this.context)}call(t,n){return this.fn.marshalledCall(t,n,this.context,this.parameterEvaluator)}marshalledCall(t,n,e){return this.fn.marshalledCall(t,n,this.context,this.parameterEvaluator)}},K=class Yt extends M{constructor(n,e,r,s,a,i){super(n),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=e,this._hasZ=r,this._hasM=s,this._cacheId=a,this._partId=i}get(n){if(this._lazyPt[n]===void 0){const e=this._elements[n];if(e===void 0)return;const r=new q(e[0],e[1],this._spRef);this._hasZ&&(r.z=e[2]),this._hasM&&(r.m=this._hasZ?e[3]:e[2]),r.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+n.toString(),this._lazyPt[n]=r}return this._lazyPt[n]}equalityTest(n){return n===this||n!==null&&n instanceof Yt&&n.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}};class bt extends M{constructor(n,e,r,s,a){super(n),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=e,this._cacheId=a}get(n){if(this._lazyPath[n]===void 0){const e=this._elements[n];if(e===void 0)return;this._lazyPath[n]=new K(e,this._spRef,this._hasZ,this._hasM,this._cacheId,n)}return this._lazyPath[n]}equalityTest(n){return n===this||n!==null&&n instanceof bt&&n.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}let xn=class{constructor(t){this.value=t}};class Cn{constructor(n){this.value=n}}const _={type:"VOID"},Zn=Symbol("BREAK"),kn=Symbol("CONTINUE");function E(t,n,e){return n===""||n==null||n===e||n===e?t:t=t.split(n).join(e)}function V(t){return t instanceof B}function St(t){return t instanceof gt}function G(t){return!!m(t)||!!b(t)||!!f(t)||!!y(t)||!!g(t)||!!S(t)||t===null||t===_||typeof t=="number"}function An(t,n){return t===void 0?n:t}function On(t){return t==null?"":v(t)||k(t)?"Array":f(t)?"Date":g(t)?"Time":y(t)?"DateOnly":m(t)?"String":S(t)?"Boolean":b(t)?"Number":(t==null?void 0:t.declaredClass)==="esri.arcade.Attachment"?"Attachment":(t==null?void 0:t.declaredClass)==="esri.arcade.Portal"?"Portal":(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?"Dictionary":vt(t)?"KnowledgeGraph":t instanceof gt?"Module":X(t)?"Feature":t instanceof q?"Point":t instanceof ft?"Polygon":t instanceof ht?"Polyline":t instanceof dt?"Multipoint":t instanceof mt?"Extent":V(t)?"Function":wt(t)?"FeatureSet":Tt(t)?"FeatureSetCollection":_t(t)?"Voxel":t===_?"":typeof t=="number"&&isNaN(t)?"Number":"Unrecognized Type"}function Dn(t){return t===_}function et(t){return t instanceof I}function X(t){return(t==null?void 0:t.arcadeDeclaredClass)==="esri.arcade.Feature"}function _t(t){return(t==null?void 0:t.arcadeDeclaredClass)==="esri.arcade.Voxel"}function wt(t){return(t==null?void 0:t.declaredRootClass)==="esri.arcade.featureset.support.FeatureSet"}function Nt(t){return(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"}function Fn(t){return Nt(t)||X(t)||_t(t)}function Tt(t){return(t==null?void 0:t.declaredRootClass)==="esri.arcade.featureSetCollection"}function vt(t){return(t==null?void 0:t.declaredClass)==="esri.rest.knowledgeGraph.KnowledgeGraph"}function k(t){return t instanceof M}function f(t){return t instanceof z}function y(t){return t instanceof tn}function g(t){return t instanceof nn}function ot(t){return t!=null&&typeof t=="object"}function qt(t,n,e,r,s){if(t.length<n||t.length>e)throw new N(r,T.WrongNumberOfParameters,s)}function jn(t){return t<0?-Math.round(-t):Math.round(t)}function xt(t,n){return isNaN(t)||n==null||n===""?t.toString():(n=E(n,"‰",""),n=E(n,"¤",""),Sn(t,{pattern:n}))}function rt(t,n){return n==null||n===""?t.toISOString(!0):t.toFormat(Gt(n),{locale:zt(),numberingSystem:"latn"})}function Gt(t,n=!1){t=t.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let e="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const s of t.match(r)||[])switch(s){case"D":e+="d";break;case"DD":e+="dd";break;case"DDD":e+="o";break;case"d":e+="c";break;case"ddd":e+="ccc";break;case"dddd":e+="cccc";break;case"M":e+="L";break;case"MM":e+="LL";break;case"MMM":e+="LLL";break;case"MMMM":e+="LLLL";break;case"YY":e+="yy";break;case"Y":case"YYYY":e+="yyyy";break;case"Q":e+="q";break;case"Z":e+="Z";break;case"ZZ":e+="ZZ";break;case"ZZZ":e+="ZZZ";break;case"ZZZZ":e+=n?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":e+=n?"[ZZZZZ]":"ZZZZZ";break;case"S":e+="'S'";break;case"SS":e+="'SS'";break;case"SSS":e+="u";break;case"A":case"a":e+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":e+=s;break;default:s.length>=2&&s.slice(0,1)==="["&&s.slice(-1)==="]"?e+=`'${s.slice(1,-1)}'`:e+=`'${s}'`}return e}function l(t,n,e){switch(e){case">":return t>n;case"<":return t<n;case">=":return t>=n;case"<=":return t<=n}return!1}function Mn(t,n,e){if(t===null){if(n===null||n===_)return l(null,null,e);if(b(n))return l(0,n,e);if(m(n)||S(n))return l(0,p(n),e);if(f(n))return l(0,n.toNumber(),e);if(g(n)||y(n))return l(t,n.toNumber(),e)}if(t===_){if(n===null||n===_)return l(null,null,e);if(b(n))return l(0,n,e);if(m(n)||S(n))return l(0,p(n),e);if(f(n))return l(0,n.toNumber(),e);if(g(n)||y(n))return l(t,n.toNumber(),e)}else if(b(t)){if(b(n))return l(t,n,e);if(S(n))return l(t,p(n),e);if(n===null||n===_)return l(t,0,e);if(m(n))return l(t,p(n),e);if(f(n)||g(n)||y(n))return l(t,n.toNumber(),e)}else if(m(t)){if(m(n))return l(j(t),j(n),e);if(f(n)||g(n)||y(n))return l(p(t),n.toNumber(),e);if(b(n))return l(p(t),n,e);if(n===null||n===_)return l(p(t),0,e);if(S(n))return l(p(t),p(n),e)}else if(f(t)){if(f(n))return t.timeZone!==n.timeZone&&(t.isUnknownTimeZone?t=z.arcadeDateAndZoneToArcadeDate(t,n.timeZone):n.isUnknownTimeZone&&(n=z.arcadeDateAndZoneToArcadeDate(n,t.timeZone))),l(t.toNumber(),n.toNumber(),e);if(n===null||n===_)return l(t.toNumber(),0,e);if(b(n))return l(t.toNumber(),n,e);if(S(n)||m(n))return l(t.toNumber(),p(n),e);if(g(n))throw new N(null,T.CannotCompareDateAndTime,null);if(y(n))return l(t.toNumber(),n.toNumber(),e)}else if(S(t)){if(S(n))return l(t,n,e);if(b(n))return l(p(t),p(n),e);if(f(n)||g(n)||y(n))return l(p(t),n.toNumber(),e);if(n===null||n===_)return l(p(t),0,e);if(m(n))return l(p(t),p(n),e)}else if(y(t)){if(f(n))return l(t.toNumber(),n.toNumber(),e);if(n===null||n===_)return l(t.toNumber(),0,e);if(b(n))return l(t.toNumber(),n,e);if(S(n)||m(n))return l(t.toNumber(),p(n),e);if(g(n))throw new N(null,T.CannotCompareDateAndTime,null);if(y(n))return l(t.toNumber(),n.toNumber(),e)}else if(g(t)){if(f(n))throw new N(null,T.CannotCompareDateAndTime,null);if(n===null||n===_)return l(t.toNumber(),0,e);if(b(n))return l(t.toNumber(),n,e);if(S(n)||m(n))return l(t.toNumber(),p(n),e);if(g(n))return l(t.toNumber(),n.toNumber(),e);if(y(n))throw new N(null,T.CannotCompareDateAndTime,null)}return!!Ut(t,n)&&(e==="<="||e===">=")}function Ut(t,n){if(t===n||t===null&&n===_||n===null&&t===_)return!0;if(f(t)&&f(n)||g(t)&&g(n)||y(t)&&y(n))return t.equals(n);if(t instanceof bt||t instanceof K)return t.equalityTest(n);if(t instanceof q&&n instanceof q){const e=t.cache._arcadeCacheId,r=n.cache._arcadeCacheId;if(e!=null)return e===r}return!!(ot(t)&&ot(n)&&(t._arcadeCacheId===n._arcadeCacheId&&t._arcadeCacheId!==void 0&&t._arcadeCacheId!==null||t._underlyingGraphic===n._underlyingGraphic&&t._underlyingGraphic!==void 0&&t._underlyingGraphic!==null))}function Vt(t,{useNumbersForDates:n}){let e="";for(const r in t){e!==""&&(e+=",");const s=t[r];s==null?e+=JSON.stringify(r)+":null":S(s)||b(s)||m(s)?e+=JSON.stringify(r)+":"+JSON.stringify(s):et(s)?e+=JSON.stringify(r)+":"+$(s):g(s)||y(s)?e+=`${JSON.stringify(r)}:${JSON.stringify(s.toString())}`:k(s)||Array.isArray(s)?e+=JSON.stringify(r)+":"+$(s,null,n):f(s)?e+=n?JSON.stringify(r)+":"+JSON.stringify(s.getTime()):JSON.stringify(r)+":"+s.stringify():s!==null&&typeof s=="object"&&"castToText"in s&&(e+=JSON.stringify(r)+":"+s.castToText(n))}return"{"+e+"}"}function j(t,n){if(m(t))return t;if(t===null)return"";if(b(t))return xt(t,n);if(S(t))return t.toString();if(f(t))return rt(t,n);if(g(t)||y(t))return t.toFormat(n);if(t instanceof I)return JSON.stringify(t.toJSON());if(v(t)){const e=[];for(let r=0;r<t.length;r++)e[r]=tt(t[r]);return"["+e.join(",")+"]"}if(t instanceof M){const e=[];for(let r=0;r<t.length();r++)e[r]=tt(t.get(r));return"["+e.join(",")+"]"}return t!==null&&typeof t=="object"&&"castToText"in t?t.castToText():V(t)?"object, Function":t===_?"":St(t)?"object, Module":""}function Jn(t){const n=[];if(t instanceof M){for(let e=0;e<t.length();e++)n[e]=p(t.get(e));return n}if(!v(t))return null;for(let e=0;e<t.length;e++)n[e]=p(t[e]);return n}function $(t,n,e=!1){if(m(t))return t;if(t===null)return"";if(b(t))return xt(t,n);if(S(t))return t.toString();if(f(t))return rt(t,n);if(g(t)||y(t))return t.toFormat(n);if(t instanceof I)return t instanceof mt?'{"xmin":'+t.xmin.toString()+',"ymin":'+t.ymin.toString()+","+(t.hasZ?'"zmin":'+t.zmin.toString()+",":"")+(t.hasM?'"mmin":'+t.mmin.toString()+",":"")+'"xmax":'+t.xmax.toString()+',"ymax":'+t.ymax.toString()+","+(t.hasZ?'"zmax":'+t.zmax.toString()+",":"")+(t.hasM?'"mmax":'+t.mmax.toString()+",":"")+'"spatialReference":'+lt(t.spatialReference)+"}":lt(t.toJSON(),(r,s)=>r.key===s.key?0:r.key==="spatialReference"?1:s.key==="spatialReference"||r.key<s.key?-1:r.key>s.key?1:0);if(v(t)){const r=[];for(let s=0;s<t.length;s++)r[s]=tt(t[s],e);return"["+r.join(",")+"]"}if(t instanceof M){const r=[];for(let s=0;s<t.length();s++)r[s]=tt(t.get(s),e);return"["+r.join(",")+"]"}return t!==null&&typeof t=="object"&&"castToText"in t?t.castToText(e):V(t)?"object, Function":t===_?"":St(t)?"object, Module":""}function tt(t,n=!1){if(t===null)return"null";if(S(t)||b(t)||m(t))return JSON.stringify(t);if(t instanceof I||t instanceof M||Array.isArray(t))return $(t,null,n);if(f(t))return JSON.stringify(n?t.getTime():rt(t,""));if(g(t)||y(t))return JSON.stringify(t.toString());if(t!==null&&typeof t=="object"){if("castToText"in t)return t.castToText(n)}else if(t===_)return"null";return"null"}function p(t,n){return b(t)?t:t===null||t===""?0:f(t)||y(t)||g(t)?NaN:S(t)?t?1:0:v(t)||t===""||t===void 0?NaN:n!==void 0&&m(t)?(n=E(n,"‰",""),n=E(n,"¤",""),bn(t,{pattern:n})):t===_?0:Number(t)}function Ln(t,n){if(f(t))return t;if(m(t)){const e=In(t,n);if(e)return z.dateTimeToArcadeDate(e)}return null}function In(t,n){const e=/ (\d\d)/,r=en(n);let s=Jt.fromISO(t,{zone:r});return s.isValid||e.test(t)&&(t=t.replace(e,"T$1"),s=Jt.fromISO(t,{zone:n}),s.isValid)?s:null}function Pn(t){return S(t)?t:m(t)?(t=t.toLowerCase())==="true":!!b(t)&&t!==0&&!isNaN(t)}function Rn(t,n){const e=JSON.parse(t);return e&&!e.spatialReference&&(e.spatialReference=n),fn(e)}function zn(t,n){return t==null?null:(t.spatialReference!==null&&t.spatialReference!==void 0||(t.spatialReference=n),t)}function Yn(t){if(t===null)return null;if(t instanceof q)return t.x==="NaN"||t.x===null||isNaN(t.x)?null:t;if(t instanceof ft){if((t.curveRings??t.rings).length===0)return null;for(const n of t.curveRings??t.rings)if(n.length>0)return t;return null}if(t instanceof ht){if((t.curvePaths??t.paths).length===0)return null;for(const n of t.curvePaths??t.paths)if(n.length>0)return t;return null}return t instanceof dt?t.points.length===0?null:t:t instanceof mt?t.xmin==="NaN"||t.xmin===null||isNaN(t.xmin)?null:t:null}function Bt(t,n){if(!t||!t.domain)return n;let e=null,r=null;if(f(n))e=n.toNumber();else if(y(n))e=n.toString();else if(g(n))e=n.toStorageString();else if(t.field.type==="string"||t.field.type==="esriFieldTypeString")e=j(n);else{if(n==null)return null;if(n==="")return n;e=p(n)}for(let s=0;s<t.domain.codedValues.length;s++){const a=t.domain.codedValues[s];a.code===e&&(r=a)}return r===null?j(n):r.name}function Et(t,n){if(!t||!t.domain)return n;let e=null;const r=j(n);for(let s=0;s<t.domain.codedValues.length;s++){const a=t.domain.codedValues[s];a.name===r&&(e=a)}return e===null?n:e.code}function st(t,n,e=null,r=null){if(!n||!n.fields)return null;let s,a,i=null;for(let c=0;c<n.fields.length;c++){const d=n.fields[c];d.name.toLowerCase()===t.toString().toLowerCase()&&(i=d)}if(i===null)throw new N(null,T.FieldNotFound,null,{key:t});let o=n.typeIdField,u="id",h=n.types;if(n.subtypeField&&(o=n.subtypeField,u="code",h=n.subtypes??[]),r===null&&e&&o)r=e.hasField(o)?e.field(o):null;else if(o&&r!==null){let c=!1;for(const d of h||[])if(r===d[u]){c=!0;break}if(!c){for(const d of h||[])if(r===d.name){r=d[u],c=!0;break}}c||(r=null,e&&o&&(r=e.hasField(o)?e.field(o):null))}return r!=null&&h.some(c=>{var d;return c[u]===r&&(s=(d=c.domains)==null?void 0:d[i.name],s&&s.type==="inherited"&&(s=Pt(i.name,n),a=!0),!0)}),a||s||(s=Pt(t,n)),{field:i,domain:s}}function Pt(t,n){let e;return n.fields.some(r=>(r.name.toLowerCase()===t.toLowerCase()&&(e=r.domain),!!e)),e}function lt(t,n){n||(n={}),typeof n=="function"&&(n={cmp:n});const e=typeof n.cycles=="boolean"&&n.cycles,r=n.cmp&&(s=n.cmp,function(i){return function(o,u){const h={key:o,value:i[o]},c={key:u,value:i[u]};return s(h,c)}});var s;const a=[];return function i(o){if(o!=null&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o===void 0)return;if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);let u,h;if(Array.isArray(o)){for(h="[",u=0;u<o.length;u++)u&&(h+=","),h+=i(o[u])||"null";return h+"]"}if(o===null)return"null";if(a.includes(o)){if(e)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const c=a.push(o)-1,d=Object.keys(o).sort(r==null?void 0:r(o));for(h="",u=0;u<d.length;u++){const D=d[u],x=i(o[D]);x&&(h&&(h+=","),h+=JSON.stringify(D)+":"+x)}return a.splice(c,1),"{"+h+"}"}(t)}function qn(t){if(t===null)return null;const n=[];for(const e of t)X(e)?n.push(e.geometry()):n.push(e);return n}function U(t,n){if(!(n instanceof q))throw new N(null,T.InvalidParameter,null);t.push(n.hasZ?n.hasM?[n.x,n.y,n.z,n.m]:[n.x,n.y,n.z]:[n.x,n.y])}function Gn(t,n){if(v(t)||k(t)){let e=!1,r=!1,s=[],a=n;if(v(t)){for(const i of t)U(s,i);s.length>0&&(a=t[0].spatialReference,e=t[0].hasZ,r=t[0].hasM)}else if(t instanceof K)s=t._elements,s.length>0&&(e=t._hasZ,r=t._hasM,a=t.get(0).spatialReference);else{if(!k(t))throw new N(null,T.InvalidParameter,null);for(const i of t.toArray())U(s,i);s.length>0&&(a=t.get(0).spatialReference,e=t.get(0).hasZ===!0,r=t.get(0).hasM===!0)}return s.length===0?null:(sn(s)||(s=s.slice().reverse()),new ft({rings:[s],spatialReference:a,hasZ:e,hasM:r}))}return t}function Un(t,n){if(v(t)||k(t)){let e=!1,r=!1,s=[],a=n;if(v(t)){for(const i of t)U(s,i);s.length>0&&(a=t[0].spatialReference,e=t[0].hasZ===!0,r=t[0].hasM===!0)}else if(t instanceof K)s=t._elements,s.length>0&&(e=t._hasZ,r=t._hasM,a=t.get(0).spatialReference);else if(k(t)){for(const i of t.toArray())U(s,i);s.length>0&&(a=t.get(0).spatialReference,e=t.get(0).hasZ===!0,r=t.get(0).hasM===!0)}return s.length===0?null:new ht({paths:[s],spatialReference:a,hasZ:e,hasM:r})}return t}function Vn(t,n){if(v(t)||k(t)){let e=!1,r=!1,s=[],a=n;if(v(t)){for(const i of t)U(s,i);s.length>0&&(a=t[0].spatialReference,e=t[0].hasZ===!0,r=t[0].hasM===!0)}else if(t instanceof K)s=t._elements,s.length>0&&(e=t._hasZ,r=t._hasM,a=t.get(0).spatialReference);else if(k(t)){for(const i of t.toArray())U(s,i);s.length>0&&(a=t.get(0).spatialReference,e=t.get(0).hasZ===!0,r=t.get(0).hasM===!0)}return s.length===0?null:new dt({points:s,spatialReference:a,hasZ:e,hasM:r})}return t}function ut(t,n=!0){if(t==null)return[];if(v(t)){const e=[];for(const r of t){const s=j(r);(n||s!=="")&&e.push(s)}return e}if(k(t)){const e=[];for(let r=0;r<t.length();r++){const s=j(t.get(r));(n||s!=="")&&e.push(s)}return e}if(G(t)){const e=j(t);if(n||e!=="")return[e]}return[]}let at=0;function Bn(t){return at++,at%100==0?(at=0,new Promise(n=>{setTimeout(()=>{n(t)},0)})):t}function En(t,n,e){switch(e){case"&":return t&n;case"|":return t|n;case"^":return t^n;case"<<":return t<<n;case">>":return t>>n;case">>>":return t>>>n}}function Y(t,n=null){return t==null?null:S(t)||b(t)||m(t)?t:t instanceof I?(n==null?void 0:n.keepGeometryType)===!0?t:t.toJSON():t instanceof M?t.toArray().map(e=>Y(e,n)):Array.isArray(t)?t.map(e=>Y(e,n)):W(t)?t:f(t)?t.toJSDate():g(t)?t.toString():y(t)?t.toJSDate():t!==null&&typeof t=="object"&&t.castAsJson!==void 0?t.castAsJson(n):null}async function Hn(t,n,e,r,s){const a=await Ct(t,n,e);s[r]=a}async function Ct(t,n=null,e=null){if(t instanceof M&&(t=t.toArray()),t==null)return null;if(G(t)||t instanceof I||W(t)||f(t))return Y(t,e);if(Array.isArray(t)){const r=[],s=[];for(const a of t)a===null||G(a)||a instanceof I||W(a)||f(a)?s.push(Y(a,e)):(s.push(null),r.push(Hn(a,n,e,s.length-1,s)));return r.length>0&&await Promise.all(r),s}return t!==null&&typeof t=="object"&&t.castAsJsonAsync!==void 0?t.castAsJsonAsync(n,e):null}function Q(t){return Ht(t)?t.parent:t}function Ht(t){return t&&"declaredClass"in t&&t.declaredClass==="esri.layers.support.SubtypeSublayer"}function Kn(t){return t&&"declaredClass"in t&&t.declaredClass==="esri.layers.SubtypeGroupLayer"}function Xn(t,n,e){const r=Q(t.fullSchema());return r===null||!r.fields?null:st(n,r,t,e)}function Qn(t){const n=Q(t.fullSchema());return n===null?null:n.fields?n.subtypeField?{subtypeField:n.subtypeField,subtypes:n.subtypes?n.subtypes.map(e=>({name:e.name,code:e.code})):[]}:n.typeIdField?{subtypeField:n.typeIdField,subtypes:n.types?n.types.map(e=>({name:e.name,code:e.id})):[]}:null:null}function Wn(t,n,e,r){const s=Q(t.fullSchema());if(s===null||!s.fields)return null;const a=st(n,s,t,r);if(e===void 0)try{e=t.field(n)}catch{return null}return Bt(a,e)}function $n(t,n,e,r){const s=Q(t.fullSchema());if(s===null||!s.fields)return null;if(e===void 0){try{e=t.field(n)}catch{return null}return e}return Et(st(n,s,t,r),e)}function te(t){return(t==null?void 0:t.timeZone)??"system"}function ne(t){const n=Q(t.fullSchema());if(n===null||!n.fields)return null;const e=[];for(const r of n.fields)e.push(gn(r));return{objectIdField:n.objectIdField,globalIdField:n.globalIdField??"",geometryType:Lt[n.geometryType]===void 0?"":Lt[n.geometryType],fields:e}}function ee(t,n){const e=z.systemTimeZoneCanonicalName;return t==="system"&&(t=e),{version:Kt,engineVersion:an,timeZone:t,userTimeZone:e,spatialReference:n instanceof on?n.toJSON():n,application:ln.applicationName??"",engine:"web",locale:zt()}}const Kt="1.32",be=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:Cn,ReturnResult:xn,absRound:jn,arcadeVersion:Kt,autoCastArrayOfPointsToMultiPoint:Vn,autoCastArrayOfPointsToPolygon:Gn,autoCastArrayOfPointsToPolyline:Un,autoCastFeatureToGeometry:qn,binaryOperator:En,breakResult:Zn,castAsJson:Y,castAsJsonAsync:Ct,castRecordToText:Vt,continueResult:kn,defaultExecutingContext:ee,defaultTimeZone:te,defaultUndefined:An,equalityTest:Ut,featureDomainCodeLookup:$n,featureDomainValueLookup:Wn,featureFullDomain:Xn,featureSchema:ne,featureSubtypes:Qn,fixNullGeometry:Yn,fixSpatialReference:zn,formatDate:rt,formatNumber:xt,getDomain:st,getDomainCode:Et,getDomainValue:Bt,getType:On,greaterThanLessThan:Mn,isArray:v,isBoolean:S,isDate:f,isDateOnly:y,isDictionary:Nt,isDictionaryLike:Fn,isFeature:X,isFeatureSet:wt,isFeatureSetCollection:Tt,isFunctionParameter:V,isGeometry:et,isGraphic:un,isImmutableArray:k,isInteger:cn,isJsDate:W,isKnowledgeGraph:vt,isModule:St,isNumber:b,isObject:ot,isSimpleType:G,isString:m,isSubtypeGrouplayer:Kn,isSubtypeSublayer:Ht,isTime:g,isVoid:Dn,isVoxel:_t,multiReplace:E,parseGeometryFromJson:Rn,pcCheck:qt,stableStringify:lt,standardiseDateFormat:Gt,tick:Bn,toBoolean:Pn,toDate:Ln,toNumber:p,toNumberArray:Jn,toString:j,toStringArray:ut,toStringExplicit:$,voidOperation:_},Symbol.toStringTag,{value:"Module"}));function Se(t){Xt=t}let Xt;function ct(t){return t===null?null:f(t)?t.clone():G(t)?t:et(t)?t.clone():k(t)?t.toArray().map(n=>ct(n)):v(t)?t.map(n=>ct(n)):X(t)?Xt.createFromArcadeFeature(t):Tt(t)||wt(t)?t:Nt(t)||(t==null?void 0:t.declaredClass)==="esri.arcade.Attachment"?t.deepClone():((t==null?void 0:t.declaredClass)==="esri.arcade.Portal"||vt(t)||t instanceof gt||V(t),t)}function nt(t,n,e=!1,r=!1){if(t==null)return null;if(b(t)||S(t)||m(t)||f(t)||y(t)||g(t))return t;if(v(t)){const a=[];for(const i of t)a.push(nt(i,n,e,r));return a}if(r&&et(t))return t;const s=new O;s.immutable=!1;for(const[a,i]of Object.entries(t))i!==void 0&&s.setField(a,nt(i,n,e,r));return s.immutable=e,s}class O{constructor(n){this.declaredClass="esri.arcade.Dictionary",this.plain=!1,this.immutable=!0,n instanceof O?this.attributes=n.attributes:n==null?this.attributes=Object.create(null):Object.getPrototypeOf(n)!=null?this.attributes={__proto__:null,...n}:this.attributes=n}static containerEntry(n,e){return new O({__proto__:null,key:n,value:e})}static textFormatting(){const n=new O({__proto__:null,newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});return n.immutable=!1,n}field(n){const e=n.toLowerCase(),r=this.attributes[n];if(r!==void 0)return r;for(const s in this.attributes)if(s.toLowerCase()===e)return this.attributes[s];throw new N(null,T.FieldNotFound,null,{key:n})}setField(n,e){if(this.immutable)throw new N(null,T.Immutable,null);if(V(e))throw new N(null,T.NoFunctionInDictionary,null);const r=n.toLowerCase();if(e instanceof Date&&(e=z.dateJSToArcadeDate(e)),this.attributes[n]===void 0){for(const s in this.attributes)if(s.toLowerCase()===r)return void(this.attributes[s]=e);this.attributes[n]=e}else this.attributes[n]=e}hasField(n){const e=n.toLowerCase();if(this.attributes[n]!==void 0)return!0;for(const r in this.attributes)if(r.toLowerCase()===e)return!0;return!1}keys(){let n=[];for(const e in this.attributes)n.push(e);return n=n.sort(),n}castToText(n=!1){return Vt(this.attributes,{useNumbersForDates:n})}static convertObjectToArcadeDictionary(n,e,r=!0,s=!1){const a=new O;a.immutable=!1;for(const i in n){const o=n[i];o!==void 0&&a.setField(i.toString(),nt(o,e,r,s))}return a.immutable=r,a}static convertJsonToArcade(n,e,r=!1,s=!1){return nt(n,e,r,s)}castAsJson(n=null){const e=Object.create(null);for(let r in this.attributes){const s=this.attributes[r];s!==void 0&&(n!=null&&n.keyTranslate&&(r=n.keyTranslate(r)),e[r]=Y(s,n))}return e}async castDictionaryValueAsJsonAsync(n,e,r,s=null,a){const i=await Ct(r,s,a);return n[e]=i,i}async castAsJsonAsync(n=null,e=null){const r=Object.create(null),s=[];for(let a in this.attributes){const i=this.attributes[a];e!=null&&e.keyTranslate&&(a=e.keyTranslate(a)),i!==void 0&&(G(i)||i instanceof I||i instanceof z?r[a]=Y(i,e):s.push(this.castDictionaryValueAsJsonAsync(r,a,i,n,e)))}return s.length>0&&await Promise.all(s),r}deepClone(){const n=new O;n.immutable=!1;for(const e of this.keys())n.setField(e,ct(this.field(e)));return n}}let F=class extends yt{constructor(t){super(t),this.text=null,this.detectedLanguage="en",this.detectedLanguageScore=-1}};w([C({type:String,json:{write:!0}})],F.prototype,"key",void 0),w([C({type:String,json:{write:!0}})],F.prototype,"text",void 0),w([C({type:String,json:{read:{source:"detectedLanguage.language"},write:{target:"detectedLanguage.language"}}})],F.prototype,"detectedLanguage",void 0),w([C({type:Number,json:{read:{source:"detectedLanguage.score"},write:{target:"detectedLanguage.score"}}})],F.prototype,"detectedLanguageScore",void 0),w([C({type:Object,json:{write:!0}})],F.prototype,"translation",void 0),F=w([pt("esri.rest.support.TranslateResult")],F);async function re(t,n,e){const r=n.toJSON();r.contents=JSON.stringify(r.contents),r.token=await wn(n.portalUrl,n.apiKey,{signal:e==null?void 0:e.signal,prompt:(e==null?void 0:e.authMode)!=="no-prompt"});const s=Nn(t),a=Tn(s.query,{...e,query:r,method:"post",authMode:"anonymous"});return(await pn(s.path,a)).data.results.map(i=>F.fromJSON(i))}let R=class extends yt{constructor(t){super(t)}};w([C({type:String,json:{write:!0}})],R.prototype,"key",void 0),w([C({type:String,json:{write:!0}})],R.prototype,"text",void 0),R=w([pt("esri.rest.support.TranslateContent")],R);let A=class extends yt{constructor(t){super(t),this.to=null,this.contents=null,this.portalUrl="https://www.arcgis.com",this.translator="esri",this.from=null,this.apiKey=null,this.requestSource=null}};w([C({type:[String],json:{write:!0}})],A.prototype,"to",void 0),w([C({type:[R],json:{write:!0}})],A.prototype,"contents",void 0),w([C({type:String,json:{write:!0}})],A.prototype,"portalUrl",void 0),w([C({type:String,json:{write:!0,default:"esri"}})],A.prototype,"translator",void 0),w([C({type:String,json:{write:!0}})],A.prototype,"from",void 0),w([C(_n)],A.prototype,"apiKey",void 0),w([C({type:String,json:{name:"x-esri-request-source"}})],A.prototype,"requestSource",void 0),A=w([pt("esri.rest.support.TranslateParameters")],A);class Zt{constructor(n,e){this.portal=n,this._debugLog=e}async translate(n){var s;this.portal.loaded||await this.portal.load();const e=(s=this.portal.helperServices)==null?void 0:s.aiUtilityServices;if(e==null)return{success:!1};const r=e.url+e.translateUtility;try{return n.requestSource??(n.requestSource="arcade"),{success:!0,results:(await re(r,n,{authMode:"no-prompt"})).map(a=>a.toJSON())}}catch(a){return this._debugLog!=null&&(a instanceof Error||a instanceof hn)&&this._debugLog(`TranslateText error: ${a.message}`),dn.getLogger("esri.arcade.functions.aiServices").error(a),{success:!1}}}}class se{constructor(n,e,r){this._parameters=n,this._maxTotalContentSize=e,this._maxContentsLength=r,this._requests=[],this._normalizedContents=new Map,this._contentsTotalSize=0}tryAdd(n){const e=new Set(n.filter(a=>!this._normalizedContents.has(a.text)).map(a=>a.text));if(this._requests.length+e.size>this._maxContentsLength)return null;let r=0;for(const a of e)r+=a.length;if((r+this._contentsTotalSize)*(this._parameters.to.length??1)>this._maxTotalContentSize)return null;const s=this._requests.length;for(const{key:a,text:i}of n)yn(this._normalizedContents,i,()=>[]).push({batchIdx:s,key:a});return this._requests.push(n),this._contentsTotalSize+=r,s}async send(n){const e=[],r=[];let s=0;for(const[u,h]of this._normalizedContents)e.push(new R({key:String(s++),text:u})),r.push(h);const a=new A(this._parameters);a.contents=e;const i=await n.translate(a);if(!i.success)return Array.from(this._requests,()=>i);const o=Array.from(this._requests,()=>({success:!0,results:[]}));for(const u of i.results){const h=Number(u.key);for(const c of r[h])o[c.batchIdx].results.push({...u,key:c.key})}return o}}function H(t){const n=[...new Set(t.to)].sort(),e=t.from??null,r=t.portalUrl,s=t.translator,a=t.apiKey??null;return JSON.stringify([n,e,r,s,a])}async function Rt(t,n,e){try{return(await t.yieldFor(e))[n]}catch{return{success:!1}}}class Qt{constructor(n,e,{maxTotalContentSize:r=5e4,maxContentsLength:s=1e3}={}){this._executor=n,this._service=e,this._openBatches=new Map,this._maxTotalContentSize=r,this._maxContentsLength=s}create(n){return{translate:async e=>{const r=H(e),{contents:s,to:a,from:i,translator:o,portalUrl:u,apiKey:h}=e;if(a==null)return{success:!1};if(s==null||s.every(x=>x.text.length===0))return{success:!1};const c=this._openBatches.get(r);if(c!=null){const x=c.data.tryAdd(s);if(x!=null)return await Rt(n,x,c);c.send()}const d=new se({to:a,from:i,translator:o,portalUrl:u,apiKey:h},this._maxTotalContentSize,this._maxContentsLength),D=d.tryAdd(s);if(D!=null){const x=this._executor.openBatch(d,{open:P=>{this._openBatches.set(r,P)},execute:P=>P.send(this._service),close:P=>{this._openBatches.get(r)===P&&this._openBatches.delete(r)}});return await Rt(n,D,x)}return await this._service.translate(e)}}}}function Wt(t){t.mode==="async"&&(t.functions[vn("TranslateText")]=function(n,e){return t.standardFunctionAsync(n,e,async(r,s,a)=>{var kt,At,Ot,Dt,Ft,jt;if(qt(a,2,3,r,s),!m(a[0])&&!v(a[0])&&!k(a[0]))throw new N(r,T.InvalidParameter,s);const i=ut(a[0]);if(!m(a[1])&&!v(a[1])&&!k(a[1]))throw new N(r,T.InvalidParameter,s);const o=ut(a[1]);let u=null;if(a.length>=3){if(!m(a[2]))throw new N(r,T.InvalidParameter,s);u=a[2]}const h=i.map((J,Z)=>new R({key:String(Z),text:J})),c=((kt=r.services)==null?void 0:kt.portal)??mn.getDefault(),d=new A({to:o,contents:h,from:u,portalUrl:c.restUrl.replace(/\/sharing\/rest$/,"")}),D=new Map;let x=null;if(r.lrucache!=null){const J=r.lrucache;x??(x=H(d)),d.contents=(At=d.contents)==null?void 0:At.filter(Z=>{const L=J.getCachedTranslation(x,Z.text);return L==null||(D.set(Z.key,{...L,key:Z.key,text:Z.text}),!1)})}if((Ot=d.contents)!=null&&Ot.length){const J=((Dt=r.services)==null?void 0:Dt.translation)??new Zt(c,r.console),Z=await J.translate(d);if(!Z.success)return new O({__proto__:null,success:!1});for(const L of Z.results){const Mt=(jt=(Ft=d.contents)==null?void 0:Ft.find($t=>$t.key===L.key))==null?void 0:jt.text;if(Mt==null)throw new N(null,T.NeverReach,null);D.set(L.key,L),r.lrucache!=null&&(x??(x=H(d)),r.lrucache.setCachedTranslation(x,Mt,{detectedLanguage:L.detectedLanguage,translation:L.translation}))}}const P=Array.from(h,J=>{const Z=F.fromJSON(D.get(J.key));if(Z==null)throw new N(null,T.NeverReach,null);return Z.text=J.text,O.convertJsonToArcade(Z.toJSON(),r.timeZone??"system",!0)});return new O({__proto__:null,success:!0,results:P})})})}const _e=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:Qt,PortalTranslationService:Zt,getTranslateParametersKey:H,registerFunctions:Wt},Symbol.toStringTag,{value:"Module"})),we=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:Qt,PortalTranslationService:Zt,getTranslateParametersKey:H,registerFunctions:Wt},Symbol.toStringTag,{value:"Module"}));export{X as $,g as A,$n as B,st as C,Bt as D,Nt as E,Vt as F,V as G,et as H,_ as I,zn as J,wt as K,Vn as L,Gn as M,p as N,Et as O,Zn as P,Fn as Q,Un as R,Ln as S,Pn as T,Dn as U,ut as V,ne as W,Tt as X,kn as Y,E as Z,Cn as _,qt as a,Bn as a0,Ht as a1,K as a2,bt as a3,G as a4,Y as a5,Se as a6,ct as a7,On as a8,Gt as a9,jn as aa,Yn as ab,_t as ac,Jn as ad,ee as ae,be as af,we as ag,k as b,En as c,Ut as d,ge as e,It as f,gt as g,_e as h,te as i,O as j,Xn as k,Qn as l,Mn as m,ye as n,Wn as o,j as p,An as q,B as r,it as s,vn as t,$ as u,xn as v,qn as w,vt as x,f as y,y as z};
