const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-bSKUKu5m-B44mJjFg.js","./index-CQ8-0QQp.js","./index-CyocM74Y.css","./normalizeUtils-u00NGW3M-Cj_eBFoN.js","./normalizeUtilsCommon-ClagynAA-C1rBYP54.js","./utils-BO8hgPs3-DAcioTpx.js","./utils-DpLVEUvg-WAf4cKk5.js","./Field-BIQ-quF4-kqmmAHwF.js","./fieldType-PhcL4ff8-X0HNaUrC.js","./networkEnums-DHCOt6o_-Cyuk9n4z.js","./FeatureSet-BVGGhhH9-50vSm7H-.js","./GPMessage-KKjIcGuy-FJGeijDm.js","./Relationship-CQMFhJpR-D4XzKj2X.js"])))=>i.map(i=>d[i]);
import{bq as I,j as y,_ as G,i as S,f as j,ar as P,k as O,b8 as T,db as z,z as Y,a_ as J}from"./index-CQ8-0QQp.js";import{t as B}from"./arcade-BoHTeCSG-CpeGzWt7.js";import{a as k,p as W,x as K,q,j as A,i as L,y as D,z as M,A as Q,E as U,H as E}from"./aiServices-u5nRiq9H-IfUSTXBB.js";import{l as c,r as u}from"./enum-g1DWyQyu-Ak-qLf19.js";import{n as C}from"./portalUtils-COohlq76-q5OFIj5j.js";import{k as H,K as Z,O as X}from"./projectionUtils-B-CplN3q-DW663dnS.js";import $ from"./PortalItem-BP-IQXnZ-BVF3QtiG.js";import{o as ee,O as ne}from"./project-TZjL1vJA-B0FmlY3D.js";import{s as te,n as ie,d as oe,a as ae,u as re}from"./Relationship-CQMFhJpR-D4XzKj2X.js";import"./TimeOnly-CGkId3bj-JDOpcZSO.js";import"./UnknownTimeZone-DxjyzFvs-Bj2Ovyjw.js";import"./featureConversionUtils-Bjjlcfdo-CpGOkH2T.js";import"./OptimizedFeature-mIz_HhJg-BomJ3mxO.js";import"./memoryEstimations-DeWfxwaV-D8kkh29b.js";import"./OptimizedGeometry-pzfNw1AT-Ckm1nrtQ.js";import"./OptimizedFeatureSet-Dz5hF8Qm-B1brSkRC.js";import"./FieldsIndex-Bt0Y8aWr-Dy7qhi0q.js";import"./timeZoneUtils-d5p0Jda1-CK3w7ysb.js";import"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import"./shared-DttuBH5Z-Bv7AyvY-.js";import"./Field-BIQ-quF4-kqmmAHwF.js";import"./fieldType-PhcL4ff8-X0HNaUrC.js";import"./WhereClause-D4rZJkVN-BZnvVYD0.js";import"./unitConversion-BxD3RA9Y-BlJdKWE3.js";import"./number-mnL_JN3f-tG8t-bWU.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";import"./commonProperties-D1Pjvz5u-DHiB1uzW.js";import"./utils-BO8hgPs3-DAcioTpx.js";import"./utils-DpLVEUvg-WAf4cKk5.js";let f=null;async function se(e){const n=j.geometryServiceUrl??"";if(!n){H()||await Z();for(const t of e)t.container[t.indexer]=X(t.container[t.indexer],P.WGS84);return}const i=e.map(t=>t.container[t.indexer]),a=new ee({geometries:i,outSpatialReference:P.WGS84}),s=await ne(n,a);for(let t=0;t<s.length;t++){const o=e[t];o.container[o.indexer]=s[t]}}async function F(e,n){const i=new $({portal:e,id:n});return await i.load(),f===null&&(f=await G(()=>import("./knowledgeGraphService-bSKUKu5m-B44mJjFg.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url).then(a=>a.k)),await f.fetchKnowledgeGraph(i.url)}function x(e,n,i,a,s){if(e===null)return null;if(y(e)||O(e))return e;if(D(e)||D(e))return e.toJSDate();if(M(e))return e.toStorageFormat();if(Q(e))return e.toStorageString();if(U(e)){const t={};for(const o of e.keys())t[o]=x(e.field(o),n,i,a,s),t[o]instanceof T&&s.push({container:t,indexer:o});return t}if(S(e)){const t=e.map(o=>x(o,n,i,a,s));for(let o=0;o<t.length;o++)t[o]instanceof T&&s.push({container:t,indexer:o});return t}return E(e)?e.spatialReference.isWGS84?e:e.spatialReference.isWebMercator&&n?z(e):e:void 0}function pe(e,n){if(!e)return e;if(e.spatialReference.isWGS84&&n.spatialReference.isWebMercator)return J(e);if(e.spatialReference.equals(n.spatialReference))return e;throw new c(n,u.WrongSpatialReference,null)}function R(e,n){if(!e)return null;const i={};for(const a in e)i[a]=h(e[a],n);return i}function h(e,n){return e===null?null:S(e)?e.map(i=>h(i,n)):e instanceof ie?{graphTypeName:e.typeName,id:e.id,graphType:"entity",properties:R(e.properties,n)}:e instanceof oe?{graphType:"object",properties:R(e.properties,n)}:e instanceof ae?{graphTypeName:e.typeName,id:e.id,graphType:"relationship",originId:e.originId??null,destinationId:e.destinationId??null,properties:R(e.properties,n)}:e instanceof re?{graphType:"path",path:e.path?e.path.map(i=>h(i,n)):null}:E(e)?pe(e,n):y(e)||O(e)||Y(e)?e:null}function Ve(e){e.mode==="async"&&(e.functions.knowledgegraphbyportalitem=function(n,i){return e.standardFunctionAsync(n,i,(a,s,t)=>{var m,d;if(k(t,2,2,n,i),t[0]===null)throw new c(n,u.PortalRequired,i);if(t[0]instanceof B){const l=W(t[1]);let g;return g=(m=n.services)!=null&&m.portal?n.services.portal:I.getDefault(),F(C(t[0],g),l)}if(y(t[0])===!1)throw new c(n,u.InvalidParameter,i);const o=W(t[0]);return F(((d=n.services)==null?void 0:d.portal)??I.getDefault(),o)})},e.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),e.functions.querygraph=function(n,i){return e.standardFunctionAsync(n,i,async(a,s,t)=>{var b;k(t,2,4,n,i);const o=t[0];if(!K(o))throw new c(n,u.InvalidParameter,i);const m=t[1];if(!y(m))throw new c(n,u.InvalidParameter,i);f===null&&(f=await G(()=>import("./knowledgeGraphService-bSKUKu5m-B44mJjFg.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url).then(r=>r.k));let d=null;const l=q(t[2],null);if(!(l instanceof A||l===null))throw new c(n,u.InvalidParameter,i);if(l){let r=[];d=x(l,!0,!1,n,r),r=r.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),r.length>0&&await se(r)}const g=q(t[3],!1),_=new te({openCypherQuery:m,bindParameters:d,provenanceBehavior:g?"include":"exclude"});(((b=o==null?void 0:o.serviceDefinition)==null?void 0:b.currentVersion)??11.3)>11.2&&(_.outputSpatialReference=n.spatialReference);const N=(await f.executeQueryStreaming(o,_)).resultRowsStream.getReader(),v=[];try{for(;;){const{done:r,value:p}=await N.read();if(r)break;if(S(p))for(const w of p)v.push(h(w,n));else{const w=[];for(const V of p)w.push(h(p[V],n));v.push(w)}}}catch(r){throw r}return A.convertJsonToArcade(v,L(n),!1,!0)})},e.signatures.push({name:"querygraph",min:2,max:4}))}export{Ve as registerFunctions};
