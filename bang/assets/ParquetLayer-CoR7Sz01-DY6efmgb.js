import{bo as _,Q as F,ah as I,a7 as m,as as d,fg as P,ch as c,eO as S,l as T,fj as R,be as j,fk as J,fl as N,bK as E,P as h,F as q,N as g,m as r,E as o,n as x,bP as f,c5 as $,R as z}from"./index-BeTPrQ6f.js";import{M as C}from"./MultiOriginJSONSupport-DNNJhlNT-Bm4fcG4m.js";import{a as D,s as L}from"./GraphicOrigin-BZpgptRb-BMZxic91.js";import{T as Q}from"./workers-CixlqDQM-CMoJ1YZN.js";import{x as U,l as k,u as M,p as G,y}from"./parquetUtils-efARFe0s-tuTN4jBU.js";import{c as V}from"./FeatureSet-BIUKCqNW-D9YRl-VE.js";import{c as W}from"./BlendLayer-D8oJmNCO-A0sTzbOF.js";import{n as B}from"./CustomParametersMixin-CqtpZgix-ZCd9Um94.js";import{I as H}from"./DisplayFilteredLayer-Ce0lf91Z-D_UnOF-a.js";import{c as K}from"./FeatureEffectLayer-Bw8pqFtl-COIpRlV8.js";import{h as X}from"./FeatureReductionLayer-fRVzjp_G-BAykrsM3.js";import{b as Y,i as A,n as Z,t as ee}from"./OperationalLayer-Ds0FQSCg-DEUbTcjK.js";import{p as te}from"./OrderedLayer-BpzV2gVo-B7bag0TS.js";import{r as re}from"./ScaleRangeLayer-DkZwCH6_-C95kTMqN.js";import{v as ie}from"./TemporalLayer-D43PzGI2-BVfMl_Wx.js";import{e as oe}from"./FeatureTemplate-DN-lMS1p-caqKKpFl.js";import{m as se}from"./Field-Dn1Bgq7n-CJCGLoNR.js";import{f as ae}from"./fieldProperties-B4tOVJmv-DQSPMAAi.js";import{i as ne,u as pe}from"./labelingInfo-jIy5P_vY-D8rEl7NY.js";import{_ as le}from"./typeUtils-BTAsL08--B1VjqkPN.js";import{b as v}from"./Query-DKLDaFaA-I4zhlfzt.js";import{y as ue}from"./popupUtils-D0h6TFFF-Bch8GtRu.js";import"./Queue-CK6TduSr-C-T211SM.js";import"./intl-DRhjUnwt-Dihhq8dq.js";import"./messages-DQ10DjvF-6kk0dzjG.js";import"./locationUtils-sOTPEtiz-Bwo0TKFc.js";import"./parquet-BKuoy8EM-tvadAp3d.js";import"./QueueProcessor-Bne-Dlbg-BSQ_6P13.js";import"./ReactiveMap-cp6PWICM-990o5_5b.js";import"./signal-DHxLvooI-Bin-tnuW.js";import"./layerContainerType-CJrPp4UB-BIF7XAYP.js";import"./jsonUtils-Bl9MVnOR-Be8hf0yA.js";import"./parser-CXoJuqeV-C7irlk5U.js";import"./mat4f32-BdRMyjXW-CWt6U0BP.js";import"./mat4-R0VY9B_E-DoEP887i.js";import"./scaleUtils-Ckma21r5-DhwWQymd.js";import"./uuid-CFz2qBzH-cIdlpVG-.js";import"./displayFilterUtils-BCW-UeaE-CnjPWjFU.js";import"./FeatureEffect-xxDa5IRG-DfQBGcCi.js";import"./FeatureFilter-D0iZ4sKI-BBZH0Xo9.js";import"./fieldType-DvW5hpfa-DYUbIy_X.js";import"./FeatureReductionSelection-BYDlwJ5u-CQfZ-i0-.js";import"./jsonUtils-5anAqpiW-BnpEYfRl.js";import"./ClassBreaksRenderer-AH_lBYRG-CIe34emV.js";import"./commonProperties-CYpRbAZr-PcmW9U_y.js";import"./colorRamps-C5pnMn-A-BSSJ2zvJ.js";import"./ColorStop-CBXZUZ6o-_LZdJKea.js";import"./visualVariableUtils-DzY4BXXy-D_1S-x1B.js";import"./lengthUtils-CopeXEyE-DjCEitlq.js";import"./RendererLegendOptions-_ue7FeM0-ROeRce-g.js";import"./LRUCache-CvGiiws0-B3io5Jp4.js";import"./MemCache-TG-MhOJy-BkjKRNR7.js";import"./DictionaryScriptEvaluator-DrG0wIBl-D15kCKMK.js";import"./Version-DSJSGSLA-Cg87msWM.js";import"./FieldsIndex-Ds4D9xP7-BiTuE5Z3.js";import"./UnknownTimeZone-DzO8gKMe-d6rtFXqm.js";import"./timeZoneUtils-CdK7eU4Y-fyhJ3EFx.js";import"./ArcadeExpression-BGPPS6z--7N6gsB31.js";import"./TimeOnly-BFfVS_ja-C4MPGwCM.js";import"./enum-D3e-PyKo-Bl5V5br5.js";import"./utils-CIm5uQvO-CtKf129F.js";import"./defaultCIMValues-BWu-APou-XI-Li77m.js";import"./heatmapUtils-Bf2yRyEN-BAQJ1IRB.js";import"./vec42-DHp-FUwt-Br7hmYJs.js";import"./vec4f64-DD-nkcCV-CSNWKRqG.js";import"./SimpleRenderer-DSyBXxyY-CGNZcXII.js";import"./UniqueValueRenderer-4zUMozui-C0Y5GPGV.js";import"./diffUtils-D3O4EfgX-CznKxD4n.js";import"./styleUtils-DoTsJ8ze-DHY40A2q.js";import"./MD5-CXHDUqXT-CMrYdOi6.js";import"./ElevationInfo-tlrAM5SV-D86C1F9d.js";import"./OrderByInfo-D0eImi6z-Dv2CatL0.js";import"./TimeInfo-BoebCPJB-ubr6IA4W.js";import"./asyncUtils-Cu__bxqs-ecCTUaGV.js";import"./RelationshipQuery-Cf-_aN1Z-mThKQ0J2.js";import"./NormalizationBinParametersMixin-DuEmpnQx-abBJwXnQ.js";import"./labelUtils-BLNYRrPe-Cv1ZZjAO.js";const ye=Symbol("isParquetGraphicOrigin");var O;class me extends D{get[(O=ye,J)](){return this.layer}get[N](){return this.layer}get[L](){return this.layer}constructor(t){super(),this[O]=!0,this.type="parquet",this.layer=t}get id(){return this.layer.id}}let l=class extends E{constructor(e){super(e),this.type="parquet"}load(e){const t=e!=null?e.signal:null;return this.addResolvingPromise(this._initialize(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.destroy()}setCustomParameters(e){this._proxy.setCustomParameters(e).catch(()=>{h.getLogger(this).warn("Failed to update customParameters")})}async updateFiles(e){await this._proxy.updateFiles(e)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._proxy.queryFeatures(e.toJSON(),{signal:t==null?void 0:t.signal})}async queryFeatures(e,t={}){const s=await this.queryFeaturesJSON(e,{signal:t==null?void 0:t.signal});return V.fromJSON(s)}async queryObjectIds(e,t){return await this._proxy.queryObjectIds(e.toJSON(),{signal:t==null?void 0:t.signal})}async queryFeatureCount(e,t){return this._proxy.queryFeatureCount(e.toJSON(),{signal:t==null?void 0:t.signal})}async queryExtent(e,t){if(this.layer.encoding==null)return h.getLogger(this).warn("Tried to queryExtent, but source does not have a geometry. Returning null extent."),{count:0,extent:null};const s=await this._proxy.queryExtent(e.toJSON(),{signal:t==null?void 0:t.signal});return{count:s.count,extent:q.fromJSON(s.extent)}}async _initialize(e){var a,n,p;this._connection=await Q("ParquetSourceWorker",{strategy:"dedicated",signal:e,registryTarget:this}),g(e),this._proxy=this._connection.createInvokeProxy();const{layerDefinition:t,capabilities:s}=await this._proxy.load({urls:this.layer.urls.items,fields:(a=this.layer.fields)==null?void 0:a.map(u=>u.toJSON()),geometryType:this.layer.geometryType?U(this.layer.geometryType):null,spatialReference:(n=this.layer.spatialReference)==null?void 0:n.toJSON(),encoding:(p=this.layer.encoding)==null?void 0:p.toJSON(),displayOptimization:this.layer.displayOptimization,customParameters:this.layer.customParameters});g(e),this.sourceJSON=t,this.capabilities=s}};r([o()],l.prototype,"type",void 0),r([o({constructOnly:!0})],l.prototype,"layer",void 0),r([o()],l.prototype,"sourceJSON",void 0),r([o()],l.prototype,"capabilities",void 0),l=r([x("esri.layers.graphics.sources.ParquetSource")],l);const w=ae(),b="__OBJECTID",de={types:{key:"type",base:G,typeMap:{wkb:M,location:k}},json:{name:"layerDefinition.geometryEncoding",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryEncoding"}}}}};let i=class extends H(X(K(W(te(ie(re(Y(C(B(_(F))))))))))){constructor(e){super(e),this.copyright=null,this.displayOptimization=null,this.fields=null,this.fieldsIndex=null,this.encoding=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new me(this),this.labelsVisible=!0,this.labelingInfo=null,this.objectIdField=b,this.operationalLayerType="ParquetLayer",this.outFields=null,this.persistenceEnabled=!!I("parquetlayer-persistence-enabled"),this.popupTemplate=null,this.source=null,this.spatialReference=null,this.templates=null,this.title="Parquet",this.type="parquet",this.urls=new m}destroy(){var e;(e=this.source)==null||e.destroy()}async load(e){return this.addResolvingPromise(this._load(e)),this.addHandles([d(()=>this.urls,t=>{var s;return(s=this.source)==null?void 0:s.updateFiles(t.items)}),d(()=>this.customParameters,t=>{var s;return(s=this.source)==null?void 0:s.setCustomParameters(t)})]),this}get capabilities(){var e;return(e=this.source)==null?void 0:e.capabilities}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,s,a){const n=e.filter(p=>!(p.name===b&&p.type==="oid")).map(p=>p.toJSON(a));P(s,n,t)}get isTable(){return this.encoding==null}set renderer(e){c(e,this.fieldsIndex),this._set("renderer",e)}readUrls(e){return new m(e.type==="files"?e.urls:[])}writeUrls(e,t,s,a){var p;const n=[];if(e!=null&&e.length){a={blockedRelativeUrls:a==null?void 0:a.blockedRelativeUrls};for(let u of e)u=S(u,a),u&&n.push(u)}n.length?t.source={type:"files",urls:n}:(p=a.messages)==null||p.push(new T("parquet-layer:missing-urls","Missing or empty 'urls'",{layer:this}))}createPopupTemplate(e){return ue(this,e)}createQuery(){const e=new v;return e.returnGeometry=!0,e.outFields=["*"],e}async createSource(e){const t=new l({layer:this});return await t.load(e),t}getFieldDomain(e,t){return null}getField(e){return this.fieldsIndex.get(e)}async queryFeatures(e,t){await this.load();const s=await this.source.queryFeatures(this._normalizeQuery(e),t),a=this.graphicOrigin;if(s!=null&&s.features)for(const n of s.features)n.layer=n.sourceLayer=this,n.origin=a;return s}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(this._normalizeQuery(e),t)}async queryFeatureCount(e,t){return await this.load(),this.source.queryFeatureCount(this._normalizeQuery(e),t)}async queryExtent(e,t){return await this.load(),this.source.queryExtent(this._normalizeQuery(e),t)}_normalizeQuery(e){return v.from(e)??this.createQuery()}async _load(e){const t=await this.createSource(e);this._set("source",t),this.read(t.sourceJSON,{origin:"service"}),this.revert(["fields","timeInfo"],"service"),c(this.renderer,this.fieldsIndex),R(this.timeInfo,this.fieldsIndex),this.spatialReference==null&&(this.spatialReference=j.WGS84)}};r([o({readOnly:!0,json:{read:!1,write:!1}})],i.prototype,"capabilities",null),r([o({type:String})],i.prototype,"copyright",void 0),r([o({readOnly:!0})],i.prototype,"defaultPopupTemplate",null),r([o()],i.prototype,"displayOptimization",void 0),r([o({type:[se],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],i.prototype,"fields",void 0),r([f("fields")],i.prototype,"writeFields",null),r([o(w.fieldsIndex)],i.prototype,"fieldsIndex",void 0),r([o(de)],i.prototype,"encoding",void 0),r([o({type:q,json:{name:"extent"}})],i.prototype,"fullExtent",void 0),r([o({type:y.apiValues,json:{name:"layerDefinition.geometryType",read:{reader:y.read},write:{writer:y.write,ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryType",reader:y.read}}}}})],i.prototype,"geometryType",void 0),r([o({readOnly:!0,clonable:!1})],i.prototype,"graphicOrigin",void 0),r([o(A)],i.prototype,"labelsVisible",void 0),r([o({type:[pe],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:ne},write:!0}})],i.prototype,"labelingInfo",void 0),r([o(Z)],i.prototype,"legendEnabled",void 0),r([o()],i.prototype,"file",void 0),r([o({type:String,readOnly:!0})],i.prototype,"objectIdField",void 0),r([o({type:["ParquetLayer"]})],i.prototype,"operationalLayerType",void 0),r([o(w.outFields)],i.prototype,"outFields",void 0),r([o(ee)],i.prototype,"popupEnabled",void 0),r([o({type:$,json:{name:"popupInfo",write:!0}})],i.prototype,"popupTemplate",void 0),r([o({types:le,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{read:{source:"drawingInfo.renderer"}}}}})],i.prototype,"renderer",null),r([o({type:l,readOnly:!0,cast:null,json:{read:!1}})],i.prototype,"source",void 0),r([o({json:{name:"layerDefinition.spatialReference",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"extent.spatialReference"}}}}})],i.prototype,"spatialReference",void 0),r([o({type:[oe]})],i.prototype,"templates",void 0),r([o()],i.prototype,"title",void 0),r([o({json:{read:!1},readOnly:!0})],i.prototype,"type",void 0),r([o({type:m.ofType(String),json:{name:"source",write:{isRequired:!0,ignoreOrigin:!0}}})],i.prototype,"urls",void 0),r([z("urls")],i.prototype,"readUrls",null),r([f("urls")],i.prototype,"writeUrls",null),i=r([x("esri.layers.ParquetLayer")],i);const Ct=i;export{Ct as default};
